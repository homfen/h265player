!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.h265player=e():t.h265player=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=377)}({0:function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.default=t.exports,t.exports.__esModule=!0},1:function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0},100:function(t,e,n){!function(){"use strict";var e=n(45),r=n(101);function i(t,e){e=e||{};var n,o,a=this,s=i.contextForCanvas(t);if(null===s)throw new Error("WebGL unavailable");function u(t,e){var n=s.createShader(t);if(s.shaderSource(n,e),s.compileShader(n),!s.getShaderParameter(n,s.COMPILE_STATUS)){var r=s.getShaderInfoLog(n);throw s.deleteShader(n),new Error("GL shader compilation for "+t+" failed: "+r)}return n}var c,l,f,h,p,d,y,g,v,m,b=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),_={},w={},E={};function k(t){return _[t]||(_[t]=s.createTexture()),_[t]}function S(t,e,n,r){var o=k(t);if(s.activeTexture(s.TEXTURE0),i.stripe){var a=!_[t+"_temp"],u=k(t+"_temp");s.bindTexture(s.TEXTURE_2D,u),a?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e/4,n,0,s.RGBA,s.UNSIGNED_BYTE,r)):s.texSubImage2D(s.TEXTURE_2D,0,0,0,e/4,n,s.RGBA,s.UNSIGNED_BYTE,r);var c=_[t+"_stripe"],l=!c;l&&(c=k(t+"_stripe")),s.bindTexture(s.TEXTURE_2D,c),l&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,1,0,s.RGBA,s.UNSIGNED_BYTE,function(t){if(E[t])return E[t];for(var e=t,n=new Uint32Array(e),r=0;r<e;r+=4)n[r]=255,n[r+1]=65280,n[r+2]=16711680,n[r+3]=4278190080;return E[t]=new Uint8Array(n.buffer)}(e)))}else s.bindTexture(s.TEXTURE_2D,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,e,n,0,s.LUMINANCE,s.UNSIGNED_BYTE,r)}function x(t,e,n){var r=_[t];s.useProgram(o);var i=w[t];i||(s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,n,0,s.RGBA,s.UNSIGNED_BYTE,null),i=w[t]=s.createFramebuffer()),s.bindFramebuffer(s.FRAMEBUFFER,i),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0);var a=_[t+"_temp"];s.activeTexture(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,a),s.uniform1i(d,1);var u=_[t+"_stripe"];s.activeTexture(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,u),s.uniform1i(p,2),s.bindBuffer(s.ARRAY_BUFFER,c),s.enableVertexAttribArray(l),s.vertexAttribPointer(l,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,f),s.enableVertexAttribArray(h),s.vertexAttribPointer(h,2,s.FLOAT,!1,0,0),s.viewport(0,0,e,n),s.drawArrays(s.TRIANGLES,0,b.length/2),s.bindFramebuffer(s.FRAMEBUFFER,null)}function T(t,e,r){s.activeTexture(e),s.bindTexture(s.TEXTURE_2D,_[t]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.uniform1i(s.getUniformLocation(n,t),r)}function P(t,e){var n=u(s.VERTEX_SHADER,t),r=u(s.FRAGMENT_SHADER,e),i=s.createProgram();if(s.attachShader(i,n),s.attachShader(i,r),s.linkProgram(i),!s.getProgramParameter(i,s.LINK_STATUS)){var o=s.getProgramInfoLog(i);throw s.deleteProgram(i),new Error("GL program linking failed: "+o)}return i}return a.drawFrame=function(u){var _=u.format,w=!n||t.width!==_.displayWidth||t.height!==_.displayHeight;if(w&&(t.width=_.displayWidth,t.height=_.displayHeight,a.clear()),e.autoScale||function(t){var e=t.displayWidth,n=t.displayHeight,r=t.width/t.height;if(r>e/n){var i=-e/r/n;b=new Float32Array([-1,i,1,i,-1,-i,-1,-i,1,i,1,-i])}else{var o=-n*r/e;b=new Float32Array([o,-1,-o,-1,o,1,o,1,-o,-1,-o,1])}}(_),n||function(){if(i.stripe){o=P(r.vertexStripe,r.fragmentStripe),s.getAttribLocation(o,"aPosition"),f=s.createBuffer();var t=new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);s.bindBuffer(s.ARRAY_BUFFER,f),s.bufferData(s.ARRAY_BUFFER,t,s.STATIC_DRAW),h=s.getAttribLocation(o,"aTexturePosition"),p=s.getUniformLocation(o,"uStripe"),d=s.getUniformLocation(o,"uTexture")}n=P(r.vertex,r.fragment),c=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,c),s.bufferData(s.ARRAY_BUFFER,b,s.STATIC_DRAW),l=s.getAttribLocation(n,"aPosition"),y=s.createBuffer(),g=s.getAttribLocation(n,"aLumaPosition"),v=s.createBuffer(),m=s.getAttribLocation(n,"aChromaPosition")}(),w){var E=function(t,e,n){var r=_.cropLeft/n,i=(_.cropLeft+_.cropWidth)/n,o=(_.cropTop+_.cropHeight)/_.height,a=_.cropTop/_.height,u=new Float32Array([r,o,i,o,r,a,r,a,i,o,i,a]);s.bindBuffer(s.ARRAY_BUFFER,t),s.bufferData(s.ARRAY_BUFFER,u,s.STATIC_DRAW)};E(y,0,u.y.stride),E(v,0,u.u.stride*_.width/_.chromaWidth)}S("uTextureY",u.y.stride,_.height,u.y.bytes),S("uTextureCb",u.u.stride,_.chromaHeight,u.u.bytes),S("uTextureCr",u.v.stride,_.chromaHeight,u.v.bytes),i.stripe&&(x("uTextureY",u.y.stride,_.height),x("uTextureCb",u.u.stride,_.chromaHeight),x("uTextureCr",u.v.stride,_.chromaHeight)),s.useProgram(n),s.viewport(0,0,t.width,t.height),T("uTextureY",s.TEXTURE0,0),T("uTextureCb",s.TEXTURE1,1),T("uTextureCr",s.TEXTURE2,2),s.bindBuffer(s.ARRAY_BUFFER,c),s.enableVertexAttribArray(l),s.vertexAttribPointer(l,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,y),s.enableVertexAttribArray(g),s.vertexAttribPointer(g,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,v),s.enableVertexAttribArray(m),s.vertexAttribPointer(m,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLES,0,b.length/2)},a.clear=function(){s.viewport(0,0,t.width,t.height),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT)},a.clear(),a}i.stripe=!1,i.contextForCanvas=function(t){var e={preferLowPowerToHighPerformance:!0,powerPreference:"low-power",failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!0};return t.getContext("webgl",e)||t.getContext("experimental-webgl",e)},i.isAvailable=function(){var t,e=document.createElement("canvas");e.width=1,e.height=1;try{t=i.contextForCanvas(e)}catch(t){return!1}if(t){var n=t.TEXTURE0,r=t.createTexture(),o=new Uint8Array(16),a=i.stripe?1:4,s=i.stripe?t.RGBA:t.LUMINANCE,u=i.stripe?t.NEAREST:t.LINEAR;return t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u),t.texImage2D(t.TEXTURE_2D,0,s,a,4,0,s,t.UNSIGNED_BYTE,o),!t.getError()}return!1},i.prototype=Object.create(e.prototype),t.exports=i}()},101:function(t,e){t.exports={vertex:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aLumaPosition;\nattribute vec2 aChromaPosition;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vLumaPosition = aLumaPosition;\n    vChromaPosition = aChromaPosition;\n}\n",fragment:"// inspired by https://github.com/mbebenita/Broadway/blob/master/Player/canvas.js\n\nprecision lowp float;\n\nuniform sampler2D uTextureY;\nuniform sampler2D uTextureCb;\nuniform sampler2D uTextureCr;\nvarying vec2 vLumaPosition;\nvarying vec2 vChromaPosition;\nvoid main() {\n   // Y, Cb, and Cr planes are uploaded as LUMINANCE textures.\n   float fY = texture2D(uTextureY, vLumaPosition).x;\n   float fCb = texture2D(uTextureCb, vChromaPosition).x;\n   float fCr = texture2D(uTextureCr, vChromaPosition).x;\n\n   // Premultipy the Y...\n   float fYmul = fY * 1.1643828125;\n\n   // And convert that to RGB!\n   gl_FragColor = vec4(\n     fYmul + 1.59602734375 * fCr - 0.87078515625,\n     fYmul - 0.39176171875 * fCb - 0.81296875 * fCr + 0.52959375,\n     fYmul + 2.017234375   * fCb - 1.081390625,\n     1\n   );\n}\n",vertexStripe:"precision lowp float;\n\nattribute vec2 aPosition;\nattribute vec2 aTexturePosition;\nvarying vec2 vTexturePosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 0, 1);\n    vTexturePosition = aTexturePosition;\n}\n",fragmentStripe:"// extra 'stripe' texture fiddling to work around IE 11's poor performance on gl.LUMINANCE and gl.ALPHA textures\n\nprecision lowp float;\n\nuniform sampler2D uStripe;\nuniform sampler2D uTexture;\nvarying vec2 vTexturePosition;\nvoid main() {\n   // Y, Cb, and Cr planes are mapped into a pseudo-RGBA texture\n   // so we can upload them without expanding the bytes on IE 11\n   // which doesn't allow LUMINANCE or ALPHA textures\n   // The stripe textures mark which channel to keep for each pixel.\n   // Each texture extraction will contain the relevant value in one\n   // channel only.\n\n   float fLuminance = dot(\n      texture2D(uStripe, vTexturePosition),\n      texture2D(uTexture, vTexturePosition)\n   );\n\n   gl_FragColor = vec4(fLuminance, fLuminance, fLuminance, 1);\n}\n"}},102:function(t,e,n){"use strict";n.r(e);var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(0),u=n.n(s),c=n(20),l=n.n(c),f=n(14),h=n.n(f),p=n(15),d=n.n(p),y=n(12),g=n.n(y),v=n(13),m=n(23);function b(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w=v.a.get("HTTP.js",{level:2}),E=function(){var t=d()(g.a.mark((function t(e){var n;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof Blob)){t.next=5;break}return t.next=3,new Response(e).arrayBuffer();case 3:return n=t.sent,t.abrupt("return",new Uint8Array(n,0));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var k=function(t){if(t)return Object.entries(t).reduce((function(t,e,n){var r=l()(e,2),i=r[0],o=r[1];return t+(0===n?i+"="+encodeURIComponent(o):"&"+i+"="+encodeURIComponent(o))}),"")};function S(t,e){var n=("function"==typeof t.clone?t.clone():void 0)||t,r=function(t,e){var n={body:e,headers:function(t){return t.headers.entries?function(t){var e,n=Object.create(Object.getPrototypeOf(t.headers)),r=b(t.headers.entries());try{for(r.s();!(e=r.n()).done;){var i=l()(e.value,2),o=i[0],a=i[1];n[o]=a}}catch(t){r.e(t)}finally{r.f()}return n}(t):function(t){var e={},n=t.headers.__headers__;for(var r in n)e[r]=n[r].join("");return e}(t)}(t),response:t,status:t.status,statusText:t.statusText};return t.ok?Promise.resolve(n):Promise.reject(n)};return t[e]().then((function(t){return r(n,t)}))}function x(t,e){var n=t.headers.get("content-type"),r=t.clone().body.getReader(),i=0,o=i,a=setInterval((function(){var t=50*(i-o);t<=1||(w.info("HTTP>handleResponse","".concat(o," | ").concat(i),"".concat(t.toFixed(2)," Bytes/s")),self.postMessage({type:"notice",method:"fetch",noticeType:"speed",data:{speed:t,intervalValue:20,lastReceived:o,bytesReceived:i}}),o=i)}),20);return r.read().then((function o(s){return s.done?(clearInterval(a),function(){if("ts"===e||"video"===e)return S(t,"blob");if(n.includes("json"))return S(t,"json");if(n.includes("text"))return S(t,"text");if(n.includes("form"))return S(t,"formData");if(n.includes("video")||n.includes("image")||n.includes("octet-stream"))return S(t,"blob");try{return S(t,"text")}catch(e){return Object(m.a)(e,"[HTTP>handleResponse:unknow content-type]",n,t),Promise.resolve(t)}}()):(i+=s.value.length,r.read().then(o))}))}var T=null,P=(T||(T=new(function(){function t(e){i()(this,t),u()(this,"options",{"content-type":"application/json;charset=UTF-8",cache:"no-cache",mode:"cors"}),Object.assign(this.options,e)}var e;return a()(t,[{key:"setOptions",value:function(t){var e=Object.assign(this.options,t);e.url=function(t){var e=t.url,n=t.params;return n?e+"?"+k(n):e}(e),e.method=e.method||"get",e.headers=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.headers,n=void 0===e?{}:e,r=t.method,i=void 0===r?"get":r,o=t.username,a=t.password,s=t.token,u=new Headers(n);if(o||a){if(!o)throw new TypeError("username required for basic authentication");if(!a)throw new TypeError("password required for basic authentication");var c="object"===("undefined"==typeof win?"undefined":h()(win))&&win.btoa?btoa:function(t){return t};u.set("Authorization","Basic "+c(o+":"+a))}return s&&u.set("Authorization","Bearer "+s),"get"===i||u.get("content-type")||u.set("content-type","application/json"),u}(e),e.body=function(t){var e=t.headers.get("content-type");if(e)return e.includes("json")?JSON.stringify(t.body):e.includes("x-www-form-urlencoded")?k(t.body):t.body}(e),delete e.username,delete e.password,delete e.token,this.options=e}},{key:"request",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(t)return this.setOptions(Object.assign({url:t},e)),fetch(this.options.url,this.options).then((function(t){return x(t,n)}));w.error("[HTTP>request]","url is undefined","url:",t,"options:",e)}},{key:"fetch",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){var t=d()(g.a.mark((function t(e){var n,r,i,o,a=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},r=a.length>2?a[2]:void 0,i=a.length>3?a[3]:void 0,e){t.next=6;break}return w.wran("[HTTP>fetch]","url is undefined","url:",e,"options:",n),t.abrupt("return");case 6:return this.setOptions(Object.assign({url:e},n)),w.info("[HTTP>fetch]","http fetch","url:",e,"options:",n),t.next=10,fetch(e,n);case 10:(o=t.sent).ok?o.text().then((function(t){self.postMessage({type:"invoke",method:"fetch",fileType:i,name:r,data:t})})):self.postMessage({result:"failed"});case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}())},{key:"get",value:(e=d()(g.a.mark((function t(e){var n,r,i,o,a,s=arguments;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2?s[2]:void 0,i=s.length>3?s[3]:void 0,n.method="get",w.info("[HTTP>get]","http get","url:",e,"options:",n,"name:",r,"fileType:",i),a={type:"invoke",method:"get",fileType:i,name:r,url:e},t.prev=6,t.next=9,this.request.call(this,e,n,i);case 9:o=t.sent,t.next=15;break;case 12:t.prev=12,t.t0=t.catch(6),w.error("[HTTP>get]","networks error","url:",e,"options:",n,"name:",r,"fileType:",i,"ex:",t.t0);case 15:if(!o||!o.body){t.next=24;break}if(a.data=o.body,"ts"!==i&&"video"!==i){t.next=21;break}return t.next=20,E(a.data);case 20:a.arrayBuffer=t.sent;case 21:a.arrayBuffer?self.postMessage(a,[a.arrayBuffer.buffer]):self.postMessage(a),t.next=27;break;case 24:a.type="error",a.data=o,self.postMessage(a);case 27:case"end":return t.stop()}}),t,this,[[6,12]])}))),function(t){return e.apply(this,arguments)})}]),t}())({})),T);e.default=function(t){t.onmessage=function(t){var e=t.data,n=e.type,r=e.method;switch(n){case"invoke":P[r].call(P,e.url,e.options,e.name,e.fileType)}}}},103:function(t,e,n){var r=n(104);"string"==typeof r&&(r=[[t.i,r,""]]);var i={hmr:!0,transform:undefined,insertInto:void 0};n(106)(r,i);r.locals&&(t.exports=r.locals)},104:function(t,e,n){(t.exports=n(105)(!1)).push([t.i,'.goldplay{background:transparent}gp-button{cursor:pointer;font-size:14px}@-webkit-keyframes goldplay-rotate-360{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes goldplay-rotate-360{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.goldplay-btn{border:1px outset;text-align:center;display:inline-block;cursor:pointer}.goldplay-hoverbox{background:rgba(70,70,70,.8);border-radius:3px;visibility:hidden;display:inline-block;position:absolute;font-size:14px}.goldplay-hoverbox ul li{height:24px}.goldplay-hoverbox .gp-selected{color:#f60}.goldplay__container{display:block;z-index:9999;font-family:Arial,Helvetica,sans-serif;background:#000}.goldplay__container-fullpage,.goldplay__container-fullscreen{position:absolute;width:100%;height:100%;line-height:100%;left:0;top:0}.goldplay__container *{-webkit-box-sizing:border-box;box-sizing:border-box}.goldplay__container svg{overflow:auto;-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto;display:inline-block;width:auto;height:auto}.goldplay__container li,.goldplay__container ul{list-style:none}.goldplay__screen--bigplay{z-index:299;opacity:0;-webkit-transition:opacity 1s;transition:opacity 1s}.goldplay__screen--bigplay,.goldplay__screen--poster{color:#fff;text-align:center;font-family:Arial,Helvetica,sans-serif;position:absolute;display:inline-block}.goldplay__screen--poster{vertical-align:middle;z-index:399;opacity:1;-webkit-transition:opacity 2s;transition:opacity 2s}.goldplay__screen--poster-image{margin:auto;text-align:center;vertical-align:middle;-webkit-filter:"";filter:""}.goldplay__screen--poster-speed{display:block}.goldplay__control--container{width:auto;-webkit-box-sizing:border-box;box-sizing:border-box;padding:0 5px;background:transparent;opacity:0;-webkit-transition:opacity 1s;transition:opacity 1s;display:block}.goldplay__control--container-float{position:absolute;margin-top:-50px}.goldplay__control--nearside{padding-top:4px;margin-left:10px;display:block}.goldplay__control--sidebar{padding-top:4px;float:right;display:block}.goldplay__control--container.canvas{position:absolute}.goldplay__screen--container{width:100%;display:block}.goldplay__progress-bar{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;background:hsla(0,15%,90%,.4);height:3px;border-radius:5px;line-height:3px;margin:6px 0;display:inline-block}.goldplay__progress-bar:hover{height:5px;line-height:5px;margin:5px 0;border-top:1px solid transparent}.goldplay__progress-bar:hover .goldplay__progressbar--load,.goldplay__progress-bar:hover .goldplay__progressbar--play{height:5px;line-height:5px;margin-top:-1px}.goldplay__progress-bar-hover{height:5px;line-height:5px;margin:5px 0;border-radius:5px}.goldplay__progressbar--load-hover,.goldplay__progressbar--play-hover{height:5px!important;line-height:5px!important}.goldplay__control--button-block{display:inline-block}.goldplay__control--play{display:none;width:20px}.goldplay__control--replay{display:none;margin:-4px 0 0 -4px}.goldplay__control--pause{display:none;width:20px}.goldplay__control--pause-loading{margin:-5px 0 0 -5px}.goldplay__waiting-bar{position:absolute;text-align:center;color:#fff;z-index:98;display:none;opacity:.7}.goldplay__waiting-bar--icon{width:120px;text-align:center;display:block}.goldplay__waiting-bar img{opacity:.3}.goldplay__waiting-bar--speed{display:block}.goldplay__progressbar--play{height:3px;border-radius:5px;background-color:rgba(255,80,0,.8);position:absolute}.goldplay__progressbar--load{height:3px;border-radius:5px;background-color:hsla(0,0%,100%,.8);position:absolute}.goldplay__progressbar--dot{position:absolute}.goldplay__progressbar--dot:before{content:"";display:inline-block;width:12px;height:12px;background:#fff;margin-top:-5px;border-radius:50%;border:1px solid #f1f1f1;background-image:-webkit-radial-gradient(circle arthest-corner at 45px 45px,#b0b9be,#191611);-webkit-box-shadow:0 0 2px 0 rgba(0,0,0,.26);box-shadow:0 0 2px 0 rgba(0,0,0,.26);cursor:-webkit-grab;cursor:grab}.goldplay__progressbar--dot-hover:before,.goldplay__progressbar--dot:hover:before{background:#f60;border:1px solid #f60;-webkit-box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);-webkit-transform:scale(1);transform:scale(1);-webkit-transition:-webkit-transform .15s ease-in-out;transition:-webkit-transform .15s ease-in-out;transition:transform .15s ease-in-out;transition:transform .15s ease-in-out,-webkit-transform .15s ease-in-out}.goldplay__control--timer{font-size:.9em;color:#ccc;margin:3px 5px 0;display:inline-block;-webkit-transform:translateY(-5px);transform:translateY(-5px)}.goldplay__control--timer-total{color:#999}.goldplay__volume-bar--handle{height:100px;width:20px;margin:-122px 0 0;cursor:default}.goldplay__volume-bar--column{background:hsla(0,14%,92%,.5);width:4px;top:15px;left:8px;height:80px;position:absolute}.goldplay__volume-bar--precent{position:absolute;top:2px;width:100%;text-align:center;color:#f1f1f1;font-size:10px;cursor:text}.goldplay__volume-bar--size{background:#f60;left:8px;z-index:2;position:absolute}.goldplay__volume-bar--rod{position:absolute;left:5px;z-index:3}.goldplay__volume-bar--rod:before{content:"";display:table;width:12px;height:12px;background:#fff;margin-top:0;margin-left:-2px;border-radius:50%;border:1px solid #f1f1f1;background-image:radial-gradient(circle arthest-corner at 45px,at 45px,#b0b9be,#191611);background-image:radial-gradient(circle arthest-corner at 45px 45px,#b0b9be,#191611);-webkit-box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);cursor:-webkit-grab;cursor:grab}.goldplay__volume-bar--rod-hover:before,.goldplay__volume-bar--rod:hover:before{background:#f60;border:1px solid #f60;-webkit-box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);-webkit-transform:scale(1);transform:scale(1);-webkit-transition:-webkit-transform .15s ease-in-out;transition:-webkit-transform .15s ease-in-out;transition:transform .15s ease-in-out;transition:transform .15s ease-in-out,-webkit-transform .15s ease-in-out}.goldplay__control--fullpage{margin:0 0 0 5px}.goldplay__control--fullscreen{margin:0 12px 0 10px}.goldplay__alter-box{z-index:999;padding:20px;border-radius:10px;color:#fff;position:absolute;word-break:break-word;overflow:auto;-webkit-box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);box-shadow:0 0 6px 2px hsla(0,10%,100%,.5);background:rgba(0,0,0,.6);min-width:50px;min-height:20px;max-width:400px;max-height:300px;opacity:0;-webkit-transition:opacity .3s;transition:opacity .3s}.goldplay__alter--close{margin:5px;display:block;position:absolute;right:0;top:0;cursor:pointer}.goldplay__alter--warn{float:left;margin:-5px 10px 5px 0}.goldplay__rate-bar,.goldplay__speed-bar{display:inline-block;color:#ccc;vertical-align:middle;margin:-14px 10px 0 0}.goldplay__rate-bar--box,.goldplay__speed-bar--box{cursor:default}.goldplay__speed-bar--box ul{margin:6px 0;padding:0;text-align:right}.goldplay__speed-bar--box ul li{height:2em;line-height:2em;padding:0 15px}.goldplay__rate-bar--box ul li:hover,.goldplay__speed-bar--box ul li:hover{background:rgba(0,0,0,.4)}.goldplay__rate-bar--box ul{margin:6px 0;padding:0;text-align:right}.goldplay__rate-bar--box ul li{height:2em;line-height:2em;padding:0 15px}',""])},105:function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(a=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),o=r.sources.map((function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"}));return[n].concat(o).concat([i]).join("\n")}var a;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(i=0;i<t.length;i++){var a=t[i];null!=a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},106:function(t,e,n){var r,i,o={},a=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),s=function(t,e){return e?e.querySelector(t):document.querySelector(t)},u=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var r=s.call(this,t,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}}(),c=null,l=0,f=[],h=n(107);function p(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=o[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(b(r.parts[a],e))}else{var s=[];for(a=0;a<r.parts.length;a++)s.push(b(r.parts[a],e));o[r.id]={id:r.id,refs:1,parts:s}}}}function d(t,e){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i],a=e.base?o[0]+e.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function y(t,e){var n=u(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=f[f.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),f.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=u(t.insertAt.before,n);n.insertBefore(e,i)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=f.indexOf(t);e>=0&&f.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var r=function(){0;return n.nc}();r&&(t.attrs.nonce=r)}return m(e,t.attrs),y(t,e),e}function m(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function b(t,e){var n,r,i,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var a=l++;n=c||(c=v(e)),r=E.bind(null,n,a,!1),i=E.bind(null,n,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),y(t,e),e}(e),r=S.bind(null,n,e),i=function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(e),r=k.bind(null,n),i=function(){g(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return p(n,e),function(t){for(var r=[],i=0;i<n.length;i++){var a=n[i];(s=o[a.id]).refs--,r.push(s)}t&&p(d(t,e),e);for(i=0;i<r.length;i++){var s;if(0===(s=r[i]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete o[s.id]}}}};var _,w=(_=[],function(t,e){return _[t]=e,_.filter(Boolean).join("\n")});function E(t,e,n,r){var i=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=w(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function k(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function S(t,e,n){var r=n.css,i=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&i;(e.convertToAbsoluteUrls||o)&&(r=h(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var a=new Blob([r],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},107:function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,r=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var i,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},11:function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return a}));var r={projectName:"GOLDPLAY",projectAbbreviation:"GP",mode:"production",basePath:"./",get distPath(){var t="";return("development"==this.mode||"test"==this.mode)&&(t="/dist/"),t},get libPath(){return this.distPath+"lib/"},hideBarBoxTime:300,speedList:[{name:"0.5X",value:.5},{name:"1.0X",value:1},{name:"1.5X",value:1.5},{name:"2.0X",value:2},{name:"3.0X",value:3}]},i={maxDuration:15,maxSize:1024e6,maxRetryCount:3,maxSegment:10},o=1/9e4,a={READYBUFFERLENGTH:500,MAXBUFFERLENGTH:5500}},112:function(t,e,n){"use strict";n.r(e);var r,i=n(3),o=n.n(i),a=n(5),s=n.n(a),u=n(11),c=function(){function t(e){o()(this,t),this.decode=e,this.result=[]}return s()(t,[{key:"openDecode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this,n=Module.addFunction((function(t,n,r,i,o,a,s,u,c){var l={stride_y:i,stride_u:o,stride_v:a,width:s,height:u,buf_y:HEAPU8.slice(t,t+i*u),buf_u:HEAPU8.slice(n,n+o*u/2),buf_v:HEAPU8.slice(r,r+a*u/2),pts:c};e.result.push(l)}),"viiiiiiiii");Module._openDecoder(t,n,1)}},{key:"decodeData",value:function(t,e){var n=t.length,r=Module._malloc(n);Module.HEAPU8.set(t,r),Module._decodeData(r,n,e),Module._free(r)}},{key:"flush",value:function(){for(Module._flushDecoder();this.checkData();)this.decode.getDecodeYUV()}},{key:"closeDecode",value:function(){Module._closeDecoder()}},{key:"getYUV",value:function(){var t=null;return this.result.length>0&&(t=this.result.shift()),t}},{key:"checkData",value:function(){return this.result.length>0}}]),t}(),l=function(){function t(e){o()(this,t),this.decode=e}return s()(t,[{key:"openDecode",value:function(){return _web_decoder_open()}},{key:"closeDecode",value:function(t){_web_decoder_close(t)}},{key:"decodeData",value:function(t,e,n){var r=t.length||0;Module.ccall("web_decoder_decode_frame","number",["number","array","number","number"],[n,t,r,e])}},{key:"flush",value:function(t){var e=this.decode;if(_web_decoder_decode_frame)for(;;){if(_web_decoder_decode_frame(t,null,0,0)<0||!_web_got_frame(t))break;e.getDecodeYUV(t)}}},{key:"getYUV",value:function(t){var e=_web_get_stride_y(t),n=_web_get_stride_u(t),r=_web_get_stride_v(t),i=_web_get_width(t),o=_web_get_height(t),a=_web_get_frame_y(t),s=_web_get_frame_u(t),c=_web_get_frame_v(t),l=parseInt(_web_got_frame_pts(t)*u.a*1e3),f=HEAPU8.subarray(a,a+e*o),h=HEAPU8.subarray(s,s+n*o/2),p=HEAPU8.subarray(c,c+r*o/2);return{stride_y:e,stride_u:n,stride_v:r,width:i,height:o,buf_y:new Uint8Array(f),buf_u:new Uint8Array(h),buf_v:new Uint8Array(p),pts:l}}},{key:"checkData",value:function(t){return _web_got_frame(t)}}]),t}(),f=function(){function t(){o()(this,t),this.p=null,this.ptsList=[],this.ptsOffset=0,this.fps=0,this.lastDuration=0,this.previousPTS=0,this.status=!1,this.yuvArray=[],this.decodeTool=null}return s()(t,[{key:"loadWASM",value:function(t){var e=t.data.libPath;this.codec=t.data.codec,self.Module={locateFile:function(t){return e+t}},self.importScripts(e+"libffmpeg.js"),self.Module.onRuntimeInitialized=function(){Module._web_decoder_open?self.decode.decodeTool=new l(self.decode,this.event):self.decode.decodeTool=new c(self.decode,this.event),self.decode.openDecode(),self.decode.onWasmLoaded()}}},{key:"openDecode",value:function(){try{this.status||(this.p=this.decodeTool.openDecode(this.codec),this.status=!0)}catch(t){}}},{key:"closeDecode",value:function(){this.status&&(this.decodeTool.closeDecode(this.p),this.status=!1)}},{key:"push",value:function(t){var e=this;t.forEach((function(t){var n=t.PTS,r=t.data_byte,i=t.partEnd,o=t.lastTS,a=e.ptsList;e.insertSort(a,parseInt(n*u.a*1e3)),e.decodeTool.decodeData(r,n,e.p),e.decodeTool.checkData(e.p)&&e.getDecodeYUV(e.p,i,o)}))}},{key:"getDecodeYUV",value:function(t,e,n){if(!this.reseting){var r=0;this.fps||(this.fps=this.getFPS());var i=this.decodeTool.getYUV(t),o=this.ptsList.shift();if(i.pts=o,this.previousPTS&&o?(r=parseInt(o-this.previousPTS),this.lastDuration=r):r=this.lastDuration,i.duration=r,i.fps=this.fps,o)if(this.previousPTS=o,this.yuvArray.push(i),this.yuvArray.length>5){var a=Date.now(),s=this.yuvArray.reduce((function(t,e){return t.concat([e.buf_y.buffer,e.buf_u.buffer,e.buf_v.buffer])}),[]);self.postMessage({type:"decoded",data:this.yuvArray,no:this.no,poolIndex:this.poolIndex,pts:o,start:a},s),this.yuvArray=[]}if(e){if(this.yuvArray.length){var u=Date.now(),c=this.yuvArray.reduce((function(t,e){return t.concat([e.buf_y.buffer,e.buf_u.buffer,e.buf_v.buffer])}),[]);self.postMessage({type:"decoded",data:this.yuvArray,no:this.no,poolIndex:this.poolIndex,pts:o,start:u},c),this.yuvArray=[]}self.postMessage({type:"partEnd",data:n,no:this.no})}}}},{key:"reset",value:function(){this.reseting=!0,this.ptsList=[],this.ptsOffset=0,this.previousPTS=0,this.fps=0,this.yuvArray=[],this.closeDecode(),this.openDecode(),self.postMessage({type:"resetEnd",data:Date.now()}),this.reseting=!1}},{key:"flush",value:function(){this.decodeTool.flush(this.p),this.yuvArray.length&&(self.postMessage({type:"decoded",data:this.yuvArray,no:this.no,poolIndex:this.poolIndex}),this.yuvArray=[]),this.closeDecode(),self.postMessage({type:"flushEnd",data:this.previousPTS})}},{key:"getFPS",value:function(){var t=this.ptsList;return t.length>=2?Math.round(1e3/(t[1]-t[0])):null}},{key:"onWasmLoaded",value:function(){self.postMessage({type:"dataProcessorReady"})}},{key:"insertSort",value:function(t,e){var n=t.length;if(0!==n){for(var r=0;r<n;r++)if(e<t[r]){for(var i=n;i>r;)t[i]=t[i-1],i--;return void(t[r]=e)}t.push(e)}else t.push(e)}},{key:"onCodecError",value:function(){self.postMessage({type:"codecError"})}}]),t}(),h=function(){function t(e){o()(this,t),this.decode=e,this.result=[]}return s()(t,[{key:"openDecode",value:function(){var t=this,e=Module.addFunction((function(e,n,r,i,o,a,s,u,c){var l=HEAPU8.subarray(e,e+i*u),f=HEAPU8.subarray(n,n+o*u/2),h=HEAPU8.subarray(r,r+a*u/2),p={stride_y:i,stride_u:o,stride_v:a,width:s,height:u,buf_y:Uint8Array.from(l),buf_u:Uint8Array.from(f),buf_v:Uint8Array.from(h),pts:c};t.result.push(p)}),"viiiiiiiii"),n=Module.addFunction((function(t,e,n,r){}),"viiii");Module._openDecoder(e,n)}},{key:"decodeData",value:function(t){var e=t.length,n=Module._malloc(e);Module.HEAPU8.set(t,n),Module._decodeData(n,e),Module._free(n)}},{key:"flush",value:function(){for(Module._flushDecoder();this.checkData();)this.decode.getDecodeYUV()}},{key:"closeDecode",value:function(){Module._closeDecoder()}},{key:"getYUV",value:function(){var t=null;return this.result.length>0&&(t=this.result.shift()),t}},{key:"checkData",value:function(){return this.result.length>0}}]),t}(),p=function(){function t(){o()(this,t),this.p=null,this.ptsList=[],this.ptsOffset=0,this.fps=0,this.lastDuration=0,this.previousPTS=0,this.status=!1,this.yuvArray=[],this.decodeTool=null}return s()(t,[{key:"loadWASM",value:function(t){var e=t.data.libPath;this.codec=t.data.codec,self.Module={locateFile:function(t){return e+t}},self.importScripts(e+"libffmpeg_mp4.js"),self.Module.onRuntimeInitialized=function(){self.decodeMp4.decodeTool=new h(self.decodeMp4,this.event),self.decodeMp4.openDecode(),self.decodeMp4.onWasmLoaded()}}},{key:"openDecode",value:function(){try{this.status||(this.decodeTool.openDecode(),this.status=!0)}catch(t){}}},{key:"closeDecode",value:function(){this.status&&(this.decodeTool.closeDecode(),this.status=!1)}},{key:"push",value:function(t){self.decodeMp4.decodeTool.decodeData(t),self.decodeMp4.decodeTool.checkData(this.p)&&this.getDecodeYUV(this.p,partEnd,lastTS)}},{key:"getDecodeYUV",value:function(t,e,n){if(!this.reseting){var r=0;this.fps||(this.fps=this.getFPS());var i=this.decodeTool.getYUV(t),o=this.ptsList.shift();if(i.pts=o,this.previousPTS&&o?(r=parseInt(o-this.previousPTS),this.lastDuration=r):r=this.lastDuration,i.duration=r,i.fps=this.fps,o)this.previousPTS=o,this.yuvArray.push(i),this.yuvArray.length>10&&(self.postMessage({type:"decoded",data:this.yuvArray,no:this.no}),this.yuvArray=[]);e&&(this.yuvArray.length&&(self.postMessage({type:"decoded",data:this.yuvArray,no:this.no}),this.yuvArray=[]),self.postMessage({type:"partEnd",data:n}))}}},{key:"reset",value:function(){this.reseting=!0,this.ptsList=[],this.ptsOffset=0,this.previousPTS=0,this.fps=0,this.yuvArray=[],this.closeDecode(),this.openDecode(),self.postMessage({type:"resetEnd",data:Date.now()}),this.reseting=!1}},{key:"flush",value:function(){this.decodeTool.flush(this.p),this.yuvArray.length&&(self.postMessage({type:"decoded",data:this.yuvArray}),this.yuvArray=[]),this.closeDecode(),self.postMessage({type:"flushEnd",data:this.previousPTS})}},{key:"getFPS",value:function(){var t=this.ptsList;return t.length>=2?Math.round(1e3/(t[1]-t[0])):null}},{key:"onWasmLoaded",value:function(){self.postMessage({type:"dataProcessorReady"})}},{key:"insertSort",value:function(t,e){var n=t.length;if(0!==n){for(var r=0;r<n;r++)if(e<t[r]){for(var i=n;i>r;)t[i]=t[i-1],i--;return void(t[r]=e)}t.push(e)}else t.push(e)}}]),t}(),d=n(0),y=n.n(d);!function(t){t.ERROR="ERROR",t.INFO="INFO",t.DATA="DATA",t.DEMUX_DATA="DEMUX_DATA",t.DONE="DONE"}(r||(r={}));var g=Object.create||function(t){var e=function(){};return e.prototype=t,new e},v=Object.keys||function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e);return e},m=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};let b,_=10;class w{constructor(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=g(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}static listenerCount(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):T.call(t,e)}emit(t,...e){var n,r,i,o,a,s,u="error"===t;if(s=this._events)u=u&&null==s.error;else if(!u)return!1;if(u){if(arguments.length>1&&(n=arguments[1]),n instanceof Error)throw n;var c=new Error('Unhandled "error" event. ('+n+")");throw c.context=n,c}if(!(r=s[t]))return!1;var l="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var r=t.length,i=P(t,r),o=0;o<r;++o)try{i[o].call(n)}catch(t){}}(r,l,this);break;case 2:!function(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=P(t,i),a=0;a<i;++a)try{o[a].call(n,r)}catch(t){}}(r,l,this,arguments[1]);break;case 3:!function(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,a=P(t,o),s=0;s<o;++s)try{a[s].call(n,r,i)}catch(t){}}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var a=t.length,s=P(t,a),u=0;u<a;++u)try{s[u].call(n,r,i,o)}catch(t){}}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(i-1),a=1;a<i;a++)o[a-1]=arguments[a];!function(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=P(t,i),a=0;a<i;++a)try{o[a].apply(n,r)}catch(t){}}(r,l,this,o)}return!0}on(t,e){return function(t,e,n){var r,i,o;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');(i=t._events)?(i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),o=i[e]):(i=t._events=g(null),t._eventsCount=0);if(o){if("function"==typeof o?o=i[e]=[o,n]:o.push(n),!o.warned&&(r=void 0===(a=t)._maxListeners?w.defaultMaxListeners:a._maxListeners)&&r>0&&o.length>r){o.warned=!0;class n extends Error{}let r=new n("Possible Dispatcher memory leak detected. "+o.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');r.name="MaxListenersExceededWarning",r.emitter=t,r.type=e,r.count=o.length,"object"==typeof console&&console.warn}}else o=i[e]=n,++t._eventsCount;var a;return t}(this,t,e)}once(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,function(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=m.call(S,r);return i.listener=n,r.wrapFn=i,i}(this,t,e)),this}off(t,e){return k.call(this,t,e)}removeAllListeners(t){var e,n,r;if(!(n=this._events))return this;if(!n.off)return 0===arguments.length?(this._events=g(null),this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=g(null):delete n[t]),this;if(0===arguments.length){var i,o=v(n);for(r=0;r<o.length;++r)"off"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("off"),this._events=g(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.off(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.off(t,e[r]);return this}listeners(t){return x(this,t,!0)}rawListeners(t){return x(this,t,!1)}listenerCount(){return w.listenerCount.apply(this,arguments)}}try{var E={};Object.defineProperty&&Object.defineProperty(E,"x",{value:0}),b=0===E.x}catch(t){b=!1}function k(t,e){var n,r,i,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=g(null):(delete r[t],r.off&&this.emit("off",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),r.off&&this.emit("off",t,a||e)}return this}function S(){if(!this.fired)switch(this.target.off(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function x(t,e,n){var r=t._events;if(!r)return[];var i=r[e];return i?"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):P(i,i.length):[]}function T(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function P(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}b?Object.defineProperty(w,"defaultMaxListeners",{enumerable:!0,get:function(){return _},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');_=t}}):w.defaultMaxListeners=_;class R extends w{}var L=Object.prototype.toString;function A(t){return!!t&&"object"==typeof t}function B(t){return"number"==typeof t&&!isNaN(t)}function D(t){return A(t)&&"[object arraybuffer]"===L.call(t).toLowerCase()}class I{constructor(){this.list_=[]}get byteLength(){if(!B(this.byteLength_)){let t=0;for(let e,n=0;n<this.list_.length;n++)e=this.list_[n],t+=e.byteLength;this.byteLength_=t}return this.byteLength_}get bytes(){const{bufferList:t}=this;let e=null;return t.length>0&&(e=0===t.length?t[0]:this.toNewBytes()),e}get empty(){return 0===this.list_.length}get bufferList(){return this.list_}clear(){let t=this.list_.length;t>0&&this.list_.splice(0,t),this.byteLength_=null}toNewBytes(){let t=null,e=0;for(;null===t;)try{e++,t=new Uint8Array(this.byteLength)}catch(t){if(e>50)throw t}for(let e=0,n=0;e<this.list_.length;e++){let r=this.list_[e];t.set(r,n),n+=r.byteLength}return t}append(t){t instanceof I?this.list_=this.list_.concat(t.bufferList):this.list_.push(t),this.byteLength_=null}cut(t,e=!0){let n=null;if(t>0&&!this.empty){let r=this.list_,i=0,o=0;for(;r.length>0;){let a=r.shift();if(0!==o){let o=t-i;if(a.byteLength>=o){e&&n.set(a.subarray(0,o),i),a=a.subarray(o),a.byteLength>0&&r.unshift(a);break}e&&n.set(a,i),i+=a.byteLength;break}if(a.byteLength>=t){e&&(n=a.subarray(0,t)),a.byteLength>t&&(a=a.subarray(t),r.unshift(a));break}if(e){try{n=new Uint8Array(t)}catch(e){throw`alloc_memory_error@ cache buffer: ${t} ${e.message}`}n.set(a,0)}i+=a.byteLength,o++}this.byteLength_=null}return n}}class O{constructor(){this.map_={}}push(t,e){Object.prototype.hasOwnProperty.call(this.map_,t)?this.map_[t].push(e):this.map_[t]=[e]}get(t){let e=this.map_[t];return e?e.slice():null}getAll(){let t=[];for(let e in this.map_)t.push.apply(t,this.map_[e]);return t}remove(t,e){let n=this.map_[t];if(n)for(let t=0;t<n.length;++t)n[t]==e&&(n.splice(t,1),--t)}clear(){this.map_={}}forEach(t){for(let e in this.map_)t(e,this.map_[e])}}class C{constructor(t,e,n){this.target=t,this.type=e,this.listener=n,this.target.addEventListener?this.target.addEventListener(e,n,!1):this.target.on&&this.target.on(e,n,!1)}off(){this.target.removeEventListener?this.target.removeEventListener(this.type,this.listener,!1):this.target.off&&this.target.off(this.type,this.listener,!1),this.target=null,this.listener=null}}class N{constructor(){this.bindingMap_=new O}destroy(){this.removeAll(),this.bindingMap_=null}on(t,e,n){if(!this.bindingMap_)return;let r=new C(t,e,n);return this.bindingMap_.push(e,r),this}once(t,e,n){this.on(t,e,function(r){this.off(t,e),n(r)}.bind(this))}off(t,e){if(!this.bindingMap_)return;let n=this.bindingMap_.get(e)||[];for(let r=0;r<n.length;++r){let i=n[r];i.target==t&&(i.off(),this.bindingMap_.remove(e,i))}}removeAll(){if(!this.bindingMap_)return;let t=this.bindingMap_.getAll();for(let e=0;e<t.length;++e)t[e].off();this.bindingMap_.clear()}}let F;F="undefined"==typeof window?self:window;let M=F.console;const U="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof importScripts,j=">>>";let H=new class extends w{constructor(){super(),this._enable=!1}get enable(){return this._enable}set enable(t){this._enable=t,this.MSG_NAME="__log__"}log(...t){U?H.emit(this.MSG_NAME,"log",[...t].join("")):this._enable&&M.log.call(M,j,...t)}debug(...t){U?H.emit(this.MSG_NAME,"debug",[...t].join("")):this._enable&&M.debug&&M.debug.call(M,j,...t)}assert(...t){if(this._enable&&M.assert){let e=t[0],n=Array.prototype.slice.call(t,1);n.unshift(j),M.assert.call(M,e,...n)}}warn(...t){U?H.emit(this.MSG_NAME,"warn",[...t].join("")):this._enable&&M.warn.call(M,j,...t)}error(...t){U?H.emit(this.MSG_NAME,"error",[...t].join("")):this._enable&&M.error.call(M,j,...t)}};class z extends w{constructor(){super()}pipe(t){return this.on("reset",(function(){t.reset()})),this.on("data",(function(e){t.push(e)})),this.on("done",(function(e){t.flush(e)})),t}unpipe(){return this.removeAllListeners("reset"),this.removeAllListeners("data"),this.removeAllListeners("done"),this}push(t,e){this.emit("data",t)}flush(t){this.emit("done",t)}reset(){this.emit("reset")}}class W extends z{constructor(t={}){super(),t.debug&&(H.enable=!0),this.ctx_=new R,this.options_=t,this.cache_buffer_=new I}listenEndStream_(){this.eventManager_=new N,this.eventManager_.on(this.endStream,"data",(t=>{this.emit(r.DEMUX_DATA,t)})).on(this.endStream,"done",(t=>{this.emit(r.DONE,t)})).on(this.ctx_,"error",(t=>{this.emit(r.ERROR,t)}))}constraintPushData_(t){let e=null;return D(t)||A(n=t)&&"[object uint8array]"===L.call(n).toLowerCase()?(e=D(t)?new Uint8Array(t):t,e):(H.error(`Data pushed is not an ArrayBuffer or Uint8Array: ${t}`),e);var n}reset(){}destroy(){this.unpipe(),this.endStream.unpipe(),this.eventManager_.removeAll()}}var V;!function(t){t[t.WORKER_EXCEPTION=0]="WORKER_EXCEPTION",t[t.WORKER_MSG_EXCEPTION=1]="WORKER_MSG_EXCEPTION",t[t.TS_SYNC_BYTE=2]="TS_SYNC_BYTE",t[t.FLV_HEAD_SIGNATURE=3]="FLV_HEAD_SIGNATURE",t[t.FLV_NOT_EXPECTED_ADJACENT_DATA=4]="FLV_NOT_EXPECTED_ADJACENT_DATA"}(V||(V={}));var $=V;class X{constructor(t){var e,n=0,r=((15&t[1])<<8|t[2])-4-5;for(this.pmtTable=[];n<r;n+=4)if(0==(e=t[n+8]<<8|t[n+9])){let e=(31&t[10+n])<<8|t[11+n];H.log("packet->network_PID %0x /n/n",e)}else this.pmtTable.push({programNum:e,program_map_PID:(31&t[10+n])<<8|t[11+n]})}}class Y{constructor(t){let e=(15&t[1])<<8|t[2];const n=(15&t[10])<<8|t[11];if(n<0)return;if(n>2){let e=0;for(;e<n;){e+=t[13+e]}}var r=12+n,i=e-n-9-4,o=r+i;if(r>=o)return void H.warn(`es_section_pos < es_section_end ${r}, ${o}`);this.pes_table=[];let a=0;for(;a<i;){let e=r+a,n=t[e],i=8191&(t[e+1]<<8|t[e+2]),o=4095&(t[e+3]<<8|t[e+4]);this.pes_table.push({streamType:n,PID:i}),a+=o+5}}}class q{constructor(){this.pat_table=[],this.pes_streams=[]}get currentProgramPID(){let t=[];for(let e=0;e<this.pat_table.length;e++)t.push(this.pat_table[e].pid);return t.length>0?t[0]:-1}get tracks(){return this.pes_streams}reset(){this.pat_table.splice(0,this.pat_table.length),this.pes_streams.splice(0,this.pes_streams.length)}parse(t){0===t.PID?this._parsePat(t):1===t.PID||2===t.PID||3<=t.PID&&t.PID<=15||17===t.PID||t.PID===this.currentProgramPID&&this._parsePmt(t)}findTrack(t){let e=null,n=this.pes_streams;for(let r=0;r<n.length;r++)if(n[r].id===t){e=n[r];break}return e}_parsePat(t){let e;if(t.payload_unit_start_indicator){let n=t.payload[0];e=t.payload.subarray(n+1)}else e=t.payload;let n=new X(e);for(var r=0;r<n.pmtTable.length;r++)this._add_pid_to_pmt(n.pmtTable[r].programNum,n.pmtTable[r].program_map_PID);return n}_add_pid_to_pmt(t,e){let n=this.pat_table;(function(t){for(let e,r=0;r<n.length;r++)if(e=n[r],e.id===t)return{idx:r,item:e};return null})(t)||n.push({id:t,pid:e})}_parsePmt(t){let e;if(t.payload_unit_start_indicator){let n=t.payload[0];e=t.payload.subarray(n+1)}else e=t.payload;let n=new Y(e);for(var r=0;r<n.pes_table.length;r++)this._add_pes_stream(n.pes_table[r]);return n}_add_pes_stream(t){let e=this.pes_streams;(function(t){for(let n,r=0;r<e.length;r++)if(n=e[r],n.id===t)return{idx:r,item:n};return null})(t.PID)||e.push({id:t.PID,stream_type:t.streamType,duration:0,sps:[],pps:[],pixelRatio:[1,1],timescale:9e4,width:0,height:0})}}class G extends z{constructor(t,e){super(),this.context=t,this.PSI=e,this.videoTrack=null,this.audioTrack=null,this.captionTrack=null}push(t){let e=t;for(let t,n=0;n<e.length;n++)switch(t=e[n],t.type){case"video":this._complexVideo(t);break;case"audio":this._complexAudio(t);break;case"caption":this._complexCaption(t)}}flush(){this.emit("done"),this._clearStream()}reset(){this._clearStream()}_clearStream(){this.videoTrack=null,this.audioTrack=null,this.captionTrack=null}_complexVideo(t){let e=this.PSI.findTrack(t.trackId);e&&(e.type="video",e.gops=t,e.firstDTS=t[0][0].dts,e.firstPTS=t[0][0].pts,e.duration=Number.POSITIVE_INFINITY,this.videoTrack=e,this.emit("data",{videoTrack:this.videoTrack}))}_complexAudio(t){let e=this.PSI.findTrack(t.trackId);e&&(e.type="audio",e.frames=t,e.firstPTS=e.firstDTS=t[0].dts,e.duration=Number.POSITIVE_INFINITY,this.audioTrack=e,this.emit("data",{audioTrack:this.audioTrack}))}_complexCaption(){}}const Z={mac:!1,iphone:!1,android:!1},K={version:!1,CHROME:!1,SAFARI:!1,FIREFOX:!1,IE11:!1,IE:!1,EDGE:!1,WECHAT:!1};let J=navigator.userAgent.toLowerCase();var Q=/(edge)\/([\w.]+)/.exec(J)||/(opr)[/]([\w.]+)/.exec(J)||/(chrome)[ /]([\w.]+)/.exec(J)||/(firefox)[ /]([\w.]+)/.exec(J)||/(iemobile)[/]([\w.]+)/.exec(J)||/(version)(applewebkit)[ /]([\w.]+).*(safari)[ /]([\w.]+)/.exec(J)||/(webkit)[ /]([\w.]+).*(version)[ /]([\w.]+).*(safari)[ /]([\w.]+)/.exec(J)||/(webkit)[ /]([\w.]+)/.exec(J)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(J)||/(msie) ([\w.]+)/.exec(J)||J.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(J)||J.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(J)||[],tt=/(ipad)/.exec(J)||/(ipod)/.exec(J)||/(windows phone)/.exec(J)||/(iphone)/.exec(J)||/(kindle)/.exec(J)||/(silk)/.exec(J)||/(android)/.exec(J)||/(win)/.exec(J)||/(mac)/.exec(J)||/(linux)/.exec(J)||/(cros)/.exec(J)||/(playbook)/.exec(J)||/(bb)/.exec(J)||/(blackberry)/.exec(J)||[],et={version:void 0},nt={browser:Q[5]||Q[3]||Q[1]||"",version:Q[2]||Q[4]||"0",versionNumber:Q[4]||Q[2]||"0",platform:tt[0]||""};if(nt.browser){et[nt.browser]=!0;let t=nt.versionNumber.split(".");et.version={major:parseInt(nt.versionNumber,10),string:nt.version},t.length>1&&(et.version.minor=parseInt(t[1],10)),t.length>2&&(et.version.build=parseInt(t[2],10))}K.version=et.version,K.CHROME=!!et.chrome,K.SAFARI=!!et.safari&&!K.CHROME,K.FIREFOX=!!et.firefox,K.IE11=/rv:11/.test(J),K.IE=!!et.msie||K.IE11,K.EDGE=!!et.edge,K.WECHAT=/(wechat)|(micromessenger)/.test(J),Z.mac=!!nt.platform.mac,Z.iphone=!!nt.platform.iphone,Z.android=!!nt.platform.android;var rt=K,it=Z;const ot=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];const at=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];class st extends w{constructor(){super()}push(t){let e,n,r,i,o,{pts:a,dts:s,payload:u}=t,c=u,l=0,f=0;for(;l+5<c.length;){if(255!==c[l]||240!=(246&c[l+1])){l++;continue}if(n=2*(1&~c[l+1]),e=(3&c[l+3])<<11|c[l+4]<<3|(224&c[l+5])>>5,i=1024*(1+(3&c[l+6])),o=9e4*i/at[(60&c[l+2])>>>2],r=l+e,c.byteLength<r)return;let t={pts:a+f*o,dts:s+f*o,sampleCount:i,audioObjectType:1+(c[l+2]>>>6&3),channelCount:(1&c[l+2])<<2|(192&c[l+3])>>>6,sampleRate:at[(60&c[l+2])>>>2],samplingFrequencyIndex:(60&c[l+2])>>>2,sampleSize:16,data:c.subarray(l+7+n,r)};if(this.emit("frame",t),c.byteLength===r)return c=void 0,void this.emit("done");f++,c=c.subarray(r)}}}class ut extends z{constructor(t){super(),this.PSI=t,this.trackId=null,this.codec=new st,this.codec.on("frame",(t=>{this.frames.push(t),this.frames.byteLength+=t.data.byteLength,this.frames.trackId=this.trackId})),this._newFrames()}push(t){15===t.stream_type&&(this.trackId=t.pid,this.codec.push({dts:t.pes.DTS,pts:t.pes.PTS,payload:t.pes.data_byte}))}flush(){if(this.frames.length>0){let t=this.frames.length,e=this.frames[0],n=this.frames[t-1],r=n.sampleRate*n.sampleCount/9e4;this.frames.firstDTS=e.dts,this.frames.firstPTS=e.pts,this.frames.duration=1===t?r:r+(n.pts-e.pts),this._updateTrackMeta(e),this.emit("data",this.frames),this.reset(),this.emit("done")}}reset(){this.trackId=null,this._newFrames()}_newFrames(){this.frames=[],this.frames.type="audio",this.frames.byteLength=0,this.frames.duration=0,this.frames.firstDTS=0,this.frames.firstPTS=0}_updateTrackMeta(t){let e=this.PSI.findTrack(this.trackId),n=((t,e,n)=>{let r,i,o=t;if(!(e>ot.length-1))return rt.FIREFOX?e>=6?(t=5,i=new Array(4),r=e-3):(t=2,i=new Array(2),r=e):it.android?(t=2,i=new Array(2),r=e):(t=5,i=new Array(4),e>=6?r=e-3:(1===n&&(t=2,i=new Array(2)),r=e)),i[0]=t<<3,i[0]|=(14&e)>>1,i[1]|=(1&e)<<7,i[1]|=n<<3,5===t&&(i[1]|=(14&r)>>1,i[2]=(1&r)<<7,i[2]|=8,i[3]=0),{config:i,sampleRate:ot[e],channelCount:n,codec:"mp4a.40."+t,realCodec:"mp4a.40."+o};H.error(`invalid sampling index:${e}`)})(t.audioObjectType,t.samplingFrequencyIndex,t.channelCount);e.config=n.config,e.sampleRate=n.sampleRate,e.inputTimeScale=e.inputTimeScale||e.timescale,e.timescale=n.sampleRate,e.channelCount=n.channelCount,e.codec=n.codec,e.realCodec=n.realCodec,e.isAAC=!0}}function ct(t){let e=0;return ArrayBuffer.isView(t)&&(e=t.byteOffset,t=t.buffer),new DataView(t,e)}class lt{constructor(){}readUint8(t,e){return ct(t).getUint8(e)}readUint16(t,e,n=!1){return ct(t).getUint16(e,n)}readUint32(t,e,n=!1){return ct(t).getUint32(e,n)}}function ft(t,e=0,n=1){let r=0,i=0,o=0,a="",s=0;for(let o=e;o<e+n;o++)r=Math.floor(o/8),i=7-o%8,s=t[r]>>i&1,a+=s;return o=parseInt(a,2),o}function ht(t,e=0){let n=[],r=8*t.byteLength,i=!1,o=0,a=0,s=0,u="";for(let u=e;u<r;u++)if(o=Math.floor(u/8),a=7-u%8,s=t[o]>>a&1,!i){if(0!==s){i=!0,e=u;break}n.push(0)}let c=n.length+1;for(let n=e;n<e+c;n++)o=Math.floor(n/8),a=7-n%8,s=t[o]>>a&1,u+=s;return{bitLength:n.length+c,value:parseInt(u,2)-1}}var pt={readUEV:ht,readSEV:function(t,e=0){let n=ht(t,e),r=n.value,i=Math.pow(-1,r+1)*Math.ceil(r/2);return{bitLength:n.bitLength,value:i}},readBit:ft,readByte:function(t,e=0){return ft(t,e,8)}};let dt=0;function yt(t,e){let n,r=8,i=8;for(var o=0;o<e;o++)0!=i&&(n=pt.readUEV(t,dt),dt+=n.bitLength,i=(r+n.value+256)%256),r=t[o]}class gt extends lt{constructor(t){switch(super(),this.forbidden_zero_bit=t[0]>>7,this.ref_idc=t[0]>>5&3,this.unit_type=31&t[0],this.data=function(t){let e,n=t.byteLength,r=[],i=1,o=new Uint8Array(0);for(;i<n-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;e=n-r.length;try{o=new Uint8Array(e)}catch(t){throw`epsb alloc mem error ${e}`}let a=0;for(i=0;i<e;a++,i++)a===r[0]&&(a++,r.shift()),o[i]=t[a];return o}(t.subarray(1)),this.rawData=t,this.unit_type){case 1:break;case 2:case 3:case 4:case 5:break;case 7:this.sps=function(t){dt=0;let e,n,r,i,o,a,s,u=t[0],c=t[1],l=t[2],f=t.subarray(3),h=0,p=[1,1],d=1,y=0,g=!0,v=pt.readUEV(f,dt);if(dt+=v.bitLength,100==u||110==u||122==u||244==u||44==u||83==u||86==u||118==u||128==u){let t=pt.readUEV(f,dt);dt+=t.bitLength,3==t.value&&(dt+=1);let e=pt.readUEV(f,dt);dt+=e.bitLength;let n=pt.readUEV(f,dt);if(dt+=n.bitLength,dt+=1,h=pt.readBit(f,dt),dt+=1,h)for(let e=0;e<(3!=t.value?8:12);e++){let t=pt.readBit(f,dt);dt+=1,t&&yt(f,e<6?16:64)}}let m=pt.readUEV(f,dt);dt+=m.bitLength;let b=pt.readUEV(f,dt),_=b.value;if(dt+=b.bitLength,0===_)e=pt.readUEV(f,dt),dt+=e.bitLength;else if(1===_){dt+=1,n=pt.readSEV(f,dt),dt+=n.bitLength,r=pt.readSEV(f,dt),dt+=r.bitLength,i=pt.readUEV(f,dt),dt+=i.bitLength;for(let t,e=0;e<i.value;e++)t=pt.readSEV(f,dt),dt+=t.bitLength}let w=pt.readUEV(f,dt);dt+=w.bitLength,dt+=1;let E=pt.readUEV(f,dt);dt+=E.bitLength;let k=pt.readUEV(f,dt);dt+=k.bitLength;let S=pt.readBit(f,dt);dt+=1,S||(dt+=1),dt+=1;let x=pt.readBit(f,dt);dt+=1;let T=0,P=0,R=0,L=0;if(x){let t=pt.readUEV(f,dt);dt+=t.bitLength,T=t.value;let e=pt.readUEV(f,dt);dt+=e.bitLength,P=e.value;let n=pt.readUEV(f,dt);dt+=n.bitLength,R=n.value;let r=pt.readUEV(f,dt);dt+=r.bitLength,L=r.value}let A=pt.readBit(f,dt);if(dt+=1,A){let t=pt.readBit(f,dt);if(dt+=1,t){const t=pt.readByte(f,dt);switch(dt+=8,t){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:{let t=pt.readByte(f,dt);dt+=8;let e=pt.readByte(f,dt);dt+=8;let n=pt.readByte(f,dt);dt+=8;let r=pt.readByte(f,dt);dt+=8,p=[t<<8|e,n<<8|r];break}}p&&(d=p[0]/p[1]),255===t&&(dt+=16,dt+=16)}let e=pt.readBit(f,dt);dt+=1,e&&(dt+=1);let n=pt.readBit(f,dt);if(dt+=1,n){o=pt.readBit(f,dt,3),dt+=3,dt+=1;let t=pt.readBit(f,dt);dt+=1,t&&(dt+=24)}let r=pt.readBit(f,dt);if(dt+=1,r){let t=pt.readUEV(f,dt);dt+=t.bitLength;let e=pt.readUEV(f,dt);dt+=e.bitLength}let i=pt.readBit(f,dt);dt+=1,i&&(a=pt.readBit(f,dt,32),dt+=32,s=pt.readBit(f,dt,32),dt+=32,g=!!pt.readBit(f,dt),dt+=1,y=s/(2*a))}return{payload:f,profile_idc:u,profile_compatibility:c,level_idc:l,sps_id:v.value,log2_max_frame_num_minus4:b.value,pic_order_cnt_type:_,log2_max_pic_order_cnt_lsb_minus4:e?e.value:0,width:Math.ceil((16*(E.value+1)-2*T-2*P)*d),height:(2-S)*(k.value+1)*16-2*R-2*L,pixelRatio:p,video_format:o,fps:y,fixedFPS:g}}(this.data);break;case 8:this.pps=function(t){let e,n,r=0,i=t,o=[],a=0;r+=pt.readUEV(i,r).bitLength,r+=pt.readUEV(i,r).bitLength,r+=1,r+=1;let s=pt.readUEV(i,r);if(r+=s.bitLength,s.value>0){let t=pt.readUEV(i,r);r+=t.bitLength;let u,c=0;switch(t.value){case 0:for(c=0;c<=t.value;c++)u=pt.readUEV(i,r),r+=u.bitLength;break;case 2:for(c=0;c<=t.value;c++)u=pt.readUEV(i,r),r+=u.bitLength,u=pt.readUEV(i,r),r+=u.bitLength;break;case 3:case 4:case 5:r+=1,e=pt.readUEV(i,r),r+=e.bitLength;break;case 6:{n=pt.readUEV(i,r),r+=n.bitLength;let t=Math.ceil(Math.log2(s.value+1));for(a=0;a<=n.value;a++)o.push(pt.readBit(i,r,t)),r+=t}}}return r+=pt.readUEV(i,r).bitLength,r+=pt.readUEV(i,r).bitLength,r+=1,r+=1,r+=pt.readSEV(i,r).bitLength,r+=pt.readSEV(i,r).bitLength,r+=pt.readSEV(i,r).bitLength,r+=1,r+=1,r+=1,{sliceGroupNum:s.value+1}}(this.data);break;case 6:this.sei=(this.data,{});break;case 9:this.primary_pic_type=this.data[0]>>5}}}class vt extends w{constructor(){super(...arguments),this.lastState=null,this.lastNALu=null,this.lastNALuState=null}spitNalu_(t,e,n){let r=new gt(t);r.pts=e,r.dts=n,this.lastNALu=r,this.emit("nalu",r)}push(t){const{lastState:e,lastNALuState:n}=this;let r=0,i=-1,{pts:o,dts:a,payload:s,naluSizeLength:u}=t;if(u){let t=0,e=0,n=0,r=s.length;do{e=0;for(let n=0;n<u;n++)e|=s[t+n]<<8*(u-n-1);t+=u,n=t+e,n>r&&(n=r),this.spitNalu_(s.subarray(t,n),o,a),t=n}while(t<r)}else{let t=s.byteLength-1,u=0;do{if(0!==s[t])break;u++,t--}while(t>0);u>=3&&(s=s.subarray(0,t+1));const c=s.length;let l=0;do{let t=s[r++];if(0!==l)if(1!==l)if(t)if(1===t){if(i>=0)this.lastNALuState=l,this.spitNalu_(s.subarray(i,r-1-l),o,a);else{const t=this.lastNALu;if(t){e&&r<=4-e&&n&&(t.rawData=t.rawData.subarray(0,t.rawData.byteLength-e));let i=r-l-1;if(i>0){H.log(`overflow NALU found: ${i}/${o}/${a}`);let e=new I;e.append(t.rawData),e.append(s.subarray(0,i));let n=e.toNewBytes();e.clear(),t.rawData=n}}}r<c&&(i=r,l=0)}else l=0;else l=3;else l=t?0:2;else l=t?0:1}while(r<c);i>=0&&l>=0&&(this.lastNALuState=l,this.spitNalu_(s.subarray(i,c),o,a)),this.lastState=l}this.emit("done")}reset(){this.lastState=null,this.lastNALu=null,this.lastNALuState=null}}class mt extends z{constructor(t){super(),this.PSI=t,this.trackId=null,this.currentFrame=[],this.codec=new vt,this._newGop(),this._newGops(),this.codec.on("nalu",(t=>{if(7===t.unit_type){let e=this.PSI.findTrack(this.trackId),n=(t=>{let e="avc1.",n=[t.profile_idc,t.profile_compatibility,t.level_idc];for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return{codec:e}})(t.sps);e.codec=n.codec,e.width=t.sps.width,e.height=t.sps.height,e.profileIdc=t.sps.profile_idc,e.profileCompatibility=t.sps.profile_compatibility,e.levelIdc=t.sps.level_idc,e.pixelRatio=t.sps.pixelRatio,e.sps=[t.rawData]}else if(8===t.unit_type){this.PSI.findTrack(this.trackId).pps=[t.rawData]}this._grouping(t)}))}push(t){const{stream_type:e,pes:n,pid:r}=t;if(27===e||36===e){this.trackId=r;let t={pts:n.PTS,dts:n.DTS,payload:n.data_byte};this.codec.push(t)}}flush(){this.currentFrame.length>0&&((!this.currentFrame.duration||this.currentFrame.duration<=0)&&(this.currentFrame.duration=this.prevFrame.duration||0),this._pushFrameIntoGop(),this.currentFrame=[]),this.gop.length>0&&this._pushGopIntoGroup()}reset(){this.codec.reset(),this.currentFrame=[],this._newGop(),this._newGops()}_grouping(t){9===t.unit_type?(this.currentFrame.length>0&&(this.currentFrame.duration=t.dts-this.currentFrame.dts,this.gop.length>0&&this.currentFrame.keyframe&&(this.gop.trackId=this.trackId,this._pushGopIntoGroup()),this.currentFrame.keyframe||this.gop.length>0?this._pushFrameIntoGop():H.warn("h264 codec drop frame")),this.prevFrame=this.currentFrame,this.currentFrame=[],this.currentFrame.keyframe=!1,this.currentFrame.byteLength=0,this.currentFrame.naluCount=0,this.currentFrame.pts=t.pts,this.currentFrame.dts=t.dts):(5===t.unit_type&&(this.currentFrame.keyframe=!0),this.currentFrame.byteLength+=t.rawData.byteLength,this.currentFrame.naluCount++,this.currentFrame.push(t)),this.currentFrame.duration=t.dts-this.currentFrame.dts}_newGop(){this.gop=[],this.gop.duration=0,this.gop.naluCount=0,this.gop.byteLength=0}_pushFrameIntoGop(){this.gop.push(this.currentFrame),this.gop.duration+=this.currentFrame.duration,this.gop.byteLength+=this.currentFrame.byteLength,this.gop.naluCount+=this.currentFrame.naluCount}_newGops(){this.gops=[],this.gops.type="video",this.gops.duration=0,this.gops.naluCount=0,this.gops.byteLength=0,this.gops.frameLength=0,this.gops.firstDTS=0}_pushGopIntoGroup(){let t=this.gop[0];this.gops.trackId=this.trackId,this.gops.duration+=this.gop.duration,this.gops.byteLength+=this.gop.byteLength,this.gops.naluCount+=this.gop.naluCount,this.gops.frameLength+=this.gop.length,this.gops.firstDTS=t.dts,this.gops.firstPTS=t.pts,this.gops.push(this.gop),this.emit("data",this.gops),this._newGop(),this._newGops(),this.emit("done")}}class bt extends z{constructor(t,e,n={}){super(),this.context=t,this.PSI=e,this.options=n,this.tracks=[],this.adtsStream=new ut(e),this.avcStream=new mt(e),this.streams=[this.adtsStream,this.avcStream],n.decodeCodec&&(this.avcStream.on("data",(t=>{let e=n.config.stubTime;if(B(e)){let n=(t.firstPTS+t.duration)/9e4;if(n<e)return void H.warn(`drop avc gop, start/end/stubTime(${t.firstPTS}/${n}/${e})`)}this.tracks.push(t),this.emit("data",this.tracks),this.tracks=[],this.adtsStream.flush()})),this.adtsStream.on("data",(t=>{let e=n.config.stubTime;if(B(e)){let n=(t.firstPTS+t.duration)/9e4;if(n<e)return void H.warn(`drop adts, start/end/stubTime(${t.firstPTS}/${n}/${e})`)}this.tracks.push(t),this.emit("data",this.tracks),this.tracks=[]})))}push(t){const{options:e,adtsStream:n,avcStream:r}=this;let{stream_type:i}=t;if(e.decodeCodec)switch(i){case 27:case 36:r.push(t);break;case 15:n.push(t);break;default:H.warn(`ts elementary encounter unknown stream type ${i}`)}else this.emit("data",t)}flush(){let{streams:t,tracks:e}=this;for(let e=0;e<this.streams.length;e++){t[e].flush()}e.length>0&&this.emit("data",e),this.emit("done"),e.splice(0,e.length)}reset(){this.tracks=[];for(let t=0;t<this.streams.length;t++){this.streams[t].reset()}this.emit("reset")}}class _t{constructor(t){let e=t[7]>>6,n=t[8];this.PTS=0,2==(2&e)&&(this.PTS=this.calcTimestamp_(t,9)),this.DTS=this.PTS,1==(1&e)&&(this.DTS=this.calcTimestamp_(t,14)),this.data_byte=t.subarray(9+n)}calcTimestamp_(t,e){return 536870912*(14&t[e])+(t[e+1]<<22)+(t[e+2]>>1<<15)+(t[e+3]<<7)+(t[e+4]>>1)}}class wt extends z{constructor(t,e){super(),this.context=t,this.PSI=e,this.PID=null,this.cache_buffer=new I}push(t){const e=this;t.PID>31&&t.PID<8191&&(-1==this.PSI.currentProgramPID?e._pushPacket(t):this.PSI.currentProgramPID!==t.PID&&(1===t.payload_unit_start_indicator&&e._assembleOnePES(),e._pushPacket(t)))}flush(){this._assembleOnePES(),this.emit("done")}reset(){this._clearCached(),this.emit("reset")}_clearCached(){this.PID=null,this.cache_buffer.clear()}_pushPacket(t){let e=this.cache_buffer.empty;e&&0===t.payload_unit_start_indicator||(e&&(this.PID=t.PID),this.cache_buffer.append(t.payload))}_assembleOnePES(){const t=this;if(!this.cache_buffer.empty){let e;try{e=this.cache_buffer.toNewBytes()}catch(t){throw`pes alloc mem err ${this.cache_buffer.byteLength}`}let n=new _t(e),r=this.PSI.findTrack(this.PID);if(r){let e={pid:r.id,stream_type:r.stream_type,pes:n};t.emit("data",e)}t._clearCached()}}}class Et{constructor(t){if(this.sync_byte=t[0],this.payload_unit_start_indicator=t[1]>>6&1,this.PID=8191&(t[1]<<8|t[2]),this.afc=t[3]>>4&3,this.has_payload=1&this.afc,this.has_adaptation=2&this.afc,this.has_payload)if(this.has_adaptation){let e=t[4];this.payload=t.subarray(5+e)}else this.payload=t.subarray(4)}valid(){return 71===this.sync_byte&&1===this.has_payload}}class kt extends W{constructor(t={}){super(t),this.psi_=new q(this.ctx_),this.pesStream_=new wt(this.ctx_,this.psi_),this.elementaryStream_=new bt(this.ctx_,this.psi_,t),this.complexStream_=new G(this.ctx_,this.psi_),this.pipe(this.pesStream_),this.pesStream_.pipe(this.elementaryStream_),this.elementaryStream_.pipe(this.complexStream_),super.listenEndStream_()}get endStream(){let t=this.elementaryStream_;return this.options_.decodeCodec&&(t=this.complexStream_),t}push(t,e){const{done:n}=e,{options_:r,ctx_:i,cache_buffer_:o,psi_:a}=this;let s=super.constraintPushData_(t),u=o.byteLength,c=null;for(r.config=e,H.log(`hls demux received ${s.byteLength} bytes, cache ${u} bytes. ${n?"chunk done":""}`),o.append(s);o.byteLength>=188;){let t=o.cut(188);if(t){let e=new Et(t);if(!e.valid()){let n=`Encounter invalid ts packet, packet_length(${t.length}), cache_length(${this.cache_buffer_.byteLength}), has_payload(${e.has_payload}), data(${t})`;H.error(n),this.reset(),i.emit("error",$.TS_SYNC_BYTE,n,{startByte:c,endByte:c+t.byteLength});break}a.parse(e),this.emit("data",e),c+=t.byteLength}}o.empty&&n&&this.emit("done")}reset(){this.cache_buffer_.clear(),this.emit("reset")}}var St,xt;!function(t){t[t.HEAD=0]="HEAD",t[t.BODY=1]="BODY"}(St||(St={})),function(t){t[t.SCRIPT_DATA=18]="SCRIPT_DATA",t[t.VIDEO=9]="VIDEO",t[t.AUDIO=8]="AUDIO"}(xt||(xt={}));var Tt,Pt,Rt,Lt;!function(t){t[t.AAC=10]="AAC"}(Tt||(Tt={})),function(t){t[t.MONO=0]="MONO",t[t.STEREO=1]="STEREO"}(Pt||(Pt={}));!function(t){t[t.SEQUENCE_HEAD=0]="SEQUENCE_HEAD",t[t.AAC_RAW=1]="AAC_RAW"}(Rt||(Rt={}));!function(t){t[t.SEQUENCE_HEAD=0]="SEQUENCE_HEAD",t[t.NALU=1]="NALU",t[t.SEQUENCE_END=2]="SEQUENCE_END"}(Lt||(Lt={}));const At=new vt,Bt=[];At.on("nalu",(t=>{Bt.push(t)}));var Dt;!function(t){t[t.AVC=7]="AVC"}(Dt||(Dt={}));var It=function(){function t(e){o()(this,t),y()(this,"previousPes",null),y()(this,"maxAudioPTS",0),y()(this,"maxVideoPTS",0),y()(this,"error",!1),e&&(this.init(),this.dataArray=[],this.videoArray=[],this.audioArray=[],this.decode=e)}return s()(t,[{key:"init",value:function(){var t=this;try{this.demuxer=new kt({enableWorker:!1,debug:!1,onlyDemuxElementary:!0}),this.demuxer.on(r.DEMUX_DATA,(function(e){t.error||(e instanceof Array?(t.dataArray.push(e),t.demuxed(t.dataArray),t.dataArray=[]):t.dataArray.push(e))})),this.demuxer.on(r.DONE,(function(e){if(!t.error){var n={};t.demuxed(t.dataArray),t.dataArray=[],t.previousPes&&(t.previousPes.partEnd=!0,t.previousPes.lastTS=t.isLast),t.isLast?(t.maxPTS=Math.min(t.maxAudioPTS,t.maxVideoPTS),n.audioEnd=!0,t.audioQueue(n),self.postMessage({type:"demuxedAAC",data:t.audioArray,no:t.no}),t.audioArray=[],self.postMessage({type:"maxPTS",data:{maxAudioPTS:t.maxAudioPTS,maxVideoPTS:t.maxVideoPTS}})):(self.postMessage({type:"demuxedAAC",data:t.audioArray,no:t.no}),t.audioArray=[]),t.decoded||(t.decode.no=t.no,t.decode.poolIndex=t.poolIndex,t.decode.push(t.videoArray),t.videoArray=[],t.previousPes=null)}}))}catch(t){}}},{key:"push",value:function(t){this.demuxer.push(t,{done:!0})}},{key:"demuxed",value:function(t){var e=this;t.forEach((function(t){e.tsDemuxed(t)}))}},{key:"tsDemuxed",value:function(t){var e=t.stream_type,n=t.pes||{};if(27===e&&1===this.decode.codec||36===e&&0===this.decode.codec)this.error||(this.error=!0,this.decode.onCodecError());else switch(e){case 27:case 36:this.videoQueue(n);break;case 3:case 15:case 17:n.PTS=Math.round(n.PTS*u.a*1e3),this.maxAudioPTS=Math.max(n.PTS,this.maxAudioPTS),this.audioQueue(n)}}},{key:"audioQueue",value:function(t){this.audioArray.push(t)}},{key:"videoQueue",value:function(t){this.previousPes=t,this.maxVideoPTS=Math.max(this.maxVideoPTS,t.PTS),this.videoArray.push(t)}},{key:"destroy",value:function(){this.demuxer.destroy()}}]),t}();self.decode=new f,self.decodeMp4=new p;e.default=function(t){t.onmessage=function(e){var n=e.data,r=n.type,i=n.data,o=n.no,a=n.decoded,s=n.poolIndex,u=n.isLast,c=n.sourceType;switch(r){case"startDemux":"HLS"===c?(t.demuxer=new It(t.decode),t.demuxer.isLast=u,t.demuxer.no=o,t.demuxer.decoded=a,t.demuxer.poolIndex=s,t.demuxer.push(i)):"MP4"===c&&t.decodeMp4.push(i);break;case"loadwasm":"HLS"===c?t.decode.loadWASM(e):"MP4"===c&&t.decodeMp4.loadWASM(e);break;case"flush":"HLS"===c?t.decode.flush():"MP4"===c&&t.decodeMp4.flush()}}}},12:function(t,e,n){t.exports=n(95)},125:function(t,e,n){"use strict";n.r(e);var r=n(76);e.default=r.default},13:function(t,e,n){"use strict";var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(0),u=n.n(s),c=n(11),l=console||{};function f(t,e){if(l[t]){if(this.disabled||this.level<0)return;if("production"===c.c.mode&&("error"!==t||"warn"!==t))return;if(1===this.level&&["info"].includes(t))return;if(2===this.level&&["log","info"].includes(t))return;if(this.level>2&&"error"!==t)return;for(var n=(new Date).toLocaleString(),r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=["[32m".concat(e,"[39m")].concat(i,[n]);"error"!==t&&"warn"!==t||(a=[e].concat(i,[n])),"function"==typeof l[t]&&l[t].apply(l,a)}}var h=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),u()(this,"prefix",c.c.projectName),u()(this,"joiner",">"),u()(this,"left","["),u()(this,"right","]"),u()(this,"disabled",!1),u()(this,"level",0),Object.assign(this,n),"string"==typeof e?this.file=e:e&&e.constructor&&(this.file=e.constructor.name)}return a()(t,[{key:"setDisabled",value:function(t){this.disabled=t}},{key:"setLevel",value:function(t){this.level=t}}],[{key:"get",value:function(e,n){return new t(e,n)}}]),t}();["info","log","debug","warn","error"].forEach((function(t){h.prototype[t]=function(e,n){n=void 0===n?"":this.joiner+n;for(var r=this.left+e+n+this.right,i=this.left+this.prefix+" "+this.file+this.right+r,o=arguments.length,a=new Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];f.apply(this,[t,i].concat(a))}})),e.a=h},14:function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=n=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},15:function(t,e){function n(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,o){var a=t.apply(e,r);function s(t){n(a,i,o,s,u,"next",t)}function u(t){n(a,i,o,s,u,"throw",t)}s(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0},2:function(t,e,n){"use strict";n.r(e);e.default={ProcessorResetEnd:"DataProcessorController.processorResetEnd",DataProcessorReady:"DataProcessorController.dataProcessorReady",DecodeStartDecode:"DecodeController.startDecode",DecodeFlush:"DecodeController.flush",DecodeDecoded:"DecodeController.decoded",DecodeApppendEnd:"DecodeController.appendEnd",DecodeFlushEnd:"DecodeController.flushEnd",DecodeReady:"DecodeController.ready",DemuxResetEnd:"DemuxController.resetEnd",DemuxStartDemux:"DemuxController.startDemux",DemuxLast:"DemuxController.last",DemuxVideo:"DemuxController.video",DemuxAAC:"DemuxController.AAC",DemuxReady:"DemuxController.ready",DemuxCodecError:"DemuxController.codecError",ImagePlayerRenderEnd:"ImagePlayer.renderEnd",ImagePlayerWait:"ImagePlayer.wait",ImagePlayerReady:"ImagePlayer.ready",ImagePlayerEnd:"ImagePlayer.end",ImagePlayerBuffeUpdate:"ImagePlayer.bufferUpdate",ImagePlayerSwitchPool:"ImagePlayer.switchPool",ControlBarPlay:"ControlBar.onPlay",ControlBarPause:"ControlBar.onPause",ControlBarPauseLoading:"ControlBar.onPauseLoading",LoadDataReadBufferByNo:"LoadData.readBufferByNo",LoadDataReadBuffer:"LoadData.readBuffer",LoadDataRead:"LoadData.onRead",LoadDataSeek:"LoadData.onSeek",LoadDataFirstLoaded:"LoadData.onFirstLoaded",LoaderPlayListStart:"Loader.playlistStart",LoaderLoading:"Loader.onLoading",LoaderError:"Loader.onError",LoaderLoaded:"Loader.onLoaded",LoaderUpdateSpeed:"Loader.updateSpeed",LoaderLoadFile:"Loader.loadFile",LoaderPlayListLoaded:"Loader.playlistLoaded",AudioPlayerReady:"AudioPlayer.MSEReady",AudioPlayerDataReady:"AudioPlayer.dataReady",AudioPlayerWait:"AudioPlayer.wait",AudioPlayerEnd:"AudioPlayer.end",AudioPlayerPlaySuccess:"AudioPlayer.playSuccess",AudioPlayerPlayFail:"AudioPlayer.playFail",PlayerMaxPTS:"DemuxController.maxpts",PlayerSeekEnd:"Player.seekend",PlayerSpeedTo:"Player.speedTo",PlayerChangeRate:"Player.changeRate",PlayerChangeSrc:"Player.changeSrc",PlayerPlaying:"Player.playing",PlayerTimeUpdate:"Player.timeUpdate",PlayerbufferUpdate:"Player.bufferupdate",PlayerResetReady:"Player.resetReady",PlayerWait:"Player.wait",PlayerLoadNext:"Player.loadNext",PlayerOnPlay:"Player.onPlay",PlayerOnPause:"Player.onPause",PlayerOnSeek:"Player.onSeek",PlayerOnVolume:"Player.onVolume",PlayerReady:"Player.ready",PlayerPlay:"Player.play",PlayerReset:"Player.reset",PlayerLoadedMetaData:"Player.loadedMetaData",PlayerEnd:"Player.end",PlayerPause:"Player.pause",PlayerSeeking:"Player.seeking",PlayerAlert:"Player.alert",PlayerThrowError:"Player.throwError",StreamDataReady:"StreamController.dataReady"}},20:function(t,e,n){var r=n(83),i=n(84),o=n(85),a=n(87);t.exports=function(t,e){return r(t)||i(t,e)||o(t,e)||a()},t.exports.default=t.exports,t.exports.__esModule=!0},21:function(t,e,n){"use strict";(function(t,r,i){n.d(e,"b",(function(){return S})),n.d(e,"a",(function(){return _}));var o=n(20),a=n.n(o),s=n(3),u=n.n(s),c=n(5),l=n.n(c),f=n(6),h=n.n(f),p=n(7),d=n.n(p),y=n(4),g=n.n(y),v=n(9);function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g()(t);if(e){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var b=function(){},_=null,w=[],E=!1;window.fs=t;var k=function(e){h()(o,e);var n=m(o);function o(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b;return u()(this,o),(e=n.call(this)).fs_ready=r,e.write_ready=a,e.read_ready=i,e.header_cnt=11,e.base_offset=4*e.header_cnt,e.img_cache_basedir="/img_cache",e.img_cache_dir=e.img_cache_basedir+"/"+t.toString(),e}return l()(o,[{key:"onError",value:function(t){this.logger.error("Error: "+t)}},{key:"init",value:function(e,n){var i=this;r.install(n);r.configure({fs:e,options:{size:10240,cacheSize:10240,type:PERSISTENT}},(function(e){if(e)throw e;i.logger.info("fs",t),i.fs=t.getRootFS(),i.fs.empty((function(e){e&&i.onError(e),i.logger.info("empty"),i.fs.mkdir(i.img_cache_basedir,777,(function(e){e&&i.onError(e),i.logger.info("mkdir",i.img_cache_basedir),i.fs.mkdir(i.img_cache_dir,777,(function(e){e&&i.onError(e),i.logger.info("mkdir",i.img_cache_dir),E=!0,i.fs_ready(t)}))}))}))}))}},{key:"saveImg",value:function(e,n,r){var o=this;if(r&&r.buf_u){if(E){var s=[r.buf_u.length,r.buf_v.length,r.buf_y.length],u=s[0],c=s[1],l=s[2],f=r.duration,h=r.fps,p=r.height,d=r.pts,y=r.stride_u,g=r.stride_v,v=r.stride_y,m=r.width,b=new ArrayBuffer(this.base_offset+u+c+l),_=new Uint32Array(b),k=new Uint8Array(b);_.subarray(0,this.header_cnt).set(new Uint32Array([u,c,l,f,h,p,d,y,g,v,m]));var S=[0,u,u+c].map((function(t){return t+o.base_offset})),x=a()(S,3),T=x[0],P=x[1],R=x[2];k.set(r.buf_u,T),k.set(r.buf_v,P),k.set(r.buf_y,R);var L=this.img_cache_dir+"/"+e.toString(),A=L+"/"+n.toString()+".jpg",B=!1;w.indexOf(L)>-1&&(B=!0);var D=i.from(b);return new Promise((function(r){B?t.writeFile(A,D,(function(t){t&&o.onError(t),o.logger.info(A+" write ok!"),o.write_ready(e,n,A),r({video_id:e,frame_seq:n,f_path:A})})):o.fs.mkdir(L,777,(function(i){i&&o.onError(i),w.push(L),t.writeFile(A,D,(function(t){t&&o.onError(t),o.logger.info(A+" write ok!"),o.write_ready(e,n,A),r({video_id:e,frame_seq:n,f_path:A})}))}))}))}setTimeout((function(){o.saveImg(e,n,r)}),20)}}},{key:"loadImg",value:function(e,n){var r=this,i=this.img_cache_dir+"/"+e.toString()+"/"+n.toString()+".jpg";return new Promise((function(o,s){t.readFile(i,{},(function(t,i){if(t||!i)return r.onError(t),void s();var u=i.buffer,c=new Uint32Array(u),l=new Uint8Array(u),f=c.slice(0,r.header_cnt),h=f,p=a()(h,11),d=p[0],y=p[1],g=p[2],v=p[3],m=p[4],b=p[5],_=p[6],w=p[7],E=p[8],k=p[9],S=p[10],x=[0,d,d+y].map((function(t){return t+r.base_offset})),T=a()(x,3),P=T[0],R=T[1],L=T[2],A={buf_u:l.slice(P,P+d),buf_v:l.slice(R,R+y),buf_y:l.slice(L,L+g),duration:v,fps:m,height:b,pts:_,stride_u:w,stride_v:E,stride_y:k,width:S};o(A),r.read_ready(e,n,A),c=null,l=null,f=null}))}))}},{key:"empty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;if(this.fs)this.fs.empty(e);else{var n=t.getRootFS();n&&(this.fs=n,this.fs.empty(e))}}}]),o}(v.a);function S(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:window;(_=new k(t,n,r,i)).init(e,o)}}).call(this,n(96),n(43),n(60))},23:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(0),u=n.n(s),c=n(11),l={eval:EvalError,range:RangeError,reference:ReferenceError,syntax:SyntaxError,type:TypeError,uri:URIError,default:Error},f=null,h=(f||(f=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1001;return i()(this,t),u()(this,"type",""),u()(this,"errorName","DefaultError"),u()(this,"code",null),u()(this,"message",""),u()(this,"stack",""),this.type=e,this.code=n,this.throws.bind(this)}return a()(t,[{key:"throws",value:function(t){for(var e="",n=Error,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];if(t instanceof Error){for(var a in l)if(t instanceof l[a]){this.errorName=l[a].name,n=t.constructor;break}this.stack=t.stack,i&&i.splice&&(e=i[0],i.splice(0,1))}else e=t.toString();this.message="[".concat(c.c.projectName," ERROR:")+this.type+"-"+this.code+"]"+e;try{throw new n(this.message,"[args]:",i)}catch(t){this.stack=this.stack||t.stack}}}]),t}())),f)},24:function(t,e,n){var r=n(88),i=n(59);t.exports=function(t,e){var n=i(t,e,"get");return r(t,n)},t.exports.default=t.exports,t.exports.__esModule=!0},27:function(t,e,n){"use strict";var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(0),u=n.n(s);function c(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var f=n(13).a.get("Events.js"),h=function(){function t(e){i()(this,t),u()(this,"eventsQueue",{}),u()(this,"target",{}),u()(this,"disallowRepeat",!1),this.target=e}return a()(t,[{key:"add",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=c(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;this.on(o,n,r)}}catch(t){i.e(t)}finally{i.f()}}},{key:"on",value:function(t,e,n){if(void 0===this.eventsQueue[t]&&(this.eventsQueue[t]={methods:[],once:!1}),"function"==typeof e){if(!this.disallowRepeat||!this.eventsQueue[t].methods.includes(e))return this.eventsQueue[t].methods.push(e),void 0!==n&&(this.eventsQueue[t].once=n),this.target}else f.error("on","the argument is not function.",e)}},{key:"once",value:function(t,e){this.on(t,e,!0)}},{key:"off",value:function(t,e){var n=this.eventsQueue[t];if(n){var r=n.methods;if(e)for(var i=r.length;i--;)r[i]===e&&r.splice(i,1);else delete this.eventsQueue[t];return this.target}}},{key:"emit",value:function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=this.eventsQueue[t];if(o){var a=o.methods;return a.forEach((function(t){t.apply(e.target,r)})),o.once&&this.off(t),this.target}}},{key:"clear",value:function(t){delete this.eventsQueue[t]}},{key:"clearAll",value:function(){this.eventsQueue={}}}]),t}();e.a=function(t){var e=new h(t);return function(t){return e.target=t,e}}},28:function(t,e,n){var r=n(34),i=n(90);function o(e,n,a){return i()?(t.exports=o=Reflect.construct,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},t.exports.default=t.exports,t.exports.__esModule=!0),o.apply(null,arguments)}t.exports=o,t.exports.default=t.exports,t.exports.__esModule=!0},29:function(t,e,n){var r=n(89),i=n(59);t.exports=function(t,e,n){var o=i(t,e,"set");return r(t,o,n),n},t.exports.default=t.exports,t.exports.__esModule=!0},3:function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},32:function(t,e,n){var r=n(4),i=n(34),o=n(91),a=n(28);function s(e){var n="function"==typeof Map?new Map:void 0;return t.exports=s=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return a(t,arguments,r(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i(e,t)},t.exports.default=t.exports,t.exports.__esModule=!0,s(e)}t.exports=s,t.exports.default=t.exports,t.exports.__esModule=!0},34:function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,n(e,r)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},35:function(t,e,n){function r(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw t};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,e,r){var s={};s[r]=[];var u=e.toString(),c=u.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return s;for(var l,f=c[1],h=new RegExp("(\\\\n|\\W)"+a(f)+o,"g");l=h.exec(u);)"dll-reference"!==l[3]&&s[r].push(l[3]);for(h=new RegExp("\\("+a(f)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");l=h.exec(u);)t[l[2]]||(s[r].push(l[1]),t[l[2]]=n(l[1]).m),s[l[2]]=s[l[2]]||[],s[l[2]].push(l[4]);for(var p,d=Object.keys(s),y=0;y<d.length;y++)for(var g=0;g<s[d[y]].length;g++)p=s[d[y]][g],isNaN(1*p)||(s[d[y]][g]=1*s[d[y]][g]);return s}function u(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var i={main:n.m},o=e.all?{main:Object.keys(i.main)}:function(t,e){for(var n={main:[e]},r={main:[]},i={main:{}};u(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var c=o[a],l=n[c].pop();if(i[c]=i[c]||{},!i[c][l]&&t[c][l]){i[c][l]=!0,r[c]=r[c]||[],r[c].push(l);for(var f=s(t,t[c][l],c),h=Object.keys(f),p=0;p<h.length;p++)n[h[p]]=n[h[p]]||[],n[h[p]]=n[h[p]].concat(f[h[p]])}}return r}(i,t),a="";Object.keys(o).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;o[t][e];)e++;o[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var c=new window.Blob([a],{type:"text/javascript"});if(e.bare)return c;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),f=new window.Worker(l);return f.objectURL=l,f}},36:function(t,e,n){var r,i,o;i=[],void 0===(o="function"==typeof(r=function(){var t=function(){},e={},n={},r={};function i(t,e){t=t.push?t:[t];var i,o,a,s=[],u=t.length,c=u;for(i=function(t,n){n.length&&s.push(t),--c||e(s)};u--;)o=t[u],(a=n[o])?i(o,a):(r[o]=r[o]||[]).push(i)}function o(t,e){if(t){var i=r[t];if(n[t]=e,i)for(;i.length;)i[0](t,e),i.splice(0,1)}}function a(e,n){e.call&&(e={success:e}),n.length?(e.error||t)(n):(e.success||t)(e)}function s(e,n,r,i){var o,a,u=document,c=r.async,l=(r.numRetries||0)+1,f=r.before||t,h=e.replace(/[\?|#].*$/,""),p=e.replace(/^(css|img)!/,"");i=i||0,/(^css!|\.css$)/.test(h)?((a=u.createElement("link")).rel="stylesheet",a.href=p,(o="hideFocus"in a)&&a.relList&&(o=0,a.rel="preload",a.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(h)?(a=u.createElement("img")).src=p:((a=u.createElement("script")).src=e,a.async=void 0===c||c),a.onload=a.onerror=a.onbeforeload=function(t){var u=t.type[0];if(o)try{a.sheet.cssText.length||(u="e")}catch(t){18!=t.code&&(u="e")}if("e"==u){if((i+=1)<l)return s(e,n,r,i)}else if("preload"==a.rel&&"style"==a.as)return a.rel="stylesheet";n(e,u,t.defaultPrevented)},!1!==f(e,a)&&u.head.appendChild(a)}function u(t,e,n){var r,i,o=(t=t.push?t:[t]).length,a=o,u=[];for(r=function(t,n,r){if("e"==n&&u.push(t),"b"==n){if(!r)return;u.push(t)}--o||e(u)},i=0;i<a;i++)s(t[i],r,n)}function c(t,n,r){var i,s;if(n&&n.trim&&(i=n),s=(i?r:n)||{},i){if(i in e)throw"LoadJS";e[i]=!0}function c(e,n){u(t,(function(t){a(s,t),e&&a({success:e,error:n},t),o(i,t)}),s)}if(s.returnPromise)return new Promise(c);c()}return c.ready=function(t,e){return i(t,(function(t){a(e,t)})),c},c.done=function(t){o(t,[])},c.reset=function(){e={},n={},r={}},c.isDefined=function(t){return t in e},c})?r.apply(e,i):r)||(t.exports=o)},37:function(t,e,n){var r=n(34);t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0},377:function(t,e,n){"use strict";n.r(e);var r=n(125),i=n(2),o=document.querySelector(".play-container"),a=window.innerWidth-40;o.style.width=a+"px",o.style.height=a/2+"px";var s=window.location.href,u=s.slice(0,s.lastIndexOf("/")+1)+"lib/",c=location.href.slice(0,location.href.lastIndexOf(location.pathname))+"/data/video2/video.m3u8",l=null,f=!1,h=c,p=document.querySelector("#currentFrame");function d(t){var e=l.imagePlayer.imageData.fps,n=Math.trunc(t/1e3*e);p.innerHTML=n}var y=function(){l&&d(l.currentTime)},g=function(t,e){l&&(l.events.off(i.default.ImagePlayerRenderEnd,y),l.destroy()),l=new r.default(o,{sourceURL:t,type:"HLS",muted:!1,isLive:e,libPath:u,playBackRate:1,controlBar:!0,autoPlay:!1,autoScale:!0,defaultAlert:!0,keepCache:!1}),window.player=l,l.events.on(i.default.ImagePlayerRenderEnd,y)};!function(){g(c,f);var t=document.querySelector("#seekValue");document.querySelector("#seekBtn").onclick=function(){var e=t.value;l&&l.seek(1e3*e)};var e=document.querySelector("#srcValue");document.querySelector("#srcBtn").onclick=function(){var t=e.value;g(h=t,f)},document.querySelector("#isLive").onclick=function(t){f=t.target.checked,g(h,f)};var n=document.querySelector("#prevFrame"),r=document.querySelector("#nextFrame");n.onclick=function(){var t=1e3/l.imagePlayer.imageData.fps,e=l.currentTime,n=e-t<0?0:e-t;l.seek(n),d(n)},r.onclick=function(){var t=1e3/l.imagePlayer.imageData.fps,e=l.currentTime,n=1e3*l.duration,r=e+t>n?n:e+t;l.seek(r),d(r)};var i=document.querySelector("#fullScreen"),a=document.querySelector("#exitFullScreen");i.onclick=function(){l.fullScreen()},a.onclick=function(){l.exitFullScreen()},window.onresize=function(){var t=window.innerWidth-40;o.style.width=t+"px",o.style.height=t/2+"px",l.resize(t,t/2)}}()},4:function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.default=t.exports,t.exports.__esModule=!0,n(e)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},43:function(t,e,n){(function(e){var n;n=function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,r){(function(t,i,o,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var s,u=r(2),c=r(9);!function(t){t[t.EPERM=1]="EPERM",t[t.ENOENT=2]="ENOENT",t[t.EIO=5]="EIO",t[t.EBADF=9]="EBADF",t[t.EACCES=13]="EACCES",t[t.EBUSY=16]="EBUSY",t[t.EEXIST=17]="EEXIST",t[t.ENOTDIR=20]="ENOTDIR",t[t.EISDIR=21]="EISDIR",t[t.EINVAL=22]="EINVAL",t[t.EFBIG=27]="EFBIG",t[t.ENOSPC=28]="ENOSPC",t[t.EROFS=30]="EROFS",t[t.ENOTEMPTY=39]="ENOTEMPTY",t[t.ENOTSUP=95]="ENOTSUP"}(s||(s={}));var l={};l[s.EPERM]="Operation not permitted.",l[s.ENOENT]="No such file or directory.",l[s.EIO]="Input/output error.",l[s.EBADF]="Bad file descriptor.",l[s.EACCES]="Permission denied.",l[s.EBUSY]="Resource busy or locked.",l[s.EEXIST]="File exists.",l[s.ENOTDIR]="File is not a directory.",l[s.EISDIR]="File is a directory.",l[s.EINVAL]="Invalid argument.",l[s.EFBIG]="File is too big.",l[s.ENOSPC]="No space left on disk.",l[s.EROFS]="Cannot modify a read-only file system.",l[s.ENOTEMPTY]="Directory is not empty.",l[s.ENOTSUP]="Operation is not supported.";var f,h=function(e){function n(t,n,r){void 0===n&&(n=l[t]),e.call(this,n),this.syscall="",this.errno=t,this.code=s[t],this.path=r,this.stack=(new e).stack,this.message="Error: "+this.code+": "+n+(this.path?", '"+this.path+"'":"")}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.fromJSON=function(t){var e=new n(0);return e.errno=t.errno,e.code=t.code,e.path=t.path,e.stack=t.stack,e.message=t.message,e},n.fromBuffer=function(t,e){return void 0===e&&(e=0),n.fromJSON(JSON.parse(t.toString("utf8",e+4,e+4+t.readUInt32LE(e))))},n.FileError=function(t,e){return new n(t,l[t],e)},n.ENOENT=function(t){return this.FileError(s.ENOENT,t)},n.EEXIST=function(t){return this.FileError(s.EEXIST,t)},n.EISDIR=function(t){return this.FileError(s.EISDIR,t)},n.ENOTDIR=function(t){return this.FileError(s.ENOTDIR,t)},n.EPERM=function(t){return this.FileError(s.EPERM,t)},n.ENOTEMPTY=function(t){return this.FileError(s.ENOTEMPTY,t)},n.prototype.toString=function(){return this.message},n.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},n.prototype.writeToBuffer=function(e,n){void 0===e&&(e=t.alloc(this.bufferSize())),void 0===n&&(n=0);var r=e.write(JSON.stringify(this.toJSON()),n+4);return e.writeUInt32LE(r,n),e},n.prototype.bufferSize=function(){return 4+t.byteLength(JSON.stringify(this.toJSON()))},n}(Error),p=Object.freeze({get ErrorCode(){return s},ErrorStrings:l,ApiError:h});!function(t){t[t.NOP=0]="NOP",t[t.THROW_EXCEPTION=1]="THROW_EXCEPTION",t[t.TRUNCATE_FILE=2]="TRUNCATE_FILE",t[t.CREATE_FILE=3]="CREATE_FILE"}(f||(f={}));var d,y=function t(e){if(this.flagStr=e,t.validFlagStrs.indexOf(e)<0)throw new h(s.EINVAL,"Invalid flag: "+e)};y.getFileFlag=function(t){return y.flagCache.hasOwnProperty(t)?y.flagCache[t]:y.flagCache[t]=new y(t)},y.prototype.getFlagString=function(){return this.flagStr},y.prototype.isReadable=function(){return-1!==this.flagStr.indexOf("r")||-1!==this.flagStr.indexOf("+")},y.prototype.isWriteable=function(){return-1!==this.flagStr.indexOf("w")||-1!==this.flagStr.indexOf("a")||-1!==this.flagStr.indexOf("+")},y.prototype.isTruncating=function(){return-1!==this.flagStr.indexOf("w")},y.prototype.isAppendable=function(){return-1!==this.flagStr.indexOf("a")},y.prototype.isSynchronous=function(){return-1!==this.flagStr.indexOf("s")},y.prototype.isExclusive=function(){return-1!==this.flagStr.indexOf("x")},y.prototype.pathExistsAction=function(){return this.isExclusive()?f.THROW_EXCEPTION:this.isTruncating()?f.TRUNCATE_FILE:f.NOP},y.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&"r+"!==this.flagStr?f.CREATE_FILE:f.THROW_EXCEPTION},y.flagCache={},y.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"],function(t){t[t.FILE=32768]="FILE",t[t.DIRECTORY=16384]="DIRECTORY",t[t.SYMLINK=40960]="SYMLINK"}(d||(d={}));var g=function(t,e,n,r,i,o){if(void 0===r&&(r=new Date),void 0===i&&(i=new Date),void 0===o&&(o=new Date),this.size=e,this.atime=r,this.mtime=i,this.ctime=o,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.fileData=null,n)this.mode=n;else switch(t){case d.FILE:this.mode=420;break;case d.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(e/512),this.mode<4096&&(this.mode|=t)};g.fromBuffer=function(t){var e=t.readUInt32LE(0),n=t.readUInt32LE(4),r=t.readDoubleLE(8),i=t.readDoubleLE(16),o=t.readDoubleLE(24);return new g(61440&n,e,4095&n,new Date(r),new Date(i),new Date(o))},g.prototype.toBuffer=function(){var e=t.alloc(32);return e.writeUInt32LE(this.size,0),e.writeUInt32LE(this.mode,4),e.writeDoubleLE(this.atime.getTime(),8),e.writeDoubleLE(this.mtime.getTime(),16),e.writeDoubleLE(this.ctime.getTime(),24),e},g.prototype.clone=function(){return new g(61440&this.mode,this.size,4095&this.mode,this.atime,this.mtime,this.ctime)},g.prototype.isFile=function(){return(61440&this.mode)===d.FILE},g.prototype.isDirectory=function(){return(61440&this.mode)===d.DIRECTORY},g.prototype.isSymbolicLink=function(){return(61440&this.mode)===d.SYMLINK},g.prototype.chmod=function(t){this.mode=61440&this.mode|t},g.prototype.isSocket=function(){return!1},g.prototype.isBlockDevice=function(){return!1},g.prototype.isCharacterDevice=function(){return!1},g.prototype.isFIFO=function(){return!1};var v=function(t,e){return t};function m(t){if(t)return t;throw new h(s.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function b(t,e){switch(typeof t){case"number":return t;case"string":var n=parseInt(t,8);return isNaN(n)?e:n;default:return e}}function _(t){if(t instanceof Date)return t;if("number"==typeof t)return new Date(1e3*t);throw new h(s.EINVAL,"Invalid time.")}function w(t){if(t.indexOf("\0")>=0)throw new h(s.EINVAL,"Path must be a string without null bytes.");if(""===t)throw new h(s.EINVAL,"Path must not be empty.");return c.resolve(t)}function E(t,e,n,r){switch(typeof t){case"object":return{encoding:void 0!==t.encoding?t.encoding:e,flag:void 0!==t.flag?t.flag:n,mode:b(t.mode,r)};case"string":return{encoding:t,flag:n,mode:r};default:return{encoding:e,flag:n,mode:r}}}function k(){}var S=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};S.prototype.initialize=function(t){if(!t.constructor.isAvailable())throw new h(s.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=t},S.prototype._toUnixTimestamp=function(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw new Error("Cannot parse time: "+t)},S.prototype.getRootFS=function(){return this.root?this.root:null},S.prototype.rename=function(t,e,n){void 0===n&&(n=k);var r=v(n,1);try{m(this.root).rename(w(t),w(e),r)}catch(t){r(t)}},S.prototype.renameSync=function(t,e){m(this.root).renameSync(w(t),w(e))},S.prototype.exists=function(t,e){void 0===e&&(e=k);var n=v(e,1);try{return m(this.root).exists(w(t),n)}catch(t){return n(!1)}},S.prototype.existsSync=function(t){try{return m(this.root).existsSync(w(t))}catch(t){return!1}},S.prototype.stat=function(t,e){void 0===e&&(e=k);var n=v(e,2);try{return m(this.root).stat(w(t),!1,n)}catch(t){return n(t)}},S.prototype.statSync=function(t){return m(this.root).statSync(w(t),!1)},S.prototype.lstat=function(t,e){void 0===e&&(e=k);var n=v(e,2);try{return m(this.root).stat(w(t),!0,n)}catch(t){return n(t)}},S.prototype.lstatSync=function(t){return m(this.root).statSync(w(t),!0)},S.prototype.truncate=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=k);var r=0;"function"==typeof e?n=e:"number"==typeof e&&(r=e);var i=v(n,1);try{if(r<0)throw new h(s.EINVAL);return m(this.root).truncate(w(t),r,i)}catch(t){return i(t)}},S.prototype.truncateSync=function(t,e){if(void 0===e&&(e=0),e<0)throw new h(s.EINVAL);return m(this.root).truncateSync(w(t),e)},S.prototype.unlink=function(t,e){void 0===e&&(e=k);var n=v(e,1);try{return m(this.root).unlink(w(t),n)}catch(t){return n(t)}},S.prototype.unlinkSync=function(t){return m(this.root).unlinkSync(w(t))},S.prototype.open=function(t,e,n,r){var i=this;void 0===r&&(r=k);var o=b(n,420),a=v(r="function"==typeof n?n:r,2);try{m(this.root).open(w(t),y.getFileFlag(e),o,(function(t,e){e?a(t,i.getFdForFile(e)):a(t)}))}catch(t){a(t)}},S.prototype.openSync=function(t,e,n){return void 0===n&&(n=420),this.getFdForFile(m(this.root).openSync(w(t),y.getFileFlag(e),b(n,420)))},S.prototype.readFile=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n=k);var r=E(e,null,"r",null),i=v(n="function"==typeof e?e:n,2);try{var o=y.getFileFlag(r.flag);return o.isReadable()?m(this.root).readFile(w(t),r.encoding,o,i):i(new h(s.EINVAL,"Flag passed to readFile must allow for reading."))}catch(t){return i(t)}},S.prototype.readFileSync=function(t,e){void 0===e&&(e={});var n=E(e,null,"r",null),r=y.getFileFlag(n.flag);if(!r.isReadable())throw new h(s.EINVAL,"Flag passed to readFile must allow for reading.");return m(this.root).readFileSync(w(t),n.encoding,r)},S.prototype.writeFile=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r=k);var i=E(n,"utf8","w",420),o=v(r="function"==typeof n?n:r,1);try{var a=y.getFileFlag(i.flag);return a.isWriteable()?m(this.root).writeFile(w(t),e,i.encoding,a,i.mode,o):o(new h(s.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(t){return o(t)}},S.prototype.writeFileSync=function(t,e,n){var r=E(n,"utf8","w",420),i=y.getFileFlag(r.flag);if(!i.isWriteable())throw new h(s.EINVAL,"Flag passed to writeFile must allow for writing.");return m(this.root).writeFileSync(w(t),e,r.encoding,i,r.mode)},S.prototype.appendFile=function(t,e,n,r){void 0===r&&(r=k);var i=E(n,"utf8","a",420),o=v(r="function"==typeof n?n:r,1);try{var a=y.getFileFlag(i.flag);if(!a.isAppendable())return o(new h(s.EINVAL,"Flag passed to appendFile must allow for appending."));m(this.root).appendFile(w(t),e,i.encoding,a,i.mode,o)}catch(t){o(t)}},S.prototype.appendFileSync=function(t,e,n){var r=E(n,"utf8","a",420),i=y.getFileFlag(r.flag);if(!i.isAppendable())throw new h(s.EINVAL,"Flag passed to appendFile must allow for appending.");return m(this.root).appendFileSync(w(t),e,r.encoding,i,r.mode)},S.prototype.fstat=function(t,e){void 0===e&&(e=k);var n=v(e,2);try{this.fd2file(t).stat(n)}catch(t){n(t)}},S.prototype.fstatSync=function(t){return this.fd2file(t).statSync()},S.prototype.close=function(t,e){var n=this;void 0===e&&(e=k);var r=v(e,1);try{this.fd2file(t).close((function(e){e||n.closeFd(t),r(e)}))}catch(t){r(t)}},S.prototype.closeSync=function(t){this.fd2file(t).closeSync(),this.closeFd(t)},S.prototype.ftruncate=function(t,e,n){void 0===n&&(n=k);var r="number"==typeof e?e:0,i=v(n="function"==typeof e?e:n,1);try{var o=this.fd2file(t);if(r<0)throw new h(s.EINVAL);o.truncate(r,i)}catch(t){i(t)}},S.prototype.ftruncateSync=function(t,e){void 0===e&&(e=0);var n=this.fd2file(t);if(e<0)throw new h(s.EINVAL);n.truncateSync(e)},S.prototype.fsync=function(t,e){void 0===e&&(e=k);var n=v(e,1);try{this.fd2file(t).sync(n)}catch(t){n(t)}},S.prototype.fsyncSync=function(t){this.fd2file(t).syncSync()},S.prototype.fdatasync=function(t,e){void 0===e&&(e=k);var n=v(e,1);try{this.fd2file(t).datasync(n)}catch(t){n(t)}},S.prototype.fdatasyncSync=function(t){this.fd2file(t).datasyncSync()},S.prototype.write=function(e,n,r,i,o,a){void 0===a&&(a=k);var u,c,l,f=null;if("string"==typeof n){var p="utf8";switch(typeof r){case"function":a=r;break;case"number":f=r,p="string"==typeof i?i:"utf8",a="function"==typeof o?o:a;break;default:return(a="function"==typeof i?i:"function"==typeof o?o:a)(new h(s.EINVAL,"Invalid arguments."))}c=0,l=(u=t.from(n,p)).length}else u=n,c=r,l=i,f="number"==typeof o?o:null,a="function"==typeof o?o:a;var d=v(a,3);try{var y=this.fd2file(e);null==f&&(f=y.getPos()),y.write(u,c,l,f,d)}catch(t){d(t)}},S.prototype.writeSync=function(e,n,r,i,o){var a,s,u,c=0;if("string"==typeof n){u="number"==typeof r?r:null;var l="string"==typeof i?i:"utf8";c=0,s=(a=t.from(n,l)).length}else a=n,c=r,s=i,u="number"==typeof o?o:null;var f=this.fd2file(e);return null==u&&(u=f.getPos()),f.writeSync(a,c,s,u)},S.prototype.read=function(e,n,r,i,o,a){var s,u,c,l,f;if(void 0===a&&(a=k),"number"==typeof n){c=n,s=r;var h=i;a="function"==typeof o?o:a,u=0,l=t.alloc(c),f=v((function(t,e,n){if(t)return a(t);a(t,n.toString(h),e)}),3)}else l=n,u=r,c=i,s=o,f=v(a,3);try{var p=this.fd2file(e);null==s&&(s=p.getPos()),p.read(l,u,c,s,f)}catch(t){f(t)}},S.prototype.readSync=function(e,n,r,i,o){var a,s,u,c,l=!1,f="utf8";"number"==typeof n?(u=n,c=r,f=i,s=0,a=t.alloc(u),l=!0):(a=n,s=r,u=i,c=o);var h=this.fd2file(e);null==c&&(c=h.getPos());var p=h.readSync(a,s,u,c);return l?[a.toString(f),p]:p},S.prototype.fchown=function(t,e,n,r){void 0===r&&(r=k);var i=v(r,1);try{this.fd2file(t).chown(e,n,i)}catch(t){i(t)}},S.prototype.fchownSync=function(t,e,n){this.fd2file(t).chownSync(e,n)},S.prototype.fchmod=function(t,e,n){var r=v(n,1);try{var i="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmod(i,r)}catch(t){r(t)}},S.prototype.fchmodSync=function(t,e){var n="string"==typeof e?parseInt(e,8):e;this.fd2file(t).chmodSync(n)},S.prototype.futimes=function(t,e,n,r){void 0===r&&(r=k);var i=v(r,1);try{var o=this.fd2file(t);"number"==typeof e&&(e=new Date(1e3*e)),"number"==typeof n&&(n=new Date(1e3*n)),o.utimes(e,n,i)}catch(t){i(t)}},S.prototype.futimesSync=function(t,e,n){this.fd2file(t).utimesSync(_(e),_(n))},S.prototype.rmdir=function(t,e){void 0===e&&(e=k);var n=v(e,1);try{t=w(t),m(this.root).rmdir(t,n)}catch(t){n(t)}},S.prototype.rmdirSync=function(t){return t=w(t),m(this.root).rmdirSync(t)},S.prototype.mkdir=function(t,e,n){void 0===n&&(n=k),"function"==typeof e&&(n=e,e=511);var r=v(n,1);try{t=w(t),m(this.root).mkdir(t,e,r)}catch(t){r(t)}},S.prototype.mkdirSync=function(t,e){m(this.root).mkdirSync(w(t),b(e,511))},S.prototype.readdir=function(t,e){void 0===e&&(e=k);var n=v(e,2);try{t=w(t),m(this.root).readdir(t,n)}catch(t){n(t)}},S.prototype.readdirSync=function(t){return t=w(t),m(this.root).readdirSync(t)},S.prototype.link=function(t,e,n){void 0===n&&(n=k);var r=v(n,1);try{t=w(t),e=w(e),m(this.root).link(t,e,r)}catch(t){r(t)}},S.prototype.linkSync=function(t,e){return t=w(t),e=w(e),m(this.root).linkSync(t,e)},S.prototype.symlink=function(t,e,n,r){void 0===r&&(r=k);var i="string"==typeof n?n:"file",o=v(r="function"==typeof n?n:r,1);try{if("file"!==i&&"dir"!==i)return o(new h(s.EINVAL,"Invalid type: "+i));t=w(t),e=w(e),m(this.root).symlink(t,e,i,o)}catch(t){o(t)}},S.prototype.symlinkSync=function(t,e,n){if(n){if("file"!==n&&"dir"!==n)throw new h(s.EINVAL,"Invalid type: "+n)}else n="file";return t=w(t),e=w(e),m(this.root).symlinkSync(t,e,n)},S.prototype.readlink=function(t,e){void 0===e&&(e=k);var n=v(e,2);try{t=w(t),m(this.root).readlink(t,n)}catch(t){n(t)}},S.prototype.readlinkSync=function(t){return t=w(t),m(this.root).readlinkSync(t)},S.prototype.chown=function(t,e,n,r){void 0===r&&(r=k);var i=v(r,1);try{t=w(t),m(this.root).chown(t,!1,e,n,i)}catch(t){i(t)}},S.prototype.chownSync=function(t,e,n){t=w(t),m(this.root).chownSync(t,!1,e,n)},S.prototype.lchown=function(t,e,n,r){void 0===r&&(r=k);var i=v(r,1);try{t=w(t),m(this.root).chown(t,!0,e,n,i)}catch(t){i(t)}},S.prototype.lchownSync=function(t,e,n){t=w(t),m(this.root).chownSync(t,!0,e,n)},S.prototype.chmod=function(t,e,n){void 0===n&&(n=k);var r=v(n,1);try{var i=b(e,-1);if(i<0)throw new h(s.EINVAL,"Invalid mode.");m(this.root).chmod(w(t),!1,i,r)}catch(t){r(t)}},S.prototype.chmodSync=function(t,e){var n=b(e,-1);if(n<0)throw new h(s.EINVAL,"Invalid mode.");t=w(t),m(this.root).chmodSync(t,!1,n)},S.prototype.lchmod=function(t,e,n){void 0===n&&(n=k);var r=v(n,1);try{var i=b(e,-1);if(i<0)throw new h(s.EINVAL,"Invalid mode.");m(this.root).chmod(w(t),!0,i,r)}catch(t){r(t)}},S.prototype.lchmodSync=function(t,e){var n=b(e,-1);if(n<1)throw new h(s.EINVAL,"Invalid mode.");m(this.root).chmodSync(w(t),!0,n)},S.prototype.utimes=function(t,e,n,r){void 0===r&&(r=k);var i=v(r,1);try{m(this.root).utimes(w(t),_(e),_(n),i)}catch(t){i(t)}},S.prototype.utimesSync=function(t,e,n){m(this.root).utimesSync(w(t),_(e),_(n))},S.prototype.realpath=function(t,e,n){void 0===n&&(n=k);var r="object"==typeof e?e:{},i=v(n="function"==typeof e?e:k,2);try{t=w(t),m(this.root).realpath(t,r,i)}catch(t){i(t)}},S.prototype.realpathSync=function(t,e){return void 0===e&&(e={}),t=w(t),m(this.root).realpathSync(t,e)},S.prototype.watchFile=function(t,e,n){throw void 0===n&&(n=k),new h(s.ENOTSUP)},S.prototype.unwatchFile=function(t,e){throw void 0===e&&(e=k),new h(s.ENOTSUP)},S.prototype.watch=function(t,e,n){throw void 0===n&&(n=k),new h(s.ENOTSUP)},S.prototype.access=function(t,e,n){throw void 0===n&&(n=k),new h(s.ENOTSUP)},S.prototype.accessSync=function(t,e){throw new h(s.ENOTSUP)},S.prototype.createReadStream=function(t,e){throw new h(s.ENOTSUP)},S.prototype.createWriteStream=function(t,e){throw new h(s.ENOTSUP)},S.prototype.wrapCallbacks=function(t){v=t},S.prototype.getFdForFile=function(t){var e=this.nextFd++;return this.fdMap[e]=t,e},S.prototype.fd2file=function(t){var e=this.fdMap[t];if(e)return e;throw new h(s.EBADF,"Invalid file descriptor.")},S.prototype.closeFd=function(t){delete this.fdMap[t]},S.Stats=g;var x=new S,T={},P=S.prototype;function R(t,e,n,r,i){return t<e||n<e?t>n?n+1:t+1:r===i?e:e+1}function L(t,e){if(t===e)return 0;if(t.length>e.length){var n=t;t=e,e=n}for(var r=t.length,i=e.length;r>0&&t.charCodeAt(r-1)===e.charCodeAt(i-1);)r--,i--;for(var o=0;o<r&&t.charCodeAt(o)===e.charCodeAt(o);)o++;if(i-=o,0==(r-=o)||1===i)return i;for(var a,s,u,c,l,f=new Array(r<<1),h=0;h<r;)f[r+h]=t.charCodeAt(o+h),f[h]=++h;for(a=0;a+3<i;)for(var p=e.charCodeAt(o+(s=a)),d=e.charCodeAt(o+(u=a+1)),y=e.charCodeAt(o+(c=a+2)),g=e.charCodeAt(o+(l=a+3)),v=a+=4,m=0;m<r;){var b=f[r+m],_=f[m];s=R(_,s,u,p,b),u=R(s,u,c,d,b),c=R(u,c,l,y,b),v=R(c,l,v,g,b),f[m++]=v,l=c,c=u,u=s,s=_}for(var w=0;a<i;){var E=e.charCodeAt(o+(s=a));w=++a;for(var k=0;k<r;k++){var S=f[k];f[k]=w=S<s||w<s?S>w?w+1:S+1:E===f[r+k]?s:s+1,s=S}}return w}function A(t,e,n){}Object.keys(P).forEach((function(t){"function"==typeof x[t]?T[t]=function(){return x[t].apply(x,arguments)}:T[t]=x[t]})),T.changeFSModule=function(t){x=t},T.getFSModule=function(){return x},T.FS=S;var B="undefined"!=typeof navigator&&!(!/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())&&-1===navigator.userAgent.indexOf("Trident")),D="undefined"==typeof window;function I(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function O(t,e,n){n.existsSync(t)||(O(c.dirname(t),e,n),n.mkdirSync(t,e))}function C(t){var e=N(t),n=e.byteOffset,r=e.byteLength;return 0===n&&r===e.buffer.byteLength?e.buffer:e.buffer.slice(n,n+r)}function N(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function F(e){return e instanceof t?e:e instanceof Uint8Array?M(e):t.from(e)}function M(e){return e instanceof t?e:0===e.byteOffset&&e.byteLength===e.buffer.byteLength?U(e.buffer):t.from(e.buffer,e.byteOffset,e.byteLength)}function U(e){return t.from(e)}function j(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=t.length),e<0||n<0||n>t.length||e>n)throw new TypeError("Invalid slice bounds on buffer of length "+t.length+": ["+e+", "+n+"]");if(0===t.length)return z();var r=N(t),i=t[0],o=(i+1)%255;return t[0]=o,r[0]===o?(r[0]=i,M(r.slice(e,n))):(t[0]=i,M(r.subarray(e,n)))}var H=null;function z(){return H||(H=t.alloc(0))}function W(e,n){t.isBuffer(e)?n():n(new h(s.EINVAL,"option must be a Buffer."))}function V(t,e,n){var r=t.Options,i=t.Name,o=0,a=!1,u=!1;function c(t){a||(t&&(a=!0,n(t)),0==--o&&u&&n())}var l=function(t){if(r.hasOwnProperty(t)){var u=r[t],l=e[t];if(null==l){if(!u.optional){var f=Object.keys(e).filter((function(t){return!(t in r)})).map((function(e){return{str:e,distance:L(t,e)}})).filter((function(t){return t.distance<5})).sort((function(t,e){return t.distance-e.distance}));return a?{}:(a=!0,{v:n(new h(s.EINVAL,"["+i+"] Required option '"+t+"' not provided."+(f.length>0?" You provided unrecognized option '"+f[0].str+"'; perhaps you meant to type '"+t+"'.":"")+"\nOption description: "+u.description))})}}else{if(!(Array.isArray(u.type)?-1!==u.type.indexOf(typeof l):typeof l===u.type))return a?{}:(a=!0,{v:n(new h(s.EINVAL,"["+i+"] Value provided for option "+t+" is not the proper type. Expected "+(Array.isArray(u.type)?"one of {"+u.type.join(", ")+"}":u.type)+", but received "+typeof l+"\nOption description: "+u.description))});u.validator&&(o++,u.validator(l,c))}}};for(var f in r){var p=l(f);if(p)return p.v}u=!0,0!==o||a||n()}var $=Object.freeze({deprecationMessage:A,isIE:B,isWebWorker:D,fail:I,mkdirpSync:O,buffer2ArrayBuffer:C,buffer2Uint8array:N,arrayish2Buffer:F,uint8Array2Buffer:M,arrayBuffer2Buffer:U,copyingSlice:j,emptyBuffer:z,bufferValidator:W,checkOptions:V}),X=function(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()};X.prototype.open=function(t){var e=this.fs.realPath(t.node),n=this.FS;try{n.isFile(t.node.mode)&&(t.nfd=this.nodefs.openSync(e,this.fs.flagsToPermissionString(t.flags)))}catch(t){if(!t.code)throw t;throw new n.ErrnoError(this.ERRNO_CODES[t.code])}},X.prototype.close=function(t){var e=this.FS;try{e.isFile(t.node.mode)&&t.nfd&&this.nodefs.closeSync(t.nfd)}catch(t){if(!t.code)throw t;throw new e.ErrnoError(this.ERRNO_CODES[t.code])}},X.prototype.read=function(t,e,n,r,i){try{return this.nodefs.readSync(t.nfd,M(e),n,r,i)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},X.prototype.write=function(t,e,n,r,i){try{return this.nodefs.writeSync(t.nfd,M(e),n,r,i)}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},X.prototype.llseek=function(t,e,n){var r=e;if(1===n)r+=t.position;else if(2===n&&this.FS.isFile(t.node.mode))try{r+=this.nodefs.fstatSync(t.nfd).size}catch(t){throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(r<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return t.position=r,r};var Y=function(t){this.fs=t,this.nodefs=t.getNodeFS(),this.FS=t.getFS(),this.PATH=t.getPATH(),this.ERRNO_CODES=t.getERRNO_CODES()};Y.prototype.getattr=function(t){var e,n=this.fs.realPath(t);try{e=this.nodefs.lstatSync(n)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return{dev:e.dev,ino:e.ino,mode:e.mode,nlink:e.nlink,uid:e.uid,gid:e.gid,rdev:e.rdev,size:e.size,atime:e.atime,mtime:e.mtime,ctime:e.ctime,blksize:e.blksize,blocks:e.blocks}},Y.prototype.setattr=function(t,e){var n=this.fs.realPath(t);try{if(void 0!==e.mode&&(this.nodefs.chmodSync(n,e.mode),t.mode=e.mode),void 0!==e.timestamp){var r=new Date(e.timestamp);this.nodefs.utimesSync(n,r,r)}}catch(t){if(!t.code)throw t;if("ENOTSUP"!==t.code)throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}if(void 0!==e.size)try{this.nodefs.truncateSync(n,e.size)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.lookup=function(t,e){var n=this.PATH.join2(this.fs.realPath(t),e),r=this.fs.getMode(n);return this.fs.createNode(t,e,r)},Y.prototype.mknod=function(t,e,n,r){var i=this.fs.createNode(t,e,n,r),o=this.fs.realPath(i);try{this.FS.isDir(i.mode)?this.nodefs.mkdirSync(o,i.mode):this.nodefs.writeFileSync(o,"",{mode:i.mode})}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return i},Y.prototype.rename=function(t,e,n){var r=this.fs.realPath(t),i=this.PATH.join2(this.fs.realPath(e),n);try{this.nodefs.renameSync(r,i),t.name=n,t.parent=e}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.unlink=function(t,e){var n=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.unlinkSync(n)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.rmdir=function(t,e){var n=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.rmdirSync(n)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.readdir=function(t){var e=this.fs.realPath(t);try{var n=this.nodefs.readdirSync(e);return n.push(".",".."),n}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.symlink=function(t,e,n){var r=this.PATH.join2(this.fs.realPath(t),e);try{this.nodefs.symlinkSync(n,r)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}},Y.prototype.readlink=function(t){var e=this.fs.realPath(t);try{return this.nodefs.readlinkSync(e)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}};var q=function(t,e,n,r){void 0===t&&(t=self.FS),void 0===e&&(e=self.PATH),void 0===n&&(n=self.ERRNO_CODES),void 0===r&&(r=T),this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=r,this.FS=t,this.PATH=e,this.ERRNO_CODES=n,this.node_ops=new Y(this),this.stream_ops=new X(this)};q.prototype.mount=function(t){return this.createNode(null,"/",this.getMode(t.opts.root),0)},q.prototype.createNode=function(t,e,n,r){var i=this.FS;if(!i.isDir(n)&&!i.isFile(n)&&!i.isLink(n))throw new i.ErrnoError(this.ERRNO_CODES.EINVAL);var o=i.createNode(t,e,n);return o.node_ops=this.node_ops,o.stream_ops=this.stream_ops,o},q.prototype.getMode=function(t){var e;try{e=this.nodefs.lstatSync(t)}catch(t){if(!t.code)throw t;throw new this.FS.ErrnoError(this.ERRNO_CODES[t.code])}return e.mode},q.prototype.realPath=function(t){for(var e=[];t.parent!==t;)e.push(t.name),t=t.parent;return e.push(t.mount.opts.root),e.reverse(),this.PATH.join.apply(null,e)},q.prototype.flagsToPermissionString=function(t){var e="string"==typeof t?parseInt(t,10):t;return(e&=8191)in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[e]:t},q.prototype.getNodeFS=function(){return this.nodefs},q.prototype.getFS=function(){return this.FS},q.prototype.getPATH=function(){return this.PATH},q.prototype.getERRNO_CODES=function(){return this.ERRNO_CODES};var G=function(){};G.prototype.supportsLinks=function(){return!1},G.prototype.diskSpace=function(t,e){e(0,0)},G.prototype.openFile=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.createFile=function(t,e,n,r){throw new h(s.ENOTSUP)},G.prototype.open=function(t,e,n,r){var i=this;this.stat(t,!1,(function(o,a){if(o)switch(e.pathNotExistsAction()){case f.CREATE_FILE:return i.stat(c.dirname(t),!1,(function(o,a){o?r(o):a&&!a.isDirectory()?r(h.ENOTDIR(c.dirname(t))):i.createFile(t,e,n,r)}));case f.THROW_EXCEPTION:return r(h.ENOENT(t));default:return r(new h(s.EINVAL,"Invalid FileFlag object."))}else{if(a&&a.isDirectory())return r(h.EISDIR(t));switch(e.pathExistsAction()){case f.THROW_EXCEPTION:return r(h.EEXIST(t));case f.TRUNCATE_FILE:return i.openFile(t,e,(function(t,e){t?r(t):e?e.truncate(0,(function(){e.sync((function(){r(null,e)}))})):I()}));case f.NOP:return i.openFile(t,e,r);default:return r(new h(s.EINVAL,"Invalid FileFlag object."))}}}))},G.prototype.rename=function(t,e,n){n(new h(s.ENOTSUP))},G.prototype.renameSync=function(t,e){throw new h(s.ENOTSUP)},G.prototype.stat=function(t,e,n){n(new h(s.ENOTSUP))},G.prototype.statSync=function(t,e){throw new h(s.ENOTSUP)},G.prototype.openFileSync=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.createFileSync=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.openSync=function(t,e,n){var r;try{r=this.statSync(t,!1)}catch(r){switch(e.pathNotExistsAction()){case f.CREATE_FILE:if(!this.statSync(c.dirname(t),!1).isDirectory())throw h.ENOTDIR(c.dirname(t));return this.createFileSync(t,e,n);case f.THROW_EXCEPTION:throw h.ENOENT(t);default:throw new h(s.EINVAL,"Invalid FileFlag object.")}}if(r.isDirectory())throw h.EISDIR(t);switch(e.pathExistsAction()){case f.THROW_EXCEPTION:throw h.EEXIST(t);case f.TRUNCATE_FILE:return this.unlinkSync(t),this.createFileSync(t,e,r.mode);case f.NOP:return this.openFileSync(t,e,n);default:throw new h(s.EINVAL,"Invalid FileFlag object.")}},G.prototype.unlink=function(t,e){e(new h(s.ENOTSUP))},G.prototype.unlinkSync=function(t){throw new h(s.ENOTSUP)},G.prototype.rmdir=function(t,e){e(new h(s.ENOTSUP))},G.prototype.rmdirSync=function(t){throw new h(s.ENOTSUP)},G.prototype.mkdir=function(t,e,n){n(new h(s.ENOTSUP))},G.prototype.mkdirSync=function(t,e){throw new h(s.ENOTSUP)},G.prototype.readdir=function(t,e){e(new h(s.ENOTSUP))},G.prototype.readdirSync=function(t){throw new h(s.ENOTSUP)},G.prototype.exists=function(t,e){this.stat(t,null,(function(t){e(!t)}))},G.prototype.existsSync=function(t){try{return this.statSync(t,!0),!0}catch(t){return!1}},G.prototype.realpath=function(t,e,n){if(this.supportsLinks())for(var r=t.split(c.sep),i=0;i<r.length;i++){var o=r.slice(0,i+1);r[i]=c.join.apply(null,o)}else this.exists(t,(function(e){e?n(null,t):n(h.ENOENT(t))}))},G.prototype.realpathSync=function(t,e){if(this.supportsLinks()){for(var n=t.split(c.sep),r=0;r<n.length;r++){var i=n.slice(0,r+1);n[r]=c.join.apply(c,i)}return n.join(c.sep)}if(this.existsSync(t))return t;throw h.ENOENT(t)},G.prototype.truncate=function(t,e,n){this.open(t,y.getFileFlag("r+"),420,(function(t,r){if(t)return n(t);r.truncate(e,(function(t){r.close((function(e){n(t||e)}))}))}))},G.prototype.truncateSync=function(t,e){var n=this.openSync(t,y.getFileFlag("r+"),420);try{n.truncateSync(e)}catch(t){throw t}finally{n.closeSync()}},G.prototype.readFile=function(e,n,r,i){var o=i;this.open(e,r,420,(function(e,r){if(e)return i(e);i=function(t,e){r.close((function(n){return t||(t=n),o(t,e)}))},r.stat((function(e,o){if(e)return i(e);var a=t.alloc(o.size);r.read(a,0,o.size,0,(function(t){if(t)return i(t);if(null===n)return i(t,a);try{i(null,a.toString(n))}catch(t){i(t)}}))}))}))},G.prototype.readFileSync=function(e,n,r){var i=this.openSync(e,r,420);try{var o=i.statSync(),a=t.alloc(o.size);return i.readSync(a,0,o.size,0),i.closeSync(),null===n?a:a.toString(n)}finally{i.closeSync()}},G.prototype.writeFile=function(e,n,r,i,o,a){var s=a;this.open(e,i,420,(function(e,i){if(e)return a(e);a=function(t){i.close((function(e){s(t||e)}))};try{"string"==typeof n&&(n=t.from(n,r))}catch(t){return a(t)}i.write(n,0,n.length,0,a)}))},G.prototype.writeFileSync=function(e,n,r,i,o){var a=this.openSync(e,i,o);try{"string"==typeof n&&(n=t.from(n,r)),a.writeSync(n,0,n.length,0)}finally{a.closeSync()}},G.prototype.appendFile=function(e,n,r,i,o,a){var s=a;this.open(e,i,o,(function(e,i){if(e)return a(e);a=function(t){i.close((function(e){s(t||e)}))},"string"==typeof n&&(n=t.from(n,r)),i.write(n,0,n.length,null,a)}))},G.prototype.appendFileSync=function(e,n,r,i,o){var a=this.openSync(e,i,o);try{"string"==typeof n&&(n=t.from(n,r)),a.writeSync(n,0,n.length,null)}finally{a.closeSync()}},G.prototype.chmod=function(t,e,n,r){r(new h(s.ENOTSUP))},G.prototype.chmodSync=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.chown=function(t,e,n,r,i){i(new h(s.ENOTSUP))},G.prototype.chownSync=function(t,e,n,r){throw new h(s.ENOTSUP)},G.prototype.utimes=function(t,e,n,r){r(new h(s.ENOTSUP))},G.prototype.utimesSync=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.link=function(t,e,n){n(new h(s.ENOTSUP))},G.prototype.linkSync=function(t,e){throw new h(s.ENOTSUP)},G.prototype.symlink=function(t,e,n,r){r(new h(s.ENOTSUP))},G.prototype.symlinkSync=function(t,e,n){throw new h(s.ENOTSUP)},G.prototype.readlink=function(t,e){e(new h(s.ENOTSUP))},G.prototype.readlinkSync=function(t){throw new h(s.ENOTSUP)};var Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.supportsSynch=function(){return!0},e.prototype.rename=function(t,e,n){try{this.renameSync(t,e),n()}catch(t){n(t)}},e.prototype.stat=function(t,e,n){try{n(null,this.statSync(t,e))}catch(t){n(t)}},e.prototype.open=function(t,e,n,r){try{r(null,this.openSync(t,e,n))}catch(t){r(t)}},e.prototype.unlink=function(t,e){try{this.unlinkSync(t),e()}catch(t){e(t)}},e.prototype.rmdir=function(t,e){try{this.rmdirSync(t),e()}catch(t){e(t)}},e.prototype.mkdir=function(t,e,n){try{this.mkdirSync(t,e),n()}catch(t){n(t)}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}},e.prototype.chmod=function(t,e,n,r){try{this.chmodSync(t,e,n),r()}catch(t){r(t)}},e.prototype.chown=function(t,e,n,r,i){try{this.chownSync(t,e,n,r),i()}catch(t){i(t)}},e.prototype.utimes=function(t,e,n,r){try{this.utimesSync(t,e,n),r()}catch(t){r(t)}},e.prototype.link=function(t,e,n){try{this.linkSync(t,e),n()}catch(t){n(t)}},e.prototype.symlink=function(t,e,n,r){try{this.symlinkSync(t,e,n),r()}catch(t){r(t)}},e.prototype.readlink=function(t,e){try{e(null,this.readlinkSync(t))}catch(t){e(t)}},e}(G),K=function(){};K.prototype.sync=function(t){t(new h(s.ENOTSUP))},K.prototype.syncSync=function(){throw new h(s.ENOTSUP)},K.prototype.datasync=function(t){this.sync(t)},K.prototype.datasyncSync=function(){return this.syncSync()},K.prototype.chown=function(t,e,n){n(new h(s.ENOTSUP))},K.prototype.chownSync=function(t,e){throw new h(s.ENOTSUP)},K.prototype.chmod=function(t,e){e(new h(s.ENOTSUP))},K.prototype.chmodSync=function(t){throw new h(s.ENOTSUP)},K.prototype.utimes=function(t,e,n){n(new h(s.ENOTSUP))},K.prototype.utimesSync=function(t,e){throw new h(s.ENOTSUP)};var J=function(e){function n(t,n,r,i,o){if(e.call(this),this._pos=0,this._dirty=!1,this._fs=t,this._path=n,this._flag=r,this._stat=i,this._buffer=o||z(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.getBuffer=function(){return this._buffer},n.prototype.getStats=function(){return this._stat},n.prototype.getFlag=function(){return this._flag},n.prototype.getPath=function(){return this._path},n.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},n.prototype.advancePos=function(t){return this._pos+=t},n.prototype.setPos=function(t){return this._pos=t},n.prototype.sync=function(t){try{this.syncSync(),t()}catch(e){t(e)}},n.prototype.syncSync=function(){throw new h(s.ENOTSUP)},n.prototype.close=function(t){try{this.closeSync(),t()}catch(e){t(e)}},n.prototype.closeSync=function(){throw new h(s.ENOTSUP)},n.prototype.stat=function(t){try{t(null,this._stat.clone())}catch(e){t(e)}},n.prototype.statSync=function(){return this._stat.clone()},n.prototype.truncate=function(t,e){try{this.truncateSync(t),this._flag.isSynchronous()&&!T.getRootFS().supportsSynch()&&this.sync(e),e()}catch(t){return e(t)}},n.prototype.truncateSync=function(e){if(this._dirty=!0,!this._flag.isWriteable())throw new h(s.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,e>this._buffer.length){var n=t.alloc(e-this._buffer.length,0);return this.writeSync(n,0,n.length,this._buffer.length),void(this._flag.isSynchronous()&&T.getRootFS().supportsSynch()&&this.syncSync())}this._stat.size=e;var r=t.alloc(e);this._buffer.copy(r,0,0,e),this._buffer=r,this._flag.isSynchronous()&&T.getRootFS().supportsSynch()&&this.syncSync()},n.prototype.write=function(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(t){i(t)}},n.prototype.writeSync=function(e,n,r,i){if(this._dirty=!0,null==i&&(i=this.getPos()),!this._flag.isWriteable())throw new h(s.EPERM,"File not opened with a writeable mode.");var o=i+r;if(o>this._stat.size&&(this._stat.size=o,o>this._buffer.length)){var a=t.alloc(o);this._buffer.copy(a),this._buffer=a}var u=e.copy(this._buffer,i,n,n+r);return this._stat.mtime=new Date,this._flag.isSynchronous()?(this.syncSync(),u):(this.setPos(i+u),u)},n.prototype.read=function(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(t){i(t)}},n.prototype.readSync=function(t,e,n,r){if(!this._flag.isReadable())throw new h(s.EPERM,"File not opened with a readable mode.");null==r&&(r=this.getPos()),r+n>this._stat.size&&(n=this._stat.size-r);var i=this._buffer.copy(t,e,r,r+n);return this._stat.atime=new Date,this._pos=r+n,i},n.prototype.chmod=function(t,e){try{this.chmodSync(t),e()}catch(t){e(t)}},n.prototype.chmodSync=function(t){if(!this._fs.supportsProps())throw new h(s.ENOTSUP);this._dirty=!0,this._stat.chmod(t),this.syncSync()},n.prototype.isDirty=function(){return this._dirty},n.prototype.resetDirty=function(){this._dirty=!1},n}(K),Q=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){t()},e.prototype.syncSync=function(){},e.prototype.close=function(t){t()},e.prototype.closeSync=function(){},e}(J),tt=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(J),et=function(t){function e(n,r,i){if(void 0===i&&(i=!0),t.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=n,this._async=r,!n.supportsSynch())throw new Error("The first argument to AsyncMirror needs to be a synchronous file system.");e.Name}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){try{var r=new e(t.sync,t.async,!1);r.initialize((function(t){t?n(t):n(null,r)}),!1)}catch(t){n(t)}},e.isAvailable=function(){return!0},e.prototype.getName=function(){return e.Name},e.prototype._syncSync=function(t){this._sync.writeFileSync(t.getPath(),t.getBuffer(),null,y.getFileFlag("w"),t.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[t.getPath(),t.getBuffer(),null,t.getFlag(),t.getStats().mode]})},e.prototype.initialize=function(t,e){var n=this;void 0===e&&(e=!0);var r=this._initializeCallbacks;if(this._isInitialized)t();else if(1===r.push(t)){var i=function(t,e,r){"/"!==t&&n._sync.mkdirSync(t,e),n._async.readdir(t,(function(e,n){var i=0;e?r(e):function e(a){a?r(a):i<n.length?(o(c.join(t,n[i]),e),i++):r()}()}))},o=function(t,e){n._async.stat(t,!1,(function(r,o){r?e(r):o.isDirectory()?i(t,o.mode,e):function(t,e,r){n._async.readFile(t,null,y.getFileFlag("r"),(function(i,o){if(i)r(i);else try{n._sync.writeFileSync(t,o,null,y.getFileFlag("w"),e)}catch(t){i=t}finally{r(i)}}))}(t,o.mode,e)}))};i("/",0,(function(t){n._isInitialized=!t,n._initializeCallbacks=[],r.forEach((function(e){return e(t)}))}))}},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},e.prototype.renameSync=function(t,e){this.checkInitialized(),this._sync.renameSync(t,e),this.enqueueOp({apiMethod:"rename",arguments:[t,e]})},e.prototype.statSync=function(t,e){return this.checkInitialized(),this._sync.statSync(t,e)},e.prototype.openSync=function(t,e,n){return this.checkInitialized(),this._sync.openSync(t,e,n).closeSync(),new tt(this,t,e,this._sync.statSync(t,!1),this._sync.readFileSync(t,null,y.getFileFlag("r")))},e.prototype.unlinkSync=function(t){this.checkInitialized(),this._sync.unlinkSync(t),this.enqueueOp({apiMethod:"unlink",arguments:[t]})},e.prototype.rmdirSync=function(t){this.checkInitialized(),this._sync.rmdirSync(t),this.enqueueOp({apiMethod:"rmdir",arguments:[t]})},e.prototype.mkdirSync=function(t,e){this.checkInitialized(),this._sync.mkdirSync(t,e),this.enqueueOp({apiMethod:"mkdir",arguments:[t,e]})},e.prototype.readdirSync=function(t){return this.checkInitialized(),this._sync.readdirSync(t)},e.prototype.existsSync=function(t){return this.checkInitialized(),this._sync.existsSync(t)},e.prototype.chmodSync=function(t,e,n){this.checkInitialized(),this._sync.chmodSync(t,e,n),this.enqueueOp({apiMethod:"chmod",arguments:[t,e,n]})},e.prototype.chownSync=function(t,e,n,r){this.checkInitialized(),this._sync.chownSync(t,e,n,r),this.enqueueOp({apiMethod:"chown",arguments:[t,e,n,r]})},e.prototype.utimesSync=function(t,e,n){this.checkInitialized(),this._sync.utimesSync(t,e,n),this.enqueueOp({apiMethod:"utimes",arguments:[t,e,n]})},e.prototype.checkInitialized=function(){if(!this._isInitialized)throw new h(s.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")},e.prototype.enqueueOp=function(t){var e=this;if(this._queue.push(t),!this._queueRunning){this._queueRunning=!0;var n=function(t){if(e._queue.length>0){var r=e._queue.shift(),i=r.arguments;i.push(n),e._async[r.apiMethod].apply(e._async,i)}else e._queueRunning=!1};n()}},e}(Z);function nt(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}et.Name="AsyncMirror",et.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};var rt=Math.max;function it(t){return t}function ot(t,e){return function(t,e,n){return e=rt(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=rt(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),nt(t,this,s)}}(t,e,it)}var at=function(t){return ot((function(e){var n=e.pop();t.call(this,e,n)}))};function st(t){return ot((function(e,n){var r=at((function(n,r){var i=this;return t(e,(function(t,e){t.apply(i,n.concat(e))}),r)}));return n.length?r.apply(this,n):r}))}var ut="object"==typeof i&&i&&i.Object===Object&&i,ct="object"==typeof self&&self&&self.Object===Object&&self,lt=ut||ct||Function("return this")(),ft=lt.Symbol,ht=Object.prototype,pt=ht.hasOwnProperty,dt=ht.toString,yt=ft?ft.toStringTag:void 0,gt=Object.prototype.toString,vt=ft?ft.toStringTag:void 0;function mt(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":vt&&vt in Object(t)?function(t){var e=pt.call(t,yt),n=t[yt];try{t[yt]=void 0;var r=!0}catch(t){}var i=dt.call(t);return r&&(e?t[yt]=n:delete t[yt]),i}(t):function(t){return gt.call(t)}(t)}function bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function _t(t){return null!=t&&bt(t.length)&&!function(t){if(!function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}(t))return!1;var e=mt(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}(t)}var wt={};function Et(){}function kt(t){return function(){if(null!==t){var e=t;t=null,e.apply(this,arguments)}}}var St="function"==typeof Symbol&&Symbol.iterator;function xt(t){return null!=t&&"object"==typeof t}function Tt(t){return xt(t)&&"[object Arguments]"==mt(t)}var Pt=Object.prototype,Rt=Pt.hasOwnProperty,Lt=Pt.propertyIsEnumerable,At=Tt(function(){return arguments}())?Tt:function(t){return xt(t)&&Rt.call(t,"callee")&&!Lt.call(t,"callee")},Bt=Array.isArray,Dt="object"==typeof n&&n&&!n.nodeType&&n,It=Dt&&"object"==typeof o&&o&&!o.nodeType&&o,Ot=It&&It.exports===Dt?lt.Buffer:void 0,Ct=(Ot?Ot.isBuffer:void 0)||function(){return!1},Nt=/^(?:0|[1-9]\d*)$/;function Ft(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||Nt.test(t))&&t>-1&&t%1==0&&t<e}var Mt={};Mt["[object Float32Array]"]=Mt["[object Float64Array]"]=Mt["[object Int8Array]"]=Mt["[object Int16Array]"]=Mt["[object Int32Array]"]=Mt["[object Uint8Array]"]=Mt["[object Uint8ClampedArray]"]=Mt["[object Uint16Array]"]=Mt["[object Uint32Array]"]=!0,Mt["[object Arguments]"]=Mt["[object Array]"]=Mt["[object ArrayBuffer]"]=Mt["[object Boolean]"]=Mt["[object DataView]"]=Mt["[object Date]"]=Mt["[object Error]"]=Mt["[object Function]"]=Mt["[object Map]"]=Mt["[object Number]"]=Mt["[object Object]"]=Mt["[object RegExp]"]=Mt["[object Set]"]=Mt["[object String]"]=Mt["[object WeakMap]"]=!1;var Ut,jt="object"==typeof n&&n&&!n.nodeType&&n,Ht=jt&&"object"==typeof o&&o&&!o.nodeType&&o,zt=Ht&&Ht.exports===jt&&ut.process,Wt=function(){try{return zt&&zt.binding&&zt.binding("util")}catch(t){}}(),Vt=Wt&&Wt.isTypedArray,$t=Vt?(Ut=Vt,function(t){return Ut(t)}):function(t){return xt(t)&&bt(t.length)&&!!Mt[mt(t)]},Xt=Object.prototype.hasOwnProperty;function Yt(t,e){var n=Bt(t),r=!n&&At(t),i=!n&&!r&&Ct(t),o=!n&&!r&&!i&&$t(t),a=n||r||i||o,s=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],u=s.length;for(var c in t)!e&&!Xt.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Ft(c,u))||s.push(c);return s}var qt=Object.prototype,Gt=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),Zt=Object.prototype.hasOwnProperty;function Kt(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||qt))return Gt(t);var e,n,r=[];for(var i in Object(t))Zt.call(t,i)&&"constructor"!=i&&r.push(i);return r}function Jt(t){return _t(t)?Yt(t):Kt(t)}function Qt(t){if(_t(t))return function(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}(t);var e=function(t){return St&&t[St]&&t[St]()}(t);return e?function(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}(e):function(t){var e=Jt(t),n=-1,r=e.length;return function(){var i=e[++n];return n<r?{value:t[i],key:i}:null}}(t)}function te(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}function ee(t){return function(e,n,r){if(r=kt(r||Et),t<=0||!e)return r(null);var i=Qt(e),o=!1,a=0;function s(t,e){if(a-=1,t)o=!0,r(t);else{if(e===wt||o&&a<=0)return o=!0,r(null);u()}}function u(){for(;a<t&&!o;){var e=i();if(null===e)return o=!0,void(a<=0&&r(null));a+=1,n(e.value,e.key,te(s))}}u()}}function ne(t,e,n,r){ee(e)(t,n,r)}function re(t,e){return function(n,r,i){return t(n,e,r,i)}}function ie(t,e,n){n=kt(n||Et);var r=0,i=0,o=t.length;function a(t,e){t?n(t):++i!==o&&e!==wt||n(null)}for(0===o&&n(null);r<o;r++)e(t[r],r,te(a))}var oe,ae=re(ne,1/0),se=function(t,e,n){(_t(t)?ie:ae)(t,e,n)};function ue(t,e,n,r){r=r||Et;var i=[],o=0;t(e=e||[],(function(t,e,r){var a=o++;n(t,(function(t,e){i[a]=e,r(t)}))}),(function(t){r(t,i)}))}st((oe=ue,function(t,e,n){return oe(se,t,e,n)})),st(re(function(t){return function(e,n,r,i){return t(ee(n),e,r,i)}}(ue),1)),ot((function(t,e){return ot((function(n){return t.apply(null,e.concat(n))}))}));var ce="[\\ud800-\\udfff]",le="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",fe="[^\\ud800-\\udfff]",he="(?:\\ud83c[\\udde6-\\uddff]){2}",pe="[\\ud800-\\udbff][\\udc00-\\udfff]",de=([fe,he,pe].join("|"),[fe+le+"?",le,he,pe,ce].join("|"),"function"==typeof e&&e),ye="object"==typeof a&&"function"==typeof a.nextTick;function ge(t){setTimeout(t,0)}function ve(t){return ot((function(e,n){t((function(){e.apply(null,n)}))}))}ve(de?e:ye?a.nextTick:ge);var me,be=re(ne,1),_e=ot((function(t){return ot((function(e){var n,r,i,o,a=this,s=e[e.length-1];"function"==typeof s?e.pop():s=Et,n=t,r=e,i=function(t,e,n){e.apply(a,t.concat(ot((function(t,e){n(t,e)}))))},o=kt((o=function(t,e){s.apply(a,[t].concat(e))})||Et),be(n,(function(t,e,n){i(r,t,(function(t,e){r=e,n(t)}))}),(function(t){o(t,r)}))}))}));function we(t){return ot((function(e,n){e.apply(null,n.concat(ot((function(e,n){"object"==typeof console&&(e?console.error:console[t]&&function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(n,(function(t){})))}))))}))}function Ee(t,e,n){se(t,function(t){return function(e,n,r){return t(e,r)}}(e),n)}ot((function(t){return _e.apply(null,t.reverse())})),ot((function(t){var e=[null].concat(t);return at((function(t,n){return n.apply(this,e)}))})),we("dir"),we("log"),ve(ye?a.nextTick:de?e:ge),Math.ceil,Math.max;var ke=function(t){this._cache={},this._client=t};ke.prototype.readdir=function(t,e){var n=this,r=this.getCachedDirInfo(t);this._wrap((function(e){null!==r&&r.contents?n._client.readdir(t,{contentHash:r.stat.contentHash},e):n._client.readdir(t,e)}),(function(i,o,a,s){i?i.status===Dropbox.ApiError.NO_CONTENT&&null!==r?e(null,r.contents.slice(0)):e(i):(n.updateCachedDirInfo(t,a,o.slice(0)),s.forEach((function(e){n.updateCachedInfo(c.join(t,e.name),e)})),e(null,o))}))},ke.prototype.remove=function(t,e){var n=this;this._wrap((function(e){n._client.remove(t,e)}),(function(r,i){r||n.updateCachedInfo(t,i),e(r)}))},ke.prototype.move=function(t,e,n){var r=this;this._wrap((function(n){r._client.move(t,e,n)}),(function(i,o){i||(r.deleteCachedInfo(t),r.updateCachedInfo(e,o)),n(i)}))},ke.prototype.stat=function(t,e){var n=this;this._wrap((function(e){n._client.stat(t,e)}),(function(r,i){r||n.updateCachedInfo(t,i),e(r,i)}))},ke.prototype.readFile=function(t,e){var n=this,r=this.getCachedFileInfo(t);null!==r&&null!==r.contents?this.stat(t,(function(i,o){i?e(i):o.contentHash===r.stat.contentHash?e(i,r.contents.slice(0),r.stat):n.readFile(t,e)})):this._wrap((function(e){n._client.readFile(t,{arrayBuffer:!0},e)}),(function(r,i,o){r||n.updateCachedInfo(t,o,i.slice(0)),e(r,i,o)}))},ke.prototype.writeFile=function(t,e,n){var r=this;this._wrap((function(n){r._client.writeFile(t,e,n)}),(function(i,o){i||r.updateCachedInfo(t,o,e.slice(0)),n(i,o)}))},ke.prototype.mkdir=function(t,e){var n=this;this._wrap((function(e){n._client.mkdir(t,e)}),(function(r,i){r||n.updateCachedInfo(t,i,[]),e(r)}))},ke.prototype._wrap=function(t,e){var n=0,r=function(i){var o=2;if(i&&3>++n)switch(i.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout((function(){t(r)}),1e3*o);break;default:e.apply(null,arguments)}else e.apply(null,arguments)};t(r)},ke.prototype.getCachedInfo=function(t){return this._cache[t.toLowerCase()]},ke.prototype.putCachedInfo=function(t,e){this._cache[t.toLowerCase()]=e},ke.prototype.deleteCachedInfo=function(t){delete this._cache[t.toLowerCase()]},ke.prototype.getCachedDirInfo=function(t){var e,n=this.getCachedInfo(t);return(e=n)&&e.stat.isFolder?n:null},ke.prototype.getCachedFileInfo=function(t){var e,n=this.getCachedInfo(t);return(e=n)&&e.stat.isFile?n:null},ke.prototype.updateCachedDirInfo=function(t,e,n){void 0===n&&(n=null);var r=this.getCachedInfo(t);null===e.contentHash||void 0!==r&&r.stat.contentHash===e.contentHash||this.putCachedInfo(t,{stat:e,contents:n})},ke.prototype.updateCachedFileInfo=function(t,e,n){void 0===n&&(n=null);var r=this.getCachedInfo(t);null===e.versionTag||void 0!==r&&r.stat.versionTag===e.versionTag||this.putCachedInfo(t,{stat:e,contents:n})},ke.prototype.updateCachedInfo=function(t,e,n){var r;void 0===n&&(n=null),e.isFile&&(null==(r=n)||"object"==typeof r&&"number"==typeof r.byteLength)?this.updateCachedFileInfo(t,e,n):e.isFolder&&Array.isArray(n)&&this.updateCachedDirInfo(t,e,n)};var Se=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;if(this.isDirty()){var n=C(this.getBuffer());this._fs._writeFileStrict(this.getPath(),n,(function(n){n||e.resetDirty(),t(n)}))}else t()},e.prototype.close=function(t){this.sync(t)},e}(J),xe=function(t){function e(n,r){void 0===r&&(r=!0),t.call(this),this._client=new ke(n),e.Name,me||((me={})[Dropbox.ApiError.NETWORK_ERROR]=s.EIO,me[Dropbox.ApiError.INVALID_PARAM]=s.EINVAL,me[Dropbox.ApiError.INVALID_TOKEN]=s.EPERM,me[Dropbox.ApiError.OAUTH_ERROR]=s.EPERM,me[Dropbox.ApiError.NOT_FOUND]=s.ENOENT,me[Dropbox.ApiError.INVALID_METHOD]=s.EINVAL,me[Dropbox.ApiError.NOT_ACCEPTABLE]=s.EINVAL,me[Dropbox.ApiError.CONFLICT]=s.EINVAL,me[Dropbox.ApiError.RATE_LIMITED]=s.EBUSY,me[Dropbox.ApiError.SERVER_ERROR]=s.EBUSY,me[Dropbox.ApiError.OVER_QUOTA]=s.ENOSPC)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){n(null,new e(t.client,!1))},e.isAvailable=function(){return"undefined"!=typeof Dropbox},e.prototype.getName=function(){return e.Name},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.empty=function(t){var e=this;this._client.readdir("/",(function(n,r){n?t(e.convert(n,"/")):Ee(r,(function(t,n){var r=c.join("/",t);e._client.remove(r,(function(t){n(t?e.convert(t,r):null)}))}),(function(e){e?t(e):t()}))}))},e.prototype.rename=function(t,e,n){var r=this;this._client.move(t,e,(function(i){i?r._client.stat(e,(function(o,a){if(o||a.isFolder){var s=i.response.error.indexOf(t)>-1?t:e;n(r.convert(i,s))}else r._client.remove(e,(function(i){i?n(r.convert(i,e)):r.rename(t,e,n)}))})):n()}))},e.prototype.stat=function(t,e,n){var r=this;this._client.stat(t,(function(e,i){if(e)n(r.convert(e,t));else{if(!i||!i.isRemoved){var o=new g(r._statType(i),i.size);return n(null,o)}n(h.FileError(s.ENOENT,t))}}))},e.prototype.open=function(t,e,n,r){var i=this;this._client.readFile(t,(function(n,o,a){if(!n){var s;s=null===o?z():U(o);var u=i._makeFile(t,e,a,s);return r(null,u)}if(e.isReadable())r(i.convert(n,t));else switch(n.status){case Dropbox.ApiError.NOT_FOUND:var c=new ArrayBuffer(0);return i._writeFileStrict(t,c,(function(n,o){if(n)r(n);else{var a=i._makeFile(t,e,o,U(c));r(null,a)}}));default:return r(i.convert(n,t))}}))},e.prototype._writeFileStrict=function(t,e,n){var r=this,i=c.dirname(t);this.stat(i,!1,(function(o,a){o?n(h.FileError(s.ENOENT,i)):r._client.writeFile(t,e,(function(e,i){e?n(r.convert(e,t)):n(null,i)}))}))},e.prototype._statType=function(t){return t.isFile?d.FILE:d.DIRECTORY},e.prototype._makeFile=function(t,e,n,r){var i=this._statType(n),o=new g(i,n.size);return new Se(this,t,e,o,r)},e.prototype._remove=function(t,e,n){var r=this;this._client.stat(t,(function(i,o){i?e(r.convert(i,t)):o.isFile&&!n?e(h.FileError(s.ENOTDIR,t)):!o.isFile&&n?e(h.FileError(s.EISDIR,t)):r._client.remove(t,(function(n){e(n?r.convert(n,t):null)}))}))},e.prototype.unlink=function(t,e){this._remove(t,e,!0)},e.prototype.rmdir=function(t,e){this._remove(t,e,!1)},e.prototype.mkdir=function(t,e,n){var r=this,i=c.dirname(t);this._client.stat(i,(function(e,o){e?n(r.convert(e,i)):r._client.mkdir(t,(function(e){n(e?h.FileError(s.EEXIST,t):null)}))}))},e.prototype.readdir=function(t,e){var n=this;this._client.readdir(t,(function(t,r){return t?e(n.convert(t)):e(null,r)}))},e.prototype.convert=function(t,e){void 0===e&&(e=null);var n=me[t.status];return void 0===n&&(n=s.EIO),e?h.FileError(n,e):new h(n)},e}(G);function Te(t,e){void 0===e&&(e="");for(var n=t.errno,r=t.node,i=[];r&&(i.unshift(r.name),r!==r.parent);)r=r.parent;return new h(n,l[n],i.length>0?"/"+i.join("/"):e)}xe.Name="Dropbox",xe.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(t,e){t.isAuthenticated&&t.isAuthenticated()?e():e(new h(s.EINVAL,"'client' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}};var Pe=function(t){function e(e,n,r,i){t.call(this),this._fs=e,this._FS=n,this._path=r,this._stream=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPos=function(){},e.prototype.close=function(t){var e=null;try{this.closeSync()}catch(t){e=t}finally{t(e)}},e.prototype.closeSync=function(){try{this._FS.close(this._stream)}catch(t){throw Te(t,this._path)}},e.prototype.stat=function(t){try{t(null,this.statSync())}catch(e){t(e)}},e.prototype.statSync=function(){try{return this._fs.statSync(this._path,!1)}catch(t){throw Te(t,this._path)}},e.prototype.truncate=function(t,e){var n=null;try{this.truncateSync(t)}catch(t){n=t}finally{e(n)}},e.prototype.truncateSync=function(t){try{this._FS.ftruncate(this._stream.fd,t)}catch(t){throw Te(t,this._path)}},e.prototype.write=function(t,e,n,r,i){try{i(null,this.writeSync(t,e,n,r),t)}catch(t){i(t)}},e.prototype.writeSync=function(t,e,n,r){try{var i=N(t),o=null===r?void 0:r;return this._FS.write(this._stream,i,e,n,o)}catch(t){throw Te(t,this._path)}},e.prototype.read=function(t,e,n,r,i){try{i(null,this.readSync(t,e,n,r),t)}catch(t){i(t)}},e.prototype.readSync=function(t,e,n,r){try{var i=N(t),o=null===r?void 0:r;return this._FS.read(this._stream,i,e,n,o)}catch(t){throw Te(t,this._path)}},e.prototype.sync=function(t){t()},e.prototype.syncSync=function(){},e.prototype.chown=function(t,e,n){var r=null;try{this.chownSync(t,e)}catch(t){r=t}finally{n(r)}},e.prototype.chownSync=function(t,e){try{this._FS.fchown(this._stream.fd,t,e)}catch(t){throw Te(t,this._path)}},e.prototype.chmod=function(t,e){var n=null;try{this.chmodSync(t)}catch(t){n=t}finally{e(n)}},e.prototype.chmodSync=function(t){try{this._FS.fchmod(this._stream.fd,t)}catch(t){throw Te(t,this._path)}},e.prototype.utimes=function(t,e,n){var r=null;try{this.utimesSync(t,e)}catch(t){r=t}finally{n(r)}},e.prototype.utimesSync=function(t,e){this._fs.utimesSync(this._path,t,e)},e}(K),Re=function(e){function n(t){e.call(this),this._FS=t}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.Create=function(t,e){e(null,new n(t.FS))},n.isAvailable=function(){return!0},n.prototype.getName=function(){return this._FS.DB_NAME()},n.prototype.isReadOnly=function(){return!1},n.prototype.supportsLinks=function(){return!0},n.prototype.supportsProps=function(){return!0},n.prototype.supportsSynch=function(){return!0},n.prototype.renameSync=function(t,e){try{this._FS.rename(t,e)}catch(n){throw n.errno===s.ENOENT?Te(n,this.existsSync(t)?e:t):Te(n)}},n.prototype.statSync=function(t,e){try{var n=e?this._FS.lstat(t):this._FS.stat(t),r=this.modeToFileType(n.mode);return new g(r,n.size,n.mode,n.atime,n.mtime,n.ctime)}catch(e){throw Te(e,t)}},n.prototype.openSync=function(t,e,n){try{var r=this._FS.open(t,e.getFlagString(),n);if(this._FS.isDir(r.node.mode))throw this._FS.close(r),h.EISDIR(t);return new Pe(this,this._FS,t,r)}catch(e){throw Te(e,t)}},n.prototype.unlinkSync=function(t){try{this._FS.unlink(t)}catch(e){throw Te(e,t)}},n.prototype.rmdirSync=function(t){try{this._FS.rmdir(t)}catch(e){throw Te(e,t)}},n.prototype.mkdirSync=function(t,e){try{this._FS.mkdir(t,e)}catch(e){throw Te(e,t)}},n.prototype.readdirSync=function(t){try{return this._FS.readdir(t).filter((function(t){return"."!==t&&".."!==t}))}catch(e){throw Te(e,t)}},n.prototype.truncateSync=function(t,e){try{this._FS.truncate(t,e)}catch(e){throw Te(e,t)}},n.prototype.readFileSync=function(t,e,n){try{var r=M(this._FS.readFile(t,{flags:n.getFlagString()}));return e?r.toString(e):r}catch(e){throw Te(e,t)}},n.prototype.writeFileSync=function(e,n,r,i,o){try{r&&(n=t.from(n,r));var a=N(n);this._FS.writeFile(e,a,{flags:i.getFlagString(),encoding:"binary"}),this._FS.chmod(e,o)}catch(t){throw Te(t,e)}},n.prototype.chmodSync=function(t,e,n){try{e?this._FS.lchmod(t,n):this._FS.chmod(t,n)}catch(e){throw Te(e,t)}},n.prototype.chownSync=function(t,e,n,r){try{e?this._FS.lchown(t,n,r):this._FS.chown(t,n,r)}catch(e){throw Te(e,t)}},n.prototype.symlinkSync=function(t,e,n){try{this._FS.symlink(t,e)}catch(t){throw Te(t)}},n.prototype.readlinkSync=function(t){try{return this._FS.readlink(t)}catch(e){throw Te(e,t)}},n.prototype.utimesSync=function(t,e,n){try{this._FS.utime(t,e.getTime(),n.getTime())}catch(e){throw Te(e,t)}},n.prototype.modeToFileType=function(t){if(this._FS.isDir(t))return d.DIRECTORY;if(this._FS.isFile(t))return d.FILE;if(this._FS.isLink(t))return d.SYMLINK;throw h.EPERM("Invalid mode: "+t)},n}(Z);Re.Name="EmscriptenFileSystem",Re.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var Le=function(t){function e(e,n){t.call(this),this._folder=e,this._wrapped=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){n(null,new e(t.folder,t.wrapped))},e.isAvailable=function(){return!0},e.prototype.initialize=function(t){var e=this;this._wrapped.exists(this._folder,(function(n){n?t():e._wrapped.isReadOnly()?t(h.ENOENT(e._folder)):e._wrapped.mkdir(e._folder,511,t)}))},e.prototype.getName=function(){return this._wrapped.getName()},e.prototype.isReadOnly=function(){return this._wrapped.isReadOnly()},e.prototype.supportsProps=function(){return this._wrapped.supportsProps()},e.prototype.supportsSynch=function(){return this._wrapped.supportsSynch()},e.prototype.supportsLinks=function(){return!1},e}(G);function Ae(t,e){if(null!==e&&"object"==typeof e){var n=e,r=n.path;r&&(r="/"+c.relative(t,r),n.message=n.message.replace(n.path,r),n.path=r)}return e}function Be(t,e){return"function"==typeof e?function(n){arguments.length>0&&(arguments[0]=Ae(t,n)),e.apply(null,arguments)}:e}function De(t,e,n){return"Sync"!==t.slice(t.length-4)?function(){return arguments.length>0&&(e&&(arguments[0]=c.join(this._folder,arguments[0])),n&&(arguments[1]=c.join(this._folder,arguments[1])),arguments[arguments.length-1]=Be(this._folder,arguments[arguments.length-1])),this._wrapped[t].apply(this._wrapped,arguments)}:function(){try{return e&&(arguments[0]=c.join(this._folder,arguments[0])),n&&(arguments[1]=c.join(this._folder,arguments[1])),this._wrapped[t].apply(this._wrapped,arguments)}catch(t){throw Ae(this._folder,t)}}}Le.Name="FolderAdapter",Le.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}},["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach((function(t){Le.prototype[t]=De(t,!0,!1)})),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach((function(t){Le.prototype[t]=De(t,!0,!0)}));var Ie="undefined"!=typeof window?window:"undefined"!=typeof self?self:i,Oe=Ie.webkitRequestFileSystem||Ie.requestFileSystem||null;function Ce(t,e,n){switch(t.name){case"PathExistsError":return h.EEXIST(e);case"QuotaExceededError":return h.FileError(s.ENOSPC,e);case"NotFoundError":return h.ENOENT(e);case"SecurityError":return h.FileError(s.EACCES,e);case"InvalidModificationError":return h.FileError(s.EPERM,e);case"TypeMismatchError":return h.FileError(n?s.ENOTDIR:s.EISDIR,e);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return h.FileError(s.EINVAL,e)}}var Ne=function(t){function e(e,n,r,i,o,a){t.call(this,e,r,i,o,a),this._entry=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;if(!this.isDirty())return t();this._entry.createWriter((function(n){var r=e.getBuffer(),i=new Blob([C(r)]),o=i.size;n.onwriteend=function(r){n.onwriteend=null,n.onerror=null,n.truncate(o),e.resetDirty(),t()},n.onerror=function(n){t(Ce(n,e.getPath(),!1))},n.write(i)}))},e.prototype.close=function(t){this.sync(t)},e}(J),Fe=function(t){function e(n,r,i){void 0===n&&(n=5),void 0===r&&(r=Ie.PERSISTENT),void 0===i&&(i=!0),t.call(this),this.size=1048576*n,this.type=r,e.Name}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){var r=new e(t.size,t.type,!1);r.allocate((function(t){return t?n(t):n(null,r)}),!1)},e.isAvailable=function(){return!!Oe},e.prototype.getName=function(){return e.Name},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSymlinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!1},e.prototype.allocate=function(t,e){var n=this;void 0===t&&(t=function(){}),void 0===e&&(e=!0);var r=function(e){n.fs=e,t()},i=function(e){t(Ce(e,"/",!0))};this.type===Ie.PERSISTENT?function(t,e,n,r){if(void 0!==navigator.webkitPersistentStorage)switch(t){case Ie.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(e,n,r);break;case Ie.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(e,n,r);break;default:r(new TypeError("Invalid storage type: "+t))}else Ie.webkitStorageInfo.requestQuota(t,e,n,r)}(this.type,this.size,(function(t){Oe(n.type,t,r,i)}),i):Oe(this.type,this.size,r,i)},e.prototype.empty=function(t){this._readdir("/",(function(e,n){e?t(e):Ee(n,(function(t,e){var n=function(){e()},r=function(n){e(Ce(n,t.fullPath,!t.isDirectory))};!function(t){return t.isDirectory}(t)?t.remove(n,r):t.removeRecursively(n,r)}),(function(n){e?t(e):t()}))}))},e.prototype.rename=function(t,e,n){var r=this,i=2,o=0,a=this.fs.root,u=t,l=function(t){--i<=0&&n(Ce(t,u,!1))},f=function(i){return 2==++o?n(new h(s.EINVAL,"Something was identified as both a file and a directory. This should never happen.")):t===e?n():(u=c.dirname(e),void a.getDirectory(u,{},(function(o){u=c.basename(e),i.moveTo(o,u,(function(t){n()}),(function(o){i.isDirectory?(u=e,r.unlink(e,(function(i){i?l(o):r.rename(t,e,n)}))):l(o)}))}),l))};a.getFile(t,{},f,l),a.getDirectory(t,{},f,l)},e.prototype.stat=function(t,e,n){var r=this,i={create:!1},o=function(t){var e=new g(d.DIRECTORY,4096);n(null,e)},a=function(e){n(Ce(e,t,!1))};this.fs.root.getFile(t,i,(function(t){t.file((function(t){var e=new g(d.FILE,t.size);n(null,e)}),a)}),(function(){r.fs.root.getDirectory(t,i,o,a)}))},e.prototype.open=function(t,e,n,r){var i=this,o=function(n){"InvalidModificationError"===n.name&&e.isExclusive()?r(h.EEXIST(t)):r(Ce(n,t,!1))};this.fs.root.getFile(t,{create:e.pathNotExistsAction()===f.CREATE_FILE,exclusive:e.isExclusive()},(function(n){n.file((function(a){var s=new FileReader;s.onloadend=function(o){var u=i._makeFile(t,n,e,a,s.result);r(null,u)},s.onerror=function(t){o(s.error)},s.readAsArrayBuffer(a)}),o)}),o)},e.prototype.unlink=function(t,e){this._remove(t,e,!0)},e.prototype.rmdir=function(t,e){var n=this;this.readdir(t,(function(r,i){r?e(r):i.length>0?e(h.ENOTEMPTY(t)):n._remove(t,e,!1)}))},e.prototype.mkdir=function(t,e,n){this.fs.root.getDirectory(t,{create:!0,exclusive:!0},(function(t){n()}),(function(e){n(Ce(e,t,!0))}))},e.prototype.readdir=function(t,e){this._readdir(t,(function(t,n){if(!n)return e(t);for(var r=[],i=0,o=n;i<o.length;i+=1){var a=o[i];r.push(a.name)}e(null,r)}))},e.prototype._makeFile=function(t,e,n,r,i){void 0===i&&(i=new ArrayBuffer(0));var o=new g(d.FILE,r.size),a=U(i);return new Ne(this,e,t,n,o,a)},e.prototype._readdir=function(t,e){var n=function(n){e(Ce(n,t,!0))};this.fs.root.getDirectory(t,{create:!1},(function(t){var r=t.createReader(),i=[],o=function(){r.readEntries((function(t){t.length?(i=i.concat(function(t){return Array.prototype.slice.call(t||[],0)}(t)),o()):e(null,i)}),n)};o()}),n)},e.prototype._remove=function(t,e,n){var r=function(r){r.remove((function(){e()}),(function(r){e(Ce(r,t,!n))}))},i=function(r){e(Ce(r,t,!n))},o={create:!1};n?this.fs.root.getFile(t,o,r,i):this.fs.root.getDirectory(t,o,r,i)},e}(G);Fe.Name="HTML5FS",Fe.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var Me=function(t,e,n,r,i,o){this.id=t,this.size=e,this.mode=n,this.atime=r,this.mtime=i,this.ctime=o};Me.fromBuffer=function(t){if(void 0===t)throw new Error("NO");return new Me(t.toString("ascii",30),t.readUInt32LE(0),t.readUInt16LE(4),t.readDoubleLE(6),t.readDoubleLE(14),t.readDoubleLE(22))},Me.prototype.toStats=function(){return new g((61440&this.mode)===d.DIRECTORY?d.DIRECTORY:d.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},Me.prototype.getSize=function(){return 30+this.id.length},Me.prototype.toBuffer=function(e){return void 0===e&&(e=t.alloc(this.getSize())),e.writeUInt32LE(this.size,0),e.writeUInt16LE(this.mode,4),e.writeDoubleLE(this.atime,6),e.writeDoubleLE(this.mtime,14),e.writeDoubleLE(this.ctime,22),e.write(this.id,30,this.id.length,"ascii"),e},Me.prototype.update=function(t){var e=!1;this.size!==t.size&&(this.size=t.size,e=!0),this.mode!==t.mode&&(this.mode=t.mode,e=!0);var n=t.atime.getTime();this.atime!==n&&(this.atime=n,e=!0);var r=t.mtime.getTime();this.mtime!==r&&(this.mtime=r,e=!0);var i=t.ctime.getTime();return this.ctime!==i&&(this.ctime=i,e=!0),e},Me.prototype.isFile=function(){return(61440&this.mode)===d.FILE},Me.prototype.isDirectory=function(){return(61440&this.mode)===d.DIRECTORY};var Ue="/",je=null;function He(){return je||(je=t.from("{}"))}function ze(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function We(t,e){return!t||(e(t),!1)}function Ve(t,e,n){return!t||(e.abort((function(){n(t)})),!1)}var $e=function(t){this.store=t,this.originalData={},this.modifiedKeys=[]};$e.prototype.get=function(t){var e=this.store.get(t);return this.stashOldValue(t,e),e},$e.prototype.put=function(t,e,n){return this.markModified(t),this.store.put(t,e,n)},$e.prototype.del=function(t){this.markModified(t),this.store.del(t)},$e.prototype.commit=function(){},$e.prototype.abort=function(){for(var t=this,e=0,n=t.modifiedKeys;e<n.length;e+=1){var r=n[e],i=t.originalData[r];i?t.store.put(r,i,!0):t.store.del(r)}},$e.prototype.stashOldValue=function(t,e){this.originalData.hasOwnProperty(t)||(this.originalData[t]=e)},$e.prototype.markModified=function(t){-1===this.modifiedKeys.indexOf(t)&&(this.modifiedKeys.push(t),this.originalData.hasOwnProperty(t)||(this.originalData[t]=this.store.get(t)))};var Xe=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},e.prototype.closeSync=function(){this.syncSync()},e}(J),Ye=function(e){function n(t){e.call(this),this.store=t.store,this.makeRootDirectory()}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.isAvailable=function(){return!0},n.prototype.getName=function(){return this.store.name()},n.prototype.isReadOnly=function(){return!1},n.prototype.supportsSymlinks=function(){return!1},n.prototype.supportsProps=function(){return!1},n.prototype.supportsSynch=function(){return!0},n.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},n.prototype.renameSync=function(e,n){var r=this.store.beginTransaction("readwrite"),i=c.dirname(e),o=c.basename(e),a=c.dirname(n),u=c.basename(n),l=this.findINode(r,i),f=this.getDirListing(r,i,l);if(!f[o])throw h.ENOENT(e);var p,d,y=f[o];if(delete f[o],0===(a+"/").indexOf(e+"/"))throw new h(s.EBUSY,i);if(a===i?(p=l,d=f):(p=this.findINode(r,a),d=this.getDirListing(r,a,p)),d[u]){var g=this.getINode(r,n,d[u]);if(!g.isFile())throw h.EPERM(n);try{r.del(g.id),r.del(d[u])}catch(t){throw r.abort(),t}}d[u]=y;try{r.put(l.id,t.from(JSON.stringify(f)),!0),r.put(p.id,t.from(JSON.stringify(d)),!0)}catch(t){throw r.abort(),t}r.commit()},n.prototype.statSync=function(t,e){return this.findINode(this.store.beginTransaction("readonly"),t).toStats()},n.prototype.createFileSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=z(),o=this.commitNewFile(r,t,d.FILE,n,i);return new Xe(this,t,e,o.toStats(),i)},n.prototype.openFileSync=function(t,e){var n=this.store.beginTransaction("readonly"),r=this.findINode(n,t),i=n.get(r.id);if(void 0===i)throw h.ENOENT(t);return new Xe(this,t,e,r.toStats(),i)},n.prototype.unlinkSync=function(t){this.removeEntry(t,!1)},n.prototype.rmdirSync=function(t){if(this.readdirSync(t).length>0)throw h.ENOTEMPTY(t);this.removeEntry(t,!0)},n.prototype.mkdirSync=function(e,n){var r=this.store.beginTransaction("readwrite"),i=t.from("{}");this.commitNewFile(r,e,d.DIRECTORY,n,i)},n.prototype.readdirSync=function(t){var e=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(e,t,this.findINode(e,t)))},n.prototype._syncSync=function(t,e,n){var r=this.store.beginTransaction("readwrite"),i=this._findINode(r,c.dirname(t),c.basename(t)),o=this.getINode(r,t,i),a=o.update(n);try{r.put(o.id,e,!0),a&&r.put(i,o.toBuffer(),!0)}catch(t){throw r.abort(),t}r.commit()},n.prototype.makeRootDirectory=function(){var t=this.store.beginTransaction("readwrite");if(void 0===t.get(Ue)){var e=(new Date).getTime(),n=new Me(ze(),4096,511|d.DIRECTORY,e,e,e);t.put(n.id,He(),!1),t.put(Ue,n.toBuffer(),!1),t.commit()}},n.prototype._findINode=function(t,e,n){var r=this,i=function(i){var o=r.getDirListing(t,e,i);if(o[n])return o[n];throw h.ENOENT(c.resolve(e,n))};return"/"===e?""===n?Ue:i(this.getINode(t,e,Ue)):i(this.getINode(t,e+c.sep+n,this._findINode(t,c.dirname(e),c.basename(e))))},n.prototype.findINode=function(t,e){return this.getINode(t,e,this._findINode(t,c.dirname(e),c.basename(e)))},n.prototype.getINode=function(t,e,n){var r=t.get(n);if(void 0===r)throw h.ENOENT(e);return Me.fromBuffer(r)},n.prototype.getDirListing=function(t,e,n){if(!n.isDirectory())throw h.ENOTDIR(e);var r=t.get(n.id);if(void 0===r)throw h.ENOENT(e);return JSON.parse(r.toString())},n.prototype.addNewNode=function(t,e){for(var n;;)try{return n=ze(),t.put(n,e,!1),n}catch(t){}throw new h(s.EIO,"Unable to commit data to key-value store.")},n.prototype.commitNewFile=function(e,n,r,i,o){var a,s=c.dirname(n),u=c.basename(n),l=this.findINode(e,s),f=this.getDirListing(e,s,l),p=(new Date).getTime();if("/"===n)throw h.EEXIST(n);if(f[u])throw h.EEXIST(n);try{var d=this.addNewNode(e,o);a=new Me(d,o.length,i|r,p,p,p);var y=this.addNewNode(e,a.toBuffer());f[u]=y,e.put(l.id,t.from(JSON.stringify(f)),!0)}catch(t){throw e.abort(),t}return e.commit(),a},n.prototype.removeEntry=function(e,n){var r=this.store.beginTransaction("readwrite"),i=c.dirname(e),o=this.findINode(r,i),a=this.getDirListing(r,i,o),s=c.basename(e);if(!a[s])throw h.ENOENT(e);var u=a[s];delete a[s];var l=this.getINode(r,e,u);if(!n&&l.isDirectory())throw h.EISDIR(e);if(n&&!l.isDirectory())throw h.ENOTDIR(e);try{r.del(l.id),r.del(u),r.put(o.id,t.from(JSON.stringify(a)),!0)}catch(t){throw r.abort(),t}r.commit()},n}(Z),qe=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),(function(n){n||e.resetDirty(),t(n)})):t()},e.prototype.close=function(t){this.sync(t)},e}(J),Ge=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.isAvailable=function(){return!0},n.prototype.init=function(t,e){this.store=t,this.makeRootDirectory(e)},n.prototype.getName=function(){return this.store.name()},n.prototype.isReadOnly=function(){return!1},n.prototype.supportsSymlinks=function(){return!1},n.prototype.supportsProps=function(){return!1},n.prototype.supportsSynch=function(){return!1},n.prototype.empty=function(t){var e=this;this.store.clear((function(n){We(n,t)&&e.makeRootDirectory(t)}))},n.prototype.rename=function(e,n,r){var i=this,o=this.store.beginTransaction("readwrite"),a=c.dirname(e),u=c.basename(e),l=c.dirname(n),f=c.basename(n),p={},d={},y=!1;if(0===(l+"/").indexOf(e+"/"))return r(new h(s.EBUSY,a));var g=function(s){i.findINodeAndDirListing(o,s,(function(c,g,v){c?y||(y=!0,o.abort((function(){r(c)}))):(p[s]=g,d[s]=v,function(){if(!y&&d.hasOwnProperty(a)&&d.hasOwnProperty(l)){var s=d[a],c=p[a],g=d[l],v=p[l];if(s[u]){var m=s[u];delete s[u];var b=function(){g[f]=m,o.put(c.id,t.from(JSON.stringify(s)),!0,(function(e){Ve(e,o,r)&&(a===l?o.commit(r):o.put(v.id,t.from(JSON.stringify(g)),!0,(function(t){Ve(t,o,r)&&o.commit(r)})))}))};g[f]?i.getINode(o,n,g[f],(function(t,e){Ve(t,o,r)&&(e.isFile()?o.del(e.id,(function(t){Ve(t,o,r)&&o.del(g[f],(function(t){Ve(t,o,r)&&b()}))})):o.abort((function(t){r(h.EPERM(n))})))})):b()}else r(h.ENOENT(e))}}())}))};g(a),a!==l&&g(l)},n.prototype.stat=function(t,e,n){var r=this.store.beginTransaction("readonly");this.findINode(r,t,(function(t,e){We(t,n)&&n(null,e.toStats())}))},n.prototype.createFile=function(t,e,n,r){var i=this,o=this.store.beginTransaction("readwrite"),a=z();this.commitNewFile(o,t,d.FILE,n,a,(function(n,o){We(n,r)&&r(null,new qe(i,t,e,o.toStats(),a))}))},n.prototype.openFile=function(t,e,n){var r=this,i=this.store.beginTransaction("readonly");this.findINode(i,t,(function(o,a){We(o,n)&&i.get(a.id,(function(i,o){We(i,n)&&(void 0===o?n(h.ENOENT(t)):n(null,new qe(r,t,e,a.toStats(),o)))}))}))},n.prototype.unlink=function(t,e){this.removeEntry(t,!1,e)},n.prototype.rmdir=function(t,e){var n=this;this.readdir(t,(function(r,i){r?e(r):i.length>0?e(h.ENOTEMPTY(t)):n.removeEntry(t,!0,e)}))},n.prototype.mkdir=function(e,n,r){var i=this.store.beginTransaction("readwrite"),o=t.from("{}");this.commitNewFile(i,e,d.DIRECTORY,n,o,r)},n.prototype.readdir=function(t,e){var n=this,r=this.store.beginTransaction("readonly");this.findINode(r,t,(function(i,o){We(i,e)&&n.getDirListing(r,t,o,(function(t,n){We(t,e)&&e(null,Object.keys(n))}))}))},n.prototype._sync=function(t,e,n,r){var i=this,o=this.store.beginTransaction("readwrite");this._findINode(o,c.dirname(t),c.basename(t),(function(a,s){Ve(a,o,r)&&i.getINode(o,t,s,(function(t,i){if(Ve(t,o,r)){var a=i.update(n);o.put(i.id,e,!0,(function(t){Ve(t,o,r)&&(a?o.put(s,i.toBuffer(),!0,(function(t){Ve(t,o,r)&&o.commit(r)})):o.commit(r))}))}}))}))},n.prototype.makeRootDirectory=function(t){var e=this.store.beginTransaction("readwrite");e.get(Ue,(function(n,r){if(n||void 0===r){var i=(new Date).getTime(),o=new Me(ze(),4096,511|d.DIRECTORY,i,i,i);e.put(o.id,He(),!1,(function(n){Ve(n,e,t)&&e.put(Ue,o.toBuffer(),!1,(function(n){n?e.abort((function(){t(n)})):e.commit(t)}))}))}else e.commit(t)}))},n.prototype._findINode=function(t,e,n,r){var i=this,o=function(t,i,o){t?r(t):o[n]?r(null,o[n]):r(h.ENOENT(c.resolve(e,n)))};"/"===e?""===n?r(null,Ue):this.getINode(t,e,Ue,(function(n,a){We(n,r)&&i.getDirListing(t,e,a,(function(t,e){o(t,0,e)}))})):this.findINodeAndDirListing(t,e,o)},n.prototype.findINode=function(t,e,n){var r=this;this._findINode(t,c.dirname(e),c.basename(e),(function(i,o){We(i,n)&&r.getINode(t,e,o,n)}))},n.prototype.getINode=function(t,e,n,r){t.get(n,(function(t,n){We(t,r)&&(void 0===n?r(h.ENOENT(e)):r(null,Me.fromBuffer(n)))}))},n.prototype.getDirListing=function(t,e,n,r){n.isDirectory()?t.get(n.id,(function(t,n){if(We(t,r))try{r(null,JSON.parse(n.toString()))}catch(t){r(h.ENOENT(e))}})):r(h.ENOTDIR(e))},n.prototype.findINodeAndDirListing=function(t,e,n){var r=this;this.findINode(t,e,(function(i,o){We(i,n)&&r.getDirListing(t,e,o,(function(t,e){We(t,n)&&n(null,o,e)}))}))},n.prototype.addNewNode=function(t,e,n){var r,i=0,o=function(){5==++i?n(new h(s.EIO,"Unable to commit data to key-value store.")):(r=ze(),t.put(r,e,!1,(function(t,e){t||!e?o():n(null,r)})))};o()},n.prototype.commitNewFile=function(e,n,r,i,o,a){var s=this,u=c.dirname(n),l=c.basename(n),f=(new Date).getTime();if("/"===n)return a(h.EEXIST(n));this.findINodeAndDirListing(e,u,(function(u,c,p){Ve(u,e,a)&&(p[l]?e.abort((function(){a(h.EEXIST(n))})):s.addNewNode(e,o,(function(n,u){if(Ve(n,e,a)){var h=new Me(u,o.length,i|r,f,f,f);s.addNewNode(e,h.toBuffer(),(function(n,r){Ve(n,e,a)&&(p[l]=r,e.put(c.id,t.from(JSON.stringify(p)),!0,(function(t){Ve(t,e,a)&&e.commit((function(t){Ve(t,e,a)&&a(null,h)}))})))}))}})))}))},n.prototype.removeEntry=function(e,n,r){var i=this,o=this.store.beginTransaction("readwrite"),a=c.dirname(e),s=c.basename(e);this.findINodeAndDirListing(o,a,(function(a,u,c){if(Ve(a,o,r))if(c[s]){var l=c[s];delete c[s],i.getINode(o,e,l,(function(i,a){Ve(i,o,r)&&(!n&&a.isDirectory()?o.abort((function(){r(h.EISDIR(e))})):n&&!a.isDirectory()?o.abort((function(){r(h.ENOTDIR(e))})):o.del(a.id,(function(e){Ve(e,o,r)&&o.del(l,(function(e){Ve(e,o,r)&&o.put(u.id,t.from(JSON.stringify(c)),!0,(function(t){Ve(t,o,r)&&o.commit(r)}))}))})))}))}else o.abort((function(){r(h.ENOENT(e))}))}))},n}(G),Ze=function(){this.store={}};Ze.prototype.name=function(){return Ke.Name},Ze.prototype.clear=function(){this.store={}},Ze.prototype.beginTransaction=function(t){return new $e(this)},Ze.prototype.get=function(t){return this.store[t]},Ze.prototype.put=function(t,e,n){return!(!n&&this.store.hasOwnProperty(t)||(this.store[t]=e,0))},Ze.prototype.del=function(t){delete this.store[t]};var Ke=function(t){function e(){t.call(this,{store:new Ze})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){n(null,new e)},e}(Ye);Ke.Name="InMemory",Ke.Options={};var Je=Ie.indexedDB||Ie.mozIndexedDB||Ie.webkitIndexedDB||Ie.msIndexedDB;function Qe(t,e){switch(void 0===e&&(e=t.toString()),t.name){case"NotFoundError":return new h(s.ENOENT,e);case"QuotaExceededError":return new h(s.ENOSPC,e);default:return new h(s.EIO,e)}}function tn(t,e,n){return void 0===e&&(e=s.EIO),void 0===n&&(n=null),function(r){r.preventDefault(),t(new h(e,null!==n?n:void 0))}}var en=function(t,e){this.tx=t,this.store=e};en.prototype.get=function(t,e){try{var n=this.store.get(t);n.onerror=tn(e),n.onsuccess=function(t){var n=t.target.result;e(null,void 0===n?n:U(n))}}catch(t){e(Qe(t))}};var nn=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.put=function(t,e,n,r){try{var i,o=C(e);(i=n?this.store.put(o,t):this.store.add(o,t)).onerror=tn(r),i.onsuccess=function(t){r(null,!0)}}catch(t){r(Qe(t))}},e.prototype.del=function(t,e){try{var n=this.store.delete(t);n.onerror=tn(e),n.onsuccess=function(t){e()}}catch(t){e(Qe(t))}},e.prototype.commit=function(t){setTimeout(t,0)},e.prototype.abort=function(t){var e=null;try{this.tx.abort()}catch(t){e=Qe(t)}finally{t(e)}},e}(en),rn=function(t,e){var n=this;void 0===e&&(e="browserfs"),this.storeName=e;var r=Je.open(this.storeName,1);r.onupgradeneeded=function(t){var e=t.target.result;e.objectStoreNames.contains(n.storeName)&&e.deleteObjectStore(n.storeName),e.createObjectStore(n.storeName)},r.onsuccess=function(e){n.db=e.target.result,t(null,n)},r.onerror=tn(t,s.EACCES)};rn.prototype.name=function(){return on.Name+" - "+this.storeName},rn.prototype.clear=function(t){try{var e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();e.onsuccess=function(e){setTimeout(t,0)},e.onerror=tn(t)}catch(e){t(Qe(e))}},rn.prototype.beginTransaction=function(t){void 0===t&&(t="readonly");var e=this.db.transaction(this.storeName,t),n=e.objectStore(this.storeName);if("readwrite"===t)return new nn(e,n);if("readonly"===t)return new en(e,n);throw new h(s.EINVAL,"Invalid transaction type.")};var on=function(t){function e(n,r,i){var o=this;void 0===i&&(i=!0),t.call(this),this.store=new rn((function(t){t?n(t):o.init(o.store,(function(t){n(t,o)}))}),r),e.Name}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){new e(n,t.storeName,!1)},e.isAvailable=function(){try{return void 0!==Je&&null!==Je.open("__browserfs_test__")}catch(t){return!1}},e}(Ge);on.Name="IndexedDB",on.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var an,sn=!1;try{Ie.localStorage.setItem("__test__",String.fromCharCode(55296)),sn=Ie.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(t){sn=!1}an=sn?"binary_string":"binary_string_ie",t.isEncoding(an)||(an="base64");var un=function(){};un.prototype.name=function(){return cn.Name},un.prototype.clear=function(){Ie.localStorage.clear()},un.prototype.beginTransaction=function(t){return new $e(this)},un.prototype.get=function(e){try{var n=Ie.localStorage.getItem(e);if(null!==n)return t.from(n,an)}catch(t){}},un.prototype.put=function(t,e,n){try{return!(!n&&null!==Ie.localStorage.getItem(t)||(Ie.localStorage.setItem(t,e.toString(an)),0))}catch(t){throw new h(s.ENOSPC,"LocalStorage is full.")}},un.prototype.del=function(t){try{Ie.localStorage.removeItem(t)}catch(e){throw new h(s.EIO,"Unable to delete key "+t+": "+e)}};var cn=function(t){function e(){t.call(this,{store:new un})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){n(null,new e)},e.isAvailable=function(){return void 0!==Ie.localStorage},e}(Ye);cn.Name="LocalStorage",cn.Options={};var ln=function(t){function e(){t.call(this),this.mountList=[],this.mntMap={},this.rootFs=new Ke}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){var r=new e;Object.keys(t).forEach((function(e){r.mount(e,t[e])})),n(null,r)},e.isAvailable=function(){return!0},e.prototype.mount=function(t,e){if("/"!==t[0]&&(t="/"+t),t=c.resolve(t),this.mntMap[t])throw new h(s.EINVAL,"Mount point "+t+" is already taken.");O(t,511,this.rootFs),this.mntMap[t]=e,this.mountList.push(t),this.mountList=this.mountList.sort((function(t,e){return e.length-t.length}))},e.prototype.umount=function(t){if("/"!==t[0]&&(t="/"+t),t=c.resolve(t),!this.mntMap[t])throw new h(s.EINVAL,"Mount point "+t+" is already unmounted.");for(delete this.mntMap[t],this.mountList.splice(this.mountList.indexOf(t),1);"/"!==t&&0===this.rootFs.readdirSync(t).length;)this.rootFs.rmdirSync(t),t=c.dirname(t)},e.prototype._getFs=function(t){for(var e=this.mountList,n=e.length,r=0;r<n;r++){var i=e[r];if(i.length<=t.length&&0===t.indexOf(i))return""===(t=t.substr(i.length>1?i.length:0))&&(t="/"),{fs:this.mntMap[i],path:t}}return{fs:this.rootFs,path:t}},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(t,e){e(0,0)},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.standardizeError=function(t,e,n){var r=t.message.indexOf(e);return-1!==r&&(t.message=t.message.substr(0,r)+n+t.message.substr(r+e.length),t.path=n),t},e.prototype.rename=function(t,e,n){var r=this,i=this._getFs(t),o=this._getFs(e);return i.fs===o.fs?i.fs.rename(i.path,o.path,(function(a){a&&r.standardizeError(r.standardizeError(a,i.path,t),o.path,e),n(a)})):T.readFile(t,(function(r,i){if(r)return n(r);T.writeFile(e,i,(function(e){if(e)return n(e);T.unlink(t,n)}))}))},e.prototype.renameSync=function(t,e){var n=this._getFs(t),r=this._getFs(e);if(n.fs===r.fs)try{return n.fs.renameSync(n.path,r.path)}catch(i){throw this.standardizeError(this.standardizeError(i,n.path,t),r.path,e),i}var i=T.readFileSync(t);return T.writeFileSync(e,i),T.unlinkSync(t)},e.prototype.readdirSync=function(t){var e=this._getFs(t),n=null;if(e.fs!==this.rootFs)try{n=this.rootFs.readdirSync(t)}catch(t){}try{var r=e.fs.readdirSync(e.path);return null===n?r:r.concat(n.filter((function(t){return-1===r.indexOf(t)})))}catch(r){if(null===n)throw this.standardizeError(r,e.path,t);return n}},e.prototype.readdir=function(t,e){var n=this,r=this._getFs(t);r.fs.readdir(r.path,(function(i,o){if(r.fs!==n.rootFs)try{var a=n.rootFs.readdirSync(t);o=o?o.concat(a.filter((function(t){return-1===o.indexOf(t)}))):a}catch(o){if(i)return e(n.standardizeError(i,r.path,t))}else if(i)return e(n.standardizeError(i,r.path,t));e(null,o)}))},e.prototype.rmdirSync=function(t){var e=this._getFs(t);if(this._containsMountPt(t))throw h.ENOTEMPTY(t);try{e.fs.rmdirSync(e.path)}catch(n){throw this.standardizeError(n,e.path,t)}},e.prototype.rmdir=function(t,e){var n=this,r=this._getFs(t);this._containsMountPt(t)?e(h.ENOTEMPTY(t)):r.fs.rmdir(r.path,(function(i){e(i?n.standardizeError(i,r.path,t):null)}))},e.prototype._containsMountPt=function(t){for(var e=this.mountList,n=e.length,r=0;r<n;r++){var i=e[r];if(i.length>=t.length&&i.slice(0,t.length)===t)return!0}return!1},e}(G);function fn(t,e,n){return e?function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];var r=e[0],i=this._getFs(r);e[0]=i.path;try{return i.fs[t].apply(i.fs,e)}catch(t){throw this.standardizeError(t,i.path,r),t}}:function(){for(var e=this,n=[],r=arguments.length;r--;)n[r]=arguments[r];var i=n[0],o=this._getFs(i);if(n[0]=o.path,"function"==typeof n[n.length-1]){var a=n[n.length-1];n[n.length-1]=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];t.length>0&&t[0]instanceof h&&e.standardizeError(t[0],o.path,i),a.apply(null,t)}}return o.fs[t].apply(o.fs,n)}}ln.Name="MountableFileSystem",ln.Options={};for(var hn,pn=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],dn=0;dn<pn.length;dn++)for(var yn=0,gn=pn[dn];yn<gn.length;yn+=1){var vn=gn[yn];ln.prototype[vn]=fn(vn,!1),ln.prototype[vn+"Sync"]=fn(vn+"Sync",!0)}if(void 0!==e)hn=e;else{var mn=Ie,bn=[],_n="zero-timeout-message";if(function(){if(void 0!==mn.importScripts||!mn.postMessage)return!1;var t=!0,e=mn.onmessage;return mn.onmessage=function(){t=!1},mn.postMessage("","*"),mn.onmessage=e,t}()){hn=function(t){bn.push(t),mn.postMessage(_n,"*")};var wn=function(t){if(t.source===self&&t.data===_n&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,bn.length>0))return bn.shift()()};mn.addEventListener?mn.addEventListener("message",wn,!0):mn.attachEvent("onmessage",wn)}else if(mn.MessageChannel){var En=new mn.MessageChannel;En.port1.onmessage=function(t){if(bn.length>0)return bn.shift()()},hn=function(t){bn.push(t),En.port2.postMessage("")}}else hn=function(t){return setTimeout(t,0)}}var kn=hn,Sn=function(){this._locked=!1,this._waiters=[]};Sn.prototype.lock=function(t){this._locked?this._waiters.push(t):(this._locked=!0,t())},Sn.prototype.unlock=function(){if(!this._locked)throw new Error("unlock of a non-locked mutex");var t=this._waiters.shift();t?kn(t):this._locked=!1},Sn.prototype.tryLock=function(){return!this._locked&&(this._locked=!0,!0)},Sn.prototype.isLocked=function(){return this._locked};var xn=function(t){this._fs=t,this._mu=new Sn};xn.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},xn.prototype.getFSUnlocked=function(){return this._fs},xn.prototype.initialize=function(t){this._fs.initialize(t)},xn.prototype.diskSpace=function(t,e){this._fs.diskSpace(t,e)},xn.prototype.isReadOnly=function(){return this._fs.isReadOnly()},xn.prototype.supportsLinks=function(){return this._fs.supportsLinks()},xn.prototype.supportsProps=function(){return this._fs.supportsProps()},xn.prototype.supportsSynch=function(){return this._fs.supportsSynch()},xn.prototype.rename=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.rename(t,e,(function(t){r._mu.unlock(),n(t)}))}))},xn.prototype.renameSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(t,e)},xn.prototype.stat=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.stat(t,e,(function(t,e){r._mu.unlock(),n(t,e)}))}))},xn.prototype.statSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(t,e)},xn.prototype.open=function(t,e,n,r){var i=this;this._mu.lock((function(){i._fs.open(t,e,n,(function(t,e){i._mu.unlock(),r(t,e)}))}))},xn.prototype.openSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(t,e,n)},xn.prototype.unlink=function(t,e){var n=this;this._mu.lock((function(){n._fs.unlink(t,(function(t){n._mu.unlock(),e(t)}))}))},xn.prototype.unlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(t)},xn.prototype.rmdir=function(t,e){var n=this;this._mu.lock((function(){n._fs.rmdir(t,(function(t){n._mu.unlock(),e(t)}))}))},xn.prototype.rmdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(t)},xn.prototype.mkdir=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.mkdir(t,e,(function(t){r._mu.unlock(),n(t)}))}))},xn.prototype.mkdirSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(t,e)},xn.prototype.readdir=function(t,e){var n=this;this._mu.lock((function(){n._fs.readdir(t,(function(t,r){n._mu.unlock(),e(t,r)}))}))},xn.prototype.readdirSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(t)},xn.prototype.exists=function(t,e){var n=this;this._mu.lock((function(){n._fs.exists(t,(function(t){n._mu.unlock(),e(t)}))}))},xn.prototype.existsSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(t)},xn.prototype.realpath=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.realpath(t,e,(function(t,e){r._mu.unlock(),n(t,e)}))}))},xn.prototype.realpathSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(t,e)},xn.prototype.truncate=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.truncate(t,e,(function(t){r._mu.unlock(),n(t)}))}))},xn.prototype.truncateSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(t,e)},xn.prototype.readFile=function(t,e,n,r){var i=this;this._mu.lock((function(){i._fs.readFile(t,e,n,(function(t,e){i._mu.unlock(),r(t,e)}))}))},xn.prototype.readFileSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(t,e,n)},xn.prototype.writeFile=function(t,e,n,r,i,o){var a=this;this._mu.lock((function(){a._fs.writeFile(t,e,n,r,i,(function(t){a._mu.unlock(),o(t)}))}))},xn.prototype.writeFileSync=function(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(t,e,n,r,i)},xn.prototype.appendFile=function(t,e,n,r,i,o){var a=this;this._mu.lock((function(){a._fs.appendFile(t,e,n,r,i,(function(t){a._mu.unlock(),o(t)}))}))},xn.prototype.appendFileSync=function(t,e,n,r,i){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(t,e,n,r,i)},xn.prototype.chmod=function(t,e,n,r){var i=this;this._mu.lock((function(){i._fs.chmod(t,e,n,(function(t){i._mu.unlock(),r(t)}))}))},xn.prototype.chmodSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(t,e,n)},xn.prototype.chown=function(t,e,n,r,i){var o=this;this._mu.lock((function(){o._fs.chown(t,e,n,r,(function(t){o._mu.unlock(),i(t)}))}))},xn.prototype.chownSync=function(t,e,n,r){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(t,e,n,r)},xn.prototype.utimes=function(t,e,n,r){var i=this;this._mu.lock((function(){i._fs.utimes(t,e,n,(function(t){i._mu.unlock(),r(t)}))}))},xn.prototype.utimesSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(t,e,n)},xn.prototype.link=function(t,e,n){var r=this;this._mu.lock((function(){r._fs.link(t,e,(function(t){r._mu.unlock(),n(t)}))}))},xn.prototype.linkSync=function(t,e){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(t,e)},xn.prototype.symlink=function(t,e,n,r){var i=this;this._mu.lock((function(){i._fs.symlink(t,e,n,(function(t){i._mu.unlock(),r(t)}))}))},xn.prototype.symlinkSync=function(t,e,n){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(t,e,n)},xn.prototype.readlink=function(t,e){var n=this;this._mu.lock((function(){n._fs.readlink(t,(function(t,r){n._mu.unlock(),e(t,r)}))}))},xn.prototype.readlinkSync=function(t){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(t)};var Tn="/.deletedFiles.log";function Pn(t){return 146|t}function Rn(t){return y.getFileFlag(t)}var Ln,An=function(t){function e(e,n,r,i,o){t.call(this,e,n,r,i,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.sync=function(t){var e=this;this.isDirty()?this._fs._syncAsync(this,(function(n){e.resetDirty(),t(n)})):t(null)},e.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},e.prototype.close=function(t){this.sync(t)},e.prototype.closeSync=function(){this.syncSync()},e}(J),Bn=function(t){function e(e,n){if(t.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=e,this._readable=n,this._writable.isReadOnly())throw new h(s.EINVAL,"Writable file system must be writable.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.isAvailable=function(){return!0},e.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},e.prototype._syncAsync=function(t,e){var n=this;this.createParentDirectoriesAsync(t.getPath(),(function(r){if(r)return e(r);n._writable.writeFile(t.getPath(),t.getBuffer(),null,Rn("w"),t.getStats().mode,e)}))},e.prototype._syncSync=function(t){this.createParentDirectories(t.getPath()),this._writable.writeFileSync(t.getPath(),t.getBuffer(),null,Rn("w"),t.getStats().mode)},e.prototype.getName=function(){return Dn.Name},e.prototype.initialize=function(t){var e=this,n=this._initializeCallbacks,r=function(t){e._isInitialized=!t,e._initializeCallbacks=[],n.forEach((function(e){return e(t)}))};if(this._isInitialized)return t();n.push(t),1===n.length&&this._writable.readFile(Tn,"utf8",Rn("r"),(function(t,n){if(t){if(t.errno!==s.ENOENT)return r(t)}else e._deleteLog=n;e._reparseDeletionLog(),r()}))},e.prototype.isReadOnly=function(){return!1},e.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},e.prototype.getDeletionLog=function(){return this._deleteLog},e.prototype.restoreDeletionLog=function(t){this._deleteLog=t,this._reparseDeletionLog(),this.updateLog("")},e.prototype.rename=function(t,e,n){var r=this;if(this.checkInitAsync(n)&&!this.checkPathAsync(t,n)&&!this.checkPathAsync(e,n))return t===Tn||e===Tn?n(h.EPERM("Cannot rename deletion log.")):t===e?n():void this.stat(t,!1,(function(i,o){return i?n(i):r.stat(e,!1,(function(i,a){var u=r;function l(r){var i=r.shift();if(!i)return n();var o=c.resolve(t,i),a=c.resolve(e,i);u.rename(o,a,(function(t){if(t)return n(t);l(r)}))}var f=511;if(o.isDirectory()){if(i)return i.errno!==s.ENOENT?n(i):r._writable.exists(t,(function(i){if(i)return r._writable.rename(t,e,n);r._writable.mkdir(e,f,(function(e){if(e)return n(e);r._readable.readdir(t,(function(t,e){if(t)return n();l(e)}))}))}));if(f=a.mode,!a.isDirectory())return n(h.ENOTDIR(e));r.readdir(e,(function(i,o){if(o&&o.length)return n(h.ENOTEMPTY(e));r._readable.readdir(t,(function(t,e){if(t)return n();l(e)}))}))}if(a&&a.isDirectory())return n(h.EISDIR(e));r.readFile(t,null,Rn("r"),(function(i,a){return i?n(i):r.writeFile(e,a,null,Rn("w"),o.mode,(function(e){return e?n(e):r.unlink(t,n)}))}))}))}))},e.prototype.renameSync=function(t,e){var n=this;if(this.checkInitialized(),this.checkPath(t),this.checkPath(e),t===Tn||e===Tn)throw h.EPERM("Cannot rename deletion log.");var r=this.statSync(t,!1);if(r.isDirectory()){if(t===e)return;var i=511;if(this.existsSync(e)){var o=this.statSync(e,!1);if(i=o.mode,!o.isDirectory())throw h.ENOTDIR(e);if(this.readdirSync(e).length>0)throw h.ENOTEMPTY(e)}this._writable.existsSync(t)?this._writable.renameSync(t,e):this._writable.existsSync(e)||this._writable.mkdirSync(e,i),this._readable.existsSync(t)&&this._readable.readdirSync(t).forEach((function(r){n.renameSync(c.resolve(t,r),c.resolve(e,r))}))}else{if(this.existsSync(e)&&this.statSync(e,!1).isDirectory())throw h.EISDIR(e);this.writeFileSync(e,this.readFileSync(t,null,Rn("r")),null,Rn("w"),r.mode)}t!==e&&this.existsSync(t)&&this.unlinkSync(t)},e.prototype.stat=function(t,e,n){var r=this;this.checkInitAsync(n)&&this._writable.stat(t,e,(function(i,o){i&&i.errno===s.ENOENT?(r._deletedFiles[t]&&n(h.ENOENT(t)),r._readable.stat(t,e,(function(t,e){e&&((e=e.clone()).mode=Pn(e.mode)),n(t,e)}))):n(i,o)}))},e.prototype.statSync=function(t,e){this.checkInitialized();try{return this._writable.statSync(t,e)}catch(r){if(this._deletedFiles[t])throw h.ENOENT(t);var n=this._readable.statSync(t,e).clone();return n.mode=Pn(n.mode),n}},e.prototype.open=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&!this.checkPathAsync(t,r)&&this.stat(t,!1,(function(o,a){if(a)switch(e.pathExistsAction()){case f.TRUNCATE_FILE:return i.createParentDirectoriesAsync(t,(function(o){if(o)return r(o);i._writable.open(t,e,n,r)}));case f.NOP:return i._writable.exists(t,(function(o){o?i._writable.open(t,e,n,r):((a=a.clone()).mode=n,i._readable.readFile(t,null,Rn("r"),(function(n,o){if(n)return r(n);-1===a.size&&(a.size=o.length);var s=new An(i,t,e,a,o);r(null,s)})))}));default:return r(h.EEXIST(t))}else switch(e.pathNotExistsAction()){case f.CREATE_FILE:return i.createParentDirectoriesAsync(t,(function(o){return o?r(o):i._writable.open(t,e,n,r)}));default:return r(h.ENOENT(t))}}))},e.prototype.openSync=function(t,e,n){if(this.checkInitialized(),this.checkPath(t),t===Tn)throw h.EPERM("Cannot open deletion log.");if(this.existsSync(t))switch(e.pathExistsAction()){case f.TRUNCATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);case f.NOP:if(this._writable.existsSync(t))return this._writable.openSync(t,e,n);var r=this._readable.readFileSync(t,null,Rn("r")),i=this._readable.statSync(t,!1).clone();return i.mode=n,new An(this,t,e,i,r);default:throw h.EEXIST(t)}else switch(e.pathNotExistsAction()){case f.CREATE_FILE:return this.createParentDirectories(t),this._writable.openSync(t,e,n);default:throw h.ENOENT(t)}},e.prototype.unlink=function(t,e){var n=this;this.checkInitAsync(e)&&!this.checkPathAsync(t,e)&&this.exists(t,(function(r){if(!r)return e(h.ENOENT(t));n._writable.exists(t,(function(r){if(r)return n._writable.unlink(t,(function(r){if(r)return e(r);n.exists(t,(function(r){r&&n.deletePath(t),e(null)}))}));n.deletePath(t),e(null)}))}))},e.prototype.unlinkSync=function(t){if(this.checkInitialized(),this.checkPath(t),!this.existsSync(t))throw h.ENOENT(t);this._writable.existsSync(t)&&this._writable.unlinkSync(t),this.existsSync(t)&&this.deletePath(t)},e.prototype.rmdir=function(t,e){var n=this;if(this.checkInitAsync(e)){var r=function(){n.readdir(t,(function(r,i){return r?e(r):i.length?e(h.ENOTEMPTY(t)):(n.deletePath(t),void e(null))}))};this.exists(t,(function(i){if(!i)return e(h.ENOENT(t));n._writable.exists(t,(function(i){i?n._writable.rmdir(t,(function(i){if(i)return e(i);n._readable.exists(t,(function(t){t?r():e()}))})):r()}))}))}},e.prototype.rmdirSync=function(t){if(this.checkInitialized(),!this.existsSync(t))throw h.ENOENT(t);if(this._writable.existsSync(t)&&this._writable.rmdirSync(t),this.existsSync(t)){if(this.readdirSync(t).length>0)throw h.ENOTEMPTY(t);this.deletePath(t)}},e.prototype.mkdir=function(t,e,n){var r=this;this.checkInitAsync(n)&&this.exists(t,(function(i){if(i)return n(h.EEXIST(t));r.createParentDirectoriesAsync(t,(function(i){if(i)return n(i);r._writable.mkdir(t,e,n)}))}))},e.prototype.mkdirSync=function(t,e){if(this.checkInitialized(),this.existsSync(t))throw h.EEXIST(t);this.createParentDirectories(t),this._writable.mkdirSync(t,e)},e.prototype.readdir=function(t,e){var n=this;this.checkInitAsync(e)&&this.stat(t,!1,(function(r,i){return r?e(r):i.isDirectory()?void n._writable.readdir(t,(function(r,i){if(r&&"ENOENT"!==r.code)return e(r);!r&&i||(i=[]),n._readable.readdir(t,(function(r,o){!r&&o||(o=[]);var a={},s=i.concat(o.filter((function(e){return!n._deletedFiles[t+"/"+e]}))).filter((function(t){var e=!a[t];return a[t]=!0,e}));e(null,s)}))})):e(h.ENOTDIR(t))}))},e.prototype.readdirSync=function(t){var e=this;if(this.checkInitialized(),!this.statSync(t,!1).isDirectory())throw h.ENOTDIR(t);var n=[];try{n=n.concat(this._writable.readdirSync(t))}catch(t){}try{n=n.concat(this._readable.readdirSync(t).filter((function(n){return!e._deletedFiles[t+"/"+n]})))}catch(t){}var r={};return n.filter((function(t){var e=!r[t];return r[t]=!0,e}))},e.prototype.exists=function(t,e){var n=this;this.checkInitialized(),this._writable.exists(t,(function(r){if(r)return e(!0);n._readable.exists(t,(function(r){e(r&&!0!==n._deletedFiles[t])}))}))},e.prototype.existsSync=function(t){return this.checkInitialized(),this._writable.existsSync(t)||this._readable.existsSync(t)&&!0!==this._deletedFiles[t]},e.prototype.chmod=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(t,(function(o){if(o)return r(o);i._writable.chmod(t,e,n,r)}))},e.prototype.chmodSync=function(t,e,n){var r=this;this.checkInitialized(),this.operateOnWritable(t,(function(){r._writable.chmodSync(t,e,n)}))},e.prototype.chown=function(t,e,n,r,i){var o=this;this.checkInitAsync(i)&&this.operateOnWritableAsync(t,(function(a){if(a)return i(a);o._writable.chown(t,e,n,r,i)}))},e.prototype.chownSync=function(t,e,n,r){var i=this;this.checkInitialized(),this.operateOnWritable(t,(function(){i._writable.chownSync(t,e,n,r)}))},e.prototype.utimes=function(t,e,n,r){var i=this;this.checkInitAsync(r)&&this.operateOnWritableAsync(t,(function(o){if(o)return r(o);i._writable.utimes(t,e,n,r)}))},e.prototype.utimesSync=function(t,e,n){var r=this;this.checkInitialized(),this.operateOnWritable(t,(function(){r._writable.utimesSync(t,e,n)}))},e.prototype.deletePath=function(t){this._deletedFiles[t]=!0,this.updateLog("d"+t+"\n")},e.prototype.updateLog=function(t){var e=this;this._deleteLog+=t,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(Tn,this._deleteLog,"utf8",y.getFileFlag("w"),420,(function(t){e._deleteLogUpdatePending=!1,t?e._deleteLogError=t:e._deleteLogUpdateNeeded&&(e._deleteLogUpdateNeeded=!1,e.updateLog(""))})))},e.prototype._reparseDeletionLog=function(){var t=this;this._deletedFiles={},this._deleteLog.split("\n").forEach((function(e){t._deletedFiles[e.slice(1)]="d"===e.slice(0,1)}))},e.prototype.checkInitialized=function(){if(!this._isInitialized)throw new h(s.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.");if(null!==this._deleteLogError){var t=this._deleteLogError;throw this._deleteLogError=null,t}},e.prototype.checkInitAsync=function(t){if(!this._isInitialized)return t(new h(s.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;if(null!==this._deleteLogError){var e=this._deleteLogError;return this._deleteLogError=null,t(e),!1}return!0},e.prototype.checkPath=function(t){if(t===Tn)throw h.EPERM(t)},e.prototype.checkPathAsync=function(t,e){return t===Tn&&(e(h.EPERM(t)),!0)},e.prototype.createParentDirectoriesAsync=function(t,e){var n=c.dirname(t),r=[],i=this;function o(){if(!r.length)return e();var t=r.pop();i._readable.stat(t,!1,(function(n,r){if(!r)return e();i._writable.mkdir(t,r.mode,(function(t){if(t)return e(t);o()}))}))}this._writable.stat(n,!1,(function t(e,a){e?(r.push(n),n=c.dirname(n),i._writable.stat(n,!1,t)):o()}))},e.prototype.createParentDirectories=function(t){for(var e=this,n=c.dirname(t),r=[];!this._writable.existsSync(n);)r.push(n),n=c.dirname(n);(r=r.reverse()).forEach((function(t){e._writable.mkdirSync(t,e.statSync(t,!1).mode)}))},e.prototype.operateOnWritable=function(t,e){if(!this.existsSync(t))throw h.ENOENT(t);this._writable.existsSync(t)||this.copyToWritable(t),e()},e.prototype.operateOnWritableAsync=function(t,e){var n=this;this.exists(t,(function(r){if(!r)return e(h.ENOENT(t));n._writable.exists(t,(function(r){if(!r)return n.copyToWritableAsync(t,e);e()}))}))},e.prototype.copyToWritable=function(t){var e=this.statSync(t,!1);e.isDirectory()?this._writable.mkdirSync(t,e.mode):this.writeFileSync(t,this._readable.readFileSync(t,null,Rn("r")),null,Rn("w"),this.statSync(t,!1).mode)},e.prototype.copyToWritableAsync=function(t,e){var n=this;this.stat(t,!1,(function(r,i){return r?e(r):i.isDirectory()?n._writable.mkdir(t,i.mode,e):void n._readable.readFile(t,null,Rn("r"),(function(r,o){if(r)return e(r);n.writeFile(t,o,null,Rn("w"),i.mode,e)}))}))},e}(G),Dn=function(t){function e(n,r,i){void 0===i&&(i=!0),t.call(this,new Bn(n,r)),e.Name}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){try{var r=new e(t.writable,t.readable,!1);r.initialize((function(t){n(t,r)}),!1)}catch(t){n(t)}},e.isAvailable=function(){return Bn.isAvailable()},e.prototype.initialize=function(e,n){void 0===n&&(n=!0),t.prototype.initialize.call(this,e)},e.prototype.getOverlayedFileSystems=function(){return t.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},e.prototype.unwrap=function(){return t.prototype.getFSUnlocked.call(this)},e}(xn);Dn.Name="OverlayFS",Dn.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}},function(t){t[t.CB=0]="CB",t[t.FD=1]="FD",t[t.API_ERROR=2]="API_ERROR",t[t.STATS=3]="STATS",t[t.PROBE=4]="PROBE",t[t.FILEFLAG=5]="FILEFLAG",t[t.BUFFER=6]="BUFFER",t[t.ERROR=7]="ERROR"}(Ln||(Ln={}));var In=function(){this._callbacks={},this._nextId=0};In.prototype.toRemoteArg=function(t){var e=this._nextId++;return this._callbacks[e]=t,{type:Ln.CB,id:e}},In.prototype.toLocalArg=function(t){var e=this._callbacks[t];return delete this._callbacks[t],e};var On=function(){this._fileDescriptors={},this._nextId=0};function Cn(t){return{type:Ln.API_ERROR,errorData:Wn(t.writeToBuffer())}}function Nn(t){return h.fromBuffer(Vn(t.errorData))}function Fn(t){return{type:Ln.ERROR,name:t.name,message:t.message,stack:t.stack}}function Mn(t){var e=Ie[t.name];"function"!=typeof e&&(e=Error);var n=new e(t.message);return n.stack=t.stack,n}function Un(t){return{type:Ln.STATS,statsData:Wn(t.toBuffer())}}function jn(t){return g.fromBuffer(Vn(t.statsData))}function Hn(t){return{type:Ln.FILEFLAG,flagStr:t.getFlagString()}}function zn(t){return y.getFileFlag(t.flagStr)}function Wn(t){return C(t)}function Vn(t){return U(t)}function $n(t){return{type:Ln.BUFFER,data:Wn(t)}}function Xn(t){return Vn(t.data)}On.prototype.toRemoteArg=function(e,n,r,i){var o,a,s=this._nextId++;this._fileDescriptors[s]=e,e.stat((function(u,c){u?i(u):(a=Wn(c.toBuffer()),r.isReadable()?e.read(t.alloc(c.size),0,c.size,0,(function(t,e,u){t?i(t):(o=Wn(u),i(null,{type:Ln.FD,id:s,data:o,stat:a,path:n,flag:r.getFlagString()}))})):i(null,{type:Ln.FD,id:s,data:new ArrayBuffer(0),stat:a,path:n,flag:r.getFlagString()}))}))},On.prototype.applyFdAPIRequest=function(t,e){var n=this,r=t.args[0];this._applyFdChanges(r,(function(i,o){i?e(i):o[t.method]((function(i){"close"===t.method&&delete n._fileDescriptors[r.id],e(i)}))}))},On.prototype._applyFdChanges=function(t,e){var n=this._fileDescriptors[t.id],r=Vn(t.data),i=g.fromBuffer(Vn(t.stat)),o=y.getFileFlag(t.flag);o.isWriteable()?n.write(r,0,r.length,o.isAppendable()?n.getPos():0,(function(t){function a(){n.stat((function(t,r){t?e(t):r.mode!==i.mode?n.chmod(i.mode,(function(t){e(t,n)})):e(t,n)}))}t?e(t):o.isAppendable()?a():n.truncate(r.length,(function(){a()}))})):e(null,n)};var Yn=function(t){function e(e,n,r,i,o,a){t.call(this,e,n,r,i,a),this._remoteFdId=o}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getRemoteFdId=function(){return this._remoteFdId},e.prototype.toRemoteArg=function(){return{type:Ln.FD,id:this._remoteFdId,data:Wn(this.getBuffer()),stat:Wn(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}},e.prototype.sync=function(t){this._syncClose("sync",t)},e.prototype.close=function(t){this._syncClose("close",t)},e.prototype._syncClose=function(t,e){var n=this;this.isDirty()?this._fs.syncClose(t,this,(function(t){t||n.resetDirty(),e(t)})):e()},e}(J),qn=function(e){function n(t,r){var i=this;void 0===r&&(r=!0),e.call(this),this._callbackConverter=new In,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=t,n.Name,this._worker.addEventListener("message",(function(t){var e,n=t.data;if((e=n)&&"object"==typeof e&&e.hasOwnProperty("browserfsMessage")&&e.browserfsMessage){var r,o=n.args,a=new Array(o.length);for(r=0;r<a.length;r++)a[r]=i._argRemote2Local(o[r]);i._callbackConverter.toLocalArg(n.cbId).apply(null,a)}}))}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.Create=function(t,e){var r=new n(t.worker,!1);r.initialize((function(){e(null,r)}))},n.isAvailable=function(){return"undefined"!=typeof importScripts||"undefined"!=typeof Worker},n.attachRemoteListener=function(e){var n=new On;function r(e,r,i){switch(typeof e){case"object":e instanceof g?i(null,Un(e)):e instanceof h?i(null,Cn(e)):e instanceof K?i(null,n.toRemoteArg(e,r[0],r[1],i)):e instanceof y?i(null,Hn(e)):e instanceof t?i(null,$n(e)):e instanceof Error?i(null,Fn(e)):i(null,e);break;default:i(null,e)}}function i(t,n){if(!t)return t;switch(typeof t){case"object":if("number"!=typeof t.type)return t;var i=t;switch(i.type){case Ln.CB:var o=t.id;return function(){var t,i,a=arguments,s=new Array(arguments.length),u=arguments.length;function c(t){u>0&&(u=-1,i={browserfsMessage:!0,cbId:o,args:[Cn(t)]},e.postMessage(i))}for(t=0;t<arguments.length;t++)!function(t,a){r(a,n,(function(n,r){s[t]=r,n?c(n):0==--u&&(i={browserfsMessage:!0,cbId:o,args:s},e.postMessage(i))}))}(t,a[t]);0===arguments.length&&(i={browserfsMessage:!0,cbId:o,args:s},e.postMessage(i))};case Ln.API_ERROR:return Nn(i);case Ln.STATS:return jn(i);case Ln.FILEFLAG:return zn(i);case Ln.BUFFER:return Xn(i);case Ln.ERROR:return Mn(i);default:return t}default:return t}}e.addEventListener("message",(function(t){var r,o,a=t.data;if((o=a)&&"object"==typeof o&&o.hasOwnProperty("browserfsMessage")&&o.browserfsMessage){var s=a.args,u=new Array(s.length);switch(a.method){case"close":case"sync":r=s[1],n.applyFdAPIRequest(a,(function(t){var n={browserfsMessage:!0,cbId:r.id,args:t?[Cn(t)]:[]};e.postMessage(n)}));break;case"probe":!function(){var t=T.getRootFS(),n=s[1],r={type:Ln.PROBE,isReadOnly:t.isReadOnly(),supportsLinks:t.supportsLinks(),supportsProps:t.supportsProps()},i={browserfsMessage:!0,cbId:n.id,args:[r]};e.postMessage(i)}();break;default:for(var c=0;c<s.length;c++)u[c]=i(s[c],u);var l=T.getRootFS();l[a.method].apply(l,u)}}}))},n.prototype.getName=function(){return n.Name},n.prototype.initialize=function(t){var e=this;if(this._isInitialized)t();else{var n={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(z()),this._callbackConverter.toRemoteArg((function(n){e._isInitialized=!0,e._isReadOnly=n.isReadOnly,e._supportLinks=n.supportsLinks,e._supportProps=n.supportsProps,t()}))]};this._worker.postMessage(n)}},n.prototype.isReadOnly=function(){return this._isReadOnly},n.prototype.supportsSynch=function(){return!1},n.prototype.supportsLinks=function(){return this._supportLinks},n.prototype.supportsProps=function(){return this._supportProps},n.prototype.rename=function(t,e,n){this._rpc("rename",arguments)},n.prototype.stat=function(t,e,n){this._rpc("stat",arguments)},n.prototype.open=function(t,e,n,r){this._rpc("open",arguments)},n.prototype.unlink=function(t,e){this._rpc("unlink",arguments)},n.prototype.rmdir=function(t,e){this._rpc("rmdir",arguments)},n.prototype.mkdir=function(t,e,n){this._rpc("mkdir",arguments)},n.prototype.readdir=function(t,e){this._rpc("readdir",arguments)},n.prototype.exists=function(t,e){this._rpc("exists",arguments)},n.prototype.realpath=function(t,e,n){this._rpc("realpath",arguments)},n.prototype.truncate=function(t,e,n){this._rpc("truncate",arguments)},n.prototype.readFile=function(t,e,n,r){this._rpc("readFile",arguments)},n.prototype.writeFile=function(t,e,n,r,i,o){this._rpc("writeFile",arguments)},n.prototype.appendFile=function(t,e,n,r,i,o){this._rpc("appendFile",arguments)},n.prototype.chmod=function(t,e,n,r){this._rpc("chmod",arguments)},n.prototype.chown=function(t,e,n,r,i){this._rpc("chown",arguments)},n.prototype.utimes=function(t,e,n,r){this._rpc("utimes",arguments)},n.prototype.link=function(t,e,n){this._rpc("link",arguments)},n.prototype.symlink=function(t,e,n,r){this._rpc("symlink",arguments)},n.prototype.readlink=function(t,e){this._rpc("readlink",arguments)},n.prototype.syncClose=function(t,e,n){this._worker.postMessage({browserfsMessage:!0,method:t,args:[e.toRemoteArg(),this._callbackConverter.toRemoteArg(n)]})},n.prototype._argRemote2Local=function(t){if(!t)return t;switch(typeof t){case"object":if("number"!=typeof t.type)return t;var e=t;switch(e.type){case Ln.API_ERROR:return Nn(e);case Ln.FD:var n=e;return new Yn(this,n.path,y.getFileFlag(n.flag),g.fromBuffer(Vn(n.stat)),n.id,Vn(n.data));case Ln.STATS:return jn(e);case Ln.FILEFLAG:return zn(e);case Ln.BUFFER:return Xn(e);case Ln.ERROR:return Mn(e);default:return t}default:return t}},n.prototype._rpc=function(t,e){for(var n=new Array(e.length),r=0;r<e.length;r++)n[r]=this._argLocal2Remote(e[r]);var i={browserfsMessage:!0,method:t,args:n};this._worker.postMessage(i)},n.prototype._argLocal2Remote=function(e){if(!e)return e;switch(typeof e){case"object":return e instanceof g?Un(e):e instanceof h?Cn(e):e instanceof Yn?e.toRemoteArg():e instanceof y?Hn(e):e instanceof t?$n(e):e instanceof Error?Fn(e):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(e);default:return e}},n}(G);function Gn(t,e,n){var r=new XMLHttpRequest;r.open("HEAD",e,t),r.onreadystatechange=function(t){if(4===r.readyState){if(200!==r.status)return n(new h(r.status,"XHR HEAD error."));try{return n(null,parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(t){return n(new h(s.EIO,"XHR HEAD error: Could not read content-length."))}}},r.send()}qn.Name="WorkerFS",qn.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(t,e){t.postMessage?e():e(new h(s.EINVAL,"option must be a Web Worker instance."))}}};var Zn=function(e,n,r){var i=new XMLHttpRequest;i.open("GET",e,!0);var o=!0;switch(n){case"buffer":i.responseType="arraybuffer";break;case"json":try{i.responseType="json",o="json"===i.responseType}catch(t){o=!1}break;default:return r(new h(s.EINVAL,"Invalid download type: "+n))}i.onreadystatechange=function(e){if(4===i.readyState){if(200!==i.status)return r(new h(i.status,"XHR error."));switch(n){case"buffer":return r(null,i.response?t.from(i.response):z());case"json":return r(null,o?i.response:JSON.parse(i.responseText))}}},i.send()},Kn=B&&"undefined"!=typeof Blob?function(e,n){var r,i,o=new XMLHttpRequest;switch(o.open("GET",e,!1),n){case"buffer":o.responseType="arraybuffer";break;case"json":break;default:throw new h(s.EINVAL,"Invalid download type: "+n)}if(o.onreadystatechange=function(e){if(4===o.readyState)if(200===o.status)switch(n){case"buffer":r=t.from(o.response);break;case"json":r=JSON.parse(o.response)}else i=new h(o.status,"XHR error.")},o.send(),i)throw i;return r}:function(e,n){var r=new XMLHttpRequest;r.open("GET",e,!1);var i=null,o=null;if(r.overrideMimeType("text/plain; charset=x-user-defined"),r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)return void(o=new h(r.status,"XHR error."));switch(n){case"buffer":var a=r.responseText;i=t.alloc(a.length);for(var s=0;s<a.length;s++)i[s]=a.charCodeAt(s);return;case"json":return void(i=JSON.parse(r.responseText))}}},r.send(),o)throw o;return i},Jn=function(){this._index={},this.addPath("/",new tr)};Jn.fromListing=function(t){var e=new Jn,n=new tr;e._index["/"]=n;for(var r=[["",t,n]];r.length>0;){var i=void 0,o=r.pop(),a=o[0],s=o[1],u=o[2];for(var c in s)if(s.hasOwnProperty(c)){var l=s[c],f=a+"/"+c;l?(e._index[f]=i=new tr,r.push([f,l,i])):i=new Qn(new g(d.FILE,-1,365)),u&&(u._ls[c]=i)}}return e},Jn.prototype.fileIterator=function(t){var e=this;for(var n in e._index)if(e._index.hasOwnProperty(n))for(var r=e._index[n],i=0,o=r.getListing();i<o.length;i+=1){var a=o[i],s=r.getItem(a);er(s)&&t(s.getData())}},Jn.prototype.addPath=function(t,e){if(!e)throw new Error("Inode must be specified");if("/"!==t[0])throw new Error("Path must be absolute, got: "+t);if(this._index.hasOwnProperty(t))return this._index[t]===e;var n=this._split_path(t),r=n[0],i=n[1],o=this._index[r];return!(void 0===o&&"/"!==t&&(o=new tr,!this.addPath(r,o))||"/"!==t&&!o.addItem(i,e)||(nr(e)&&(this._index[t]=e),0))},Jn.prototype.addPathFast=function(t,e){var n=t.lastIndexOf("/"),r=0===n?"/":t.substring(0,n),i=t.substring(n+1),o=this._index[r];return void 0===o&&(o=new tr,this.addPathFast(r,o)),!!o.addItem(i,e)&&(e.isDir()&&(this._index[t]=e),!0)},Jn.prototype.removePath=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];if(void 0===i)return null;var o=i.remItem(r);if(null===o)return null;if(nr(o)){for(var a=0,s=o.getListing();a<s.length;a+=1){var u=s[a];this.removePath(t+"/"+u)}"/"!==t&&delete this._index[t]}return o},Jn.prototype.ls=function(t){var e=this._index[t];return void 0===e?null:e.getListing()},Jn.prototype.getInode=function(t){var e=this._split_path(t),n=e[0],r=e[1],i=this._index[n];return void 0===i?null:n===t?i:i.getItem(r)},Jn.prototype._split_path=function(t){var e=c.dirname(t);return[e,t.substr(e.length+("/"===e?0:1))]};var Qn=function(t){this.data=t};Qn.prototype.isFile=function(){return!0},Qn.prototype.isDir=function(){return!1},Qn.prototype.getData=function(){return this.data},Qn.prototype.setData=function(t){this.data=t};var tr=function(t){void 0===t&&(t=null),this.data=t,this._ls={}};function er(t){return!!t&&t.isFile()}function nr(t){return!!t&&t.isDir()}tr.prototype.isFile=function(){return!1},tr.prototype.isDir=function(){return!0},tr.prototype.getData=function(){return this.data},tr.prototype.getStats=function(){return new g(d.DIRECTORY,4096,365)},tr.prototype.getListing=function(){return Object.keys(this._ls)},tr.prototype.getItem=function(t){var e=this._ls[t];return e||null},tr.prototype.addItem=function(t,e){return!(t in this._ls)&&(this._ls[t]=e,!0)},tr.prototype.remItem=function(t){var e=this._ls[t];return void 0===e?null:(delete this._ls[t],e)};var rr=function(t){function e(n,r,i){void 0===r&&(r=""),void 0===i&&(i=!0),t.call(this),n||(n="index.json"),r.length>0&&"/"!==r.charAt(r.length-1)&&(r+="/"),this.prefixUrl=r;var o=null;if("string"==typeof n){if(!(o=this._requestFileSync(n,"json")))throw new Error("Unable to find listing at URL: ${listingUrlOrObj}")}else o=n;e.Name,this._index=Jn.fromListing(o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){void 0===t.index&&(t.index="index.json"),"string"==typeof t.index?e.FromURL(t.index,n,t.baseUrl,!1):n(null,new e(t.index,t.baseUrl,!1))},e.isAvailable=function(){return"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest},e.FromURL=function(t,n,r,i){void 0===r&&(r=t.slice(0,t.lastIndexOf("/")+1)),void 0===i&&(i=!0),Zn(t,"json",(function(t,i){t?n(t):n(null,new e(i,r,!1))}))},e.prototype.empty=function(){this._index.fileIterator((function(t){t.fileData=null}))},e.prototype.getName=function(){return e.Name},e.prototype.diskSpace=function(t,e){e(0,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.preloadFile=function(t,e){var n=this._index.getInode(t);if(!er(n))throw h.EISDIR(t);if(null===n)throw h.ENOENT(t);var r=n.getData();r.size=e.length,r.fileData=e},e.prototype.stat=function(t,e,n){var r,i=this._index.getInode(t);if(null===i)return n(h.ENOENT(t));er(i)?(r=i.getData()).size<0?this._requestFileSizeAsync(t,(function(t,e){if(t)return n(t);r.size=e,n(null,r.clone())})):n(null,r.clone()):nr(i)?(r=i.getStats(),n(null,r)):n(h.FileError(s.EINVAL,t))},e.prototype.statSync=function(t,e){var n,r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);if(er(r))(n=r.getData()).size<0&&(n.size=this._requestFileSizeSync(t));else{if(!nr(r))throw h.FileError(s.EINVAL,t);n=r.getStats()}return n},e.prototype.open=function(t,e,n,r){if(e.isWriteable())return r(new h(s.EPERM,t));var i=this,o=this._index.getInode(t);if(null===o)return r(h.ENOENT(t));if(!er(o))return r(h.EISDIR(t));var a=o.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:return r(h.EEXIST(t));case f.NOP:if(a.fileData)return r(null,new Q(i,t,e,a.clone(),a.fileData));this._requestFileAsync(t,"buffer",(function(n,o){return n?r(n):(a.size=o.length,a.fileData=o,r(null,new Q(i,t,e,a.clone(),o)))}));break;default:return r(new h(s.EINVAL,"Invalid FileMode object."))}},e.prototype.openSync=function(t,e,n){if(e.isWriteable())throw new h(s.EPERM,t);var r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);if(!er(r))throw h.EISDIR(t);var i=r.getData();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw h.EEXIST(t);case f.NOP:if(i.fileData)return new Q(this,t,e,i.clone(),i.fileData);var o=this._requestFileSync(t,"buffer");return i.size=o.length,i.fileData=o,new Q(this,t,e,i.clone(),o);default:throw new h(s.EINVAL,"Invalid FileMode object.")}},e.prototype.readdir=function(t,e){try{e(null,this.readdirSync(t))}catch(t){e(t)}},e.prototype.readdirSync=function(t){var e=this._index.getInode(t);if(null===e)throw h.ENOENT(t);if(nr(e))return e.getListing();throw h.ENOTDIR(t)},e.prototype.readFile=function(t,e,n,r){var i=r;this.open(t,n,420,(function(t,n){if(t)return r(t);r=function(t,e){n.close((function(n){return t||(t=n),i(t,e)}))};var o=n.getBuffer();null===e?r(t,j(o)):function(t,e,n){try{n(null,t.toString(e))}catch(t){n(t)}}(o,e,r)}))},e.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.getBuffer();return null===e?j(i):i.toString(e)}finally{r.closeSync()}},e.prototype.getXhrPath=function(t){return"/"===t.charAt(0)&&(t=t.slice(1)),this.prefixUrl+t},e.prototype._requestFileAsync=function(t,e,n){Zn(this.getXhrPath(t),e,n)},e.prototype._requestFileSync=function(t,e){return Kn(this.getXhrPath(t),e)},e.prototype._requestFileSizeAsync=function(t,e){!function(t,e){Gn(!0,t,e)}(this.getXhrPath(t),e)},e.prototype._requestFileSizeSync=function(t){return e=this.getXhrPath(t),n=-1,Gn(!1,e,(function(t,e){if(t)throw t;n=e})),n;var e,n},e}(G);rr.Name="XmlHttpRequest",rr.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var ir=function(){};ir.str2byte=function(t,e){for(var n=t.length>e.length?e.length:t.length,r=0;r<n;r++){var i=t.charCodeAt(r);if(i>127){var o=ir.extendedChars.indexOf(t.charAt(r));o>-1&&(i=o+128)}e[i]=r}return n},ir.byte2str=function(t){for(var e=new Array(t.length),n=0;n<t.length;n++){var r=t[n];e[n]=r>127?ir.extendedChars[r-128]:String.fromCharCode(r)}return e.join("")},ir.byteLength=function(t){return t.length},ir.extendedChars=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];var or,ar,sr=r(31).inflateRaw,ur={};function cr(t,e){return new Date(1980+(e>>9),(e>>5&15)-1,31&e,t>>11,t>>5&63,31&t)}function lr(t,e,n,r){return 0===r?"":e?t.toString("utf8",n,n+r):ir.byte2str(t.slice(n,n+r))}!function(t){t[t.MSDOS=0]="MSDOS",t[t.AMIGA=1]="AMIGA",t[t.OPENVMS=2]="OPENVMS",t[t.UNIX=3]="UNIX",t[t.VM_CMS=4]="VM_CMS",t[t.ATARI_ST=5]="ATARI_ST",t[t.OS2_HPFS=6]="OS2_HPFS",t[t.MAC=7]="MAC",t[t.Z_SYSTEM=8]="Z_SYSTEM",t[t.CP_M=9]="CP_M",t[t.NTFS=10]="NTFS",t[t.MVS=11]="MVS",t[t.VSE=12]="VSE",t[t.ACORN_RISC=13]="ACORN_RISC",t[t.VFAT=14]="VFAT",t[t.ALT_MVS=15]="ALT_MVS",t[t.BEOS=16]="BEOS",t[t.TANDEM=17]="TANDEM",t[t.OS_400=18]="OS_400",t[t.OSX=19]="OSX"}(or||(or={})),function(t){t[t.STORED=0]="STORED",t[t.SHRUNK=1]="SHRUNK",t[t.REDUCED_1=2]="REDUCED_1",t[t.REDUCED_2=3]="REDUCED_2",t[t.REDUCED_3=4]="REDUCED_3",t[t.REDUCED_4=5]="REDUCED_4",t[t.IMPLODE=6]="IMPLODE",t[t.DEFLATE=8]="DEFLATE",t[t.DEFLATE64=9]="DEFLATE64",t[t.TERSE_OLD=10]="TERSE_OLD",t[t.BZIP2=12]="BZIP2",t[t.LZMA=14]="LZMA",t[t.TERSE_NEW=18]="TERSE_NEW",t[t.LZ77=19]="LZ77",t[t.WAVPACK=97]="WAVPACK",t[t.PPMD=98]="PPMD"}(ar||(ar={}));var fr=function(t){if(this.data=t,67324752!==t.readUInt32LE(0))throw new h(s.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))};fr.prototype.versionNeeded=function(){return this.data.readUInt16LE(4)},fr.prototype.flags=function(){return this.data.readUInt16LE(6)},fr.prototype.compressionMethod=function(){return this.data.readUInt16LE(8)},fr.prototype.lastModFileTime=function(){return cr(this.data.readUInt16LE(10),this.data.readUInt16LE(12))},fr.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(10)},fr.prototype.crc32=function(){return this.data.readUInt32LE(14)},fr.prototype.fileNameLength=function(){return this.data.readUInt16LE(26)},fr.prototype.extraFieldLength=function(){return this.data.readUInt16LE(28)},fr.prototype.fileName=function(){return lr(this.data,this.useUTF8(),30,this.fileNameLength())},fr.prototype.extraField=function(){var t=30+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())},fr.prototype.totalSize=function(){return 30+this.fileNameLength()+this.extraFieldLength()},fr.prototype.useUTF8=function(){return 2048==(2048&this.flags())};var hr=function(t,e,n){this.header=t,this.record=e,this.data=n};hr.prototype.decompress=function(){var t=this.header.compressionMethod(),e=ur[t];if(e)return e(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());var n=ar[t];throw n||(n="Unknown: "+t),new h(s.EINVAL,"Invalid compression method on file '"+this.header.fileName()+"': "+n)},hr.prototype.getHeader=function(){return this.header},hr.prototype.getRecord=function(){return this.record},hr.prototype.getRawData=function(){return this.data};var pr=function(t){this.data=t};pr.prototype.crc32=function(){return this.data.readUInt32LE(0)},pr.prototype.compressedSize=function(){return this.data.readUInt32LE(4)},pr.prototype.uncompressedSize=function(){return this.data.readUInt32LE(8)};var dr=function(t){if(this.data=t,134630224!==this.data.readUInt32LE(0))throw new h(s.EINVAL,"Invalid archive extra data record signature: "+this.data.readUInt32LE(0))};dr.prototype.length=function(){return this.data.readUInt32LE(4)},dr.prototype.extraFieldData=function(){return this.data.slice(8,8+this.length())};var yr=function(t){if(this.data=t,84233040!==this.data.readUInt32LE(0))throw new h(s.EINVAL,"Invalid digital signature signature: "+this.data.readUInt32LE(0))};yr.prototype.size=function(){return this.data.readUInt16LE(4)},yr.prototype.signatureData=function(){return this.data.slice(6,6+this.size())};var gr=function(t,e){if(this.zipData=t,this.data=e,33639248!==this.data.readUInt32LE(0))throw new h(s.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0));this._filename=this.produceFilename()};gr.prototype.versionMadeBy=function(){return this.data.readUInt16LE(4)},gr.prototype.versionNeeded=function(){return this.data.readUInt16LE(6)},gr.prototype.flag=function(){return this.data.readUInt16LE(8)},gr.prototype.compressionMethod=function(){return this.data.readUInt16LE(10)},gr.prototype.lastModFileTime=function(){return cr(this.data.readUInt16LE(12),this.data.readUInt16LE(14))},gr.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(12)},gr.prototype.crc32=function(){return this.data.readUInt32LE(16)},gr.prototype.compressedSize=function(){return this.data.readUInt32LE(20)},gr.prototype.uncompressedSize=function(){return this.data.readUInt32LE(24)},gr.prototype.fileNameLength=function(){return this.data.readUInt16LE(28)},gr.prototype.extraFieldLength=function(){return this.data.readUInt16LE(30)},gr.prototype.fileCommentLength=function(){return this.data.readUInt16LE(32)},gr.prototype.diskNumberStart=function(){return this.data.readUInt16LE(34)},gr.prototype.internalAttributes=function(){return this.data.readUInt16LE(36)},gr.prototype.externalAttributes=function(){return this.data.readUInt32LE(38)},gr.prototype.headerRelativeOffset=function(){return this.data.readUInt32LE(42)},gr.prototype.produceFilename=function(){return lr(this.data,this.useUTF8(),46,this.fileNameLength()).replace(/\\/g,"/")},gr.prototype.fileName=function(){return this._filename},gr.prototype.rawFileName=function(){return this.data.slice(46,46+this.fileNameLength())},gr.prototype.extraField=function(){var t=44+this.fileNameLength();return this.data.slice(t,t+this.extraFieldLength())},gr.prototype.fileComment=function(){var t=46+this.fileNameLength()+this.extraFieldLength();return lr(this.data,this.useUTF8(),t,this.fileCommentLength())},gr.prototype.rawFileComment=function(){var t=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(t,t+this.fileCommentLength())},gr.prototype.totalSize=function(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()},gr.prototype.isDirectory=function(){var t=this.fileName();return!!(16&this.externalAttributes())||"/"===t.charAt(t.length-1)},gr.prototype.isFile=function(){return!this.isDirectory()},gr.prototype.useUTF8=function(){return 2048==(2048&this.flag())},gr.prototype.isEncrypted=function(){return 1==(1&this.flag())},gr.prototype.getFileData=function(){var t=this.headerRelativeOffset(),e=new fr(this.zipData.slice(t));return new hr(e,this,this.zipData.slice(t+e.totalSize()))},gr.prototype.getData=function(){return this.getFileData().decompress()},gr.prototype.getRawData=function(){return this.getFileData().getRawData()},gr.prototype.getStats=function(){return new g(d.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var vr=function(t){if(this.data=t,101010256!==this.data.readUInt32LE(0))throw new h(s.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))};vr.prototype.diskNumber=function(){return this.data.readUInt16LE(4)},vr.prototype.cdDiskNumber=function(){return this.data.readUInt16LE(6)},vr.prototype.cdDiskEntryCount=function(){return this.data.readUInt16LE(8)},vr.prototype.cdTotalEntryCount=function(){return this.data.readUInt16LE(10)},vr.prototype.cdSize=function(){return this.data.readUInt32LE(12)},vr.prototype.cdOffset=function(){return this.data.readUInt32LE(16)},vr.prototype.cdZipCommentLength=function(){return this.data.readUInt16LE(20)},vr.prototype.cdZipComment=function(){return lr(this.data,!0,22,this.cdZipCommentLength())},vr.prototype.rawCdZipComment=function(){return this.data.slice(22,22+this.cdZipCommentLength())};var mr=function(t,e,n,r){this.index=t,this.directoryEntries=e,this.eocd=n,this.data=r},br=function(t){function e(n,r,i){void 0===r&&(r=""),void 0===i&&(i=!0),t.call(this),this.name=r,this._index=new Jn,this._directoryEntries=[],this._eocd=null,e.Name,n instanceof mr?(this._index=n.index,this._directoryEntries=n.directoryEntries,this._eocd=n.eocd,this.data=n.data):(this.data=n,this.populateIndex())}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){try{e.computeIndex(t.zipData,(function(r){var i=new e(r,t.name,!1);n(null,i)}),!1)}catch(t){n(t)}},e.isAvailable=function(){return!0},e.RegisterDecompressionMethod=function(t,e){ur[t]=e},e.computeIndex=function(t,n,r){void 0===r&&(r=!0);var i=new Jn,o=e.getEOCD(t);if(o.diskNumber()!==o.cdDiskNumber())throw new h(s.EINVAL,"ZipFS does not support spanned zip files.");var a=o.cdOffset();if(4294967295===a)throw new h(s.EINVAL,"ZipFS does not support Zip64.");var u=a+o.cdSize();e.computeIndexResponsive(t,i,a,u,n,[],o)},e.getEOCD=function(t){for(var e=Math.min(65557,t.length-1),n=22;n<e;n++)if(101010256===t.readUInt32LE(t.length-n))return new vr(t.slice(t.length-n));throw new h(s.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")},e.addToIndex=function(t,e){var n=t.fileName();if("/"===n.charAt(0))throw new Error("WHY IS THIS ABSOLUTE");"/"===n.charAt(n.length-1)&&(n=n.substr(0,n.length-1)),t.isDirectory()?e.addPathFast("/"+n,new tr(t)):e.addPathFast("/"+n,new Qn(t))},e.computeIndexResponsive=function(t,n,r,i,o,a,s){if(r<i){for(var u=0;u++<200&&r<i;){var c=new gr(t,t.slice(r));e.addToIndex(c,n),r+=c.totalSize(),a.push(c)}kn((function(){e.computeIndexResponsive(t,n,r,i,o,a,s)}))}else o(new mr(n,a,s,t))},e.prototype.getName=function(){return e.Name+(""!==this.name?" "+this.name:"")},e.prototype.getCentralDirectoryEntry=function(t){var e=this._index.getInode(t);if(null===e)throw h.ENOENT(t);if(er(e))return e.getData();if(nr(e))return e.getData();throw h.EPERM("Invalid inode: "+e)},e.prototype.getCentralDirectoryEntryAt=function(t){var e=this._directoryEntries[t];if(!e)throw new RangeError("Invalid directory index: "+t+".");return e},e.prototype.getNumberOfCentralDirectoryEntries=function(){return this._directoryEntries.length},e.prototype.getEndOfCentralDirectory=function(){return this._eocd},e.prototype.diskSpace=function(t,e){e(this.data.length,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.statSync=function(t,e){var n,r=this._index.getInode(t);if(null===r)throw h.ENOENT(t);if(er(r))n=r.getData().getStats();else{if(!nr(r))throw new h(s.EINVAL,"Invalid inode.");n=r.getStats()}return n},e.prototype.openSync=function(t,e,n){if(e.isWriteable())throw new h(s.EPERM,t);var r=this._index.getInode(t);if(!r)throw h.ENOENT(t);if(!er(r))throw h.EISDIR(t);var i=r.getData(),o=i.getStats();switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw h.EEXIST(t);case f.NOP:return new Q(this,t,e,o,i.getData());default:throw new h(s.EINVAL,"Invalid FileMode object.")}},e.prototype.readdirSync=function(t){var e=this._index.getInode(t);if(e){if(nr(e))return e.getListing();throw h.ENOTDIR(t)}throw h.ENOENT(t)},e.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.getBuffer();return null===e?j(i):i.toString(e)}finally{r.closeSync()}},e.prototype.populateIndex=function(){var t=this,n=this._eocd=e.getEOCD(this.data);if(n.diskNumber()!==n.cdDiskNumber())throw new h(s.EINVAL,"ZipFS does not support spanned zip files.");var r=n.cdOffset();if(4294967295===r)throw new h(s.EINVAL,"ZipFS does not support Zip64.");for(var i=r+n.cdSize();r<i;){var o=new gr(t.data,t.data.slice(r));r+=o.totalSize(),e.addToIndex(o,t._index),t._directoryEntries.push(o)}},e}(Z);function _r(t,e,n){return t.toString("ascii",e,e+n).trim()}function wr(t,e,n){if(1===n)return String.fromCharCode(t[e]);for(var r=Math.floor(n/2),i=new Array(r),o=0;o<r;o++){var a=e+(o<<1);i[o]=String.fromCharCode(t[a+1]|t[a]<<8)}return i.join("")}function Er(t,e){var n=parseInt(_r(t,e,4),10),r=parseInt(_r(t,e+4,2),10),i=parseInt(_r(t,e+6,2),10),o=parseInt(_r(t,e+8,2),10),a=parseInt(_r(t,e+10,2),10),s=parseInt(_r(t,e+12,2),10),u=parseInt(_r(t,e+14,2),10);return new Date(n,r,i,o,a,s,100*u)}function kr(t,e){var n=t[e],r=t[e+1],i=t[e+2],o=t[e+3],a=t[e+4],s=t[e+5];return new Date(n,r-1,i,o,a,s)}function Sr(t,e){var n=t.slice(e),r=new Ir(n);switch(r.signatureWord()){case 17221:return new Or(n);case 20548:return new Cr(n);case 21328:return new Nr(n);case 21332:return new Fr(n);case 17746:return new Mr(n);case 17747:return new Ur(n);case 20568:return new Hr(n);case 20558:return new zr(n);case 21324:return new Wr(n);case 20045:return new $r(n);case 17228:return new Xr(n);case 20556:return new Yr(n);case 21061:return new qr(n);case 21574:return new Gr(n);case 21318:return new Zr(n);case 21074:return new jr(n);default:return r}}function xr(t,e,n,r){n-=4;for(var i=new Array;e<n;){var o=Sr(t,e),a=o.length();if(0===a)return i;if(e+=a,o instanceof Fr)break;o instanceof Or?i=i.concat(o.getEntries(r)):i.push(o)}return i}br.Name="ZipFS",br.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:W},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},br.CompressionMethod=ar,br.RegisterDecompressionMethod(ar.DEFLATE,(function(t,e,n){return F(sr(t.slice(0,e),{chunkSize:n}))})),br.RegisterDecompressionMethod(ar.STORED,(function(t,e,n){return j(t,0,n)}));var Tr=function(t){this._data=t};Tr.prototype.type=function(){return this._data[0]},Tr.prototype.standardIdentifier=function(){return _r(this._data,1,5)},Tr.prototype.version=function(){return this._data[6]},Tr.prototype.data=function(){return this._data.slice(7,2048)};var Pr=function(t){function e(e){t.call(this,e),this._root=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.systemIdentifier=function(){return this._getString32(8)},e.prototype.volumeIdentifier=function(){return this._getString32(40)},e.prototype.volumeSpaceSize=function(){return this._data.readUInt32LE(80)},e.prototype.volumeSetSize=function(){return this._data.readUInt16LE(120)},e.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(124)},e.prototype.logicalBlockSize=function(){return this._data.readUInt16LE(128)},e.prototype.pathTableSize=function(){return this._data.readUInt32LE(132)},e.prototype.locationOfTypeLPathTable=function(){return this._data.readUInt32LE(140)},e.prototype.locationOfOptionalTypeLPathTable=function(){return this._data.readUInt32LE(144)},e.prototype.locationOfTypeMPathTable=function(){return this._data.readUInt32BE(148)},e.prototype.locationOfOptionalTypeMPathTable=function(){return this._data.readUInt32BE(152)},e.prototype.rootDirectoryEntry=function(t){return null===this._root&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(t)),this._root},e.prototype.volumeSetIdentifier=function(){return this._getString(190,128)},e.prototype.publisherIdentifier=function(){return this._getString(318,128)},e.prototype.dataPreparerIdentifier=function(){return this._getString(446,128)},e.prototype.applicationIdentifier=function(){return this._getString(574,128)},e.prototype.copyrightFileIdentifier=function(){return this._getString(702,38)},e.prototype.abstractFileIdentifier=function(){return this._getString(740,36)},e.prototype.bibliographicFileIdentifier=function(){return this._getString(776,37)},e.prototype.volumeCreationDate=function(){return Er(this._data,813)},e.prototype.volumeModificationDate=function(){return Er(this._data,830)},e.prototype.volumeExpirationDate=function(){return Er(this._data,847)},e.prototype.volumeEffectiveDate=function(){return Er(this._data,864)},e.prototype.fileStructureVersion=function(){return this._data[881]},e.prototype.applicationUsed=function(){return this._data.slice(883,1395)},e.prototype.reserved=function(){return this._data.slice(1395,2048)},e.prototype._getString32=function(t){return this._getString(t,32)},e}(Tr),Rr=function(t){function e(e){if(t.call(this,e),1!==this.type())throw new h(s.EIO,"Invalid primary volume descriptor.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.name=function(){return"ISO9660"},e.prototype._constructRootDirectoryRecord=function(t){return new Br(t,-1)},e.prototype._getString=function(t,e){return this._getString(t,e)},e}(Pr),Lr=function(t){function e(e){if(t.call(this,e),2!==this.type())throw new h(s.EIO,"Invalid supplementary volume descriptor.");var n=this.escapeSequence(),r=n[2];if(37!==n[0]||47!==n[1]||64!==r&&67!==r&&69!==r)throw new h(s.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+n.toString())}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.name=function(){return"Joliet"},e.prototype.escapeSequence=function(){return this._data.slice(88,120)},e.prototype._constructRootDirectoryRecord=function(t){return new Dr(t,-1)},e.prototype._getString=function(t,e){return wr(this._data,t,e)},e}(Pr),Ar=function(t,e){this._suEntries=null,this._fileOrDir=null,this._data=t,this._rockRidgeOffset=e};Ar.prototype.hasRockRidge=function(){return this._rockRidgeOffset>-1},Ar.prototype.getRockRidgeOffset=function(){return this._rockRidgeOffset},Ar.prototype.rootCheckForRockRidge=function(t){var e=this.getDirectory(t);this._rockRidgeOffset=e.getDotEntry(t)._getRockRidgeOffset(t),this._rockRidgeOffset>-1&&(this._fileOrDir=null)},Ar.prototype.length=function(){return this._data[0]},Ar.prototype.extendedAttributeRecordLength=function(){return this._data[1]},Ar.prototype.lba=function(){return 2048*this._data.readUInt32LE(2)},Ar.prototype.dataLength=function(){return this._data.readUInt32LE(10)},Ar.prototype.recordingDate=function(){return kr(this._data,18)},Ar.prototype.fileFlags=function(){return this._data[25]},Ar.prototype.fileUnitSize=function(){return this._data[26]},Ar.prototype.interleaveGapSize=function(){return this._data[27]},Ar.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(28)},Ar.prototype.identifier=function(){return this._getString(33,this._data[32])},Ar.prototype.fileName=function(t){if(this.hasRockRidge()){var e=this._rockRidgeFilename(t);if(null!==e)return e}var n=this.identifier();if(this.isDirectory(t))return n;var r=n.indexOf(";");return-1===r?n:"."===n[r-1]?n.slice(0,r-1):n.slice(0,r)},Ar.prototype.isDirectory=function(t){var e=!!(2&this.fileFlags());return!e&&this.hasRockRidge()&&(e=this.getSUEntries(t).filter((function(t){return t instanceof Xr})).length>0),e},Ar.prototype.isSymlink=function(t){return this.hasRockRidge()&&this.getSUEntries(t).filter((function(t){return t instanceof Wr})).length>0},Ar.prototype.getSymlinkPath=function(t){for(var e="",n=this.getSUEntries(t),r=this._getGetString(),i=0,o=n;i<o.length;i+=1){var a=o[i];if(a instanceof Wr){for(var s=0,u=a.componentRecords();s<u.length;s+=1){var c=u[s],l=c.flags();2&l?e+="./":4&l?e+="../":8&l?e+="/":(e+=c.content(r),1&l||(e+="/"))}if(!a.continueFlag())break}}return e.length>1&&"/"===e[e.length-1]?e.slice(0,e.length-1):e},Ar.prototype.getFile=function(t){if(this.isDirectory(t))throw new Error("Tried to get a File from a directory.");return null===this._fileOrDir&&(this._fileOrDir=t.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir},Ar.prototype.getDirectory=function(t){if(!this.isDirectory(t))throw new Error("Tried to get a Directory from a file.");return null===this._fileOrDir&&(this._fileOrDir=this._constructDirectory(t)),this._fileOrDir},Ar.prototype.getSUEntries=function(t){return this._suEntries||this._constructSUEntries(t),this._suEntries},Ar.prototype._rockRidgeFilename=function(t){var e=this.getSUEntries(t).filter((function(t){return t instanceof $r}));if(0===e.length||6&e[0].flags())return null;for(var n="",r=this._getGetString(),i=0,o=e;i<o.length;i+=1){var a=o[i];if(n+=a.name(r),!(1&a.flags()))break}return n},Ar.prototype._constructSUEntries=function(t){var e=33+this._data[32];e%2==1&&e++,e+=this._rockRidgeOffset,this._suEntries=xr(this._data,e,this.length(),t)},Ar.prototype._getRockRidgeOffset=function(t){this._rockRidgeOffset=0;var e=this.getSUEntries(t);if(e.length>0){var n=e[0];if(n instanceof Nr&&n.checkBytesPass())for(var r=1;r<e.length;r++){var i=e[r];if(i instanceof jr||i instanceof Mr&&"IEEE_P1282"===i.extensionIdentifier())return n.bytesSkipped()}}return this._rockRidgeOffset=-1,-1};var Br=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getString=function(t,e){return _r(this._data,t,e)},e.prototype._constructDirectory=function(t){return new Jr(this,t)},e.prototype._getGetString=function(){return _r},e}(Ar),Dr=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._getString=function(t,e){return wr(this._data,t,e)},e.prototype._constructDirectory=function(t){return new Qr(this,t)},e.prototype._getGetString=function(){return wr},e}(Ar),Ir=function(t){this._data=t};Ir.prototype.signatureWord=function(){return this._data.readUInt16BE(0)},Ir.prototype.signatureWordString=function(){return _r(this._data,0,2)},Ir.prototype.length=function(){return this._data[2]},Ir.prototype.suVersion=function(){return this._data[3]};var Or=function(t){function e(e){t.call(this,e),this._entries=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.continuationLba=function(){return this._data.readUInt32LE(4)},e.prototype.continuationLbaOffset=function(){return this._data.readUInt32LE(12)},e.prototype.continuationLength=function(){return this._data.readUInt32LE(20)},e.prototype.getEntries=function(t){if(!this._entries){var e=2048*this.continuationLba()+this.continuationLbaOffset();this._entries=xr(t,e,this.continuationLength(),t)}return this._entries},e}(Ir),Cr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ir),Nr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.checkBytesPass=function(){return 190===this._data[4]&&239===this._data[5]},e.prototype.bytesSkipped=function(){return this._data[6]},e}(Ir),Fr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ir),Mr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.identifierLength=function(){return this._data[4]},e.prototype.descriptorLength=function(){return this._data[5]},e.prototype.sourceLength=function(){return this._data[6]},e.prototype.extensionVersion=function(){return this._data[7]},e.prototype.extensionIdentifier=function(){return _r(this._data,8,this.identifierLength())},e.prototype.extensionDescriptor=function(){return _r(this._data,8+this.identifierLength(),this.descriptorLength())},e.prototype.extensionSource=function(){return _r(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())},e}(Ir),Ur=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.extensionSequence=function(){return this._data[4]},e}(Ir),jr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ir),Hr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.mode=function(){return this._data.readUInt32LE(4)},e.prototype.fileLinks=function(){return this._data.readUInt32LE(12)},e.prototype.uid=function(){return this._data.readUInt32LE(20)},e.prototype.gid=function(){return this._data.readUInt32LE(28)},e.prototype.inode=function(){return this._data.readUInt32LE(36)},e}(Ir),zr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.devTHigh=function(){return this._data.readUInt32LE(4)},e.prototype.devTLow=function(){return this._data.readUInt32LE(12)},e}(Ir),Wr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.continueFlag=function(){return 1&this.flags()},e.prototype.componentRecords=function(){for(var t=new Array,e=5;e<this.length();){var n=new Vr(this._data.slice(e));t.push(n),e+=n.length()}return t},e}(Ir),Vr=function(t){this._data=t};Vr.prototype.flags=function(){return this._data[0]},Vr.prototype.length=function(){return 2+this.componentLength()},Vr.prototype.componentLength=function(){return this._data[1]},Vr.prototype.content=function(t){return t(this._data,2,this.componentLength())};var $r=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.name=function(t){return t(this._data,5,this.length()-5)},e}(Ir),Xr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.childDirectoryLba=function(){return this._data.readUInt32LE(4)},e}(Ir),Yr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.parentDirectoryLba=function(){return this._data.readUInt32LE(4)},e}(Ir),qr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ir),Gr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flags=function(){return this._data[4]},e.prototype.creation=function(){return 1&this.flags()?this._longFormDates()?Er(this._data,5):kr(this._data,5):null},e.prototype.modify=function(){if(2&this.flags()){var t=1&this.flags()?1:0;return this._longFormDates?Er(this._data,5+17*t):kr(this._data,5+7*t)}return null},e.prototype.access=function(){if(4&this.flags()){var t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,this._longFormDates?Er(this._data,5+17*t):kr(this._data,5+7*t)}return null},e.prototype.backup=function(){if(16&this.flags()){var t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,this._longFormDates?Er(this._data,5+17*t):kr(this._data,5+7*t)}return null},e.prototype.expiration=function(){if(32&this.flags()){var t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,this._longFormDates?Er(this._data,5+17*t):kr(this._data,5+7*t)}return null},e.prototype.effective=function(){if(64&this.flags()){var t=1&this.flags()?1:0;return t+=2&this.flags()?1:0,t+=4&this.flags()?1:0,t+=16&this.flags()?1:0,t+=32&this.flags()?1:0,this._longFormDates?Er(this._data,5+17*t):kr(this._data,5+7*t)}return null},e.prototype._longFormDates=function(){return!!this.flags()},e}(Ir),Zr=function(t){function e(e){t.call(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.virtualSizeHigh=function(){return this._data.readUInt32LE(4)},e.prototype.virtualSizeLow=function(){return this._data.readUInt32LE(12)},e.prototype.tableDepth=function(){return this._data[20]},e}(Ir),Kr=function(t,e){var n=this;this._fileList=[],this._fileMap={},this._record=t;var r=t.lba(),i=r+t.dataLength();for(2&t.fileFlags()||(r=2048*t.getSUEntries(e).filter((function(t){return t instanceof Xr}))[0].childDirectoryLba(),i=1/0);r<i;)if(0!==e[r]){var o=n._constructDirectoryRecord(e.slice(r)),a=o.fileName(e);"\0"!==a&&""!==a?o.hasRockRidge()&&0!==o.getSUEntries(e).filter((function(t){return t instanceof qr})).length||(n._fileMap[a]=o,n._fileList.push(a)):i===1/0&&(i=r+o.dataLength()),r+=o.length()}else r++};Kr.prototype.getRecord=function(t){return this._fileMap[t]},Kr.prototype.getFileList=function(){return this._fileList},Kr.prototype.getDotEntry=function(t){return this._constructDirectoryRecord(t.slice(this._record.lba()))};var Jr=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._constructDirectoryRecord=function(t){return new Br(t,this._record.getRockRidgeOffset())},e}(Kr),Qr=function(t){function e(e,n){t.call(this,e,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._constructDirectoryRecord=function(t){return new Dr(t,this._record.getRockRidgeOffset())},e}(Kr),ti=function(t){function e(n,r,i){var o=this;void 0===r&&(r=""),void 0===i&&(i=!0),t.call(this),this._data=n,e.Name;for(var a=!1,u=32768,c=new Array;!a;){var l=n.slice(u);switch(new Tr(l).type()){case 1:c.push(new Rr(l));break;case 2:c.push(new Lr(l));break;case 255:a=!0}u+=2048}if(0===c.length)throw new h(s.EIO,"Unable to find a suitable volume descriptor.");c.forEach((function(t){o._pvd&&2===o._pvd.type()||(o._pvd=t)})),this._root=this._pvd.rootDirectoryEntry(n),this._name=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.Create=function(t,n){var r,i;try{r=new e(t.data,t.name,!1)}catch(i){i=i}finally{n(void 0,r)}},e.isAvailable=function(){return!0},e.prototype.getName=function(){var t="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(t+="-RockRidge"),t},e.prototype.diskSpace=function(t,e){e(this._data.length,0)},e.prototype.isReadOnly=function(){return!0},e.prototype.supportsLinks=function(){return!1},e.prototype.supportsProps=function(){return!1},e.prototype.supportsSynch=function(){return!0},e.prototype.statSync=function(t,e){var n=this._getDirectoryRecord(t);if(null===n)throw h.ENOENT(t);return this._getStats(t,n)},e.prototype.openSync=function(t,e,n){if(e.isWriteable())throw new h(s.EPERM,t);var r=this._getDirectoryRecord(t);if(!r)throw h.ENOENT(t);if(r.isSymlink(this._data))return this.openSync(c.resolve(t,r.getSymlinkPath(this._data)),e,n);if(r.isDirectory(this._data))throw h.EISDIR(t);var i=r.getFile(this._data),o=this._getStats(t,r);switch(e.pathExistsAction()){case f.THROW_EXCEPTION:case f.TRUNCATE_FILE:throw h.EEXIST(t);case f.NOP:return new Q(this,t,e,o,i);default:throw new h(s.EINVAL,"Invalid FileMode object.")}},e.prototype.readdirSync=function(t){var e=this._getDirectoryRecord(t);if(e){if(e.isDirectory(this._data))return e.getDirectory(this._data).getFileList().slice(0);throw h.ENOTDIR(t)}throw h.ENOENT(t)},e.prototype.readFileSync=function(t,e,n){var r=this.openSync(t,n,420);try{var i=r.getBuffer();return null===e?j(i):i.toString(e)}finally{r.closeSync()}},e.prototype._getDirectoryRecord=function(t){if("/"===t)return this._root;for(var e=t.split("/").slice(1),n=this._root,r=0,i=e;r<i.length;r+=1){var o=i[r];if(!n.isDirectory(this._data))return null;if(!(n=n.getDirectory(this._data).getRecord(o)))return null}return n},e.prototype._getStats=function(t,e){if(e.isSymlink(this._data)){var n=c.resolve(t,e.getSymlinkPath(this._data)),r=this._getDirectoryRecord(n);return r?this._getStats(n,r):null}var i=e.dataLength(),o=365,a=e.recordingDate(),s=a,u=a,l=a;if(e.hasRockRidge())for(var f=0,h=e.getSUEntries(this._data);f<h.length;f+=1){var p=h[f];if(p instanceof Hr)o=p.mode();else if(p instanceof Gr){var y=p.flags();4&y&&(s=p.access()),2&y&&(u=p.modify()),1&y&&(l=p.creation())}}return o&=365,new g(e.isDirectory(this._data)?d.DIRECTORY:d.FILE,i,o,s,u,l)},e}(Z);ti.Name="IsoFS",ti.Options={data:{type:"object",description:"The ISO file in a buffer",validator:W}},[et,xe,Re,Le,Fe,Ke,on,ti,cn,ln,Dn,qn,rr,br].forEach((function(t){var e=t.Create;t.Create=function(n,r){var i="function"==typeof n,o=i?n:r,a=i?{}:n;V(t,a,(function(n){n?o(n):e.call(t,a,o)}))}}));var ei,ni={AsyncMirror:et,Dropbox:xe,Emscripten:Re,FolderAdapter:Le,HTML5FS:Fe,InMemory:Ke,IndexedDB:on,IsoFS:ti,LocalStorage:cn,MountableFileSystem:ln,OverlayFS:Dn,WorkerFS:qn,XmlHttpRequest:rr,ZipFS:br};function ri(t){switch(t){case"fs":return T;case"path":return c;case"buffer":return u;case"process":return a;case"bfs_utils":return $;default:return ni[t]}}function ii(t){return T.initialize(t)}function oi(t,e){var n=t.fs;if(!n)return e(new h(s.EPERM,'Missing "fs" property on configuration object.'));var r=t.options,i=0,o=!1;function a(){if(!o){o=!0;var t=ni[n];t?t.Create(r,e):e(new h(s.EPERM,"File system "+n+" is not available in BrowserFS."))}}if(null!==r&&"object"==typeof r){var u=!1;Object.keys(r).filter((function(t){return"fs"!==t})).forEach((function(t){var n=r[t];null!==n&&"object"==typeof n&&n.fs&&(i++,oi(n,(function(n,s){if(i--,n){if(o)return;o=!0,e(n)}else r[t]=s,0===i&&u&&a()})))})),u=!0}0===i&&a()}a.initializeTTYs&&a.initializeTTYs(),"b"!=="ab".substr(-1)&&(String.prototype.substr=(ei=String.prototype.substr,function(t,e){return t<0&&(t=this.length+t),ei.call(this,t,e)})),"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&(Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t<0&&(t=this.length+t)<0&&(t=0),e<0&&(e=this.length+e)<0&&(e=0),e<t&&(e=t),new Uint8Array(this.buffer,this.byteOffset+t,e-t)})),n.install=function(e){e.Buffer=t,e.process=a;var n=e.require?e.require:null;e.require=function(t){var e=ri(t);return e||n.apply(null,Array.prototype.slice.call(arguments,0))}},n.registerFileSystem=function(t,e){ni[t]=e},n.BFSRequire=ri,n.initialize=ii,n.configure=function(t,e){oi(t,(function(t,n){n?(ii(n),e()):e(t)}))},n.getFileSystem=oi,n.EmscriptenFS=q,n.FileSystem=ni,n.Errors=p,n.setImmediate=kn}).call(n,r(1),function(){return this}(),r(5)(t),r(6))},function(t,e,n){t.exports=n(2).Buffer},function(t,e,n){(function(t){"use strict";var r=n(3),i=n(4);e.Buffer=t,e.SlowBuffer=function(e){return+e!=e&&(e=0),t.alloc(+e)},e.INSPECT_MAX_BYTES=50;var o=2147483647;function a(e){if(e>o)throw new RangeError("Invalid typed array length");var n=new Uint8Array(e);return n.__proto__=t.prototype,n}function t(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(t)}return s(t,e,n)}function s(e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return U(e)?function(e,n,r){if(n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");var i;return(i=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r)).__proto__=t.prototype,i}(e,n,r):"string"==typeof e?function(e,n){if("string"==typeof n&&""!==n||(n="utf8"),!t.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|h(e,n),i=a(r),o=i.write(e,n);return o!==r&&(i=i.slice(0,o)),i}(e,n):function(e){if(t.isBuffer(e)){var n=0|f(e.length),r=a(n);return 0===r.length||e.copy(r,0,0,n),r}if(e){if(j(e)||"length"in e)return"number"!=typeof e.length||H(e.length)?a(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t){return u(t),a(t<0?0:0|f(t))}function l(t){for(var e=t.length<0?0:0|f(t.length),n=a(e),r=0;r<e;r+=1)n[r]=255&t[r];return n}function f(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function h(e,n){if(t.isBuffer(e))return e.length;if(j(e)||U(e))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var i=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(i)return N(e).length;n=(""+n).toLowerCase(),i=!0}}function p(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return R(this,e,n);case"utf8":case"utf-8":return S(this,e,n);case"ascii":return T(this,e,n);case"latin1":case"binary":return P(this,e,n);case"base64":return k(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function d(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(e,n,r,i,o){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof n&&(n=t.from(n,i)),t.isBuffer(n))return 0===n.length?-1:g(e,n,r,i,o);if("number"==typeof n)return n&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,n,r):Uint8Array.prototype.lastIndexOf.call(e,n,r):g(e,[n],r,i,o);throw new TypeError("val must be string, number or Buffer")}function g(t,e,n,r,i){var o,a=1,s=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,n/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var l=-1;for(o=n;o<s;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var f=!0,h=0;h<u;h++)if(c(t,o+h)!==c(e,h)){f=!1;break}if(f)return o}return-1}function v(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(H(s))return a;t[n+a]=s}return a}function m(t,e,n,r){return M(N(e,t.length-n),t,n,r)}function b(t,e,n,r){return M(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _(t,e,n,r){return b(t,e,n,r)}function w(t,e,n,r){return M(F(e),t,n,r)}function E(t,e,n,r){return M(function(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=(n=t.charCodeAt(a))>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function k(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function S(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,a,s,u,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(t){var e=t.length;if(e<=x)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=x));return n}(r)}e.kMaxLength=o,t.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),!t.TYPED_ARRAY_SUPPORT&&"undefined"!=typeof console&&console.error,"undefined"!=typeof Symbol&&Symbol.species&&t[Symbol.species]===t&&Object.defineProperty(t,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),t.poolSize=8192,t.from=function(t,e,n){return s(t,e,n)},t.prototype.__proto__=Uint8Array.prototype,t.__proto__=Uint8Array,t.alloc=function(t,e,n){return function(t,e,n){return u(t),t<=0?a(t):void 0!==e?"string"==typeof n?a(t).fill(e,n):a(t).fill(e):a(t)}(t,e,n)},t.allocUnsafe=function(t){return c(t)},t.allocUnsafeSlow=function(t){return c(t)},t.isBuffer=function(t){return null!=t&&!0===t._isBuffer},t.compare=function(e,n){if(!t.isBuffer(e)||!t.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(e===n)return 0;for(var r=e.length,i=n.length,o=0,a=Math.min(r,i);o<a;++o)if(e[o]!==n[o]){r=e[o],i=n[o];break}return r<i?-1:i<r?1:0},t.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},t.concat=function(e,n){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return t.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<e.length;++r)n+=e[r].length;var i=t.allocUnsafe(n),o=0;for(r=0;r<e.length;++r){var a=e[r];if(!t.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,o),o+=a.length}return i},t.byteLength=h,t.prototype._isBuffer=!0,t.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},t.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},t.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},t.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?S(this,0,t):p.apply(this,arguments)},t.prototype.equals=function(e){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===t.compare(this,e)},t.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},t.prototype.compare=function(e,n,r,i,o){if(!t.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),n<0||r>e.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&n>=r)return 0;if(i>=o)return-1;if(n>=r)return 1;if(this===e)return 0;for(var a=(o>>>=0)-(i>>>=0),s=(r>>>=0)-(n>>>=0),u=Math.min(a,s),c=this.slice(i,o),l=e.slice(n,r),f=0;f<u;++f)if(c[f]!==l[f]){a=c[f],s=l[f];break}return a<s?-1:s<a?1:0},t.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},t.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},t.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},t.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return m(this,t,e,n);case"ascii":return b(this,t,e,n);case"latin1":case"binary":return _(this,t,e,n);case"base64":return w(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function T(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function P(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function R(t,e,n){var r,i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var o="",a=e;a<n;++a)o+=(r=t[a])<16?"0"+r.toString(16):r.toString(16);return o}function L(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function A(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function B(e,n,r,i,o,a){if(!t.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>o||n<a)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function D(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function I(t,e,n,r,o){return e=+e,n>>>=0,o||D(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function O(t,e,n,r,o){return e=+e,n>>>=0,o||D(t,0,n,8),i.write(t,e,n,r,52,8),n+8}t.prototype.slice=function(e,n){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(n=void 0===n?r:~~n)<0?(n+=r)<0&&(n=0):n>r&&(n=r),n<e&&(n=e);var i=this.subarray(e,n);return i.__proto__=t.prototype,i},t.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},t.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||A(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},t.prototype.readUInt8=function(t,e){return t>>>=0,e||A(t,1,this.length),this[t]},t.prototype.readUInt16LE=function(t,e){return t>>>=0,e||A(t,2,this.length),this[t]|this[t+1]<<8},t.prototype.readUInt16BE=function(t,e){return t>>>=0,e||A(t,2,this.length),this[t]<<8|this[t+1]},t.prototype.readUInt32LE=function(t,e){return t>>>=0,e||A(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},t.prototype.readUInt32BE=function(t,e){return t>>>=0,e||A(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},t.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||A(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},t.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||A(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},t.prototype.readInt8=function(t,e){return t>>>=0,e||A(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},t.prototype.readInt16LE=function(t,e){t>>>=0,e||A(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt16BE=function(t,e){t>>>=0,e||A(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},t.prototype.readInt32LE=function(t,e){return t>>>=0,e||A(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},t.prototype.readInt32BE=function(t,e){return t>>>=0,e||A(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},t.prototype.readFloatLE=function(t,e){return t>>>=0,e||A(t,4,this.length),i.read(this,t,!0,23,4)},t.prototype.readFloatBE=function(t,e){return t>>>=0,e||A(t,4,this.length),i.read(this,t,!1,23,4)},t.prototype.readDoubleLE=function(t,e){return t>>>=0,e||A(t,8,this.length),i.read(this,t,!0,52,8)},t.prototype.readDoubleBE=function(t,e){return t>>>=0,e||A(t,8,this.length),i.read(this,t,!1,52,8)},t.prototype.writeUIntLE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||B(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},t.prototype.writeUIntBE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||B(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},t.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,1,255,0),this[e]=255&t,e+1},t.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},t.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},t.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},t.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},t.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);B(this,t,e,n,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},t.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);B(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},t.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},t.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},t.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},t.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},t.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},t.prototype.writeFloatLE=function(t,e,n){return I(this,t,e,!0,n)},t.prototype.writeFloatBE=function(t,e,n){return I(this,t,e,!1,n)},t.prototype.writeDoubleLE=function(t,e,n){return O(this,t,e,!0,n)},t.prototype.writeDoubleBE=function(t,e,n){return O(this,t,e,!1,n)},t.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},t.prototype.fill=function(e,n,r,i){if("string"==typeof e){if("string"==typeof n?(i=n,n=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!t.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;var a;if(n>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=n;a<r;++a)this[a]=e;else{var s=t.isBuffer(e)?e:new t(e,i),u=s.length;for(a=0;a<r-n;++a)this[a+n]=s[a%u]}return this};var C=/[^+/0-9A-Za-z-_]/g;function N(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(t){return r.toByteArray(function(t){if((t=t.trim().replace(C,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function M(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function U(t){return t instanceof ArrayBuffer||null!=t&&null!=t.constructor&&"ArrayBuffer"===t.constructor.name&&"number"==typeof t.byteLength}function j(t){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(t)}function H(t){return t!=t}}).call(e,n(1))},function(t,e){"use strict";e.byteLength=function(t){return 3*t.length/4-u(t)},e.toByteArray=function(t){var e,n,o,a,s,c,l=t.length;s=u(t),c=new i(3*l/4-s),o=s>0?l-4:l;var f=0;for(e=0,n=0;e<o;e+=4,n+=3)a=r[t.charCodeAt(e)]<<18|r[t.charCodeAt(e+1)]<<12|r[t.charCodeAt(e+2)]<<6|r[t.charCodeAt(e+3)],c[f++]=a>>16&255,c[f++]=a>>8&255,c[f++]=255&a;return 2===s?(a=r[t.charCodeAt(e)]<<2|r[t.charCodeAt(e+1)]>>4,c[f++]=255&a):1===s&&(a=r[t.charCodeAt(e)]<<10|r[t.charCodeAt(e+1)]<<4|r[t.charCodeAt(e+2)]>>2,c[f++]=a>>8&255,c[f++]=255&a),c},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o="",a=[],s=16383,u=0,l=r-i;u<l;u+=s)a.push(c(t,u,u+s>l?l:u+s));return 1===i?(e=t[r-1],o+=n[e>>2],o+=n[e<<4&63],o+="=="):2===i&&(e=(t[r-2]<<8)+t[r-1],o+=n[e>>10],o+=n[e>>4&63],o+=n[e<<2&63],o+="="),a.push(o),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function c(t,e,r){for(var i,o,a=[],s=e;s<r;s+=3)i=(t[s]<<16)+(t[s+1]<<8)+t[s+2],a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+t[e+f],f+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(e*u-1)*Math.pow(2,i),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+p]=255&a,p+=d,a/=256,c-=8);t[n+p-d]|=128*y}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,n){"use strict";var r=new(n(7)),i={};function o(t){i[t]||("function"==typeof r[t]?i[t]=function(){return r[t].apply(r,arguments)}:i[t]=r[t])}for(var a in r)o(a);i.initializeTTYs=function(){null===r.stdin&&(r.initializeTTYs(),i.stdin=r.stdin,i.stdout=r.stdout,i.stderr=r.stderr)},r.nextTick((function(){i.initializeTTYs()})),t.exports=i},function(t,e,n){(function(e){"use strict";var r=this&&this.__extends||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},i=n(8),o=null,a=function(){function t(t,e){this.fun=t,this.array=e}return t.prototype.run=function(){this.fun.apply(null,this.array)},t}(),s=function(){function t(){this._queue=[],this._draining=!1,this._currentQueue=null,this._queueIndex=-1}return t.prototype.push=function(t){var e=this;1!==this._queue.push(t)||this._draining||setTimeout((function(){return e._drainQueue()}),0)},t.prototype._cleanUpNextTick=function(){this._draining=!1,this._currentQueue&&this._currentQueue.length?this._queue=this._currentQueue.concat(this._queue):this._queueIndex=-1,this._queue.length&&this._drainQueue()},t.prototype._drainQueue=function(){var t=this;if(!this._draining){var e=setTimeout((function(){return t._cleanUpNextTick()}));this._draining=!0;for(var n=this._queue.length;n;){for(this._currentQueue=this._queue,this._queue=[];++this._queueIndex<n;)this._currentQueue&&this._currentQueue[this._queueIndex].run();this._queueIndex=-1,n=this._queue.length}this._currentQueue=null,this._draining=!1,clearTimeout(e)}},t}(),u=function(t){function i(){t.apply(this,arguments),this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.execArgv=[],this.stdout=null,this.stderr=null,this.stdin=null,this.domain=null,this._queue=new s,this.execPath=e,this.env={},this.exitCode=0,this._gid=1,this._uid=1,this.version="v5.0",this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"},this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:!1,node_install_waf:!1,node_prefix:"",node_shared_cares:!1,node_shared_http_parser:!1,node_shared_libuv:!1,node_shared_zlib:!1,node_shared_v8:!1,node_use_dtrace:!1,node_use_etw:!1,node_use_openssl:!1,node_shared_openssl:!1,strict_aliasing:!1,target_arch:"x32",v8_use_snapshot:!1,v8_no_strict_aliasing:0,visibility:""}},this.pid=1e3*Math.random()|0,this.title="node",this.arch="x32",this._mask=18,this.connected=void 0}return r(i,t),i.prototype.chdir=function(t){null===o&&(o=n(9)),this._cwd=o.resolve(t)},i.prototype.cwd=function(){return this._cwd},i.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},i.prototype.nextTick=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._queue.push(new a(t,e))},i.prototype.abort=function(){this.emit("abort")},i.prototype.exit=function(t){this.exitCode=t,this.emit("exit",[t])},i.prototype.getgid=function(){return this._gid},i.prototype.setgid=function(t){this._gid="number"==typeof t?t:1},i.prototype.getuid=function(){return this._uid},i.prototype.setuid=function(t){this._uid="number"==typeof t?t:1},i.prototype.kill=function(t,e){this.emit("kill",[t,e])},i.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}},i.prototype.umask=function(t){void 0===t&&(t=this._mask);var e=this._mask;return this._mask=t,this.emit("umask",[t]),e},i.prototype.hrtime=function(){var t,e=(t="undefined"!=typeof performance?performance.now():Date.now?Date.now():(new Date).getTime())/1e3|0;return[e,t=1e6*(t-=1e3*e)|0]},i.prototype.initializeTTYs=function(){if(null===this.stdout){var t=n(10);this.stdout=new t,this.stderr=new t,this.stdin=new t}},i.prototype.disconnect=function(){},i}(i.EventEmitter);t.exports=u}).call(e,"/")},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,a,s,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(o(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),a=(c=n.slice()).length,u=0;u<a;u++)c[u].apply(this,s);return!0},n.prototype.addListener=function(t,e){var a;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(a=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.trace),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var n,o,a,s;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(n=this._events[t]).length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(s=a;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){(function(e){"use strict";var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(){function t(){}return t.normalize=function(e){""===e&&(e=".");for(var n=e.charAt(0)===t.sep,r=(e=t._removeDuplicateSeps(e)).split(t.sep),i=[],o=0;o<r.length;o++){var a=r[o];"."!==a&&(".."===a&&(n||!n&&i.length>0&&".."!==i[0])?i.pop():i.push(a))}if(!n&&i.length<2)switch(i.length){case 1:""===i[0]&&i.unshift(".");break;default:i.push(".")}return e=i.join(t.sep),n&&e.charAt(0)!==t.sep&&(e=t.sep+e),e},t.join=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];for(var r=[],i=0;i<e.length;i++){var o=e[i];if("string"!=typeof o)throw new TypeError("Invalid argument type to path.join: "+typeof o);""!==o&&r.push(o)}return t.normalize(r.join(t.sep))},t.resolve=function(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];for(var i=[],o=0;o<n.length;o++){var a=n[o];if("string"!=typeof a)throw new TypeError("Invalid argument type to path.join: "+typeof a);""!==a&&(a.charAt(0)===t.sep&&(i=[]),i.push(a))}var s=t.normalize(i.join(t.sep));if(s.length>1&&s.charAt(s.length-1)===t.sep)return s.substr(0,s.length-1);if(s.charAt(0)!==t.sep){"."!==s.charAt(0)||1!==s.length&&s.charAt(1)!==t.sep||(s=1===s.length?"":s.substr(2));var u=e.cwd();s=""!==s?this.normalize(u+("/"!==u?t.sep:"")+s):u}return s},t.relative=function(e,n){var r;e=t.resolve(e),n=t.resolve(n);var i=e.split(t.sep),o=n.split(t.sep);o.shift(),i.shift();var a=0,s=[];for(r=0;r<i.length;r++)if(i[r]!==o[r]){a=i.length-r;break}s=o.slice(r),1===i.length&&""===i[0]&&(a=0),a>i.length&&(a=i.length);var u="";for(r=0;r<a;r++)u+="../";return(u+=s.join(t.sep)).length>1&&u.charAt(u.length-1)===t.sep&&(u=u.substr(0,u.length-1)),u},t.dirname=function(e){var n=(e=t._removeDuplicateSeps(e)).charAt(0)===t.sep,r=e.split(t.sep);return""===r.pop()&&r.length>0&&r.pop(),r.length>1||1===r.length&&!n?r.join(t.sep):n?t.sep:"."},t.basename=function(e,n){if(void 0===n&&(n=""),""===e)return e;var r=(e=t.normalize(e)).split(t.sep),i=r[r.length-1];return""===i&&r.length>1?r[r.length-2]:n.length>0&&i.substr(i.length-n.length)===n?i.substr(0,i.length-n.length):i},t.extname=function(e){var n=(e=t.normalize(e)).split(t.sep);if(""===(e=n.pop())&&n.length>0&&(e=n.pop()),".."===e)return"";var r=e.lastIndexOf(".");return-1===r||0===r?"":e.substr(r)},t.isAbsolute=function(e){return e.length>0&&e.charAt(0)===t.sep},t._makeLong=function(t){return t},t.parse=function(t){var e,r,i=(e=t,(r=n.exec(e)).shift(),r);return{root:i[0],dir:i[0]+i[1].slice(0,-1),base:i[2],ext:i[3],name:i[2].slice(0,i[2].length-i[3].length)}},t.format=function(e){if(null===e||"object"!=typeof e)throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof e);if("string"!=typeof(e.root||""))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof e.root);return(e.dir?e.dir+t.sep:"")+(e.base||"")},t._removeDuplicateSeps=function(t){return t=t.replace(this._replaceRegex,this.sep)},t.sep="/",t._replaceRegex=new RegExp("//+","g"),t.delimiter=":",t.posix=t,t.win32=t,t}();t.exports=r}).call(e,n(6))},function(t,e,n){(function(e){"use strict";var r=this&&this.__extends||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},i=function(t){function n(){t.call(this),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0,this._bufferedWrites=[],this._waitingForWrites=!1}return r(n,t),n.prototype.setRawMode=function(t){this.isRaw!==t&&(this.isRaw=t,this.emit("modeChange"))},n.prototype.changeColumns=function(t){t!==this.columns&&(this.columns=t,this.emit("resize"))},n.prototype.changeRows=function(t){t!==this.rows&&(this.rows=t,this.emit("resize"))},n.isatty=function(t){return t&&t instanceof n},n.prototype._write=function(t,n,r){var i;try{var o;o="string"==typeof t?new e(t,n):t,this._bufferedWrites.push(o),this._waitingForWrites&&this._read(1024)}catch(t){i=t}finally{r(i)}},n.prototype._read=function(t){if(0===this._bufferedWrites.length)this._waitingForWrites=!0;else for(;this._bufferedWrites.length>0&&(this._waitingForWrites=this.push(this._bufferedWrites.shift()),this._waitingForWrites););},n}(n(11).Duplex);t.exports=i}).call(e,n(1))},function(t,e,n){t.exports=i;var r=n(8).EventEmitter;function i(){r.call(this)}n(12)(i,r),i.Readable=n(13),i.Writable=n(27),i.Duplex=n(28),i.Transform=n(29),i.PassThrough=n(30),i.Stream=i,i.prototype.pipe=function(t,e){var n=this;function i(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),t.on("drain",o),t._isStdio||e&&!1===e.end||(n.on("end",s),n.on("close",u));var a=!1;function s(){a||(a=!0,t.end())}function u(){a||(a=!0,"function"==typeof t.destroy&&t.destroy())}function c(t){if(l(),0===r.listenerCount(this,"error"))throw t}function l(){n.removeListener("data",i),t.removeListener("drain",o),n.removeListener("end",s),n.removeListener("close",u),n.removeListener("error",c),t.removeListener("error",c),n.removeListener("end",l),n.removeListener("close",l),t.removeListener("close",l)}return n.on("error",c),t.on("error",c),n.on("end",l),n.on("close",l),t.on("close",l),t.emit("pipe",n),t}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){(function(r){var i=function(){try{return n(11)}catch(t){}}();(e=t.exports=n(14)).Stream=i||e,e.Readable=e,e.Writable=n(22),e.Duplex=n(21),e.Transform=n(25),e.PassThrough=n(26),!r.browser&&"disable"===r.env.READABLE_STREAM&&i&&(t.exports=i)}).call(e,n(6))},function(t,e,n){(function(e){"use strict";t.exports=g;var r,i=n(15),o=n(16);g.ReadableState=y,n(8).EventEmitter;var a,s=function(t,e){return t.listeners(e).length};!function(){try{a=n(11)}catch(t){}finally{a||(a=n(8).EventEmitter)}}();var u=n(2).Buffer,c=n(17),l=n(18);l.inherits=n(12);var f=n(19),h=void 0;h=f&&f.debuglog?f.debuglog("stream"):function(){};var p,d=n(20);function y(t,e){r=r||n(21),t=t||{},this.objectMode=!!t.objectMode,e instanceof r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:o,this.highWaterMark=~~this.highWaterMark,this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=n(24).StringDecoder),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function g(t){if(r=r||n(21),!(this instanceof g))return new g(t);this._readableState=new y(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),a.call(this)}function v(t,e,n,r,o){var a=function(t,e){var n=null;return u.isBuffer(e)||"string"==typeof e||null==e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(e,n);if(a)t.emit("error",a);else if(null===n)e.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,_(t)}}(t,e);else if(e.objectMode||n&&n.length>0)if(e.ended&&!o){var s=new Error("stream.push() after EOF");t.emit("error",s)}else if(e.endEmitted&&o){var c=new Error("stream.unshift() after end event");t.emit("error",c)}else{var l;!e.decoder||o||r||(n=e.decoder.write(n),l=!e.objectMode&&0===n.length),o||(e.reading=!1),l||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,o?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&_(t))),function(t,e){e.readingMore||(e.readingMore=!0,i(E,t,e))}(t,e)}else o||(e.reading=!1);return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(e)}l.inherits(g,a),g.prototype.push=function(t,e){var n=this._readableState;return n.objectMode||"string"!=typeof t||(e=e||n.defaultEncoding)!==n.encoding&&(t=c.from(t,e),e=""),v(this,n,t,e,!1)},g.prototype.unshift=function(t){return v(this,this._readableState,t,"",!0)},g.prototype.isPaused=function(){return!1===this._readableState.flowing},g.prototype.setEncoding=function(t){return p||(p=n(24).StringDecoder),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var m=8388608;function b(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=m?t=m:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function _(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(h("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i(w,t):w(t))}function w(t){h("emit readable"),t.emit("readable"),x(t)}function E(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(h("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function k(t){h("readable nexttick read 0"),t.read(0)}function S(t,e){e.reading||(h("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),x(t),e.flowing&&!e.reading&&t.read(0)}function x(t){var e=t._readableState;for(h("flow",e.flowing);e.flowing&&null!==t.read(););}function T(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,r=1,i=n.data;for(t-=i.length;n=n.next;){var o=n.data,a=t>o.length?o.length:t;if(a===o.length?i+=o:i+=o.slice(0,t),0==(t-=a)){a===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(a));break}++r}return e.length-=r,i}(t,e):function(t,e){var n=c.allocUnsafe(t),r=e.head,i=1;for(r.data.copy(n),t-=r.data.length;r=r.next;){var o=r.data,a=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,a),0==(t-=a)){a===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(a));break}++i}return e.length-=i,n}(t,e),r}(t,e.buffer,e.decoder),n);var n}function P(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i(R,e,t))}function R(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function L(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}g.prototype.read=function(t){h("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return h("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?P(this):_(this),null;if(0===(t=b(t,e))&&e.ended)return 0===e.length&&P(this),null;var r,i=e.needReadable;return h("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&h("length less than watermark",i=!0),e.ended||e.reading?h("reading or ended",i=!1):i&&(h("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=b(n,e))),null===(r=t>0?T(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&P(this)),null!==r&&this.emit("data",r),r},g.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},g.prototype.pipe=function(t,n){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=t;break;case 1:a.pipes=[a.pipes,t];break;default:a.pipes.push(t)}a.pipesCount+=1,h("pipe count=%d opts=%j",a.pipesCount,n);var u=n&&!1===n.end||t===e.stdout||t===e.stderr?d:l;function c(t){h("onunpipe"),t===r&&d()}function l(){h("onend"),t.end()}a.endEmitted?i(u):r.once("end",u),t.on("unpipe",c);var f=function(t){return function(){var e=t._readableState;h("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,x(t))}}(r);t.on("drain",f);var p=!1;function d(){h("cleanup"),t.removeListener("close",m),t.removeListener("finish",b),t.removeListener("drain",f),t.removeListener("error",v),t.removeListener("unpipe",c),r.removeListener("end",l),r.removeListener("end",d),r.removeListener("data",g),p=!0,!a.awaitDrain||t._writableState&&!t._writableState.needDrain||f()}var y=!1;function g(e){h("ondata"),y=!1,!1!==t.write(e)||y||((1===a.pipesCount&&a.pipes===t||a.pipesCount>1&&-1!==L(a.pipes,t))&&!p&&(h("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,y=!0),r.pause())}function v(e){h("onerror",e),_(),t.removeListener("error",v),0===s(t,"error")&&t.emit("error",e)}function m(){t.removeListener("finish",b),_()}function b(){h("onfinish"),t.removeListener("close",m),_()}function _(){h("unpipe"),r.unpipe(t)}return r.on("data",g),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",v),t.once("close",m),t.once("finish",b),t.emit("pipe",r),a.flowing||(h("pipe resume"),r.resume()),t},g.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=L(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},g.prototype.on=function(t,e){var n=a.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&_(this):i(k,this))}return n},g.prototype.addListener=g.prototype.on,g.prototype.resume=function(){var t=this._readableState;return t.flowing||(h("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i(S,t,e))}(this,t)),this},g.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},g.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",(function(){if(h("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)})),t.on("data",(function(i){h("wrapped data"),e.decoder&&(i=e.decoder.write(i)),e.objectMode&&null==i||(e.objectMode||i&&i.length)&&(r.push(i)||(n=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}(["error","close","destroy","pause","resume"],(function(e){t.on(e,r.emit.bind(r,e))})),r._read=function(e){h("wrapped _read",e),n&&(n=!1,t.resume())},r},g._fromList=T}).call(e,n(6))},function(t,e,n){(function(e){"use strict";!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,r)}));case 4:return e.nextTick((function(){t.call(null,n,r,i)}));default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick((function(){t.apply(null,o)}))}}:t.exports=e.nextTick}).call(e,n(6))},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){(function(t){"use strict";var r=n(2),i=r.Buffer,o=r.SlowBuffer,a=r.kMaxLength||2147483647;e.alloc=function(t,e,n){if("function"==typeof i.alloc)return i.alloc(t,e,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof t)throw new TypeError("size must be a number");if(t>a)throw new RangeError("size is too large");var r=n,o=e;void 0===o&&(r=void 0,o=0);var s=new i(t);if("string"==typeof o)for(var u=new i(o,r),c=u.length,l=-1;++l<t;)s[l]=u[l%c];else s.fill(o);return s},e.allocUnsafe=function(t){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(t);if("number"!=typeof t)throw new TypeError("size must be a number");if(t>a)throw new RangeError("size is too large");return new i(t)},e.from=function(e,n,r){if("function"==typeof i.from&&(!t.Uint8Array||Uint8Array.from!==i.from))return i.from(e,n,r);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,n);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=n;if(1===arguments.length)return new i(e);void 0===o&&(o=0);var a=r;if(void 0===a&&(a=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(a>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new i(e.slice(o,o+a))}if(i.isBuffer(e)){var s=new i(e.length);return e.copy(s,0,0,e.length),s}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},e.allocUnsafeSlow=function(t){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(t);if("number"!=typeof t)throw new TypeError("size must be a number");if(t>=a)throw new RangeError("size is too large");return new o(t)}}).call(e,function(){return this}())},function(t,e,n){(function(t){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(e,n(1))},function(t,e){},function(t,e,n){"use strict";n(2).Buffer;var r=n(17);function i(){this.head=null,this.tail=null,this.length=0}t.exports=i,i.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},i.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},i.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},i.prototype.clear=function(){this.head=this.tail=null,this.length=0},i.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},i.prototype.concat=function(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e=r.allocUnsafe(t>>>0),n=this.head,i=0;n;)n.data.copy(e,i),i+=n.data.length,n=n.next;return e}},function(t,e,n){"use strict";var r=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=f;var i=n(15),o=n(18);o.inherits=n(12);var a=n(14),s=n(22);o.inherits(f,a);for(var u=r(s.prototype),c=0;c<u.length;c++){var l=u[c];f.prototype[l]||(f.prototype[l]=s.prototype[l])}function f(t){if(!(this instanceof f))return new f(t);a.call(this,t),s.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||i(p,this)}function p(t){t.end()}},function(t,n,r){(function(n){"use strict";t.exports=g;var i,o=r(15),a=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?e:o;g.WritableState=y;var s=r(18);s.inherits=r(12);var u,c={deprecate:r(23)};!function(){try{u=r(11)}catch(t){}finally{u||(u=r(8).EventEmitter)}}();var l,f=r(2).Buffer,h=r(17);function p(){}function d(t,e,n){this.chunk=t,this.encoding=e,this.callback=n,this.next=null}function y(t,e){i=i||r(21),t=t||{},this.objectMode=!!t.objectMode,e instanceof i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:s,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,r,i){--e.pendingcb,n?o(i,r):i(r),t._writableState.errorEmitted=!0,t.emit("error",r)}(t,n,r,e,i);else{var s=_(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||b(t,n),r?a(m,t,n,s,i):m(t,n,s,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new k(this)}function g(t){if(i=i||r(21),!(l.call(g,this)||this instanceof i))return new g(t);this._writableState=new y(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),u.call(this)}function v(t,e,n,r,i,o,a){e.writelen=r,e.writecb=a,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function m(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),E(t,e)}function b(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),o=e.corkedRequestsFree;o.entry=n;for(var a=0;n;)i[a]=n,n=n.next,a+=1;v(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new k(e)}else{for(;n;){var s=n.chunk,u=n.encoding,c=n.callback;if(v(t,e,!1,e.objectMode?1:s.length,s,u,c),n=n.next,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=n,e.bufferProcessing=!1}function _(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function w(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function E(t,e){var n=_(e);return n&&(0===e.pendingcb?(w(t,e),e.finished=!0,t.emit("finish")):w(t,e)),n}function k(t){var e=this;this.next=null,this.entry=null,this.finish=function(n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}s.inherits(g,u),y.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(y.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(t){return!!l.call(this,t)||t&&t._writableState instanceof y}})):l=function(t){return t instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(t,e,n){var r=this._writableState,i=!1,a=f.isBuffer(t);return"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=p),r.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),o(e,n)}(this,n):(a||function(t,e,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),o(r,a),i=!1),i}(this,r,t,n))&&(r.pendingcb++,i=function(t,e,n,r,i,o){n||(r=function(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=h.from(e,n)),e}(e,r,i),f.isBuffer(r)&&(i="buffer"));var a=e.objectMode?1:r.length;e.length+=a;var s=e.length<e.highWaterMark;if(s||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest=new d(r,i,o),u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else v(t,e,!1,a,r,i,o);return s}(this,r,a,t,e,n)),i},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},g.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},g.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,n){e.ending=!0,E(t,e),n&&(e.finished?o(n):t.once("finish",n)),e.ended=!0,t.writable=!1}(this,r,n)}}).call(n,r(6))},function(t,e){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(t,e){if(n("noDeprecation"))return t;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation"),r=!0}return t.apply(this,arguments)}}}).call(e,function(){return this}())},function(t,e,n){var r=n(2).Buffer,i=r.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},o=e.StringDecoder=function(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),function(t){if(t&&!i(t))throw new Error("Unknown encoding: "+t)}(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=u;break;default:return void(this.write=a)}this.charBuffer=new r(6),this.charReceived=0,this.charLength=0};function a(t){return t.toString(this.encoding)}function s(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function u(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}o.prototype.write=function(t){for(var e="";this.charLength;){var n=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(t=t.slice(n,t.length),!((r=(e=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(e.length-1))>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var r,i=t.length;if(this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,i),i-=this.charReceived),i=(e+=t.toString(this.encoding,0,i)).length-1,(r=e.charCodeAt(i))>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),t.copy(this.charBuffer,0,0,o),e.substring(0,i)}return e},o.prototype.detectIncompleteChar=function(t){for(var e=t.length>=3?3:t.length;e>0;e--){var n=t[t.length-e];if(1==e&&n>>5==6){this.charLength=2;break}if(e<=2&&n>>4==14){this.charLength=3;break}if(e<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=e},o.prototype.end=function(t){var e="";if(t&&t.length&&(e=this.write(t)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;e+=r.slice(0,n).toString(i)}return e}},function(t,e,n){"use strict";t.exports=a;var r=n(21),i=n(18);function o(t){this.afterTransform=function(e,n){return function(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&t.push(n),i(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function a(t){if(!(this instanceof a))return new a(t);r.call(this,t),this._transformState=new o(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(t,n){s(e,t,n)})):s(e)}))}function s(t,e,n){if(e)return t.emit("error",e);null!=n&&t.push(n);var r=t._writableState,i=t._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=n(12),i.inherits(a,r),a.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},a.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},a.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},a.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0}},function(t,e,n){"use strict";t.exports=o;var r=n(25),i=n(18);function o(t){if(!(this instanceof o))return new o(t);r.call(this,t)}i.inherits=n(12),i.inherits(o,r),o.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){t.exports=n(22)},function(t,e,n){t.exports=n(21)},function(t,e,n){t.exports=n(25)},function(t,e,n){t.exports=n(26)},function(t,e,n){"use strict";var r=n(32),i=n(33),o=n(38),a=n(39),s=n(40),u=n(41),c=n(42),l=Object.prototype.toString;function f(t){if(!(this instanceof f))return new f(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function h(t,e){var n=new f(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}f.prototype.push=function(t,e){var n,s,u,c,f,h,p=this.strm,d=this.options.chunkSize,y=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?p.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?p.input=new Uint8Array(t):p.input=t,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new i.Buf8(d),p.next_out=0,p.avail_out=d),(n=r.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&y&&(h="string"==typeof y?o.string2buf(y):"[object ArrayBuffer]"===l.call(y)?new Uint8Array(y):y,n=r.inflateSetDictionary(this.strm,h)),n===a.Z_BUF_ERROR&&!0===g&&(n=a.Z_OK,g=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&n!==a.Z_STREAM_END&&(0!==p.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(p.output,p.next_out),c=p.next_out-u,f=o.buf2string(p.output,u),p.next_out=c,p.avail_out=d-c,c&&i.arraySet(p.output,p.output,u,c,0),this.onData(f)):this.onData(i.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(g=!0)}while((p.avail_in>0||0===p.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),p.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=f,e.inflate=h,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,h(t,e)},e.ungzip=h},function(t,e,n){"use strict";var r=n(33),i=n(34),o=n(35),a=n(36),s=n(37),u=-2,c=12,l=30;function f(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function h(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function p(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(852),e.distcode=e.distdyn=new r.Buf32(592),e.sane=1,e.back=-1,0):u}function d(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,p(t)):u}function y(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?u:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,d(t))):u}function g(t,e){var n,r;return t?(r=new h,t.state=r,r.window=null,0!==(n=y(t,e))&&(t.state=null),n):u}var v,m,b=!0;function _(t){if(b){var e;for(v=new r.Buf32(512),m=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(1,t.lens,0,288,v,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(2,t.lens,0,32,m,0,t.work,{bits:5}),b=!1}t.lencode=v,t.lenbits=9,t.distcode=m,t.distbits=5}function w(t,e,n,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,e,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}e.inflateReset=d,e.inflateReset2=y,e.inflateResetKeep=p,e.inflateInit=function(t){return g(t,15)},e.inflateInit2=g,e.inflate=function(t,e){var n,h,p,d,y,g,v,m,b,E,k,S,x,T,P,R,L,A,B,D,I,O,C,N,F=0,M=new r.Buf8(4),U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return u;(n=t.state).mode===c&&(n.mode=13),y=t.next_out,p=t.output,v=t.avail_out,d=t.next_in,h=t.input,g=t.avail_in,m=n.hold,b=n.bits,E=g,k=v,O=0;t:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;b<16;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(2&n.wrap&&35615===m){n.check=0,M[0]=255&m,M[1]=m>>>8&255,n.check=o(n.check,M,2,0),m=0,b=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",n.mode=l;break}if(8!=(15&m)){t.msg="unknown compression method",n.mode=l;break}if(b-=4,I=8+(15&(m>>>=4)),0===n.wbits)n.wbits=I;else if(I>n.wbits){t.msg="invalid window size",n.mode=l;break}n.dmax=1<<I,t.adler=n.check=1,n.mode=512&m?10:c,m=0,b=0;break;case 2:for(;b<16;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(n.flags=m,8!=(255&n.flags)){t.msg="unknown compression method",n.mode=l;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=l;break}n.head&&(n.head.text=m>>8&1),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=o(n.check,M,2,0)),m=0,b=0,n.mode=3;case 3:for(;b<32;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.head&&(n.head.time=m),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,M[2]=m>>>16&255,M[3]=m>>>24&255,n.check=o(n.check,M,4,0)),m=0,b=0,n.mode=4;case 4:for(;b<16;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.head&&(n.head.xflags=255&m,n.head.os=m>>8),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=o(n.check,M,2,0)),m=0,b=0,n.mode=5;case 5:if(1024&n.flags){for(;b<16;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.length=m,n.head&&(n.head.extra_len=m),512&n.flags&&(M[0]=255&m,M[1]=m>>>8&255,n.check=o(n.check,M,2,0)),m=0,b=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((S=n.length)>g&&(S=g),S&&(n.head&&(I=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,h,d,S,I)),512&n.flags&&(n.check=o(n.check,h,S,d)),g-=S,d+=S,n.length-=S),n.length))break t;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===g)break t;S=0;do{I=h[d+S++],n.head&&I&&n.length<65536&&(n.head.name+=String.fromCharCode(I))}while(I&&S<g);if(512&n.flags&&(n.check=o(n.check,h,S,d)),g-=S,d+=S,I)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===g)break t;S=0;do{I=h[d+S++],n.head&&I&&n.length<65536&&(n.head.comment+=String.fromCharCode(I))}while(I&&S<g);if(512&n.flags&&(n.check=o(n.check,h,S,d)),g-=S,d+=S,I)break t}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;b<16;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(m!==(65535&n.check)){t.msg="header crc mismatch",n.mode=l;break}m=0,b=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=c;break;case 10:for(;b<32;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}t.adler=n.check=f(m),m=0,b=0,n.mode=11;case 11:if(0===n.havedict)return t.next_out=y,t.avail_out=v,t.next_in=d,t.avail_in=g,n.hold=m,n.bits=b,2;t.adler=n.check=1,n.mode=c;case c:if(5===e||6===e)break t;case 13:if(n.last){m>>>=7&b,b-=7&b,n.mode=27;break}for(;b<3;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}switch(n.last=1&m,b-=1,3&(m>>>=1)){case 0:n.mode=14;break;case 1:if(_(n),n.mode=20,6===e){m>>>=2,b-=2;break t}break;case 2:n.mode=17;break;case 3:t.msg="invalid block type",n.mode=l}m>>>=2,b-=2;break;case 14:for(m>>>=7&b,b-=7&b;b<32;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",n.mode=l;break}if(n.length=65535&m,m=0,b=0,n.mode=15,6===e)break t;case 15:n.mode=16;case 16:if(S=n.length){if(S>g&&(S=g),S>v&&(S=v),0===S)break t;r.arraySet(p,h,d,S,y),g-=S,d+=S,v-=S,y+=S,n.length-=S;break}n.mode=c;break;case 17:for(;b<14;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(n.nlen=257+(31&m),m>>>=5,b-=5,n.ndist=1+(31&m),m>>>=5,b-=5,n.ncode=4+(15&m),m>>>=4,b-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=l;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;b<3;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.lens[U[n.have++]]=7&m,m>>>=3,b-=3}for(;n.have<19;)n.lens[U[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},O=s(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,O){t.msg="invalid code lengths set",n.mode=l;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;R=(F=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,L=65535&F,!((P=F>>>24)<=b);){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(L<16)m>>>=P,b-=P,n.lens[n.have++]=L;else{if(16===L){for(N=P+2;b<N;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(m>>>=P,b-=P,0===n.have){t.msg="invalid bit length repeat",n.mode=l;break}I=n.lens[n.have-1],S=3+(3&m),m>>>=2,b-=2}else if(17===L){for(N=P+3;b<N;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}b-=P,I=0,S=3+(7&(m>>>=P)),m>>>=3,b-=3}else{for(N=P+7;b<N;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}b-=P,I=0,S=11+(127&(m>>>=P)),m>>>=7,b-=7}if(n.have+S>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=l;break}for(;S--;)n.lens[n.have++]=I}}if(n.mode===l)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=l;break}if(n.lenbits=9,C={bits:n.lenbits},O=s(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,O){t.msg="invalid literal/lengths set",n.mode=l;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},O=s(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,O){t.msg="invalid distances set",n.mode=l;break}if(n.mode=20,6===e)break t;case 20:n.mode=21;case 21:if(g>=6&&v>=258){t.next_out=y,t.avail_out=v,t.next_in=d,t.avail_in=g,n.hold=m,n.bits=b,a(t,k),y=t.next_out,p=t.output,v=t.avail_out,d=t.next_in,h=t.input,g=t.avail_in,m=n.hold,b=n.bits,n.mode===c&&(n.back=-1);break}for(n.back=0;R=(F=n.lencode[m&(1<<n.lenbits)-1])>>>16&255,L=65535&F,!((P=F>>>24)<=b);){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(R&&0==(240&R)){for(A=P,B=R,D=L;R=(F=n.lencode[D+((m&(1<<A+B)-1)>>A)])>>>16&255,L=65535&F,!(A+(P=F>>>24)<=b);){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}m>>>=A,b-=A,n.back+=A}if(m>>>=P,b-=P,n.back+=P,n.length=L,0===R){n.mode=26;break}if(32&R){n.back=-1,n.mode=c;break}if(64&R){t.msg="invalid literal/length code",n.mode=l;break}n.extra=15&R,n.mode=22;case 22:if(n.extra){for(N=n.extra;b<N;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.length+=m&(1<<n.extra)-1,m>>>=n.extra,b-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;R=(F=n.distcode[m&(1<<n.distbits)-1])>>>16&255,L=65535&F,!((P=F>>>24)<=b);){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(0==(240&R)){for(A=P,B=R,D=L;R=(F=n.distcode[D+((m&(1<<A+B)-1)>>A)])>>>16&255,L=65535&F,!(A+(P=F>>>24)<=b);){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}m>>>=A,b-=A,n.back+=A}if(m>>>=P,b-=P,n.back+=P,64&R){t.msg="invalid distance code",n.mode=l;break}n.offset=L,n.extra=15&R,n.mode=24;case 24:if(n.extra){for(N=n.extra;b<N;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}n.offset+=m&(1<<n.extra)-1,m>>>=n.extra,b-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=l;break}n.mode=25;case 25:if(0===v)break t;if(S=k-v,n.offset>S){if((S=n.offset-S)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=l;break}S>n.wnext?(S-=n.wnext,x=n.wsize-S):x=n.wnext-S,S>n.length&&(S=n.length),T=n.window}else T=p,x=y-n.offset,S=n.length;S>v&&(S=v),v-=S,n.length-=S;do{p[y++]=T[x++]}while(--S);0===n.length&&(n.mode=21);break;case 26:if(0===v)break t;p[y++]=n.length,v--,n.mode=21;break;case 27:if(n.wrap){for(;b<32;){if(0===g)break t;g--,m|=h[d++]<<b,b+=8}if(k-=v,t.total_out+=k,n.total+=k,k&&(t.adler=n.check=n.flags?o(n.check,p,k,y-k):i(n.check,p,k,y-k)),k=v,(n.flags?m:f(m))!==n.check){t.msg="incorrect data check",n.mode=l;break}m=0,b=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;b<32;){if(0===g)break t;g--,m+=h[d++]<<b,b+=8}if(m!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=l;break}m=0,b=0}n.mode=29;case 29:O=1;break t;case l:O=-3;break t;case 31:return-4;case 32:default:return u}return t.next_out=y,t.avail_out=v,t.next_in=d,t.avail_in=g,n.hold=m,n.bits=b,(n.wsize||k!==t.avail_out&&n.mode<l&&(n.mode<27||4!==e))&&w(t,t.output,t.next_out,k-t.avail_out)?(n.mode=31,-4):(E-=t.avail_in,k-=t.avail_out,t.total_in+=E,t.total_out+=k,n.total+=k,n.wrap&&k&&(t.adler=n.check=n.flags?o(n.check,p,k,t.next_out-k):i(n.check,p,k,t.next_out-k)),t.data_type=n.bits+(n.last?64:0)+(n.mode===c?128:0)+(20===n.mode||15===n.mode?256:0),(0===E&&0===k||4===e)&&0===O&&(O=-5),O)},e.inflateEnd=function(t){if(!t||!t.state)return u;var e=t.state;return e.window&&(e.window=null),t.state=null,0},e.inflateGetHeader=function(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?u:(n.head=e,e.done=!1,0):u},e.inflateSetDictionary=function(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?u:11===n.mode&&i(1,e,r,0)!==n.check?-3:w(t,e,r,r)?(n.mode=31,-4):(n.havedict=1,0):u},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,i),i+=o.length;return a}},i={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,r)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(n)},function(t,e){"use strict";t.exports=function(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(t,e){"use strict";var n=function(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();t.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},function(t,e){"use strict";t.exports=function(t,e){var n,r,i,o,a,s,u,c,l,f,h,p,d,y,g,v,m,b,_,w,E,k,S,x,T;n=t.state,r=t.next_in,x=t.input,i=r+(t.avail_in-5),o=t.next_out,T=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=n.dmax,c=n.wsize,l=n.whave,f=n.wnext,h=n.window,p=n.hold,d=n.bits,y=n.lencode,g=n.distcode,v=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;t:do{d<15&&(p+=x[r++]<<d,d+=8,p+=x[r++]<<d,d+=8),b=y[p&v];e:for(;;){if(p>>>=_=b>>>24,d-=_,0==(_=b>>>16&255))T[o++]=65535&b;else{if(!(16&_)){if(0==(64&_)){b=y[(65535&b)+(p&(1<<_)-1)];continue e}if(32&_){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}w=65535&b,(_&=15)&&(d<_&&(p+=x[r++]<<d,d+=8),w+=p&(1<<_)-1,p>>>=_,d-=_),d<15&&(p+=x[r++]<<d,d+=8,p+=x[r++]<<d,d+=8),b=g[p&m];n:for(;;){if(p>>>=_=b>>>24,d-=_,!(16&(_=b>>>16&255))){if(0==(64&_)){b=g[(65535&b)+(p&(1<<_)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(E=65535&b,d<(_&=15)&&(p+=x[r++]<<d,(d+=8)<_&&(p+=x[r++]<<d,d+=8)),(E+=p&(1<<_)-1)>u){t.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=_,d-=_,E>(_=o-a)){if((_=E-_)>l&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(k=0,S=h,0===f){if(k+=c-_,_<w){w-=_;do{T[o++]=h[k++]}while(--_);k=o-E,S=T}}else if(f<_){if(k+=c+f-_,(_-=f)<w){w-=_;do{T[o++]=h[k++]}while(--_);if(k=0,f<w){w-=_=f;do{T[o++]=h[k++]}while(--_);k=o-E,S=T}}}else if(k+=f-_,_<w){w-=_;do{T[o++]=h[k++]}while(--_);k=o-E,S=T}for(;w>2;)T[o++]=S[k++],T[o++]=S[k++],T[o++]=S[k++],w-=3;w&&(T[o++]=S[k++],w>1&&(T[o++]=S[k++]))}else{k=o-E;do{T[o++]=T[k++],T[o++]=T[k++],T[o++]=T[k++],w-=3}while(w>2);w&&(T[o++]=T[k++],w>1&&(T[o++]=T[k++]))}break}}break}}while(r<i&&o<s);r-=w=d>>3,p&=(1<<(d-=w<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<s?s-o+257:257-(o-s),n.hold=p,n.bits=d}},function(t,e,n){"use strict";var r=n(33),i=15,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,n,c,l,f,h,p){var d,y,g,v,m,b,_,w,E,k=p.bits,S=0,x=0,T=0,P=0,R=0,L=0,A=0,B=0,D=0,I=0,O=null,C=0,N=new r.Buf16(16),F=new r.Buf16(16),M=null,U=0;for(S=0;S<=i;S++)N[S]=0;for(x=0;x<c;x++)N[e[n+x]]++;for(R=k,P=i;P>=1&&0===N[P];P--);if(R>P&&(R=P),0===P)return l[f++]=20971520,l[f++]=20971520,p.bits=1,0;for(T=1;T<P&&0===N[T];T++);for(R<T&&(R=T),B=1,S=1;S<=i;S++)if(B<<=1,(B-=N[S])<0)return-1;if(B>0&&(0===t||1!==P))return-1;for(F[1]=0,S=1;S<i;S++)F[S+1]=F[S]+N[S];for(x=0;x<c;x++)0!==e[n+x]&&(h[F[e[n+x]]++]=x);if(0===t?(O=M=h,b=19):1===t?(O=o,C-=257,M=a,U-=257,b=256):(O=s,M=u,b=-1),I=0,x=0,S=T,m=f,L=R,A=0,g=-1,v=(D=1<<R)-1,1===t&&D>852||2===t&&D>592)return 1;for(;;){_=S-A,h[x]<b?(w=0,E=h[x]):h[x]>b?(w=M[U+h[x]],E=O[C+h[x]]):(w=96,E=0),d=1<<S-A,T=y=1<<L;do{l[m+(I>>A)+(y-=d)]=_<<24|w<<16|E|0}while(0!==y);for(d=1<<S-1;I&d;)d>>=1;if(0!==d?(I&=d-1,I+=d):I=0,x++,0==--N[S]){if(S===P)break;S=e[n+h[x]]}if(S>R&&(I&v)!==g){for(0===A&&(A=R),m+=T,B=1<<(L=S-A);L+A<P&&!((B-=N[L+A])<=0);)L++,B<<=1;if(D+=1<<L,1===t&&D>852||2===t&&D>592)return 1;l[g=I&v]=R<<24|L<<16|m-f|0}}return 0!==I&&(l[m+I]=S-A<<24|64<<16|0),p.bits=R,0}},function(t,e,n){"use strict";var r=n(33),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function u(t,e){if(e<65537&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,e.string2buf=function(t){var e,n,i,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),u+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},e.buf2binstring=function(t){return u(t,t.length)},e.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},e.buf2string=function(t,e){var n,r,i,o,s=e||t.length,c=new Array(2*s);for(r=0,n=0;n<s;)if((i=t[n++])<128)c[r++]=i;else if((o=a[i])>4)c[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&t[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return u(c,r)},e.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+a[t[n]]>e?n:e}},function(t,e){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}}])},t.exports=n()}).call(this,n(92).setImmediate)},44:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},45:function(t,e){!function(){"use strict";function e(t,e){throw new Error("abstract")}e.prototype.drawFrame=function(t){throw new Error("abstract")},e.prototype.clear=function(){throw new Error("abstract")},t.exports=e}()},47:function(t,e){function n(){return t.exports=n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,n.apply(this,arguments)}t.exports=n,t.exports.default=t.exports,t.exports.__esModule=!0},48:function(t,e,n){(function(e){var n;n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=n}).call(this,n(44))},49:function(t,e){var n={validateDimension:function(t){if(t<=0||t!==(0|t))throw"YUV plane dimensions must be a positive integer"},validateOffset:function(t){if(t<0||t!==(0|t))throw"YUV plane offsets must be a non-negative integer"},format:function(t){var e=t.width,n=t.height,r=t.chromaWidth||e,i=t.chromaHeight||n,o=t.cropLeft||0,a=t.cropTop||0,s=t.cropWidth||e-o,u=t.cropHeight||n-a,c=t.displayWidth||s,l=t.displayHeight||u;return this.validateDimension(e),this.validateDimension(n),this.validateDimension(r),this.validateDimension(i),this.validateOffset(o),this.validateOffset(a),this.validateDimension(s),this.validateDimension(u),this.validateDimension(c),this.validateDimension(l),{width:e,height:n,chromaWidth:r,chromaHeight:i,cropLeft:o,cropTop:a,cropWidth:s,cropHeight:u,displayWidth:c,displayHeight:l}},allocPlane:function(t,e){return n.validateDimension(t),n.validateDimension(e),{bytes:new Uint8Array(t*e),stride:t}},suitableStride:function(t){n.validateDimension(t);var e=t%4;return 0==e?t:t+(4-e)},allocPlane:function(t,e,n,r,i){var o,a;if(this.validateDimension(t),this.validateDimension(e),i=i||0,r=r||this.suitableStride(t),this.validateDimension(r),r<t)throw"Invalid input stride for YUV plane; must be larger than width";if(o=r*e,n){if(n.length-i<o)throw"Invalid input buffer for YUV plane; must be large enough for stride times height";a=n.slice(i,i+o)}else a=new Uint8Array(o),r=r||this.suitableStride(t);return{bytes:a,stride:r}},lumaPlane:function(t,e,n,r){return this.allocPlane(t.width,t.height,e,n,r)},chromaPlane:function(t,e,n,r){return this.allocPlane(t.chromaWidth,t.chromaHeight,e,n,r)},frame:function(t,e,n,r){return{format:t,y:e=e||this.lumaPlane(t),u:n=n||this.chromaPlane(t),v:r=r||this.chromaPlane(t)}},copyPlane:function(t){return{bytes:t.bytes.slice(),stride:t.stride}},copyFrame:function(t){return{format:t.format,y:this.copyPlane(t.y),u:this.copyPlane(t.u),v:this.copyPlane(t.v)}},transferables:function(t){return[t.y.bytes.buffer,t.u.bytes.buffer,t.v.bytes.buffer]}};t.exports=n},5:function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t},t.exports.default=t.exports,t.exports.__esModule=!0},59:function(t,e){t.exports=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)},t.exports.default=t.exports,t.exports.__esModule=!0},6:function(t,e,n){var r=n(34);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0},60:function(t,e,n){(function(e){t.exports=e.BFSRequire("buffer").Buffer}).call(this,n(43))},63:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return o}));var r=n(48),i=n.n(r);function o(e){for(var n,r=(n=e,i.a.atob?i.a.atob(n):t.from(n,"base64").toString("binary")),o=new Uint8Array(r.length),a=0;a<r.length;a++)o[a]=r.charCodeAt(a);return o}}).call(this,n(60))},64:function(t,e){t.exports=function(t){throw new TypeError('"'+t+'" is read-only')},t.exports.default=t.exports,t.exports.__esModule=!0},65:function(t,e,n){!function(){"use strict";var e=n(45),r=n(97),i=n(100),o={FrameSink:e,SoftwareFrameSink:r,WebGLFrameSink:i,attach:function(t,e){return("webGL"in(e=e||{})?e.webGL:i.isAvailable())?new i(t,e):new r(t,e)}};t.exports=o}()},7:function(t,e,n){var r=n(14).default,i=n(1);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e},t.exports.default=t.exports,t.exports.__esModule=!0},76:function(t,e,n){"use strict";n.r(e);var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(1),u=n.n(s),c=n(6),l=n.n(c),f=n(7),h=n.n(f),p=n(4),d=n.n(p),y=n(0),g=n.n(y),v=n(20),m=n.n(v),b=n(24),_=n.n(b),w=n(29),E=n.n(w),k=n(27),S=n(14),x=n.n(S),T=n(13),P=T.a.get("Element.js"),R=function(){function t(){i()(this,t)}return a()(t,null,[{key:"createEl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1?arguments[1]:void 0;if("string"!=typeof t)return P.error("please input element name"),null;var n=document.createElement(t,e);return n}},{key:"registerElement",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:HTMLElement,n=arguments.length>2?arguments[2]:void 0,r=document.registerElement(t,{prototype:Object.create(e.prototype),extends:n});return r}},{key:"addEl",value:function(t,e){if(t&&e)try{e.appendChild(t)}catch(t){P.error(t)}}},{key:"removeEl",value:function(t){try{var e=t.parentNode;e&&e.removeChild(t)}catch(t){P.error(t)}}},{key:"addClass",value:function(t){try{for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=t.classList).add.apply(e,r)}catch(t){P.error(t)}}},{key:"removeClass",value:function(){}},{key:"hasClass",value:function(){}},{key:"isElement",value:function(t){try{return t instanceof HTMLElement}catch(e){return"object"===x()(t)&&1===t.nodeType&&"object"===x()(t.style)&&"object"===x()(t.ownerDocument)}}},{key:"setAttributes",value:function(e,n){if(t.isElement(e))for(var r=0,i=n.length;r<i;r++){var o=n[r],a=o.name;a=o.name.replace(/["|']/g,""),e.setAttribute(a,o.value)}}},{key:"syncAttributes",value:function(e,n){var r=n.attributes;t.setAttributes(e,r);var i=e.attributes;t.setAttributes(n,i)}},{key:"getClientWidth",value:function(){return document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth}},{key:"getClientHeight",value:function(){return document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight}},{key:"adaptSizeElement",value:function(t,e,n,r){var i=n,o=r;o.width=t||o.width||i.offsetWidth,o.height=e||o.height||i.offsetHeight;var a=o.width,s=o.height,u=0;o.style.position="absolute",i.offsetWidth<=0&&(i.style.width=a+"px"),i.offsetHeight<=0&&(i.style.height=s+"px");var c=i.offsetWidth/a,l=i.offsetHeight/s;u=l>c?c:l,o.style.top=i.offsetTop+(i.offsetHeight-s*u)/2+"px",o.style.left=i.offsetLeft+(i.offsetWidth-a*u)/2+"px",o.style.transform="scale(".concat(u,", ").concat(u,")"),o.style["transform-origin"]="top left",o.style.display="inline-block"}}]),t}(),L=n(28),A=n.n(L),B=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t),g()(this,"logger",null),g()(this,"__instance__",null),g()(this,"__singleton__",null),this.options=e,this.setLogger(this.constructor.name+".js")}return a()(t,[{key:"setLogger",value:function(t){this.logger=new T.a(t)}},{key:"getLogger",value:function(){return this.logger}},{key:"setOptions",value:function(t){Object.assign(this.options,t)}},{key:"events",get:function(){return this.options&&this.options.events?this.options.events(this):Object(k.a)(this)}},{key:"toString",value:function(){return JSON.stringify(this)}}],[{key:"getInstance",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.__instance__=A()(this,e),this.__instance__}},{key:"getSingleton",value:function(){if(!this.__singleton__){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.__singleton__=A()(this,e)}return this.__singleton__}}]),t}();function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var I=function(t){l()(n,t);var e=D(n);function n(t){var r;return i()(this,n),r=e.call(this),g()(u()(r),"component",null),r.component=t.component,r}return a()(n,[{key:"confirm",value:function(){}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.component.data.content=t,"default"!==this.component.data.display&&""!==this.component.data.display||this.component.showBox(),"show"!==this.component.data.display&&this.component.show()}},{key:"hide",value:function(){this.component.hide()}}]),n}(B),O=n(23),C=n(9),N=n(11);function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var M=function(t){l()(n,t);var e=F(n);function n(){var t;return i()(this,n),t=e.call(this),g()(u()(t),"loadData",null),g()(u()(t),"sourceURL",""),t}return a()(n,[{key:"init",value:function(){}},{key:"setLoadData",value:function(t){this.loadData=t}},{key:"setSourceURL",value:function(t){this.sourceURL=t}},{key:"getLoadData",value:function(){return this.getLoadData}},{key:"getSourceURL",value:function(){return this.getSourceURL}}]),n}(C.a),U={LOAD_PLAYLIST:10,get 10(){return"loading playlist"},LOADED_PLAYLIST:11,get 11(){return"playlist is loaded"},IDLE:0,get 0(){return"is free"},LOADING:1,get 1(){return"loading segment"},DONE:2,get 2(){return"segment is loaded"},ERROR:3,get 3(){return"load get error"}},j=T.a.get("M3U8Parser.js",{level:2}),H={lineDelimiter:/\r?\n/,extensionHeader:"#EXTM3U",tagPrefix:"#EXT",segmentPrefix:"#EXTINF",segmentParse:/^#EXTINF: *([0-9.]+)(, *(.+?)?)?$/,tagParse:/^#EXT-X-([A-Z-]+)(:(.+))?$/,version:"VERSION",allowCache:"ALLOW-CACHE",combined:"COMBINED",endList:"ENDLIST",targetDuration:"TARGETDURATION",mediaSequence:"MEDIA-SEQUENCE",discontinuity:"DISCONTINUITY",streamInf:"STREAM-INF",isComment:function(t){return t&&"#"===t[0]&&!t.startsWith(H.tagPrefix)},isBlank:function(t){return""===t},canStrip:function(t){return H.isBlank(t)||H.isComment(t)}},z=0,W=1,V={file:void 0,name:void 0,start:0,end:0,discontinuity:void 0,duration:void 0},$=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),g()(this,"source",""),g()(this,"segments",[]),g()(this,"_currentSegment",null),g()(this,"discontinuous",null),g()(this,"tags",{VERSION:void 0,TARGETDURATION:void 0}),g()(this,"_state",null),this.source=e,this.options=n,this.parse(this.source)}return a()(t,[{key:"readSegment",value:function(t){var e=H.segmentParse.exec(t);if(null!==e){var n=parseFloat(e[1],10),r=e[3];n%1!=0&&this.tags.VERSION>=3&&j.info("readsegment","Version must be 3 or higher to support floating.","duration:",n),n<this.tags.TARGETDURATION&&j.info("readsegment","Segment duration must be less than the TARGETDURATION","duration:",n),n*=1e3,this._currentSegment=Object.assign({},V,{duration:n,name:r,discontinuity:this.discontinuous});var i=this.segments[this.segments.length-1]||{start:0,end:0};this._currentSegment.start=i.end,this._currentSegment.end=i.end+n,this.discontinuous=!1,this._state=W}else j.warn("readsegment","read segment failed","line:",t)}},{key:"readTag",value:function(t){var e=H.tagParse.exec(t);if(null!==e)return{name:e[1],value:e[3]}}},{key:"readLine",value:function(t){if(t.startsWith(H.segmentPrefix))return this.readSegment(t);var e=this.readTag(t);if(e)switch(e.name){case H.version:this.tags.VERSION=parseFloat(e.value,10);break;case H.mediaSequence:this.tags.MEDIA_SEQUENCE=parseFloat(e.value,10);break;case H.allowCache:this.tags.ALLOW_CACHE=!!/\s*(YES|yes)\s*/.test(e.value);break;case H.discontinuity:this.tags.DISCONTINUITY=!0,this.discontinuous=!0;break;case H.targetDuration:this.tags.TARGETDURATION=parseFloat(e.value,10);break;case H.combined:this.tags.COMBINED=e.value;break;case H.streamInf:this.tags.STREAM_INF=e.value;break;case H.endList:this.tags.ENDLIST="EOF";break;default:j.warn("readLine","unknow line","line:",t)}}},{key:"addFile",value:function(t){if("#"!==t[0]){this._currentSegment.file=t;var e=this.parseSDParam(t);if(e>=0){this._currentSegment.start=e,this._currentSegment.end=e+this._currentSegment.duration;var n=this.segments[this.segments.length-1]||{sd:0,start:0,end:0};n.duration=e-n.start,n.end=e}this._currentSegment.name||(this._currentSegment.name=t.substr(Math.max(0,t.lastIndexOf("/")),t.lastIndexOf("."))),this.segments.push(this._currentSegment),this._state=z}else{var r=this.readTag(t);switch(r.name){case"PROGRAM-DATE-TIME":var i=new Date(r.value);this._currentSegment.time=i;break;default:j.warn("addFile","Invalid tag.","tag.name:",r.name)}}}},{key:"parseSDParam",value:function(t){var e=-1;try{var n=new URL(t).searchParams.get("sd");n&&(e=parseInt(n,10))}catch(t){}return e}},{key:"parse",value:function(t){var e=this;if("string"==typeof(t=t||this.source)){this._state=z,this.discontinuous=!1;var n=t.split(H.lineDelimiter);if(n[0]==H.extensionHeader)return n.forEach((function(t){if(!H.canStrip(t))switch(e._state){case z:e.readLine(t);break;case W:e.addFile(t);break;default:Object(O.a)("parsing m3u8 get an error, it is unknow state.")}})),this;j.error("parse","it is not a valid  m3u8 header","header:",n[0])}else Object(O.a)("m3u8 file is not text.",t)}},{key:"version",get:function(){return this.tags.VERSION}},{key:"duration",get:function(){return this.segments.length?this.segments.reduce((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,n="number"==typeof t?t:t.duration;return n+e.duration})):0}},{key:"targetDuration",get:function(){return this.tags.TARGETDURATION}},{key:"mediaSequence",get:function(){return this.tags.MEDIA_SEQUENCE}},{key:"allowCache",get:function(){return this.tags.ALLOW_CACHE}},{key:"length",get:function(){return this.segments.length}}]),t}(),X=n(36),Y=n.n(X);function q(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Object";return function(e){var n="[object "+t+"]";return Object.prototype.toString.call(e)==n}}var G=function(){function t(){i()(this,t)}return a()(t,null,[{key:"importScripts",value:function(t,e,n){var r="ready"+Date.now();t instanceof Array?Y()(t,r):Y()([t],r),Y.a.ready(r,{success:e,error:n})}},{key:"blobData",value:function(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}},{key:"escapeHTML",value:function(e){if(t.isString(e))return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"getInnerWidthHeight",value:function(){return{width:window.innerWidth,height:window.innerHeight}}},{key:"Fullscreen",value:function(t){(t=t||document.documentElement).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&(t.webkitRequestFullScreen(),setTimeout((function(){document.dispatchEvent(new Event("fullscreenchange"))}),0))}},{key:"exitFullscreen",value:function(){var t=document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&(t.webkitExitFullscreen(),setTimeout((function(){document.dispatchEvent(new Event("fullscreenchange"))}),0))}},{key:"buildFilePath",value:function(t,e){return t.map((function(t){return e+t}))}},{key:"insertSort",value:function(t,e,n){var r,i,o=t.length;if(0!==o)if(n){var a=n(e);r=a.key,i=a.value;for(var s=0;s<o;s++)if(i<t[s][r]){for(var u=o;u>s;)t[u]=t[u-1],u--;return void(t[s]=e)}t.push(e)}else{i=e;for(var c=0;c<o;c++)if(i<t[c]){for(var l=o;l>c;)t[l]=t[l-1],l--;return void(t[c]=i)}t.push(i)}else t.push(e)}},{key:"isSafari",value:function(){var t=navigator.userAgent;return/Safari/.test(t)&&!/Chrome/.test(t)}},{key:"msec2sec",value:function(t){var e=(t/1e3).toFixed(3);return parseFloat(e,10)}}]),t}();g()(G,"isObject",(function(){return q("Object")})),g()(G,"isString",(function(){return q("String")})),g()(G,"isFunction",(function(){return q("Function")}));var Z=n(32),K=n.n(Z);function J(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Q=function(t){l()(n,t);var e=J(n);function n(){return i()(this,n),e.call(this)}return a()(n,[{key:"size",get:function(){return this.length}},{key:"add",value:function(t){this.push(Object.freeze(t))}},{key:"addAll",value:function(t){var e=this;t.forEach((function(t){e.add(t)}))}},{key:"get",value:function(t){return this[t]}},{key:"getLast",value:function(){return this[this.length-1]}},{key:"getBy",value:function(t){var e=this;if("function"==typeof t){var n=new this.constructor;return this.every((function(r,i){return!0===t.call(e,r,i,e)&&n.add(r),!0})),n}}},{key:"indexOfByTime",value:function(t,e){e||(e=function(e){return t>=e.start&&t<e.end});for(var n=this.length-1,r=0;r<=n;){var i=Math.floor((n+r)/2),o=this[i];if(e(o))return i;o.start>t?n=i-1:r=i+1}return-1}},{key:"getByTime",value:function(t){var e=this.indexOfByTime(t);if(e>=0)return this[e]}},{key:"getByKey",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Array.isArray(e[0])&&(e=e[0]),this.getBy((function(t){var n=!1;return e.every((function(e){return!Object.prototype.hasOwnProperty.call(t,e)||(n=!0,!1)})),n}))}},{key:"getByValue",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Array.isArray(e[0])&&(e=e[0]),this.getBy((function(t){var n=!1;return t.each((function(t,r){if(e.includes(r))return n=!0,!1})),n}))}},{key:"getByKeyValue",value:function(t,e){return this.getBy((function(n){return n[t]===e}))}},{key:"getValues",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Array.isArray(e[0])&&(e=e[0]),this.map((function(t){return e.length?t.get(t,e):t.getValues(t)}))}},{key:"indexOfBy",value:function(t){var e=0,n=this.length;for(t=t||function(){return!1};e<n;){if(!0===t.call(this,this[e],e,this))return e;e++}return-1}},{key:"indexOfByKey",value:function(t,e){return this.indexOfBy((function(n){return n[t]===e}))}},{key:"indexOfByKeyValue",value:function(t,e){return this.indexOfByKey(t,e)}},{key:"each",value:function(t){if("function"==typeof t)return this.forEach(t),this}},{key:"remove",value:function(t,e){return this.length<=0||(t=t<0?0:t,e=e||t+1,this.splice(t,e-t)),this}},{key:"removeItem",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Array.isArray(e[0])&&(e=e[0]),this.removeBy((function(t){return e.includes(t)}))}},{key:"removeBy",value:function(t){for(var e=0,n=this.length;e<n;e++)!0===t.call(this,this[e],e,this)&&(this.splice(e,1),n--,e--);return this}},{key:"removeByKeyValue",value:function(t,e){return this.removeBy((function(n){return n[t]===e}))}},{key:"toJSON",value:function(){var t=Array.from(this);return t.forEach((function(e,n){t[n]=e&&"function"==typeof e.toJSON?e.toJSON():e})),t}},{key:"toArray",value:function(){return Array.from(this)}}]),n}(K()(Array)),tt=function(){function t(){i()(this,t)}return a()(t,[{key:"pair",value:function(){return Object.entries(this)}},{key:"keys",value:function(){return Object.keys(this)}},{key:"set",value:function(t,e){return this[t]=e,this}},{key:"get",value:function(t){return this[t]}},{key:"add",value:function(t,e){return Object.prototype.hasOwnProperty.call(this,t)||this.set(t,e),this}},{key:"addAll",value:function(t){for(var e in t)this.add(e,t[e]);return this}},{key:"toJSON",value:function(){var t={};for(var e in this)Object.prototype.hasOwnProperty.call(this,e)&&(t[e]=this[e]);return t}}]),t}();function et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var nt=function(t){l()(n,t);var e=et(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"no",0),g()(u()(r),"name",null),g()(u()(r),"duration",0),g()(u()(r),"file",null),g()(u()(r),"start",0),g()(u()(r),"end",0),Object.assign(u()(r),t),r}return n}(tt);function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var it=function(t){l()(n,t);var e=rt(n);function n(t){return i()(this,n),e.call(this,t)}return a()(n,[{key:"add",value:function(t){t instanceof nt||(t=new nt(t)),t.no=this.length+1,G.isObject(t)&&this.push(t)}}]),n}(Q),ot=n(2),at=n(37),st=n.n(at),ut=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var n=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(n,1),n>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var n=e.length,r=0;r<n;++r)e[r].call(this,arguments[1]);else for(var i=Array.prototype.slice.call(arguments,1),o=e.length,a=0;a<o;++a)e[a].apply(this,i)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}(),ct=n(47),lt=n.n(ct),ft=n(63),ht=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return st()(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(ut),pt=String.fromCharCode(9),dt=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),n={};return e[1]&&(n.length=parseInt(e[1],10)),e[2]&&(n.offset=parseInt(e[2],10)),n},yt=function(t){for(var e,n=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),r={},i=n.length;i--;)""!==n[i]&&((e=/([^=]*)=(.*)/.exec(n[i]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),r[e[0]]=e[1]);return r},gt=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}st()(e,t);var n=e.prototype;return n.push=function(t){var e,n,r=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,n){var r=n(t);return r===t?e:e.concat([r])}),[t]).forEach((function(t){for(var i=0;i<r.customParsers.length;i++)if(r.customParsers[i].call(r,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))r.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return n={type:"tag",tagType:"inf"},e[1]&&(n.duration=parseFloat(e[1])),e[2]&&(n.title=e[2]),void r.trigger("data",n);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"targetduration"},e[1]&&(n.duration=parseInt(e[1],10)),void r.trigger("data",n);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return n={type:"tag",tagType:"version"},e[1]&&(n.version=parseInt(e[1],10)),void r.trigger("data",n);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return n={type:"tag",tagType:"media-sequence"},e[1]&&(n.number=parseInt(e[1],10)),void r.trigger("data",n);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return n={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(n.number=parseInt(e[1],10)),void r.trigger("data",n);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return n={type:"tag",tagType:"playlist-type"},e[1]&&(n.playlistType=e[1]),void r.trigger("data",n);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return n=lt()(dt(e[1]),{type:"tag",tagType:"byterange"}),void r.trigger("data",n);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return n={type:"tag",tagType:"allow-cache"},e[1]&&(n.allowed=!/NO/.test(e[1])),void r.trigger("data",n);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(n={type:"tag",tagType:"map"},e[1]){var o=yt(e[1]);o.URI&&(n.uri=o.URI),o.BYTERANGE&&(n.byterange=dt(o.BYTERANGE))}r.trigger("data",n)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(n={type:"tag",tagType:"stream-inf"},e[1]){if(n.attributes=yt(e[1]),n.attributes.RESOLUTION){var a=n.attributes.RESOLUTION.split("x"),s={};a[0]&&(s.width=parseInt(a[0],10)),a[1]&&(s.height=parseInt(a[1],10)),n.attributes.RESOLUTION=s}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}r.trigger("data",n)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return n={type:"tag",tagType:"media"},e[1]&&(n.attributes=yt(e[1])),void r.trigger("data",n);if(e=/^#EXT-X-ENDLIST/.exec(t))r.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))r.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return n={type:"tag",tagType:"program-date-time"},e[1]&&(n.dateTimeString=e[1],n.dateTimeObject=new Date(e[1])),void r.trigger("data",n);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return n={type:"tag",tagType:"key"},e[1]&&(n.attributes=yt(e[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void r.trigger("data",n);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return n={type:"tag",tagType:"start"},e[1]&&(n.attributes=yt(e[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void r.trigger("data",n);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-out-cont"},e[1]?n.data=e[1]:n.data="",void r.trigger("data",n);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-out"},e[1]?n.data=e[1]:n.data="",void r.trigger("data",n);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return n={type:"tag",tagType:"cue-in"},e[1]?n.data=e[1]:n.data="",void r.trigger("data",n);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"skip"}).attributes=yt(e[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(pt)),void r.trigger("data",n);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"part"}).attributes=yt(e[1]),["DURATION"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=parseFloat(n.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=/YES/.test(n.attributes[t]))})),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=dt(n.attributes.BYTERANGE)),void r.trigger("data",n);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"server-control"}).attributes=yt(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=parseFloat(n.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=/YES/.test(n.attributes[t]))})),void r.trigger("data",n);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"part-inf"}).attributes=yt(e[1]),["PART-TARGET"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=parseFloat(n.attributes[t]))})),void r.trigger("data",n);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"preload-hint"}).attributes=yt(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(n.attributes.hasOwnProperty(t)){n.attributes[t]=parseInt(n.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[e]=n.attributes[t],delete n.attributes[t]}})),void r.trigger("data",n);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(n={type:"tag",tagType:"rendition-report"}).attributes=yt(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){n.attributes.hasOwnProperty(t)&&(n.attributes[t]=parseInt(n.attributes[t],10))})),void r.trigger("data",n);r.trigger("data",{type:"tag",data:t.slice(4)})}}}else r.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},n.addParser=function(t){var e=this,n=t.expression,r=t.customType,i=t.dataParser,o=t.segment;"function"!=typeof i&&(i=function(t){return t}),this.customParsers.push((function(t){if(n.exec(t))return e.trigger("data",{type:"custom",data:i(t),customType:r,segment:o}),!0}))},n.addTagMapper=function(t){var e=t.expression,n=t.map;this.tagMappers.push((function(t){return e.test(t)?n(t):t}))},e}(ut),vt=function(t){var e={};return Object.keys(t).forEach((function(n){var r;e[(r=n,r.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[n]})),e},mt=function(t){var e=t.serverControl,n=t.targetDuration,r=t.partTargetDuration;if(e){var i="#EXT-X-SERVER-CONTROL",o="holdBack",a="partHoldBack",s=n&&3*n,u=r&&2*r;n&&!e.hasOwnProperty(o)&&(e[o]=s,this.trigger("info",{message:i+" defaulting HOLD-BACK to targetDuration * 3 ("+s+")."})),s&&e[o]<s&&(this.trigger("warn",{message:i+" clamping HOLD-BACK ("+e[o]+") to targetDuration * 3 ("+s+")"}),e[o]=s),r&&!e.hasOwnProperty(a)&&(e[a]=3*r,this.trigger("info",{message:i+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[a]+")."})),r&&e[a]<u&&(this.trigger("warn",{message:i+" clamping PART-HOLD-BACK ("+e[a]+") to partTargetDuration * 2 ("+u+")."}),e[a]=u)}},bt=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new ht,e.parseStream=new gt,e.lineStream.pipe(e.parseStream);var n,r,i=u()(e),o=[],a={},s=!1,c=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},f=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var h=0,p=0;return e.on("end",(function(){a.uri||!a.parts&&!a.preloadHints||(!a.map&&n&&(a.map=n),!a.key&&r&&(a.key=r),a.timeline||"number"!=typeof f||(a.timeline=f),e.manifest.preloadSegment=a)})),e.parseStream.on("data",(function(t){var e,u;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(a.byterange=e,e.length=t.length,"offset"in t||(t.offset=h)),"offset"in t&&(a.byterange=e,e.offset=t.offset),h=e.offset+e.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(a.duration=t.duration),0===t.duration&&(a.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=o},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:Object(ft.a)(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),r={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(r.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else r=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,f=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){n={},t.uri&&(n.uri=t.uri),t.byterange&&(n.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=o,this.manifest.mediaGroups=this.manifest.mediaGroups||l,t.attributes?(a.attributes||(a.attributes={}),lt()(a.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var n=this.manifest.mediaGroups[t.attributes.TYPE];n[t.attributes["GROUP-ID"]]=n[t.attributes["GROUP-ID"]]||{},e=n[t.attributes["GROUP-ID"]],(u={default:/yes/i.test(t.attributes.DEFAULT)}).default?u.autoselect=!0:u.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(u.language=t.attributes.LANGUAGE),t.attributes.URI&&(u.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(u.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(u.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(u.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=u}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){f+=1,a.discontinuity=!0,this.manifest.discontinuityStarts.push(o.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),a.dateTimeString=t.dateTimeString,a.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,mt.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){a.cueOut=t.data},"cue-out-cont":function(){a.cueOutCont=t.data},"cue-in":function(){a.cueIn=t.data},skip:function(){this.manifest.skip=vt(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;s=!0;var n=this.manifest.segments.length,r=vt(t.attributes);a.parts=a.parts||[],a.parts.push(r),r.byterange&&(r.byterange.hasOwnProperty("offset")||(r.byterange.offset=p),p=r.byterange.offset+r.byterange.length);var i=a.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+i+" for segment #"+n,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,n){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+n+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=vt(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),mt.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,n=vt(t.attributes),r=n.type&&"PART"===n.type;a.preloadHints=a.preloadHints||[],a.preloadHints.push(n),n.byterange&&(n.byterange.hasOwnProperty("offset")||(n.byterange.offset=r?p:0,r&&(p=n.byterange.offset+n.byterange.length)));var i=a.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+i+" for segment #"+e,t.attributes,["TYPE","URI"]),n.type)for(var o=0;o<a.preloadHints.length-1;o++){var s=a.preloadHints[o];s.type&&(s.type===n.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+i+" for segment #"+e+" has the same TYPE "+n.type+" as preload hint #"+o}))}},"rendition-report":function(){var e=vt(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var n=this.manifest.renditionReports.length-1,r=["LAST-MSN","URI"];s&&r.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+n,t.attributes,r)},"part-inf":function(){this.manifest.partInf=vt(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),mt.call(this,this.manifest)}}[t.tagType]||c).call(i)},uri:function(){a.uri=t.uri,o.push(a),this.manifest.targetDuration&&!("duration"in a)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),a.duration=this.manifest.targetDuration),r&&(a.key=r),a.timeline=f,n&&(a.map=n),p=0,a={}},comment:function(){},custom:function(){t.segment?(a.custom=a.custom||{},a.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(i)})),e}st()(e,t);var n=e.prototype;return n.warnOnMissingAttributes_=function(t,e,n){var r=[];n.forEach((function(t){e.hasOwnProperty(t)||r.push(t)})),r.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+r.join(", ")})},n.push=function(t){this.lineStream.push(t)},n.end=function(){this.lineStream.push("\n"),this.trigger("end")},n.addParser=function(t){this.parseStream.addParser(t)},n.addTagMapper=function(t){this.parseStream.addTagMapper(t)},e}(ut);function _t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var wt=null;function Et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}function kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(n),!0).forEach((function(e){g()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Tt={HLS:function(t){l()(n,t);var e=_t(n);function n(t){var r;return i()(this,n),r=e.call(this),g()(u()(r),"state",U.IDLE),g()(u()(r),"maxBufferDuration",N.b.maxDuration),g()(u()(r),"maxBufferSize",N.b.maxSize),g()(u()(r),"baseUrl",""),g()(u()(r),"options",null),g()(u()(r),"httpWorker",null),g()(u()(r),"sourceData",null),g()(u()(r),"segmentPool",[]),g()(u()(r),"currentNo",null),g()(u()(r),"maxRetryCount",N.b.maxRetryCount),r.options=t,r.player=t.player,r.loaderController=r.options.loaderController,r.dataController=r.loaderController.dataController,r.httpWorker=t.httpWorker,r.setSegmentPool(new it),r.liveRetry=0,clearInterval(wt),wt=null,r}return a()(n,[{key:"loadPlaylist",value:function(t){var e=this;if(this.isNotFree())return this.logger.info("loadPlaylist","not free."),void(this.player.options.isLive||setTimeout((function(){e.loadPlaylist(t)}),200));this.player.options.beforeLoad?this.player.options.beforeLoad(this.sourceURL,this.options.sourceURL).then((function(t){e.options.sourceURL=t,e.state=U.LOADING,e.httpWorker.postMessage({type:"invoke",fileType:"m3u8",method:"get",name:"playlist",url:t})})):(this.state=U.LOADING,this.httpWorker.postMessage({type:"invoke",fileType:"m3u8",method:"get",name:"playlist",url:this.sourceURL})),this.httpWorker.onmessage=function(n){e.state=U.IDLE;var r=n.data,i=n.data.data;if(i)"playlist"==r.name&&e.parsePlaylist(i,t);else if(e.player.options.isLive){e.events.emit(ot.default.PlayerAlert,"暂无直播")}else{var o="Get the ".concat(r.fileType," file error. URL: ").concat(r.url);e.events.emit(ot.default.PlayerAlert,o),e.events.emit(ot.default.LoaderError,o,r);var a=[e.state,"request playlist error.","data:",r,o];e.events.emit(ot.default.PlayerThrowError,a)}}}},{key:"parsePlaylist",value:function(t,e){var n,r=this,i=new bt;i.push(t),i.end();var o=i.manifest,a=null===(n=o.playlists)||void 0===n?void 0:n.length;if(a){var s=o.playlists[a-1];return this.sourceURL=s.uri,void this.loadPlaylist(e)}var u=new $(t);if(u.segments&&u.segments.length){var c=u.segments;if(c.forEach((function(t){t.start=G.msec2sec(t.start),t.end=G.msec2sec(t.end),t.duration=G.msec2sec(t.duration)})),this.player.options.isLive){if(this.segmentPool.length){var l=this.segmentPool.map((function(t){return t.name}));if(u.segments=u.segments.filter((function(t){return-1===l.indexOf(t.name)})),u.segments.length){var f=this.segmentPool.getLast(),h=f.no,p=f.end;u.segments.forEach((function(t,e){t.no=e+h+1,t.start=0===e?p:u.segments[e-1].end,t.end=t.start+t.duration})),this.liveRetry=0}else this.liveRetry++}wt||(wt=setInterval((function(){r.liveRetry<15?r.isNotFree()||r.player.seeking||r.player.reseting||r.player.loaderController.loadPlaylist():(clearInterval(wt),wt=null,r.liveRetry=0)}),1e3))}else if(o.discontinuityStarts.length){var d=o.discontinuityStarts.filter((function(t,e,n){return!n[e-1]||n[e-1]!=t-1})),y=d.map((function(t,e){var n=d[e-1];return 0===e&&(n=0),c.slice(n,t).reduce((function(t,e){return t+e.duration}),0)}));y.unshift(0);for(var g=0;g<y.length;g++)y[g]+=y[g-1]||0;for(var v=0,m=0;m<c.length;m++){var b=c[m],_=d[v];null==_?b.pred=y[y.length-1]:m<_?b.pred=y[v]:m===_&&(v+=1,b.pred=y[v])}}if(this.setSourceData(Object.freeze(u)),this.segmentPool.addAll(u.segments),u.segments.length&&(e.call(this,u),this.player.options.isLive)){var w=this.player.imagePlayer,E=w.imageData;if("play"!==w.status&&"ready"!==w.status&&null!=E.offset){var k=this.segmentPool.getLast();this.logger.info("imagePlayer end replay",this.player.currentTime),this.player.seek(1e3*k.start),setTimeout((function(){r.player.paused&&r.player.play()}),1e3)}}}else{this.events.emit(ot.default.LoaderError,u),this.events.emit(ot.default.PlayerAlert,"Parse playlist file error.");var S=[this.state,"Parse playlist error.","data:",u];this.events.emit(ot.default.PlayerThrowError,S)}}},{key:"setSourceData",value:function(t){this.sourceData=t}},{key:"getSourceData",value:function(){return this.sourceData}},{key:"setSegmentPool",value:function(t){this.segmentPool=t}},{key:"getSegmentPool",value:function(){return this.segmentPool}},{key:"isNotFree",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t="["+t+"]loader is not free. please wait.",this.state!==U.IDLE&&this.state!==U.DONE&&(this.logger.warn("isNotFree","check status for loader","notice:",t),!0)}},{key:"getBaseUrl",value:function(t){var e=this.options.sourceURL;if(!(t.indexOf("//")>-1)){var n=e.lastIndexOf("/");return e.substr(0,n+1)}return""}},{key:"checkLoadCondition",value:function(t){if(this.player.options.keepCache)return!0;if(t.no>this.segmentPool.length)return!1;var e=this.dataController.getLoadDataBufferPool().bufferDuration;return!(e>this.maxBufferDuration*this.player.playbackRate)||(this.logger.info("checkLoadCondition","stop load next segment.","bufferDuration:",e,"maxBufferDuration:",this.maxBufferDuration),!1)}},{key:"loadFile",value:function(t,e,n){var r=this;if(t instanceof nt){if(this.isNotFree()&&"seek"!==e&&"start"!==e)return this.logger.warn("loadFile","is loading","segment:",t,"type:",e),void setTimeout((function(){r.loadFile(t,e,n)}),200);if(this.checkLoadCondition(t)){this.currentNo=t.no;var i=this.getBaseUrl(t.file)+t.file,o=1,a=function(t){if(r.player.options.beforeLoad)r.player.options.beforeLoad(t.file,r.options.sourceURL).then((function(e){r.httpWorker.postMessage({type:"invoke",fileType:"ts",method:"get",name:t.no,url:e})}));else{var e=function(t,e){return"function"==typeof r.options.processURL?r.options.processURL(t,e):t}(i,t);r.httpWorker.postMessage({type:"invoke",fileType:"ts",method:"get",name:t.no,url:e})}};this.state=U.LOADING,this.events.emit(ot.default.LoaderLoading,t,e,n),this.httpWorker.onmessage=function(i){var s=i.data;if("invoke"===s.type&&(r.state=U.DONE,r.logger.info("loadfile","httpWorker","onmessage get data",s.name)),s&&"error"!==s.type)"notice"===s.type?"speed"===s.noticeType&&r.events.emit(ot.default.LoaderUpdateSpeed,s.data):"ts"===s.fileType&&s.name===t.no?(t.loaded=!0,r.logger.info("loadFile","read success","data no:",s.name),r.state=U.IDLE,r.events.emit(ot.default.LoaderLoaded,s,t,e,n)):r.logger.warn("loadFile","is not ts file or the segment'no is not equal.","fileType:",s.fileType,t.no,"data:",s);else if(r.state=U.ERROR,o<=r.maxRetryCount)r.logger.warn("loadFile","retry to load","count:",o,"segment:",t),a(),o+=1;else if(r.player.options.isLive){r.state=U.IDLE;r.events.emit(ot.default.PlayerAlert,"获取直播流数据错误")}else{r.events.emit(ot.default.LoaderError,t,e,n);r.events.emit(ot.default.PlayerAlert,"Load file error, please concat administrator.");var u=[r.state,"Load File error.","load count:",o,"segment:",t];r.events.emit(ot.default.PlayerThrowError,u)}},a(t)}else this.logger.warn("loadFile","checkLoadCondition failed","segment:",t,"type:",e)}}},{key:"destroy",value:function(){this.httpWorker&&this.httpWorker.terminate()}}]),n}(M),MP4:function(t){l()(n,t);var e=Et(n);function n(t){var r;return i()(this,n),r=e.call(this),g()(u()(r),"state",U.IDLE),g()(u()(r),"httpWorker",null),r.options=t,r.loaderController=r.options.loaderController,r.dataController=r.loaderController.dataController,r.httpWorker=t.httpWorker,r}return a()(n,[{key:"loadFile",value:function(){var t=this,e=function(){t.options.player.options.beforeLoad?t.options.player.options.beforeLoad(t.sourceURL).then((function(e){t.httpWorker.postMessage({type:"invoke",fileType:"video",method:"get",name:"video",url:e})})):t.httpWorker.postMessage({type:"invoke",fileType:"video",method:"get",name:"video",url:t.sourceURL})};this.state=U.LOADING,this.httpWorker.onmessage=function(n){t.state=U.DONE;var r=n.data;if(t.logger.info("loadfile","httpWorker","onmessage get data"),r&&"error"!==r.type)"notice"===r.type?"speed"===r.noticeType&&t.events.emit(ot.default.LoaderUpdateSpeed,r.data):"video"===r.fileType&&"video"===r.name?(t.logger.info("loadFile","read mp4 success","data:",r),t.state=U.IDLE,t.events.emit(ot.default.LoaderLoaded,r)):t.logger.warn("loadFile","load fail.","fileType:",r.fileType,"data:",r);else if(t.state=U.ERROR,retryCount<=t.maxRetryCount)t.logger.warn("loadFile","retry to load","count:",retryCount,"segment:",segment),e(),retryCount+=1;else{t.events.emit(ot.default.LoaderError,segment,type,time);t.events.emit(ot.default.PlayerAlert,"Load file error, please concat administrator.");var i=[t.state,"Load File error.","load count:",retryCount,"segment:",segment];t.events.emit(ot.default.PlayerThrowError,i)}},e()}}]),n}(M)},Pt=function(t){l()(n,t);var e=xt(n);function n(t,r){var o;return i()(this,n),o=e.call(this),g()(u()(o),"state",null),g()(u()(o),"exeLoader",null),g()(u()(o),"loadData",null),g()(u()(o),"type","HLS"),g()(u()(o),"options",null),g()(u()(o),"dataController",null),o.type=t||o.type,o.player=r.player,o.options=r.player.options,o.dataController=o.player.dataController,o.init(o.type,o.options),o}return a()(n,[{key:"init",value:function(t,e){this.bindEvent(),this.setExeLoader(new Tt[t](St(St({},e),{},{player:this.player,loaderController:this}))),this.setSourceURL(e.sourceURL),this.player.loadData?this.setLoadData(this.player.loadData):this.setLoadData(this.dataController.getDataInstance("load",e)),this.exeLoader.setLoadData(this.loadData)}},{key:"run",value:function(){"HLS"===this.type?(this.state=U.LOAD_PLAYLIST,this.events.emit(ot.default.LoaderPlayListStart,this),this.logger.info("run",U[this.state],"url:",this.options.sourceURL),this.loadPlaylist()):"MP4"===this.type&&this.exeLoader.loadFile()}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.LoaderLoadFile,(function(e,n,r){"HLS"===t.type&&t.exeLoader.loadFile(e,n,r)}))}},{key:"loadPlaylist",value:function(t){var e=this;this.exeLoader.loadPlaylist((function(n){n?(e.dataController.setLoadDataSourceData(e.exeLoader.getSourceData()),e.dataController.setLoadDataSegmentPool(e.exeLoader.getSegmentPool()),e.state=U.LOADED_PLAYLIST,e.events.emit(ot.default.LoaderPlayListLoaded,e),"function"==typeof t&&t.call(e,n)):e.logger.error("run","start load m3u8","data:",n)}))}},{key:"switchPlaylist",value:function(t,e){this.setSourceURL(t),this.dataController.clearLoadData(),this.state=U.LOAD_PLAYLIST,this.events.emit(ot.default.LoaderPlayListStart,this),this.logger.info("switchPlaylist",U[this.state],"url:",t),this.loadPlaylist(e)}},{key:"setExeLoader",value:function(t){this.exeLoader=t}},{key:"getExeLoader",value:function(){return this.exeLoader}},{key:"setSourceURL",value:function(t){this.exeLoader.setSourceURL(t)}},{key:"getSourceURL",value:function(){return this.exeLoader.getSourceURL()}},{key:"setLoadData",value:function(t){this.loadData=t}},{key:"getLoadData",value:function(){return this.loadData}},{key:"getSourceData",value:function(){return this.exeLoader.getSourceData()}},{key:"destroy",value:function(){this.exeLoader.destroy()}}]),n}(B);function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Lt=function(t){l()(n,t);var e=Rt(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"no",0),g()(u()(r),"start",0),g()(u()(r),"end",0),g()(u()(r),"blob",null),g()(u()(r),"arrayBuffer",null),g()(u()(r),"duration",0),Object.assign(u()(r),t),r}return a()(n,[{key:"size",get:function(){return this.blob.size}}]),n}(tt);function At(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Bt=function(t){l()(n,t);var e=At(n);function n(t){return i()(this,n),e.call(this,t)}return a()(n,[{key:"add",value:function(t){t instanceof Lt||(t=new Lt(t));var e=this.length;if(0!==e){for(;e--;)if(t.no<=this[e].no)return void this.splice(e,1,t);return this.push(t),this}this.push(t)}},{key:"getBufferSize",value:function(){return this.length<=0?0:this.reduce((function(t,e){return t+e.blob.size}),0)}},{key:"bufferSize",get:function(){return this.getBufferSize()}},{key:"getBufferDuration",value:function(){return this.length<=0?0:this.reduce((function(t,e){return t+(e.end-e.start)}),0)}},{key:"bufferDuration",get:function(){return this.getBufferDuration()}}]),n}(Q);function Dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var It=function(t){l()(n,t);var e=Dt(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this),g()(u()(t),"bufferPool",[]),g()(u()(t),"sourceData",{}),g()(u()(t),"options",{}),g()(u()(t),"segmentPool",[]),g()(u()(t),"readBufferNo",null),g()(u()(t),"startLoadTime",null),g()(u()(t),"currentSeekTime",null),t.options=r,t.player=r.player,t.keepCache=r.player.options.keepCache,t.init(),t}return a()(n,[{key:"init",value:function(){var t=this;this.setBufferPool(new Bt),this.events.on(ot.default.LoadDataReadBufferByNo,(function(e,n){t.readBufferByNo(e,n,!0)})),this.events.on(ot.default.LoadDataReadBuffer,(function(e,n){t.readBuffer(e,n)})),this.events.on(ot.default.LoaderLoaded,(function(e,n,r,i){var o=t.options.player.options.type;if("HLS"===o){var a=t.createBuffer({arrayBuffer:Uint8Array.from(e.arrayBuffer)},n);if(t.segmentLoaded(n,a),"seek"===r&&i===t.currentSeekTime)return t.events.emit(ot.default.LoadDataSeek,a,i),void t.removeBufferByNo(a.no);i===t.startLoadTime&&t.events.emit(ot.default.LoadDataFirstLoaded,a,i)}else if("MP4"===o){var s=t.options.player.options.duration,u=Uint8Array.from(e.arrayBuffer),c={start:0,end:s,no:0,duration:s,blob:e.data,arrayBuffer:u};t.events.emit(ot.default.LoadDataRead,new Lt(c))}}))}},{key:"setOptions",value:function(t){Object.assign(this.options,t)}},{key:"startLoad",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.logger.info("startLoad","begin to load ts data","time:",t),isNaN(t)?this.logger.error("seekTime","seek","time:",t):(this.startLoadTime=t,this.loadSegmentByTime(t,"start"))}},{key:"readBuffer",value:function(t,e){var n=this.getSegmentByTime(t);n&&this.readBufferByNo(n.no,e)}},{key:"segmentLoaded",value:function(t,e){e&&this.addBufferPool(e),t.no===this.options.player.currentIndex&&this.readBufferByNo(t.no);var n=this.segmentPool.getLast().no;t.no<n&&this.loadSegmentByNo(t.no+1)}},{key:"seekTime",value:function(t){if(isNaN(t))this.logger.error("seekTime","seek","time:",t);else{var e;this.currentSeekTime=t;var n=this.bufferPool.indexOfByTime(t);n>-1?(e=this.bufferPool[n],this.events.emit(ot.default.LoadDataSeek,e,t)):(this.removeBufferPool(this.bufferPool.length),this.loadSegmentByTime(t,"seek"))}}},{key:"loadSegmentByTime",value:function(t,e){if(!isNaN(t)){var n=this.segmentPool.indexOfByTime(t);if(n>=0){var r=this.segmentPool[n];this.events.emit(ot.default.LoaderLoadFile,r,e,t)}else this.logger.error("loadSegmentByTime","time over","time:",t,"type:",e)}}},{key:"createBuffer",value:function(t,e){if(t){var n={start:e.start,end:e.end,no:e.no,duration:e.end-e.start,arrayBuffer:t.arrayBuffer};return new Lt(n)}}},{key:"isValidSegmentNo",value:function(t){return!isNaN(t)&&t>0&&t<=this.segmentPool.length}},{key:"loadSegmentByNo",value:function(t){var e=t-1,n=this.segmentPool.get(e);n&&(this.bufferPool.getByKeyValue("no",t)[0]||this.events.emit(ot.default.LoaderLoadFile,n,"play"))}},{key:"readBufferByNo",value:function(t,e,n){this.isValidSegmentNo(t)?(this.readBufferNo=t,e=e||function(t){this.events.emit(ot.default.LoadDataRead,t)},this.getBlobByNo(t,e,n)):this.logger.error("readBufferByNo","check buffer no","is not valid no",t)}},{key:"getSegmentByTime",value:function(t){var e=this.segmentPool.indexOfByTime(t);return this.segmentPool[e]}},{key:"getBlobByNo",value:function(t,e,n){if(isNaN(t))this.logger.error("getBlobByNo","isNaN","no:",t);else{var r;if(this.keepCache||!this.isBufferReading)return this.isBufferReading=!0,r=this.bufferPool.getByKeyValue("no",t)[0],"function"==typeof e&&(e.call(this,r),r?this.removeBufferByNo(r.no):(this.logger.error("getBlobByNo","buffer null","no:",t),n&&this.loadSegmentByNo(t))),this.isBufferReading=!1,r;this.logger.warn("getBlobByNo","isBufferReading","no:",t)}}},{key:"addBufferPool",value:function(t){if(this.bufferPool.length){if(this.bufferPool[0].no===t.no+1)return this.bufferPool.unshift(t),!0;var e=this.bufferPool.getLast();if(t.no-e.no==1)return this.bufferPool.push(t),!0;if(this.bufferPool.indexOfByKey("no",t.no)>-1)return!0;this.bufferPool.splice(0,this.bufferPool.length)}this.bufferPool.push(t)}},{key:"removeBufferPool",value:function(t){this.keepCache||this.bufferPool.splice(0,t+1)}},{key:"removeBufferByNo",value:function(t){var e=this.bufferPool.indexOfByKey("no",t);if(!(e<=-1))return this.removeBufferPool(e),this.getSegmentByNo(t).loaded=!1,this.bufferPool.length?this.bufferPool.getLast().no<this.segmentPool.getLast().no&&this.loadSegmentByNo(this.bufferPool.getLast().no+1):t<this.segmentPool.getLast().no&&this.loadSegmentByNo(t+1),!0}},{key:"clear",value:function(){this.sourceData={},this.readBufferNo=null,this.currentSeekTime=null,this.bufferPool.length=0,this.segmentPool.length=0}},{key:"getSegmentByNo",value:function(t){return this.segmentPool.get(t-1)}},{key:"getSegment",value:function(t){return this.segmentPool.getByTime(t)}},{key:"setSourceData",value:function(t){this.sourceData=t}},{key:"getSourceData",value:function(){return this.sourceData}},{key:"setBufferPool",value:function(t){this.bufferPool=t}},{key:"getBufferPool",value:function(){return this.bufferPool}},{key:"setSegmentPool",value:function(t){this.segmentPool=t}},{key:"getSegmentPool",value:function(){return this.segmentPool}}]),n}(C.a);function Ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ct=function(t){l()(n,t);var e=Ot(n);function n(t){var r;return i()(this,n),r=e.call(this),g()(u()(r),"loadData",null),r.options=t,r}return a()(n,[{key:"setLoadData",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.loadData=A()(It,e)}},{key:"getLoadData",value:function(){return this.loadData}},{key:"getLoadDataBufferPool",value:function(){return this.loadData.bufferPool}},{key:"setLoadDataSourceData",value:function(t){this.loadData.setSourceData(t)}},{key:"setLoadDataSegmentPool",value:function(t){this.loadData.setSegmentPool(t)}},{key:"startLoad",value:function(t){var e=this.options.player.options.type;"HLS"===e?(t=Math.max(t,0),this.startLoadData(t)):"MP4"===e&&this.events.emit(Events.LoaderLoadFile)}},{key:"startLoadData",value:function(t){this.loadData.startLoad(t)}},{key:"clearLoadData",value:function(){this.loadData.clear()}},{key:"getDataInstance",value:function(t){if(t)switch(t){case"load":if(!this.loadData){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.setLoadData.apply(this,n)}return this.loadData;default:return null}}}]),n}(B);function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ft,Mt,Ut=function(t){l()(n,t);var e=Nt(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"checkHanlder",null),g()(u()(r),"resetStatus",{processor:!1,audioPlayer:!1}),r.player=t.player,r.player?(r.audioPlayer=t.audioPlayer,r.imagePlayer=t.imagePlayer,r.loadData=t.loadData,r.bindEvent(),r):h()(r)}return a()(n,[{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.ProcessorResetEnd,(function(){t.checkResetReady("processor")})),this.events.on(ot.default.AudioPlayerReady,(function(){t.checkResetReady("audioPlayer")})),this.events.on(ot.default.PlayerResetReady,(function(){t.onResetReady()})),this.events.on(ot.default.LoadDataSeek,(function(e,n){t.onSeek(e,n)})),this.events.on(ot.default.ImagePlayerRenderEnd,(function(e,n){t.onRenderEnd(e,n)})),this.events.on(ot.default.ImagePlayerWait,(function(){t.audioPlayer.pause()}))}},{key:"play",value:function(t){this.logger.warn("play","play start"),this.sync(t)}},{key:"playerWait",value:function(){this.imagePlayer.pause(),this.imagePlayer.status="wait",this.imagePlayer.ready=!1,this.events.emit(ot.default.ImagePlayerWait)}},{key:"sync",value:function(t){var e=this,n=this.player;if(!n.reseting){var r=this.audioPlayer,i=this.imagePlayer,o=r.offset,a=i.offset,s=i.end,u=Math.min(o,a),c=Math.max(o,a);if(r.need){if("waiting"===r.status||"wait"===i.status)return}else u=a,c=a;var l=n.playbackRate;if(n.seeking&&(n.seeking=!1),!n.reseting&&"pause"!==n.status)if("end"!==n.status){if(this.setCurrentTime(t),this.player.options.isLive&&(!i.imageData.pools[0].length&&t<1e3*this.player.duration||t>s))return this.playerWait(),void setTimeout((function(){e.player.seek(t)}),1e3);if(!(t<u))return r.need&&t>=o&&t<=a?(this.events.once(ot.default.AudioPlayerPlaySuccess,(function(){i.render(a)})),void("playing"!==this.audioPlayer.status&&(r.playbackRate=l,r.play()))):void(t>=a&&(!r.need||t<=o)?i.render(t):t>c&&(Math.abs(this.audioPlayer.currentTime-t)>200&&(this.audioPlayer.currentTime=t),"playing"!==this.audioPlayer.status&&(this.audioPlayer.playbackRate=l,this.audioPlayer.play()),i.render(t)));this.sync(u)}else r.paused||r.pause()}}},{key:"setCurrentTime",value:function(t){var e=t;this.player.currentTime=e,this.events.emit(ot.default.PlayerTimeUpdate,e)}},{key:"pause",value:function(){this.audioPlayer.pause(),this.clearDrawHanlder()}},{key:"seek",value:function(t){var e=this,n=this.imagePlayer.isBuffered(t),r=this.audioPlayer.isBuffered(t);this.player.pause(),n&&r?(this.logger.warn("seek","seek in buffer, time: ".concat(t,", buffer: ").concat(this.player.buffer()[0],", ").concat(this.player.buffer()[1])),this.audioPlayer.need?(this.audioPlayer.onSeekedHandler=function(){e.imagePlayer.render(t,!1)},this.audioPlayer.currentTime=t):this.imagePlayer.render(t,!1),this.events.emit(ot.default.StreamDataReady),setTimeout((function(){e.player.seeking=!1}),100),this.player.options.keepCache&&this.player.processController.reset()):(this.logger.warn("Action seek reset"),this.reset(t))}},{key:"reset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger.info("reset","reset start"),this.player.reseting=!0,this.events.emit(ot.default.PlayerReset,t),this.resetStatus={processor:!1,audioPlayer:!1},this.player.processController.reset(),this.player.streamController.reset(),this.player.audioPlayer.reset(t),this.player.imagePlayer.reset(t,e),this.player.currentIndex=null}},{key:"checkResetReady",value:function(t){var e=this.resetStatus;if(t&&"string"==typeof t){e[t]=!0;for(var n=Object.keys(e),r=0;r<n.length;r++)if(!e[n[r]])return!1;this.logger.warn("checkResetReady","reset ready"),this.events.emit(ot.default.PlayerResetReady)}}},{key:"onResetReady",value:function(){this.player.reseting=!1,this.logger.info("onResetReady","reset Ready"),this.player.changing&&this.events.emit(ot.default.DataProcessorReady),this.player.seeking&&this.player.loadData.seekTime(this.player.currentTime/1e3)}},{key:"onSeek",value:function(t,e){var n=this.player.currentTime;this.logger.info("onseek",n,t,t.no,e),t&&t.no&&Math.abs(n-Math.floor(1e3*e))<2?(this.player.currentIndex=t.no,this.logger.info("seektime:",t.no,e,this.player.currentTime),this.player.seekSegmentNo=t.no,this.player.streamController.startLoad(t.no)):this.logger.warn("seek failue, not found data",n,t,e)}},{key:"clearDrawHanlder",value:function(){clearTimeout(this.drawFrameHanlder),this.drawFrameHanlder=null}},{key:"onRenderEnd",value:function(t,e){this.player.seekTime&&(this.logger.info("onRenderEnd","seektoRenderTime:",Date.now()-this.player.seekTime),this.player.seekTime=null);var n=this.imagePlayer,r=this.audioPlayer,i=this.player.playbackRate,o=r.currentTime,a=n.currentTime,s=r.offset,u=n.fragDuration,c=o-a,l=0;r.need?a<s?this.drawNext(a+u*i,u):(c>0&&c>u?u=(l=a+Math.ceil(c/u+i)*u)-o:(l=a+u*i,u-=c),this.drawNext(l,u)):this.drawNext(t+e,Math.ceil(e/i))}},{key:"drawNext",value:function(t,e){var n=this;if(this.drawFrameHanlder&&this.clearDrawHanlder(),this.player.options.isLive){var r=this.player.loadData.segmentPool.getLast(),i=r.start,o=1e3*(i-15*r.duration);if(o>0&&t<o)return void this.player.seek(1e3*i)}this.drawFrameHanlder=setTimeout((function(){n.sync(t)}),e)}}]),n}(C.a);function jt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Ht(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ht(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}function Wt(t){if(Ft){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Ft.apply(void 0,[t].concat(n))}}function Vt(t){if(Mt){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Mt.apply(void 0,[t].concat(n))}}var $t=function(){function t(e){i()(this,t),this.payload=e,this.nri=(96&this.payload[0])>>5,this.ntype=31&this.payload[0]}return a()(t,[{key:"toString",value:function(){return"".concat(t.type(this),": NRI: ").concat(this.getNri())}},{key:"getNri",value:function(){return this.nri>>6}},{key:"type",value:function(){return this.ntype}},{key:"isKeyframe",value:function(){return this.ntype==t.IDR}},{key:"getSize",value:function(){return 4+this.payload.byteLength}},{key:"getData",value:function(){var t=new Uint8Array(this.getSize());return new DataView(t.buffer).setUint32(0,this.getSize()-4),t.set(this.payload,4),t}}],[{key:"NDR",get:function(){return 1}},{key:"IDR",get:function(){return 5}},{key:"SEI",get:function(){return 6}},{key:"SPS",get:function(){return 7}},{key:"PPS",get:function(){return 8}},{key:"AUD",get:function(){return 9}},{key:"TYPES",get:function(){var e;return e={},g()(e,t.IDR,"IDR"),g()(e,t.SEI,"SEI"),g()(e,t.SPS,"SPS"),g()(e,t.PPS,"PPS"),g()(e,t.NDR,"NDR"),g()(e,t.AUD,"AUD"),e}},{key:"type",value:function(e){return e.ntype in t.TYPES?t.TYPES[e.ntype]:"UNKNOWN"}}]),t}(),Xt=function(){function t(e){i()(this,t),this.data=e,this.index=0,this.bitLength=8*e.byteLength}return a()(t,[{key:"bitsAvailable",get:function(){return this.bitLength-this.index}},{key:"skipBits",value:function(t){if(this.bitsAvailable<t)return!1;this.index+=t}},{key:"readBits",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getBits(t,this.index,e);return n}},{key:"getBits",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.bitsAvailable<t)return 0;var r=e%8,i=this.data[e/8|0]&255>>>r,o=8-r;if(o>=t)return n&&(this.index+=t),i>>o-t;n&&(this.index+=o);var a=t-o;return i<<a|this.getBits(a,e+o,n)}},{key:"skipLZ",value:function(){var t;for(t=0;t<this.bitLength-this.index;++t)if(0!==this.getBits(1,this.index+t,!1))return this.index+=t,t;return t}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.readBits(8*t)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}}]),t}(),Yt=function(){function t(e){i()(this,t),this.remuxer=e,this.track=e.mp4track}return a()(t,[{key:"parseSPS",value:function(e){var n=t.readSPS(new Uint8Array(e));this.track.width=n.width,this.track.height=n.height,this.track.sps=[new Uint8Array(e)],this.track.codec="avc1.";for(var r=new DataView(e.buffer,e.byteOffset+1,4),i=0;i<3;++i){var o=r.getUint8(i).toString(16);o.length<2&&(o="0"+o),this.track.codec+=o}}},{key:"parsePPS",value:function(t){this.track.pps=[new Uint8Array(t)]}},{key:"parseNAL",value:function(t){if(!t)return!1;var e=!1;switch(t.type()){case $t.NDR:case $t.IDR:e=!0;break;case $t.PPS:this.track.pps||(this.parsePPS(t.getData().subarray(4)),!this.remuxer.readyToDecode&&this.track.pps&&this.track.sps&&(this.remuxer.readyToDecode=!0)),e=!0;break;case $t.SPS:this.track.sps||(this.parseSPS(t.getData().subarray(4)),!this.remuxer.readyToDecode&&this.track.pps&&this.track.sps&&(this.remuxer.readyToDecode=!0)),e=!0;break;case $t.AUD:Wt("AUD - ignoing and disable HD mode for live channel"),this.remuxer.isHDAvail&&(this.remuxer.isHDAvail=!1);break;case $t.SEI:Wt("SEI - ignoing")}return e}}],[{key:"extractNALu",value:function(t){for(var e,n,r=0,i=t.byteLength,o=0,a=[];r<i;)switch(e=t[r++],o){case 0:0===e&&(o=1);break;case 1:o=0===e?2:0;break;case 2:case 3:0===e?o=3:1===e&&r<i?(n&&a.push(t.subarray(n,r-o-1)),n=r,o=0):o=0}return n&&a.push(t.subarray(n,i)),a}},{key:"skipScalingList",value:function(t,e){for(var n=8,r=8,i=0;i<e;i++)0!==r&&(r=(n+t.readEG()+256)%256),n=0===r?n:r}},{key:"readSPS",value:function(e){var n,r,i,o,a,s,u=new Xt(e),c=0,l=0,f=0,h=0,p=1;if(u.readUByte(),n=u.readUByte(),u.readBits(5),u.skipBits(3),u.readUByte(),u.skipUEG(),100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n){var d=u.readUEG();if(3===d&&u.skipBits(1),u.skipUEG(),u.skipUEG(),u.skipBits(1),u.readBoolean()){s=3!==d?8:12;for(var y=0;y<s;++y)u.readBoolean()&&(y<6?t.skipScalingList(u,16):t.skipScalingList(u,64))}}u.skipUEG();var g=u.readUEG();if(0===g)u.readUEG();else if(1===g){u.skipBits(1),u.skipEG(),u.skipEG(),r=u.readUEG();for(var v=0;v<r;++v)u.skipEG()}if(u.skipUEG(),u.skipBits(1),i=u.readUEG(),o=u.readUEG(),0===(a=u.readBits(1))&&u.skipBits(1),u.skipBits(1),u.readBoolean()&&(c=u.readUEG(),l=u.readUEG(),f=u.readUEG(),h=u.readUEG()),u.readBoolean()){if(u.readBoolean()){var m;switch(u.readUByte()){case 1:m=[1,1];break;case 2:m=[12,11];break;case 3:m=[10,11];break;case 4:m=[16,11];break;case 5:m=[40,33];break;case 6:m=[24,11];break;case 7:m=[20,11];break;case 8:m=[32,11];break;case 9:m=[80,33];break;case 10:m=[18,11];break;case 11:m=[15,11];break;case 12:m=[64,33];break;case 13:m=[160,99];break;case 14:m=[4,3];break;case 15:m=[3,2];break;case 16:m=[2,1];break;case 255:m=[u.readUByte()<<8|u.readUByte(),u.readUByte()<<8|u.readUByte()]}m&&(p=m[0]/m[1])}if(u.readBoolean()&&u.skipBits(1),u.readBoolean()&&(u.skipBits(4),u.readBoolean()&&u.skipBits(24)),u.readBoolean()&&(u.skipUEG(),u.skipUEG()),u.readBoolean())u.readUInt(),u.readUInt(),u.readBoolean()}return{width:Math.ceil((16*(i+1)-2*c-2*l)*p),height:(2-a)*(o+1)*16-(a?2:4)*(f+h)}}}]),t}(),qt=function(){function t(e){i()(this,t),this.listener={},this.type=""|e}return a()(t,[{key:"on",value:function(t,e){return this.listener[t]||(this.listener[t]=[]),this.listener[t].push(e),!0}},{key:"off",value:function(t,e){if(this.listener[t]){var n=this.listener[t].indexOf(e);return n>-1&&this.listener[t].splice(n,1),!0}return!1}},{key:"offAll",value:function(){this.listener={}}},{key:"dispatch",value:function(t,e){return!!this.listener[t]&&(this.listener[t].map((function(t){t.apply(null,[e])})),!0)}}]),t}(),Gt=Math.pow(2,32)-1,Zt=function(){function t(){i()(this,t)}return a()(t,null,[{key:"init",value:function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=o,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,u,a,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,i))}},{key:"box",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i,o=8,a=n.length,s=a;a--;)o+=n[a].byteLength;for((i=new Uint8Array(o))[0]=o>>24&255,i[1]=o>>16&255,i[2]=o>>8&255,i[3]=255&o,i.set(t,4),a=0,o=8;a<s;++a)i.set(n[a],o),o+=n[a].byteLength;return i}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,n){n*=e;var r=Math.floor(n/(Gt+1)),i=Math.floor(n%(Gt+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))}},{key:"moov",value:function(e,n,r){for(var i=e.length,o=[];i--;)o[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(r,n)].concat(o).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))}},{key:"mvhd",value:function(e,n){n*=e;var r=Math.floor(n/(Gt+1)),i=Math.floor(n%(Gt+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)}},{key:"sdtp",value:function(e){var n,r,i=e.samples||[],o=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,o)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"avc1",value:function(e){var n,r,i,o=[],a=[];for(n=0;n<e.sps.length;n++)i=(r=e.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)i=(r=e.pps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));var s=t.box(t.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|e.sps.length].concat(o).concat([e.pps.length]).concat(a))),u=e.width,c=e.height;return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.byteLength,n=new Uint8Array(26+e+3);return n.set([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5,e]),n.set(t.config,26),n.set([6,1,2],26+e),n}},{key:"mp4a",value:function(e){var n=e.audiosamplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var n=e.id,r=e.duration*e.timescale,i=e.width,o=e.height,a=Math.floor(r/(Gt+1)),s=Math.floor(r%(Gt+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))}},{key:"traf",value:function(e,n){var r=t.sdtp(e),i=e.id,o=Math.floor(n/(Gt+1)),a=Math.floor(n%(Gt+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(e,r.length+16+20+8+16+8+8),r)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,n){var r,i,o,a,s,u,c=e.samples||[],l=c.length,f=12+16*l,h=new Uint8Array(f);for(n+=8+f,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<l;r++)o=(i=c[r]).duration,a=i.size,s=i.flags,u=i.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,a>>>24&255,a>>>16&255,a>>>8&255,255&a,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return t.box(t.types.trun,h)}},{key:"initSegment",value:function(e,n,r){t.types||t.init();var i,o=t.moov(e,n,r);return(i=new Uint8Array(t.FTYP.byteLength+o.byteLength)).set(t.FTYP),i.set(o,t.FTYP.byteLength),i}}]),t}(),Kt=function(){function t(e){i()(this,t),this.remuxer=e,this.track=e.mp4track,this.aacHeader=null}return a()(t,[{key:"samplingRateMap",get:function(){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]}},{key:"getAACHeaderData",get:function(){return this.aacHeader}},{key:"setAACHeaderData",set:function(t){void 0===t&&(t=null),this.aacHeader=t}},{key:"getHeaderLength",value:function(t){return 1&t[1]?7:9}},{key:"getFrameLength",value:function(t){return(3&t[3])<<11|t[4]<<3|(224&t[5])>>>5}},{key:"isAACPattern",value:function(t){return 255===t[0]&&240==(240&t[1])&&0==(6&t[1])}},{key:"extractAAC",value:function(t){var e,n,r=0,i=t.byteLength,o=[];if(!this.isAACPattern(t))return Vt("Invalid ADTS audio format"),o;for(e=this.getHeaderLength(t),this.aacHeader||(this.aacHeader=t.subarray(0,e));r<i;)n=this.getFrameLength(t),o.push(t.subarray(e,n)),t=t.slice(n),r+=n;return o}},{key:"setAACConfig",value:function(){var t,e,n,r=new Uint8Array(2),i=this.getAACHeaderData;i&&(t=1+((192&i[2])>>>6),e=(60&i[2])>>>2,n=(1&i[2])<<2,n|=(192&i[3])>>>6,r[0]=t<<3,r[0]|=(14&e)>>1,r[1]|=(1&e)<<7,r[1]|=n<<3,this.track.codec="mp4a.40."+t,this.track.channelCount=n,this.track.config=r,this.remuxer.readyToDecode=!0)}}]),t}(),Jt=1,Qt=function(){function t(){i()(this,t),this.seq=1}return a()(t,[{key:"flush",value:function(){this.seq++,this.mp4track.len=0,this.mp4track.samples=[]}},{key:"isReady",value:function(){return!(!this.readyToDecode||!this.samples.length)||null}}],[{key:"getTrackID",value:function(){return Jt++}}]),t}(),te=function(t){l()(n,t);var e=zt(n);function n(){var t;return i()(this,n),(t=e.call(this)).readyToDecode=!1,t.nextDts=0,t.dts=0,t.timescale=1e3,t.mp4track={id:Qt.getTrackID(),type:"audio",channelCount:0,len:0,fragmented:!0,timescale:t.timescale,duration:t.timescale,samples:[],config:"",codec:""},t.samples=[],t.aac=new Kt(u()(t)),t}return a()(n,[{key:"resetTrack",value:function(){this.readyToDecode=!1,this.mp4track.codec="",this.mp4track.channelCount="",this.mp4track.config="",this.mp4track.timescale=this.timescale}},{key:"remux",value:function(t){var e,n,r,i=jt(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;e=(n=o.units).byteLength,this.samples.push({units:n,size:e,duration:o.duration}),this.mp4track.len+=e,this.readyToDecode||this.aac.setAACConfig()}}catch(t){i.e(t)}finally{i.f()}}},{key:"getPayload",value:function(){if(!this.isReady())return null;var t,e,n=new Uint8Array(this.mp4track.len),r=0,i=this.mp4track.samples;for(this.dts=this.nextDts;this.samples.length;){var o=this.samples.shift();(e=o.duration)<=0?(Wt("remuxer: invalid sample duration at DTS: ".concat(this.nextDts," :").concat(e)),this.mp4track.len-=o.size):(this.nextDts+=e,t={size:o.size,duration:e,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},n.set(o.units,r),r+=o.size,i.push(t))}return i.length?new Uint8Array(n.buffer,0,this.mp4track.len):null}}]),n}(Qt),ee=function(t){l()(n,t);var e=zt(n);function n(){var t;return i()(this,n),(t=e.call(this)).readyToDecode=!1,t.nextDts=0,t.dts=0,t.timescale=1e3,t.mp4track={id:Qt.getTrackID(),type:"video",len:0,fragmented:!0,sps:"",pps:"",width:0,height:0,timescale:t.timescale,duration:t.timescale,samples:[]},t.samples=[],t.h264=new Yt(u()(t)),t}return a()(n,[{key:"resetTrack",value:function(){this.readyToDecode=!1,this.mp4track.sps="",this.mp4track.pps=""}},{key:"remux",value:function(t){var e,n,r,i,o,a,s=jt(t);try{for(s.s();!(a=s.n()).done;){e=a.value,n=[],i=0,o=!1;var u,c=jt(e.units);try{for(c.s();!(u=c.n()).done;)r=u.value,this.h264.parseNAL(r)&&(n.push(r),i+=r.getSize(),o||(o=r.isKeyframe()))}catch(t){c.e(t)}finally{c.f()}n.length>0&&this.readyToDecode&&(this.mp4track.len+=i,this.samples.push({units:n,size:i,keyFrame:o,duration:e.duration}))}}catch(t){s.e(t)}finally{s.f()}}},{key:"getPayload",value:function(){if(!this.isReady())return null;var t,e,n=new Uint8Array(this.mp4track.len),r=0,i=this.mp4track.samples;for(this.dts=this.nextDts;this.samples.length;){var o=this.samples.shift(),a=o.units;if((e=o.duration)<=0)Wt("remuxer: invalid sample duration at DTS: ".concat(this.nextDts," :").concat(e)),this.mp4track.len-=o.size;else{this.nextDts+=e,t={size:o.size,duration:e,cts:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:o.keyFrame?0:1,dependsOn:o.keyFrame?2:1}};var s,u=jt(a);try{for(u.s();!(s=u.n()).done;){var c=s.value;n.set(c.getData(),r),r+=c.getSize()}}catch(t){u.e(t)}finally{u.f()}i.push(t)}}return i.length?new Uint8Array(n.buffer,0,this.mp4track.len):null}}]),n}(Qt);function ne(t,e){var n=new Uint8Array((0|t.byteLength)+(0|e.byteLength));return n.set(t,0),n.set(e,0|t.byteLength),n}var re=function(t){l()(n,t);var e=zt(n);function n(t){var r;return i()(this,n),(r=e.call(this,"remuxer")).initialized=!1,r.trackTypes=[],r.tracks={},r.mediaDuration=t?1/0:1e3,r}return a()(n,[{key:"addTrack",value:function(t){"video"!==t&&"both"!==t||(this.tracks.video=new ee,this.trackTypes.push("video")),"audio"!==t&&"both"!==t||(this.tracks.audio=new te,this.trackTypes.push("audio"))}},{key:"reset",value:function(){var t,e=jt(this.trackTypes);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.tracks[n].resetTrack()}}catch(t){e.e(t)}finally{e.f()}this.initialized=!1}},{key:"destroy",value:function(){this.tracks={},this.offAll()}},{key:"flush",value:function(){if(this.initialized){var t,e=jt(this.trackTypes);try{for(e.s();!(t=e.n()).done;){var n=t.value,r=this.tracks[n],i=r.getPayload();if(i&&i.byteLength){var o={type:n,payload:ne(Zt.moof(r.seq,r.dts,r.mp4track),Zt.mdat(i)),dts:r.dts};this.dispatch("buffer",o);var a=(h=r.dts/1e3,p=void 0,d=void 0,y=void 0,g=void 0,g="",p=Math.floor(h),(d=parseInt(p/3600,10)%24)>0&&(g+=(d<10?"0"+d:d)+":"),g+=((y=parseInt(p/60,10)%60)<10?"0"+y:y)+":"+((p=p<0?0:p%60)<10?"0"+p:p));Wt("put segment (".concat(n,"): ").concat(r.seq," dts: ").concat(r.dts," samples: ").concat(r.mp4track.samples.length," second: ").concat(a)),r.flush()}}}catch(t){e.e(t)}finally{e.f()}}else if(this.isReady()){this.dispatch("ready");var s,u=jt(this.trackTypes);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=this.tracks[c],f={type:c,payload:Zt.initSegment([l.mp4track],this.mediaDuration,l.mp4track.timescale)};this.dispatch("buffer",f)}}catch(t){u.e(t)}finally{u.f()}Wt("Initial segment generated."),this.initialized=!0}var h,p,d,y,g}},{key:"isReady",value:function(){var t,e=jt(this.trackTypes);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(!this.tracks[n].readyToDecode||!this.tracks[n].samples.length)return!1}}catch(t){e.e(t)}finally{e.f()}return!0}},{key:"remux",value:function(t){var e,n=jt(this.trackTypes);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=t[r];"audio"===r&&this.tracks.video&&!this.tracks.video.readyToDecode||i.length>0&&this.tracks[r].remux(i)}}catch(t){n.e(t)}finally{n.f()}this.flush()}}]),n}(qt),ie=function(t){l()(n,t);var e=zt(n);function n(t,r){var o;return i()(this,n),(o=e.call(this,"buffer")).type=r,o.queue=new Uint8Array,o.cleaning=!1,o.pendingCleaning=0,o.cleanOffset=30,o.cleanRanges=[],o.sourceBuffer=t,o.sourceBuffer.addEventListener("updateend",(function(){o.dispatch("updateend",Date.now()),o.pendingCleaning>0&&(o.initCleanup(o.pendingCleaning),o.pendingCleaning=0),o.cleaning=!1,o.cleanRanges.length&&o.doCleanup()})),o.sourceBuffer.addEventListener("error",(function(t){o.dispatch("error",{type:o.type,name:"buffer",error:t})})),o}return a()(n,[{key:"destroy",value:function(){this.queue=null,this.sourceBuffer=null,this.offAll()}},{key:"doCleanup",value:function(){if(this.cleanRanges.length){var t=this.cleanRanges.shift();Wt("".concat(this.type," remove range [").concat(t[0]," - ").concat(t[1],")")),this.cleaning=!0,this.sourceBuffer.remove(t[0],t[1]),this.dispatch("clearBuffer")}else this.cleaning=!1}},{key:"initCleanup",value:function(t){if(this.sourceBuffer.updating)this.pendingCleaning=t;else if(this.sourceBuffer.buffered&&this.sourceBuffer.buffered.length&&!this.cleaning){for(var e=0;e<this.sourceBuffer.buffered.length;++e){var n=this.sourceBuffer.buffered.start(e),r=this.sourceBuffer.buffered.end(e);t-n>this.cleanOffset&&n<(r=t-this.cleanOffset)&&this.cleanRanges.push([n,r])}this.doCleanup()}}},{key:"doAppend",value:function(){if(this.queue.length&&!this.sourceBuffer.updating)try{this.sourceBuffer.appendBuffer(this.queue),this.queue=new Uint8Array}catch(t){if("QuotaExceededError"===t.name)return Wt("".concat(this.type," buffer quota full")),void this.dispatch("error",{type:this.type,name:"QuotaExceeded",error:"buffer error"});Vt("Error occured while appending ".concat(this.type," buffer -  ").concat(t.name,": ").concat(t.message)),this.dispatch("error",{type:this.type,name:"unexpectedError",error:"buffer error"})}}},{key:"feed",value:function(t){this.queue=ne(this.queue,t)}}]),n}(qt);window.MediaSource=window.MediaSource||window.WebKitMediaSource;var oe=function(t){l()(n,t);var e=zt(n);function n(t){var r;i()(this,n),r=e.call(this,"jmuxer"),window.MediaSource=window.MediaSource||window.WebKitMediaSource;if(r.options=Object.assign({},{node:"",mode:"both",flushingTime:1500,clearBuffer:!0,onReady:null,fps:30,debug:!1,onClearBuffer:null},t),r.options.debug&&(Ft=console.log,Mt=console.error),"string"==typeof r.options.node&&""==r.options.node&&Vt("no video element were found to render, provide a valid video element"),r.options.fps||(r.options.fps=30),r.frameDuration=1e3/r.options.fps|0,r.node="string"==typeof r.options.node?document.getElementById(r.options.node):r.options.node,r.sourceBuffers={},r.isMSESupported=!!window.MediaSource,!r.isMSESupported)throw"Oops! Browser does not support media source extension.";return r.setupMSE(),r.remuxController=new re(r.options.clearBuffer),r.remuxController.addTrack(r.options.mode),"audio"===r.options.mode&&(r.aacParser=r.remuxController.tracks.audio.aac),r.mseReady=!1,r.lastCleaningTime=Date.now(),r.keyframeCache=[],r.frameCounter=0,r.remuxController.on("buffer",r.onBuffer.bind(u()(r))),r.remuxController.on("ready",r.createBuffer.bind(u()(r))),r.startInterval(),r}return a()(n,[{key:"setupMSE",value:function(){this.mediaSource=new MediaSource,this.node.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",this.onMSEOpen.bind(this)),this.mediaSource.addEventListener("sourceclose",this.onMSEClose.bind(this)),this.mediaSource.addEventListener("webkitsourceopen",this.onMSEOpen.bind(this)),this.mediaSource.addEventListener("webkitsourceclose",this.onMSEClose.bind(this))}},{key:"feed",value:function(t){var e,n,r,i=!1,o={video:[],audio:[]};t&&this.remuxController&&(r=t.duration?parseInt(t.duration):0,t.video&&(e=Yt.extractNALu(t.video)).length>0&&(o.video=this.getVideoFrames(e,r),i=!0),t.audio&&(n=this.aacParser.extractAAC(t.audio)).length>0&&(o.audio=this.getAudioFrames(n,r),i=!0),i?this.remuxController.remux(o):Vt("Input object must have video and/or audio property. Make sure it is not empty and valid typed array"))}},{key:"getVideoFrames",value:function(t,e){var n,r,i,o,a=[],s=[],u=0,c=[],l=jt(t);try{for(l.s();!(o=l.n()).done;)n=o.value,r=new $t(n),a.push(r),r.type()!==$t.IDR&&r.type()!==$t.NDR||(s.push({units:a}),a=[],this.options.clearBuffer&&(r.type()===$t.IDR&&c.push(this.frameCounter),this.frameCounter++))}catch(t){l.e(t)}finally{l.f()}return e?(i=e/s.length|0,u=e-i*s.length):i=this.frameDuration,s.map((function(t){t.duration=u>0?i+1:i,0!==u&&u--})),this.options.clearBuffer&&(c=c.map((function(t){return t*i/1e3})),this.keyframeCache=this.keyframeCache.concat(c)),s}},{key:"getAudioFrames",value:function(t,e){var n,r,i,o=[],a=0,s=jt(t);try{for(s.s();!(i=s.n()).done;)n=i.value,o.push({units:n})}catch(t){s.e(t)}finally{s.f()}return e?(r=e/o.length|0,a=e-r*o.length):r=this.frameDuration,o.map((function(t){t.duration=a>0?r+1:r,0!==a&&a--})),o}},{key:"destroy",value:function(){if(this.aacParser=null,this.stopInterval(),this.mediaSource){try{this.bufferControllers&&(this.mediaSource.endOfStream(),this.removeSourceBuffer())}catch(t){Vt("mediasource is not available to end ".concat(t.message))}this.mediaSource=null}if(this.remuxController&&(this.remuxController.destroy(),this.remuxController=null),this.bufferControllers){for(var t in this.bufferControllers)this.bufferControllers[t].destroy();this.bufferControllers=null}this.node=!1,this.mseReady=!1,this.videoStarted=!1}},{key:"createBuffer",value:function(){if(this.mseReady&&this.remuxController&&this.remuxController.isReady()&&!this.bufferControllers)for(var t in this.bufferControllers={},this.remuxController.tracks){var e=this.remuxController.tracks[t];if(!n.isSupported("".concat(t,'/mp4; codecs="').concat(e.mp4track.codec,'"')))return Vt("Browser does not support codec"),!1;var r=this.mediaSource.addSourceBuffer("".concat(t,'/mp4; codecs="').concat(e.mp4track.codec,'"'));this.bufferControllers[t]=new ie(r,t),this.sourceBuffers[t]=r,this.bufferControllers[t].on("error",this.onBufferError.bind(this)),this.bufferControllers[t].on("clearBuffer",this.onClearBuffer.bind(this)),this.bufferControllers[t].on("updateend",this.onUpdateEnd.bind(this))}}},{key:"onUpdateEnd",value:function(t){"function"==typeof this.options.onUpdateEnd&&this.options.onUpdateEnd(t)}},{key:"startInterval",value:function(){var t=this;this.interval=setInterval((function(){t.bufferControllers&&(t.releaseBuffer(),t.clearBuffer())}),this.options.flushingTime)}},{key:"stopInterval",value:function(){this.interval&&clearInterval(this.interval)}},{key:"releaseBuffer",value:function(){for(var t in this.bufferControllers)this.bufferControllers[t].doAppend()}},{key:"getSafeBufferClearLimit",value:function(t){for(var e,n="audio"===this.options.mode&&t||0,r=0;r<this.keyframeCache.length&&!(this.keyframeCache[r]>=t);r++)e=this.keyframeCache[r];return e&&(this.keyframeCache=this.keyframeCache.filter((function(t){return t<e&&(n=t),t>=e}))),n}},{key:"clearBuffer",value:function(){if(this.options.clearBuffer&&Date.now()-this.lastCleaningTime>1e4){for(var t in this.bufferControllers){var e=this.getSafeBufferClearLimit(this.node.currentTime);this.bufferControllers[t].initCleanup(e)}this.lastCleaningTime=Date.now()}}},{key:"onBuffer",value:function(t){this.bufferControllers&&this.bufferControllers[t.type]&&this.bufferControllers[t.type].feed(t.payload)}},{key:"onClearBuffer",value:function(){"function"==typeof this.options.onClearBuffer&&this.options.onClearBuffer()}},{key:"removeSourceBuffer",value:function(){if(this.mediaSource){var t=this.sourceBuffers;for(var e in t)this.mediaSource.removeSourceBuffer(t[e])}}},{key:"onMSEOpen",value:function(){this.mseReady=!0,this.createBuffer(),"function"==typeof this.options.onReady&&(this.options.onReady(),this.options.onReady=null)}},{key:"onMSEClose",value:function(){this.mseReady=!1,this.videoStarted=!1}},{key:"onBufferError",value:function(t){if("QuotaExceeded"!=t.name){if(this.mediaSource.sourceBuffers.length>0&&this.sourceBuffers[t.type]&&this.mediaSource.removeSourceBuffer(this.sourceBuffers[t.type]),0==this.mediaSource.sourceBuffers.length)try{this.mediaSource.endOfStream()}catch(t){Vt("mediasource is not available to end")}}else this.bufferControllers[t.type].initCleanup(this.node.currentTime)}}],[{key:"isSupported",value:function(t){return window.MediaSource&&window.MediaSource.isTypeSupported(t)}}]),n}(qt);function ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var se=function(t){l()(n,t);var e=ae(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"source",[]),g()(u()(r),"onPlay",void 0),r.source=t.source,r.onPlay=t.onPlay,r.init(),r}return a()(n,[{key:"init",value:function(){}},{key:"extract",value:function(t,e){for(var n=this.provide(e),r=0;r<n.size;r++)t[2*r]=n.left[r],t[2*r+1]=n.right[r];return n.size}},{key:"provide",value:function(t){for(var e=t,n=new Float32Array(e),r=new Float32Array(e),i=0,o=0,a=0;this.source.length>0;){var s=this.source.shift(),u=s.loadedPosition||0;o=s.startTime+s.duration*u/s.length;var c=Math.min(s.length-u,e-i),l=s.getChannelData(0),f=s.numberOfChannels>1?s.getChannelData(1):s.getChannelData(0);if(n.set(l.slice(u,u+c),i),r.set(f.slice(u,u+c),i),a+=c,i+=c,(u+=c)<s.length){s.loadedPosition=u,this.source.unshift(s);break}}return this.onPlay&&this.onPlay(o),{left:n,right:r,size:a}}}]),n}(C.a);function ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function le(t,e,n){return e&&ce(t.prototype,e),n&&ce(t,n),t}function fe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pe(t,e)}function he(t){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pe(t,e){return(pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function de(t,e){return!e||"object"!==x()(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ye(t,e,n){return(ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=he(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}var ge=function(){function t(){ue(this,t),this._vector=new Float32Array,this._position=0,this._frameCount=0}return le(t,[{key:"clear",value:function(){this.receive(this._frameCount),this.rewind()}},{key:"put",value:function(t){this._frameCount+=t}},{key:"putSamples",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=2*(e=e||0);n>=0||(n=(t.length-r)/2);var i=2*n;this.ensureCapacity(n+this._frameCount);var o=this.endIndex;this.vector.set(t.subarray(r,r+i),o),this._frameCount+=n}},{key:"putBuffer",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e=e||0,n>=0||(n=t.frameCount-e),this.putSamples(t.vector,t.position+e,n)}},{key:"receive",value:function(t){t>=0&&!(t>this._frameCount)||(t=this.frameCount),this._frameCount-=t,this._position+=t}},{key:"receiveSamples",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*e,r=this.startIndex;t.set(this._vector.subarray(r,r+n)),this.receive(e)}},{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=this.startIndex+2*e,i=2*n;t.set(this._vector.subarray(r,r+i))}},{key:"ensureCapacity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=parseInt(2*t);if(this._vector.length<e){var n=new Float32Array(e);n.set(this._vector.subarray(this.startIndex,this.endIndex)),this._vector=n,this._position=0}else this.rewind()}},{key:"ensureAdditionalCapacity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.ensureCapacity(this._frameCount+t)}},{key:"rewind",value:function(){this._position>0&&(this._vector.set(this._vector.subarray(this.startIndex,this.endIndex)),this._position=0)}},{key:"vector",get:function(){return this._vector}},{key:"position",get:function(){return this._position}},{key:"startIndex",get:function(){return 2*this._position}},{key:"frameCount",get:function(){return this._frameCount}},{key:"endIndex",get:function(){return 2*(this._position+this._frameCount)}}]),t}(),ve=function(){function t(e){ue(this,t),e?(this._inputBuffer=new ge,this._outputBuffer=new ge):this._inputBuffer=this._outputBuffer=null}return le(t,[{key:"clear",value:function(){this._inputBuffer.clear(),this._outputBuffer.clear()}},{key:"inputBuffer",get:function(){return this._inputBuffer},set:function(t){this._inputBuffer=t}},{key:"outputBuffer",get:function(){return this._outputBuffer},set:function(t){this._outputBuffer=t}}]),t}(),me=function(t){function e(t){var n;return ue(this,e),(n=de(this,he(e).call(this,t))).reset(),n._rate=1,n}return fe(e,t),le(e,[{key:"reset",value:function(){this.slopeCount=0,this.prevSampleL=0,this.prevSampleR=0}},{key:"clone",value:function(){var t=new e;return t.rate=this._rate,t}},{key:"process",value:function(){var t=this._inputBuffer.frameCount;this._outputBuffer.ensureAdditionalCapacity(t/this._rate+1);var e=this.transpose(t);this._inputBuffer.receive(),this._outputBuffer.put(e)}},{key:"transpose",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===t)return 0;for(var e=this._inputBuffer.vector,n=this._inputBuffer.startIndex,r=this._outputBuffer.vector,i=this._outputBuffer.endIndex,o=0,a=0;this.slopeCount<1;)r[i+2*a]=(1-this.slopeCount)*this.prevSampleL+this.slopeCount*e[n],r[i+2*a+1]=(1-this.slopeCount)*this.prevSampleR+this.slopeCount*e[n+1],a+=1,this.slopeCount+=this._rate;if(this.slopeCount-=1,1!==t)t:for(;;){for(;this.slopeCount>1;)if(this.slopeCount-=1,(o+=1)>=t-1)break t;var s=n+2*o;r[i+2*a]=(1-this.slopeCount)*e[s]+this.slopeCount*e[s+2],r[i+2*a+1]=(1-this.slopeCount)*e[s+1]+this.slopeCount*e[s+3],a+=1,this.slopeCount+=this._rate}return this.prevSampleL=e[n+2*t-2],this.prevSampleR=e[n+2*t-1],a}},{key:"rate",set:function(t){this._rate=t}}]),e}(ve),be=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;ue(this,t),this._pipe=e,this.inputSize=n}return le(t,[{key:"fillInputBuffer",value:function(){throw new Error("fillInputBuffer() not overridden")}},{key:"fillOutputBuffer",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.inputSize;this.outputBuffer.frameCount<t;){var n=e-this.inputBuffer.frameCount;if(this.fillInputBuffer(n),this.inputBuffer.frameCount<e)break;this._pipe.process()}}},{key:"clear",value:function(){this._pipe.clear()}},{key:"pipe",get:function(){return this._pipe}},{key:"inputBuffer",get:function(){return this._pipe.inputBuffer}},{key:"outputBuffer",get:function(){return this._pipe.outputBuffer}}]),t}(),_e=function(){},we=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1024,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_e;return ue(this,e),(r=de(this,he(e).call(this,n,i))).callback=o,r.sourceSound=t,r.historyBufferSize=22050,r._sourcePosition=0,r.outputBufferPosition=0,r._position=0,r}return fe(e,t),le(e,[{key:"onEnd",value:function(){this.callback()}},{key:"fillInputBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=new Float32Array(2*t),n=this.sourceSound.extract(e,t,this._sourcePosition);this._sourcePosition+=n,this.inputBuffer.putSamples(e,0,n)}},{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.fillOutputBuffer(this.outputBufferPosition+e);var n=Math.min(e,this.outputBuffer.frameCount-this.outputBufferPosition);this.outputBuffer.extract(t,this.outputBufferPosition,n);var r=this.outputBufferPosition+n;return this.outputBufferPosition=Math.min(this.historyBufferSize,r),this.outputBuffer.receive(Math.max(r-this.historyBufferSize,0)),this._position+=n,n}},{key:"handleSampleData",value:function(t){this.extract(t.data,4096)}},{key:"clear",value:function(){ye(he(e.prototype),"clear",this).call(this),this.outputBufferPosition=0}},{key:"position",get:function(){return this._position},set:function(t){if(t>this._position)throw new RangeError("New position may not be greater than current position");var e=this.outputBufferPosition-(this._position-t);if(e<0)throw new RangeError("New position falls outside of history buffer");this.outputBufferPosition=e,this._position=t}},{key:"sourcePosition",get:function(){return this._sourcePosition},set:function(t){this.clear(),this._sourcePosition=t}}]),e}(be),Ee=[[124,186,248,310,372,434,496,558,620,682,744,806,868,930,992,1054,1116,1178,1240,1302,1364,1426,1488,0],[-100,-75,-50,-25,25,50,75,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-20,-15,-10,-5,5,10,15,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-4,-3,-2,-1,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],ke=-10/1.5,Se=function(t){function e(t){var n;return ue(this,e),(n=de(this,he(e).call(this,t)))._quickSeek=!0,n.midBufferDirty=!1,n.midBuffer=null,n.overlapLength=0,n.autoSeqSetting=!0,n.autoSeekSetting=!0,n._tempo=1,n.setParameters(44100,0,0,8),n}return fe(e,t),le(e,[{key:"clear",value:function(){ye(he(e.prototype),"clear",this).call(this),this.clearMidBuffer()}},{key:"clearMidBuffer",value:function(){this.midBufferDirty&&(this.midBufferDirty=!1,this.midBuffer=null)}},{key:"setParameters",value:function(t,e,n,r){t>0&&(this.sampleRate=t),r>0&&(this.overlapMs=r),e>0?(this.sequenceMs=e,this.autoSeqSetting=!1):this.autoSeqSetting=!0,n>0?(this.seekWindowMs=n,this.autoSeekSetting=!1):this.autoSeekSetting=!0,this.calculateSequenceParameters(),this.calculateOverlapLength(this.overlapMs),this.tempo=this._tempo}},{key:"calculateOverlapLength",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t=(t=this.sampleRate*e/1e3)<16?16:t,t-=t%8,this.overlapLength=t,this.refMidBuffer=new Float32Array(2*this.overlapLength),this.midBuffer=new Float32Array(2*this.overlapLength)}},{key:"checkLimits",value:function(t,e,n){return t<e?e:t>n?n:t}},{key:"calculateSequenceParameters",value:function(){var t,e;this.autoSeqSetting&&(t=150+-50*this._tempo,t=this.checkLimits(t,50,125),this.sequenceMs=Math.floor(t+.5)),this.autoSeekSetting&&(e=28.333333333333332+ke*this._tempo,e=this.checkLimits(e,15,25),this.seekWindowMs=Math.floor(e+.5)),this.seekWindowLength=Math.floor(this.sampleRate*this.sequenceMs/1e3),this.seekLength=Math.floor(this.sampleRate*this.seekWindowMs/1e3)}},{key:"clone",value:function(){var t=new e;return t.tempo=this._tempo,t.setParameters(this.sampleRate,this.sequenceMs,this.seekWindowMs,this.overlapMs),t}},{key:"seekBestOverlapPosition",value:function(){return this._quickSeek?this.seekBestOverlapPositionStereoQuick():this.seekBestOverlapPositionStereo()}},{key:"seekBestOverlapPositionStereo",value:function(){var t,e,n,r=0;for(this.preCalculateCorrelationReferenceStereo(),t=0,e=Number.MIN_VALUE;r<this.seekLength;r+=1)(n=this.calculateCrossCorrelationStereo(2*r,this.refMidBuffer))>e&&(e=n,t=r);return t}},{key:"seekBestOverlapPositionStereoQuick",value:function(){var t,e,n,r,i,o=0;for(this.preCalculateCorrelationReferenceStereo(),e=Number.MIN_VALUE,t=0,r=0,i=0;o<4;o+=1){for(var a=0;Ee[o][a]&&!((i=r+Ee[o][a])>=this.seekLength);)(n=this.calculateCrossCorrelationStereo(2*i,this.refMidBuffer))>e&&(e=n,t=i),a+=1;r=t}return t}},{key:"preCalculateCorrelationReferenceStereo",value:function(){for(var t,e,n=0;n<this.overlapLength;n+=1)e=n*(this.overlapLength-n),t=2*n,this.refMidBuffer[t]=this.midBuffer[t]*e,this.refMidBuffer[t+1]=this.midBuffer[t+1]*e}},{key:"calculateCrossCorrelationStereo",value:function(t,e){var n=this._inputBuffer.vector;t+=this._inputBuffer.startIndex;for(var r,i=0,o=2,a=2*this.overlapLength;o<a;o+=2)i+=n[r=o+t]*e[o]+n[r+1]*e[o+1];return i}},{key:"overlap",value:function(t){this.overlapStereo(2*t)}},{key:"overlapStereo",value:function(t){var e=this._inputBuffer.vector;t+=this._inputBuffer.startIndex;for(var n,r,i,o,a,s=this._outputBuffer.vector,u=this._outputBuffer.endIndex,c=0,l=1/this.overlapLength;c<this.overlapLength;c+=1)r=(this.overlapLength-c)*l,i=c*l,o=(n=2*c)+t,s[(a=n+u)+0]=e[o+0]*i+this.midBuffer[n+0]*r,s[a+1]=e[o+1]*i+this.midBuffer[n+1]*r}},{key:"process",value:function(){var t,e,n;if(null===this.midBuffer){if(this._inputBuffer.frameCount<this.overlapLength)return;this.midBuffer=new Float32Array(2*this.overlapLength),this._inputBuffer.receiveSamples(this.midBuffer,this.overlapLength)}for(;this._inputBuffer.frameCount>=this.sampleReq;){t=this.seekBestOverlapPosition(),this._outputBuffer.ensureAdditionalCapacity(this.overlapLength),this.overlap(Math.floor(t)),this._outputBuffer.put(this.overlapLength),(e=this.seekWindowLength-2*this.overlapLength)>0&&this._outputBuffer.putBuffer(this._inputBuffer,t+this.overlapLength,e);var r=this._inputBuffer.startIndex+2*(t+this.seekWindowLength-this.overlapLength);this.midBuffer.set(this._inputBuffer.vector.subarray(r,r+2*this.overlapLength)),this.skipFract+=this.nominalSkip,n=Math.floor(this.skipFract),this.skipFract-=n,this._inputBuffer.receive(n)}}},{key:"tempo",set:function(t){var e;this._tempo=t,this.calculateSequenceParameters(),this.nominalSkip=this._tempo*(this.seekWindowLength-this.overlapLength),this.skipFract=0,e=Math.floor(this.nominalSkip+.5),this.sampleReq=Math.max(e+this.overlapLength,this.seekWindowLength)+this.seekLength},get:function(){return this._tempo}},{key:"inputChunkSize",get:function(){return this.sampleReq}},{key:"outputChunkSize",get:function(){return this.overlapLength+Math.max(0,this.seekWindowLength-2*this.overlapLength)}},{key:"quickSeek",set:function(t){this._quickSeek=t}}]),e}(ve),xe=function(t,e){return(t>e?t-e:e-t)>1e-10},Te=function(){function t(){ue(this,t),this.transposer=new me(!1),this.stretch=new Se(!1),this._inputBuffer=new ge,this._intermediateBuffer=new ge,this._outputBuffer=new ge,this._rate=0,this._tempo=0,this.virtualPitch=1,this.virtualRate=1,this.virtualTempo=1,this.calculateEffectiveRateAndTempo()}return le(t,[{key:"clear",value:function(){this.transposer.clear(),this.stretch.clear()}},{key:"clone",value:function(){var e=new t;return e.rate=this.rate,e.tempo=this.tempo,e}},{key:"calculateEffectiveRateAndTempo",value:function(){var t=this._tempo,e=this._rate;this._tempo=this.virtualTempo/this.virtualPitch,this._rate=this.virtualRate*this.virtualPitch,xe(this._tempo,t)&&(this.stretch.tempo=this._tempo),xe(this._rate,e)&&(this.transposer.rate=this._rate),this._rate>1?this._outputBuffer!=this.transposer.outputBuffer&&(this.stretch.inputBuffer=this._inputBuffer,this.stretch.outputBuffer=this._intermediateBuffer,this.transposer.inputBuffer=this._intermediateBuffer,this.transposer.outputBuffer=this._outputBuffer):this._outputBuffer!=this.stretch.outputBuffer&&(this.transposer.inputBuffer=this._inputBuffer,this.transposer.outputBuffer=this._intermediateBuffer,this.stretch.inputBuffer=this._intermediateBuffer,this.stretch.outputBuffer=this._outputBuffer)}},{key:"process",value:function(){this._rate>1?(this.stretch.process(),this.transposer.process()):(this.transposer.process(),this.stretch.process())}},{key:"rate",get:function(){return this._rate},set:function(t){this.virtualRate=t,this.calculateEffectiveRateAndTempo()}},{key:"rateChange",set:function(t){this._rate=1+.01*t}},{key:"tempo",get:function(){return this._tempo},set:function(t){this.virtualTempo=t,this.calculateEffectiveRateAndTempo()}},{key:"tempoChange",set:function(t){this.tempo=1+.01*t}},{key:"pitch",set:function(t){this.virtualPitch=t,this.calculateEffectiveRateAndTempo()}},{key:"pitchOctaves",set:function(t){this.pitch=Math.exp(.69314718056*t),this.calculateEffectiveRateAndTempo()}},{key:"pitchSemitones",set:function(t){this.pitchOctaves=t/12}},{key:"inputBuffer",get:function(){return this._inputBuffer}},{key:"outputBuffer",get:function(){return this._outputBuffer}}]),t}(),Pe=function(){function t(e){ue(this,t),this.buffer=e,this._position=0}return le(t,[{key:"extract",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.position=n;for(var r=this.buffer.getChannelData(0),i=this.dualChannel?this.buffer.getChannelData(1):this.buffer.getChannelData(0),o=0;o<e;o++)t[2*o]=r[o+n],t[2*o+1]=i[o+n];return Math.min(e,r.length-n)}},{key:"dualChannel",get:function(){return this.buffer.numberOfChannels>1}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}}]),t}(),Re=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4096,i=t.createScriptProcessor(r,2,2),o=new Float32Array(2*r);return i.onaudioprocess=function(t){var i=t.outputBuffer.getChannelData(0),a=t.outputBuffer.getChannelData(1),s=e.extract(o,r);n(e.sourcePosition),0===s&&e.onEnd();for(var u=0;u<s;u++)i[u]=o[2*u],a[u]=o[2*u+1]},i},Le=function(t){var e,n,r,i=Math.floor(t/60),o=t-60*i;return"".concat(i,":").concat((e=parseInt(o),r=r||"0",(e+="").length>=(n=2)?e:new Array(n-e.length+1).join(r)+e))},Ae=function(t){var e=this.timePlayed,n=this.sampleRate;if(this.sourcePosition=t,this.timePlayed=t/n,e!==this.timePlayed){var r=new CustomEvent("play",{detail:{timePlayed:this.timePlayed,formattedTimePlayed:this.formattedTimePlayed,percentagePlayed:this.percentagePlayed}});this._node.dispatchEvent(r)}};!function(){function t(e,n,r){var i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_e;ue(this,t),this._soundtouch=new Te;var a=new Pe(n);this.timePlayed=0,this.sourcePosition=0,this._filter=new we(a,this._soundtouch,o),this._node=Re(e,this._filter,(function(t){return Ae.call(i,t)})),this.tempo=1,this.rate=1,this.duration=n.duration,this.sampleRate=e.sampleRate,this.listeners=[]}le(t,[{key:"connect",value:function(t){this._node.connect(t)}},{key:"disconnect",value:function(){this._node.disconnect()}},{key:"on",value:function(t,e){this.listeners.push({name:t,cb:e}),this._node.addEventListener(t,(function(t){return e(t.detail)}))}},{key:"off",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.listeners;e&&(n=n.filter((function(t){return t.name===e}))),n.forEach((function(e){t._node.removeEventListener(e.name,(function(t){return e.cb(t.detail)}))}))}},{key:"formattedDuration",get:function(){return Le(this.duration)}},{key:"formattedTimePlayed",get:function(){return Le(this.timePlayed)}},{key:"percentagePlayed",get:function(){return 100*this._filter.sourcePosition/(this.duration*this.sampleRate)},set:function(t){this._filter.sourcePosition=parseInt(t*this.duration*this.sampleRate)}},{key:"node",get:function(){return this._node}},{key:"pitch",set:function(t){this._soundtouch.pitch=t}},{key:"pitchSemitones",set:function(t){this._soundtouch.pitchSemitones=t}},{key:"rate",set:function(t){this._soundtouch.rate=t}},{key:"tempo",set:function(t){this._soundtouch.tempo=t}}])}();function Be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var De=function(t){l()(n,t);var e=Be(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"soundTouch",void 0),g()(u()(r),"filter",void 0),r.init(t.source),r}return a()(n,[{key:"init",value:function(t){this.soundTouch=new Te,this.soundTouch.tempo=1,this.soundTouch.rate=1,this.filter=new we(t,this.soundTouch,2048)}},{key:"rate",set:function(t){this.soundTouch.tempo=t}},{key:"provide",value:function(t){for(var e=new Float32Array(2*t),n=this.filter.extract(e,t),r=new Float32Array(n),i=new Float32Array(n),o=0;o<n;o++)r[o]=e[2*o],i[o]=e[2*o+1];return{size:n,left:r,right:i}}}]),n}(C.a);function Ie(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Oe=function(t){l()(n,t);var e=Ie(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"currentRate",1),g()(u()(r),"source",[]),g()(u()(r),"commonProcessor",void 0),g()(u()(r),"rateProcessor",void 0),g()(u()(r),"audioTime",0),r.source=t.source,r.init(),r}return a()(n,[{key:"init",value:function(){var t=this;this.commonProcessor=new se({source:this.source,onPlay:function(e){t.audioTime=e}}),this.rateProcessor=new De({source:this.commonProcessor})}},{key:"rate",set:function(t){this.currentRate=t,this.rateProcessor.rate=t}},{key:"provide",value:function(t){var e=(1===this.currentRate?this.commonProcessor:this.rateProcessor).provide(t);return e.audioTime=this.audioTime,e}}]),n}(C.a);function Ce(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ne="canplaythrough",Fe="seeked",Me="waiting",Ue=null,je=0,He=function(t){l()(n,t);var e=Ce(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"audioContext",null),g()(u()(r),"scriptNode",null),g()(u()(r),"gainNode",null),g()(u()(r),"delay",0),g()(u()(r),"audioBuffer",new ArrayBuffer(0)),g()(u()(r),"decodedBuffer",[]),g()(u()(r),"isFirstPlay",!0),g()(u()(r),"defaultVolume",1),g()(u()(r),"currentRate",1),g()(u()(r),"eventListeners",{}),g()(u()(r),"canPlay",!1),g()(u()(r),"interval",void 0),g()(u()(r),"seekTimeDelta",0),g()(u()(r),"audioTime",0),g()(u()(r),"audioProvider",void 0),g()(u()(r),"isWaiting",!1),t=Object.assign({},t),r.flushTime=t.flushTime||1e3,r.onReady=t.onReady,r.init(),r}return a()(n,[{key:"init",value:function(){this.audioProvider=new Oe({source:this.decodedBuffer}),this.initAudioContext(),"function"==typeof this.onReady&&setTimeout(this.onReady,0)}},{key:"initAudioContext",value:function(){var t=this;this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.defaultVolume,this.scriptNode=this.audioContext.createScriptProcessor(4096,2,2),this.scriptNode.onaudioprocess=function(e){var n=e.outputBuffer,r=n.length,i=t.audioProvider.provide(r);if(0!==i.size){t.isWaiting&&(t.isWaiting=!1,t.triggerEvent(Ne));var o=n.getChannelData(0),a=n.getChannelData(1);if(0!=i.audioTime&&(t.audioTime=i.audioTime),o.set(i.left),a.set(i.right),i.size<r){var s=new Float32Array(r-i.size);o.set(s,i.size),a.set(s,i.size)}}else t.isWaiting||(t.isWaiting=!0,t.triggerEvent(Me))},this.decodeAudioData.call(this,this.testAutoplay.bind(this)),this.interval=setInterval(this.decodeAudioData.bind(this),this.flushTime)}},{key:"feed",value:function(t){var e=t.audio;this.audioBuffer=this.appendByteArray(this.audioBuffer,e),this.canPlay||(this.canPlay=!0,this.triggerEvent(Ne))}},{key:"appendByteArray",value:function(t,e){var n=new Uint8Array((0|t.byteLength)+(0|e.byteLength));return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),0|t.byteLength),n.buffer}},{key:"decodeAudioData",value:function(t){var e=this,n=performance.now();this.checkBuffer()&&n-je>2e3&&(je=n),this.audioBuffer&&this.audioBuffer.byteLength>0&&(this.audioContext.decodeAudioData(this.audioBuffer,(function(n){n.startTime=e.delay,e.delay+=n.duration,e.decodedBuffer.push(n),t&&t.call(),e.isWaiting&&(clearTimeout(Ue),Ue=setTimeout((function(){e.isWaiting=!1,e.triggerEvent(Ne)}),200))}),(function(t){e.logger.error("decodeAudioData",t)})),this.audioBuffer=new ArrayBuffer(0))}},{key:"play",value:function(){var t=this;return new Promise((function(e,n){t.isFirstPlay&&(t.isFirstPlay=!1,t.logger.info("startPlay"),t.scriptNode.connect(t.gainNode),t.gainNode.connect(t.audioContext.destination)),"suspended"===t.audioContext.state?t.audioContext.resume().then((function(){t.logger.info("play","Audio is resumed"),e()})):(t.logger.info("Audio resumed from waiting"),e())}))}},{key:"checkBuffer",value:function(){var t=this.decodedBuffer.length,e=this.decodedBuffer[t-1];return!!e&&e.startTime+e.duration-this.options.player.currentTime/1e3<2}},{key:"currentTime",get:function(){return this.audioTime},set:function(t){var e=this;for(this.audioTime=t;this.decodedBuffer.length>0;){var n=this.decodedBuffer.shift();if(n.startTime<=t&&n.startTime+n.duration>t){n.loadedPosition=parseInt(n.length*(t-n.startTime)/n.duration,10),this.decodedBuffer.unshift(n);break}}setTimeout((function(){e.triggerEvent(Fe)}),0)}},{key:"pause",value:function(){var t=this;this.audioContext&&"running"===this.audioContext.state&&this.audioContext.suspend().then((function(){t.logger.info("pause","Audio is paused")}))}},{key:"addEventListener",value:function(t,e){this.eventListeners[t]=e}},{key:"triggerEvent",value:function(t){var e=this.eventListeners[t];e&&e.call()}},{key:"buffer",value:function(){var t=0;this.decodedBuffer.length>0&&(t=this.decodedBuffer[0].startTime);return{start:1e3*t,end:parseInt(1e3*this.delay)}}},{key:"volume",get:function(){return this.gainNode.gain.value},set:function(t){this.gainNode?this.gainNode.gain.value=t:this.defaultVolume=t}},{key:"destroy",value:function(){this.delay=0,this.audioContext&&(clearInterval(this.interval),this.scriptNode.disconnect(),this.scriptNode=null,this.audioContext.close(),this.audioContext=null),this.gainNode=null,this.audioBuffer=new ArrayBuffer(0),this.canPlay=!1,this.isFirstPlay=!0,this.decodedBuffer.length=0,this.seekTimeDelta=0,this.audioTime=0}},{key:"playbackRate",set:function(t){t!==this.currentRate&&(this.currentRate=t,this.audioProvider.rate=t)}},{key:"testAutoplay",value:function(t,e){var n=R.createEl("audio"),r=n.play();n=null;var i=!1;void 0!==r?(r.catch((function(){i=!0})),setTimeout((function(){r=null,i?e("Autoplay is prevented"):t()}),100)):e("Promise is undefined")}}]),n}(C.a);function ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var We=function(t){l()(n,t);var e=ze(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"need",!0),g()(u()(t),"first",!1),g()(u()(t),"offset",0),g()(u()(t),"currentPTS",0),g()(u()(t),"ready",!1),g()(u()(t),"end",!1),g()(u()(t),"lastData",null),g()(u()(t),"nodeParent",null),g()(u()(t),"useJMuxer",!1),t.player=r.audioNode,t.createAudioMuxer(),t.bindEvent(),t.logger.info("audioDecoder",t.useJMuxer?"JMuxer":"AudioContext"),t}return a()(n,[{key:"bindEvent",value:function(){var t=this;this.bindNodeEvent(),this.events.on(ot.default.PlayerMaxPTS,(function(e){t.currentPTS===e&&(t.end=!0)}))}},{key:"bindNodeEvent",value:function(){var t=this;this.addEventListener("seeked",(function(){t.onSeekedHandler&&t.onSeekedHandler(),t.events.emit("AudioPlayer.seeked")})),this.addEventListener("canplaythrough",(function(){t.logger.info("canplaythrough"),t.ready||(t.ready=!0,t.status="ready",t.logger.info("constructor","canplaythrough","ready"),t.events.emit(ot.default.AudioPlayerDataReady))})),this.addEventListener("waiting",(function(){t.pause(),t.ready=!1;var e=Math.trunc(t.options.player.duration-t.options.player.currentTime/1e3)<2;t.end||e?(t.useJMuxer||t.player.destroy(),t.status="end",t.events.emit(ot.default.AudioPlayerEnd,"audio"),t.logger.info("audioPlayer end")):(t.logger.warn("audioPlayer waiting",t.player.currentTime,t.currentPTS),t.status="waiting",t.events.emit(ot.default.AudioPlayerWait,"audio"),setTimeout((function(){t.ready=!0,t.status="ready",t.events.emit(ot.default.AudioPlayerDataReady)}),200))}))}},{key:"reset",value:function(){if(this.need){var t=this.volume,e=this.playbackRate;this.pause(),this.lastData=null,this.first=!1,this.offset=0,this.currentPTS=0,this.ready=!1,this.end=!1,this.clear(),this.createAudioMuxer(),this.bindNodeEvent(),this.stime=null,this.volume=t,this.playbackRate=e}else this.events.emit(ot.default.AudioPlayerReady)}},{key:"createNode",value:function(){this.player=document.createElement("audio"),this.player.classList.add("goldplay__audio--player"),this.parentNode.appendChild(this.player)}},{key:"createAudioMuxer",value:function(){this.useJMuxer?this.audioDecoder=new oe({node:this.player,mode:"audio",debug:!1,clearBuffer:!0,flushingTime:10,onReady:this.onMSEReady.bind(this)}):(this.audioDecoder=new He({flushTime:100,onReady:this.onMSEReady.bind(this),player:this.options.player}),this.player=this.audioDecoder)}},{key:"onMSEReady",value:function(){this.logger.info("onMSEReady","AudioPlayerReady"),this.events.emit(ot.default.AudioPlayerReady)}},{key:"clear",value:function(){this.audioDecoder.destroy(),this.audioDecoder=null}},{key:"play",value:function(){var t=this;"playing"!==this.status&&(this.status="playing",this.player.play().then((function(){t.events.emit(ot.default.AudioPlayerPlaySuccess)})).catch((function(e){t.logger.error("play","errorInfo:",e),t.events.emit(ot.default.AudioPlayerPlayFail)})))}},{key:"muted",get:function(){return this.player.muted},set:function(t){this.player.muted=!!t}},{key:"playbackRate",get:function(){return this.player.playbackRate},set:function(t){this.player.playbackRate=t}},{key:"pause",value:function(){"pause"!==this.status&&(this.status="pause",this.player.pause())}},{key:"volume",get:function(){return this.player.volume},set:function(t){this.player.volume=t,this.muted=0===t}},{key:"currentTime",get:function(){return parseInt(1e3*this.player.currentTime+this.offset)},set:function(t){this.player.currentTime=(t-this.offset)/1e3}},{key:"paused",get:function(){return this.player.paused}},{key:"send",value:function(t){if(!t.PTS)return this.need=!1,void this.events.emit(ot.default.AudioPlayerDataReady);if(this.need=!0,this.audioDecoder){if(this.stime||(this.stime=Date.now()),(t=this.format(t)).audioEnd)return this.logger.info("push","audioEnd"),this.feed(this.lastData),void(this.lastData=null);if(this.first||(this.first=!0,this.offset=t.start),t.PTS>this.currentPTS){if(!this.lastData)return void(this.lastData=t);this.lastData.duration=t.PTS-this.lastData.PTS,this.feed(this.lastData),t.duration=this.lastData.duration,this.lastData=t}}else this.logger.error("send","audioDecoder is:",this.audioDecoder)}},{key:"feed",value:function(t){this.audioDecoder.feed({pts:t.PTS,audio:t.data_byte,duration:t.duration}),this.currentPTS=t.PTS}},{key:"format",value:function(t){return t&&t.data_byte&&(t.start=t.PTS),t}},{key:"addEventListener",value:function(t,e){this.player.addEventListener(t,e)}},{key:"isBuffered",value:function(t){return!this.need||-1!==[this.buffer()].findIndex((function(e){return t>=e.start&&t<e.end}))}},{key:"buffer",value:function(){if(this.useJMuxer){for(var t=this.player.buffered,e=t.length,n={};e>0;)n.start=1e3*t.start(e-1)+this.offset,n.end=1e3*t.end(e-1)+this.offset,e--;return n}var r=this.player.buffer();return{start:r.start+this.offset,end:r.end+this.offset}}},{key:"offset",set:function(t){this.offset=t}}]),n}(C.a),Ve={playerContainer:"goldplay__container",screenContainer:"goldplay__screen--container",screenCanvas:"goldplay__screen--canvas",audioContainer:"goldplay__audio--container",audioPlayer:"goldplay__audio--player",controlContainer:"goldplay__control--container",containerFullPage:"goldplay__container-fullpage",containerFullScreen:"goldplay__container-fullscreen",controlContainerFloat:"goldplay__control--container-float",bigPlayButton:"goldplay__screen--bigplay",poster:"goldplay__screen--poster",nearside:"goldplay__control--nearside",sidebar:"goldplay__control--sidebar",buttonBlock:"goldplay__control--button-block",playButton:"goldplay__control--play",pauseButton:"goldplay__control--pause",replayButton:"goldplay__control--replay",speedBar:"goldplay__speed-bar",speedBarBox:"goldplay__speed-bar--box",rateBar:"goldplay__rate-bar",rateBarBox:"goldplay__rate-bar--box",fullPage:"goldplay__control--fullpage",fullScreen:"goldplay__control--fullscreen",waitingBar:"goldplay__waiting-bar",progressBar:"goldplay__progress-bar",progressBarHover:"goldplay__progress-bar-hover",progressBarPlay:"goldplay__progressbar--play",progressBarPlayHover:"goldplay__progressbar--play-hover",progressBarLoad:"goldplay__progressbar--load",progressBarLoadHover:"goldplay__progressbar--load-hover",progressBarDot:"goldplay__progressbar--dot",progressBarDotHover:"goldplay__progressbar--dot-hover",volumeBar:"goldplay__volume-bar",volumeBarAudio:"goldplay__volume-bar--audio",volumeBarAudioOn:"goldplay__volume-bar--audio-on",volumeBarAudioOff:"goldplay__volume-bar--audio-off",volumeBarHandle:"goldplay__volume-bar--handle",volumeBarRod:"goldplay__volume-bar--rod",volumeBarRodHover:"goldplay__volume-bar--rod-hover",volumeBarSize:"goldplay__volume-bar--size",volumeBarColumn:"goldplay__volume-bar--column",alertBox:"goldplay__alter-box",alertClose:"goldplay__alter--close"};function $e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Xe=Ve,Ye=function(){function t(){i()(this,t)}return a()(t,null,[{key:"createContainer",value:function(t){var e=function(t){l()(n,t);var e=$e(n);function n(){return i()(this,n),e.apply(this,arguments)}return n}(K()(HTMLDivElement)),n="gp-container";customElements.get(n)||customElements.define(n,e,{extends:"div"});var r=R.createEl(n,"div");return r.className=Xe.playerContainer,r.style.width=(t.options.width?t.options.width:t.el.offsetWidth)+"px",r.style.height=(t.options.height?t.options.height:t.el.offsetHeight)+"px",r}},{key:"createScreenContainer",value:function(t){var e=t.$container,n=function(t){l()(n,t);var e=$e(n);function n(){return i()(this,n),e.apply(this,arguments)}return n}(K()(HTMLDivElement)),r="gp-screen";customElements.get(r)||customElements.define(r,n,{extends:"div"});var o,a=R.createEl(r,"div");return a.classList.add(Xe.screenContainer),o=t.controlBarAutoHide||!1===t.controlBar?e.offsetHeight:e.offsetHeight-t.controlBarHeight,t.screenWidth=e.offsetWidth,t.screenHeight=o,a.style.height=o+"px",a}},{key:"createAudioContainer",value:function(){var t=R.createEl("gp-audio");return t.classList.add(Xe.audioContainer),t.style.display="none",t}},{key:"createAudio",value:function(){var t=R.createEl("audio");return t.classList.add(Xe.audioPlayer),t.controls=!0,t}},{key:"clearCavans",value:function(t){var e=t.getContext("webgl");e.clear(e.COLOR_BUFFER_BIT)}}]),t}();g()(Ye,"createCanvas",(function(t){var e=R.createEl("canvas");return e.style.display="none",e.classList.add(Xe.screenCanvas),e.width=t.options.screenWidth||t.screenWidth,e.height=t.options.screenHeight||t.screenHeight,e}));var qe=T.a.get("Template.js"),Ge=function(){function t(){i()(this,t)}return a()(t,null,[{key:"mergeVar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof t||""===t)return t;try{var n=new RegExp("\\${'?\"?\\s*([.:a-z0-9_s]+?)\\s*'?\"?}","ig");return t.replace(n,(function(t,n){n=n.trim();var r=e[n];return r=(r=void 0===(r=null===r?"":r)?"":r)||""}))}catch(e){return qe.error("mergeVar","replace variable","error:",e),t}}},{key:"makeValue",value:function(e,n,r){if("string"!=typeof n&&"function"!=typeof n)return n;if("function"==typeof n&&(n=n.call(this,this.data)),!r)return t.escapeHTML.call(this,n);var i,o=function(e){var n="";return e&&(n=" ".concat(t.slotReplaceName,'="true"')),'<gp-slot style="display:none"'.concat(n,"></gp-slot>")};if(t.isSoltType(r)){if("function"!=typeof this.getComponent)return qe.error("makeValue","the object is not support slot mode.",this.getComponent,n),n;switch(r){case t.slotTypeMap.component:i=n;var a=this.getComponent(i);"object"===x()(a)&&a.element?(a.element.setAttribute(t.slotReplaceName,"true"),n=a.element.outerHTML):n=o(i);break;case t.slotTypeMap.html:n=t.mergeVar.call(this,n,this.data)}var s="";void 0!==i&&(s=" ".concat(t.slotComName,'="').concat(i,'" '));var u="$1 "+t.slotTypeName+'="'+r+'" '+t.slotKeyName+'="'+e+'"'+s+"$2";return"string"==typeof n&&(n=(n=""===n?o():n).replace(/^\s*(<\s?[\w-]*)(.*[\r|\n|>])/,u)),n}if("string"==typeof r){var c=Ze[r];return"function"==typeof c&&(n=c.call(this,n)),n}return t.escapeHTML.call(this,n)}},{key:"escapeHTML",value:function(t){return"string"!=typeof t?t:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},{key:"generate",value:function(e,n,r){var i=this,o=r[r.length-1]||{},a=[e[0]];return n.forEach((function(n,s){if(n){var u,c,l=n.split(t.pipSeparator);l.length>1&&(n=l[0],c=l[1]),u=Number.isInteger(n)?r[n]:o[n],void 0!==(u=t.makeValue.bind(i)(n,u,c))&&a.push(u),void 0!==e[s+1]&&a.push(e[s+1])}})),a.join("")}},{key:"create",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o;o=Array.isArray(e)?"array":"function"==typeof e?"function":"string";var a=this;if("object"===x()(a)||"function"==typeof a)if(void 0!==e&&""!==e)switch(void 0!==a.data&&null!==a.data||(qe.info("create","this object.data is undefined or null",a),a.data={}),o){case"array":return function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var s=i[i.length-1]||{};"object"===x()(a)&&(a.__template__={tplObj:e,keys:r,dict:s});var u=t.generate.bind(a);return u(e,r,i)};case"function":var s=t.create.bind(a);return e.call(a,a.data,s,a);default:return function(n){return n=void 0!==n?n:a.data,t.mergeVar(e,n)}}else qe.error("create","have not give tplObj parameter.",e);else qe.error("create","this is not an object.",a)}},{key:"isSoltType",value:function(e){return e=String(e).toLowerCase(),t.slotTypeMap[e]}}]),t}();Ge.pipSeparator="|",Ge.slotTypeName="gp-slot-type",Ge.slotKeyName="gp-slot-key",Ge.slotComName="gp-slot-com",Ge.slotReplaceName="gp-slot-replace",Ge.slotTypeMap={html:"html",component:"component"};var Ze={trim:function(t){return t.trim()},upperCase:function(t){return t.toUpperCase()},lowerCase:function(t){return t.toLowerCase()}},Ke=Ge,Je=n(15),Qe=n.n(Je),tn=n(12),en=n.n(tn),nn=T.a.get("Observer.js"),rn=function(){function t(e){i()(this,t),g()(this,"object",null),this.setObject(e)}var e;return a()(t,[{key:"setObject",value:function(t){this.object=t}},{key:"watch",value:(e=Qe()(en.a.mark((function t(e,n,r){var i;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"==typeof(i=this.object).watch){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,i.watch(e,n,r);case 5:!1!==t.sent&&"function"==typeof i.render&&i.render(e,n,r),"function"==typeof i.afterWatch&&i.afterWatch(e,n,r);case 8:case"end":return t.stop()}}),t,this)}))),function(t,n,r){return e.apply(this,arguments)})},{key:"create",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,r=e.set,i=e.get;t=t||n.data;var o=n.object,a={set:function(t,e,i){return"function"==typeof r?r.call(n,t,e,i):(t[e]!==i&&(t[e]=i,o.__template__&&Object.prototype.hasOwnProperty.call(o.__template__.dict,e)&&n.watch(t,e,i)),!0)},get:function(t,e){return"function"==typeof i?i.call(n,t,e):"object"===x()(t[e])&&null!==t[e]?new Proxy(t[e],a):Reflect.get(t,e)}};return new Proxy(t,a)}}]),t}(),on=function(t){return"object"!==x()(t)&&nn.error("observer","this is not an object."),new rn(t)};function an(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return sn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sn(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function sn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function un(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}function cn(t){if(t){var e=[],n=[];for(n.push(t);n.length;){var r=n.shift(),i=r.getAttribute(Ke.slotTypeName);if(!Ke.isSoltType(i)){e.push(r);for(var o=r.children,a=0,s=o.length;a<s;a++)n.push(o[a])}}return e}}var ln,fn=function(t){return t.getAttribute&&t.getAttribute(Ke.slotTypeName)===Ke.slotTypeMap.html},hn=function(t,e){return!(!(n=t).getAttribute||n.getAttribute(Ke.slotTypeName)!==Ke.slotTypeMap.component||t.getAttribute(Ke.slotComName)===e.getAttribute(Ke.slotComName));var n},pn=function(t,e,n){var r;(t||e)&&(!t&&e?n.appendChild(e):!e&&t?n.removeChild(t):t.tagName!==e.tagName||(r=e,fn(t)&&fn(r))||hn(t,e)?t.replaceWith(e.cloneNode(!0)):t.nodeType===Node.TEXT_NODE&&t.nodeValue!==e.nodeValue?t.nodeValue=e.nodeValue:t.setAttribute&&R.setAttributes(t,e))},dn=function(t){l()(n,t);var e=un(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"createTemplate",null),g()(u()(t),"template",""),g()(u()(t),"element",null),g()(u()(t),"eventsList",{}),g()(u()(t),"data",{}),g()(u()(t),"id",""),t.id=r.id||t.constructor.name,t.options=r,t.createTemplate=Ke.create.bind(u()(t)),t}return a()(n,[{key:"getTemplate",value:function(){return this.template}},{key:"setTemplate",value:function(t){this.template=t}},{key:"init",value:function(){this.data=on(this).create(this.data),this.render(),"function"==typeof this.afterInit&&this.afterInit()}},{key:"afterInit",value:function(){}},{key:"initProps",value:function(){}},{key:"bindEvent",value:function(){}},{key:"watch",value:function(){}},{key:"render",value:function(){var t="";t="function"==typeof this.template?this.template(this.data):this.template;var e=R.createEl("div");if("string"==typeof t){e.innerHTML=t;var n,r=e.firstElementChild,i=an(r.querySelectorAll("["+Ke.slotReplaceName+"]"));try{for(i.s();!(n=i.n()).done;){var o=n.value;if("true"===o.getAttribute(Ke.slotReplaceName)){var a=o.getAttribute(Ke.slotComName),s=this.getComponent(a);if(!s)continue;var u=s.element;R.isElement(this.element)?o.replaceWith(u.cloneNode(!0)):o.replaceWith(u),s.element.removeAttribute(Ke.slotReplaceName)}}}catch(t){i.e(t)}finally{i.f()}R.isElement(this.element)?this.replaceNode(this.element,r):this.element=r}else this.logger.error("render:","this template is not html string","html:",t)}},{key:"replaceNode",value:function(t,e){if(t&&e){var n=cn(t),r=cn(e),i=n.length,o=r.length,a=Math.max(i,o);if(a<=0||t.tagName!==e.tagName)return t.replaceWith(e),void(this.element=e);for(;a--;){var s=n[a],u=r[a];if(s)if(u){if(s.tagName===u.tagName&&R.syncAttributes(s,u),!s.isEqualNode(u)){var c=Math.max(s.childNodes.length,u.childNodes.length);if(c<=0)pn(s,u,s.parentNode);else for(var l=0,f=c;l<f;l++){var h=s.childNodes[l],p=u.childNodes[l];(h||p)&&pn(h,p,s)}}}else s.parentNode.removeChild(s);else t.appendChild(u)}}}},{key:"show",value:function(){this.data.display="show",this.element&&(this.element.style.display="inline-block")}},{key:"hide",value:function(){this.data.display="hide",this.element&&(this.element.style.display="none")}},{key:"resetPosition",value:function(){var t=this.element.parentNode,e=t.offsetWidth,n=t.offsetHeight;this.element.style.marginTop=(n-this.element.offsetHeight)/2+"px",this.element.style.marginLeft=(e-this.element.offsetWidth)/2+"px"}},{key:"replace",value:function(t){this.element.replaceWith(t),this.element=t}},{key:"update",value:function(t){this.element.innerHTML=t}},{key:"addEventListener",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,n,r),{destroy:function(){t.removeEventListener(e,n)}}}},{key:"removeEventListenerAll",value:function(){var t=this;Object.keys(this.eventsList).forEach((function(e){t.eventsList[e].destroy()}))}},{key:"getComponent",value:function(t){if(void 0!==t)return this.options.componentsController?this.options.componentsController.getComponent(t):void 0}},{key:"getHTMLString",value:function(){return this.element.outerHTML}},{key:"destroy",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.events.emit("Component_"+this.id+".destroy",this),this.removeEventListenerAll()}}]),n}(C.a),yn=n(8),gn=n.n(yn),vn={formatHHMMSS:function(t){var e=parseInt(t,10),n=Math.floor(e/3600),r=Math.floor((e-3600*n)/60),i=e-3600*n-60*r;n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i);var o="";return"00"!==n&&(o=n+":"),o+r+":"+i}},mn={formatBytes:function(t,e){if(0==t)return"0 Bytes";var n=e<=0?0:e||2,r=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,r)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]}};function bn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var _n,wn=function(t){l()(n,t);var e=bn(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(ln||(ln=gn()(['\n  <gp-poster class="goldplay__screen--poster">\n  <img src="','" width="','" data-display="','" heigth="','" class="goldplay__screen--poster-image">\n  </gp-poster>\n  '])),"poster","width","display","height")),g()(u()(t),"data",{poster:"",status:"",display:"show",speed:"",width:"",height:""}),g()(u()(t),"options",{}),t.options=r,r.player.poster&&(t.data.poster=r.player.poster),Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"resetPosition",value:function(){if(this.element){var t=this.element.parentNode.offsetWidth,e=this.element.parentNode.offsetHeight;this.element.style.width=t+"px",this.element.style.marginTop=(e-this.element.offsetHeight-20)/2+"px"}}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.LoaderUpdateSpeed,(function(e){"show"===t.data.display&&(t.data.speed=mn.formatBytes(e.speed)+" /s")}))}},{key:"hide",value:function(){"hide"!==this.data.display&&(this.element.style.opacity=0,this.element.style.display="none",this.data.display="hide")}}]),n}(dn);function En(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var kn=function(t){l()(n,t);var e=En(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(_n||(_n=gn()(['\n    <gp-control class="goldplay__control--container ','" style="width:',"px;height:","px;opacity:",'" data-status="','">\n      ',"\n      ","\n      ","\n    </gp-control>\n  "])),"containerFloatCss","width","height","opacity","status","progressBarName|component","sideControlBarName|component","nearControlBarName|component")),g()(u()(t),"hideDelayTime",void 0),g()(u()(t),"hideTimeCount",void 0),g()(u()(t),"data",{progressBarName:"progressBar",sideControlBarName:"sideControlBar",nearControlBarName:"nearControlBar",width:"",height:"",opacity:1,containerFloatCss:"",display:"show",status:""}),g()(u()(t),"options",{}),t.options=r,t.hideDelayTime=t.options.player.controlBarAutoHideTime||3,r.player.controlBarAutoHide&&(t.data.containerFloatCss=t.options.cssName.controlContainerFloat,t.resetPosition()),Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"initProps",value:function(){this.hideTimeCount=this.hideDelayTime}},{key:"bindEvent",value:function(){var t=this,e=this.options;e.player.controlBarAutoHide&&(e.$container.addEventListener("mousemove",(function(){t.hideTimeCount<=0&&(t.data.display="show",t.show()),t.hideTimeCount=t.hideDelayTime})),setInterval((function(){t.hideTimeCount>0?t.hideTimeCount-=1:"hide"!==t.data.display&&(t.data.display="hide",t.hide())}),100))}},{key:"setSize",value:function(t,e){void 0!==t&&(this.data.width=t),void 0!==e&&(this.data.height=e)}},{key:"show",value:function(){var t,e=this;this.options.player.controlBarAutoHide?(clearTimeout(t),t=setTimeout((function(){e.data.opacity=1}),1)):this.data.opacity=1}},{key:"hide",value:function(){this.data.opacity=0}},{key:"resetPosition",value:function(){this.setSize(this.options.$container.offsetWidth,this.options.player.controlBarHeight)}}]),n}(dn),Sn=T.a.get("Delegator.js");function xn(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:"object"===x()(t)&&(1===t.nodeType&&"string"==typeof t.nodeName)}function Tn(t){t.preventDefault(),t.stopPropagation()}function Pn(t,e,n,r,i){var o=function(t,e){if(t&&t.matches){if(!Array.isArray(e))return t.matches(e);for(var n=0,r=e.length;n<r;n++)if(t.matches(e[n]))return!0}return!1};function a(t){for(var e=(t=t||window.event).target||t.srcElement,i=t.currentTarget,a=!0;a&&e!==i&&e;){if(o(e,n)&&(a=!1!==r.call(e,t)),!a)return void Tn(t);e=e.parentNode}}r.__delegateWrapper=a,function(t,e,n,r){void 0===r&&(r="blur"===e||"focus"===e),xn(t)&&t.addEventListener(e,n,r)}(t,e,a,i)}var Rn,Ln=function(){function t(e){return i()(this,t),g()(this,"element",null),xn(e)?this.element=e:Sn.error("constructor","new instance","element:",this.element),this}return a()(t,[{key:"off",value:function(t,e,n){return e.__delegateWrapper&&delete(e=e.__delegateWrapper).__delegateWrapper,this.element.removeEventListener(t,e,n),this}},{key:"on",value:function(t,e,n,r){var i=this;return Array.isArray(e)?e.forEach((function(e){Pn(i.element,t,e,n,r)})):Pn(this.element,t,e,n,r),this}},{key:"once",value:function(t,e,n,r){return this.on(t,e,n,{capture:r,once:!0}),this}}]),t}(),An=null,Bn=function(t){return"string"==typeof t&&(t=document.querySelector(t)),An?An.element=t:An=new Ln(t),An},Dn=function(){function t(e,n){var r=n.$container,o=n.type,a=n.scope,s=n.onStart,u=n.onDrag,c=n.onRelease;i()(this,t),g()(this,"$container",null),g()(this,"$ele",null),g()(this,"active",!1),g()(this,"offsetX",0),g()(this,"offsetY",0),g()(this,"offsetLeft",0),g()(this,"offsetTop",0),g()(this,"orginOffsetLeft",0),g()(this,"orginOffsetTop",0),g()(this,"orginOffsetWidth",0),g()(this,"orginOffsetHeight",0),g()(this,"initialX",0),g()(this,"initialY",0),g()(this,"type","default"),g()(this,"scope",{}),this.$container=r||document.body,this.$ele=e,this.type=o,this.scope=a,this.eventsList={},this.onStart=s,this.onDrag=u,this.onRelease=c,this.bindEvent()}return a()(t,[{key:"addEventListener",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.addEventListener(e,n,r),{destroy:function(){t.removeEventListener(e,n)}}}},{key:"removeEventListenerAll",value:function(){var t=this;Object.keys(this.eventsList).forEach((function(e){t.eventsList[e].destroy()}))}},{key:"bindEvent",value:function(){var t=this;this.eventsList.mousedown=this.addEventListener(this.$container,"mousedown",(function(e){t.start(e)}),!1),this.eventsList.mouseup=this.addEventListener(this.$container,"mouseup",(function(e){t.release(e)}),!1),this.eventsList.mousemove=this.addEventListener(this.$container,"mousemove",(function(e){t.drag(e)}),!1)}},{key:"start",value:function(t){t.target===this.$ele&&(void 0===this.scope&&void 0!==this.$container&&(this.scope={left:this.$container.offsetLeft,right:this.$container.offsetLeft+this.$container.offsetWidth,top:this.$container.offsetTop,bottom:this.$container.offsetTop+this.$container.offsetHeight}),this.offsetLeft=this.$ele.offsetLeft,this.offsetTop=this.$ele.offsetTop,this.active=!0,this.initialX=t.clientX,this.initialY=t.clientY,this.orginOffsetLeft=this.$ele.offsetLeft,this.orginOffsetTop=this.$ele.offsetTop,this.orginOffsetWidth=this.$ele.offsetWidth,this.orginOffsetHeight=this.$ele.offsetHeight,"function"==typeof this.onStart&&this.onStart.call(this,this.offsetX,this.offsetY,t,this))}},{key:"release",value:function(t){this.active=!1,"function"==typeof this.onRelease&&this.onRelease.call(this,this.offsetX,this.offsetY,t,this)}},{key:"drag",value:function(t){this.active&&(t.preventDefault(),t.stopPropagation(),this.offsetX=t.clientX-this.initialX+this.offsetLeft,this.offsetY=t.clientY-this.initialY+this.offsetTop,this.setPosition(t))}},{key:"setPosition",value:function(t){switch(this.type){case"vertical":this.offsetX=this.orginOffsetLeft,this.offsetY<this.scope.top&&(this.offsetY=this.scope.top),this.offsetY>this.scope.bottom-this.orginOffsetHeight&&(this.offsetY=this.scope.bottom-this.orginOffsetHeight);break;case"level":this.offsetY=this.orginOffsetTop,this.offsetX>this.scope.right-this.orginOffsetWidth&&(this.offsetX=this.scope.right-this.orginOffsetWidth),this.offsetX<this.scope.left&&(this.offsetX=this.scope.left);break;default:isNaN(this.scope.right)||this.offsetX>this.scope.right-this.orginOffsetWidth&&(this.offsetX=this.scope.right-this.orginOffsetWidth),isNaN(this.scope.left)||this.offsetX<this.scope.left&&(this.offsetX=this.scope.left),isNaN(this.scope.top)||this.offsetY<this.scope.top&&(this.offsetY=this.scope.top),isNaN(this.scope.bottom)||this.offsetY>this.scope.bottom-this.orginOffsetHeight&&(this.offsetY=this.scope.bottom-this.orginOffsetHeight)}this.$ele.style.left=this.offsetX+"px",this.$ele.style.top=this.offsetY+"px","function"==typeof this.onDrag&&this.onDrag.call(this,this.offsetX,this.offsetY,t,this)}},{key:"destroy",value:function(){this.$ele.parentNode.removeChild(this.$ele),this.removeEventListenerAll()}}]),t}(),In=function(t,e){return new Dn(t,e)};function On(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Cn,Nn=function(t){l()(n,t);var e=On(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Rn||(Rn=gn()(['\n    <gp-control-progressbar class="goldplay__progress-bar ','" data-status="','">\n      <div class="goldplay__progressbar--load ','">\n      </div>\n      <div class="goldplay__progressbar--play ','">\n      </div>\n      <span class="goldplay__progressbar--dot ','" title="','"></span>\n    </gp-control-progressbar>\n  '])),"progressBarHoverCss","status","progressBarLoadHoverCss","progressBarPlayHoverCss","progressBarDotHoverCss","time")),g()(u()(t),"options",{}),g()(u()(t),"data",{playWidth:"",dot:"",time:"",status:""}),g()(u()(t),"setProgressBarSize",(function(e){t.$progressBarPlay.style.width=e+"px"})),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){var t=this.options.cssName;"dragstart"===this.data.status?(this.data.progressBarHoverCss=t.progressBarHover,this.data.progressBarLoadHoverCss=t.progressBarLoadHover,this.data.progressBarPlayHoverCss=t.progressBarPlayHover,this.data.progressBarDotHoverCss=t.progressBarDotHover):"dragend"===this.data.status&&(this.data.progressBarHoverCss="",this.data.progressBarLoadHoverCss="",this.data.progressBarPlayHoverCss="",this.data.progressBarDotHoverCss="")}},{key:"afterInit",value:function(){}},{key:"initProps",value:function(){var t=this.element;this.options.player.options.isLive&&(t.style.visibility="hidden");var e=this.options.cssName;this.$progressDragDot=t.querySelector("."+e.progressBarDot),this.$progressBarPlay=t.querySelector("."+e.progressBarPlay),this.$progressBarLoad=t.querySelector("."+e.progressBarLoad),this.timer=this.getComponent("timer"),this.pauseButton=this.getComponent("pauseButton")}},{key:"bindEvent",value:function(){var t=this,e=this.options.cssName,n=!1;this.events.on(ot.default.PlayerTimeUpdate,(function(e){var r=t.options.loadData.sourceData.duration;if(!n&&e&&r){var i=e/1e3/r*t.progressBarWidth;t.setProgressPosition(i),t.timer.data.time=vn.formatHHMMSS(e/1e3)}})),this.events.on(ot.default.PlayerbufferUpdate,(function(e){!n&&e&&t.updateProgressLoad(e)})),Bn(this.options.$controlBarContainer).on("click","."+e.progressBar,(function(n){if(n.target!==t.$progressDragDot){var r=(t.options.loadData.sourceData.duration||0)/t.progressBarWidth,i=0;n.target.classList.contains(e.progressBarLoad)&&(i=n.target.offsetLeft-n.target.parentNode.offsetLeft);var o=i+n.offsetX,a=o*r*1e3;return t.setProgressPosition(o),t.logger.info("bindEvent","click to seek","seekTime:",a,"offsetX:",o),n.target!==t.$progressBarLoad&&t.clearLoadBar(n.offsetX),t.timer.data.time=vn.formatHHMMSS(a/1e3),t.events.emit(ot.default.PlayerOnSeek,a),!1}})),this.progressDragEvent=In(this.$progressDragDot,{$container:document.body,type:"level",scope:{left:this.progressBarLeft,right:this.progressBarLeft+this.progressBarWidth,top:this.$progressDragDot.offsetTop,bottom:this.$progressDragDot.offsetTop+this.$progressDragDot.offsetHeight},onStart:function(){n=!0,t.data.status="dragstart"},onDrag:function(e){var n;n=t.options.player.controlBarAutoHide?e:e-t.options.$controlBarContainer.offsetLeft;var r=0,i=t.$progressDragDot.offsetWidth;t.progressBarWidth-n<=i&&(r=i),t.setProgressBarSize(n),t.data.status="draging";var o=t.getSeekTime(t.progressBarWidth-r);t.timer.data.time=vn.formatHHMMSS(o/1e3),t.data.time=t.timer.data.time},onRelease:function(e,r,i){if(n){var o=t.getSeekTime();i.target!==t.$progressBarLoad&&t.clearLoadBar(e),t.events.emit(ot.default.PlayerOnSeek,o),t.logger.info("bindEvent","onDrag release seek","seekTime:",o),t.data.status="dragend",n=!1}}})}},{key:"setProgressPosition",value:function(t){var e=Math.min(t,this.progressBarWidth),n=this.$progressDragDot,r=this.progressBarWidth,i=0,o=n.offsetWidth/2;e>r||r-e<=o?i=o-(r-e):e<=o&&(i=-(o-e));var a=e-i-n.offsetWidth/2;this.setProgressPlayWidth(e),this.setProgressDragDotLeft(a+this.progressBarLeft)}},{key:"setProgressPlayWidth",value:function(t){this.$progressBarPlay.style.width=t+"px"}},{key:"setProgressDragDotLeft",value:function(t){this.$progressDragDot.style.left=t+"px"}},{key:"getProgressPlayLeftWidth",value:function(){return{offsetLeft:this.$progressBarPlay.offsetLeft,offsetWidth:this.$progressBarPlay.offsetWidth}}},{key:"getProgressLoadLeftWidth",value:function(){return{offsetLeft:this.$progressBarLoad.offsetLeft,offsetWidth:this.$progressBarLoad.offsetWidth}}},{key:"setProgressLoadLeftWidth",value:function(t,e){var n=this.progressBarLeft+this.progressBarWidth;(t=Math.min(t,n))+e>n&&(e=n-t),this.$progressBarLoad.style.left=t+"px",this.$progressBarLoad.style.width=e+"px"}},{key:"updateProgressLoad",value:function(t){var e=this.options.loadData.sourceData.duration;if(e){var n=this.progressBarWidth,r=this.progressBarLeft,i=t[0]/1e3/e*n,o=t[1]/1e3/e*n,a=Math.floor(r+i),s=Math.floor(o-i);this.setProgressLoadLeftWidth(a,s)}}},{key:"getSeekTime",value:function(t,e){var n=this.progressBarWidth,r=(e=e||this.options.loadData.sourceData.duration||0)/(t||n);return this.$progressBarPlay.offsetWidth*r*1e3}},{key:"clearLoadBar",value:function(t){t<this.$progressBarLoad.offsetLeft-this.progressBarLeft&&(this.$progressBarLoad.style.width="0px")}},{key:"getDragDotPosition",value:function(){return{offsetLeft:this.$progressDragDot.offsetLeft,offsetTop:this.$progressDragDot.offsetTop,left:this.$progressDragDot.style.left,top:this.$progressDragDot.style.top}}},{key:"progressBarWidth",get:function(){return this.element.offsetWidth}},{key:"progressBarLeft",get:function(){return this.element.offsetLeft}},{key:"clearDragDotTop",value:function(){this.$progressDragDot.style.top=""}}]),n}(dn);function Fn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Mn,Un,jn=function(t){l()(n,t);var e=Fn(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Cn||(Cn=gn()(['\n  <gp-button class="goldplay__control--play" data-status="','" title="','">\n  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n  viewBox="0 0 232.153 232.153" width="20" height="20" style="enable-background:new 0 0 232.153 232.153;" xml:space="preserve">\n  <g >\n  <path style="fill-rule:evenodd;clip-rule:evenodd;" d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266\n    c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267\n    l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z" fill="#f1f1f1"/>\n  </g>\n  </svg>\n  </gp-button>\n  '])),"status","title")),g()(u()(t),"data",{title:"play",play:">"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return n}(dn);function Hn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var zn,Wn=Ke.create(Mn||(Mn=gn()(['\n<svg style="display:','" class="goldplay__control--pausing" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="20px" height="20px" viewBox="0 0 26 26" style="background:none" xml:space="preserve">\n<g>\n<path d="M2.667,0h6v26h-6V0z M15.333,0v26h6V0H15.333z" fill="#f1f1f1"/>\n</g>\n</svg>\n'])),"pauseHide"),Vn=function(t){l()(n,t);var e=Hn(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate((function(t,e){return e(Un||(Un=gn()(['\n  <gp-button class="goldplay__control--pause" title="','" status="','">\n  ',"\n  </gp-button>\n  "])),"title","status","icon|html")}))),g()(u()(t),"data",{title:"pause",pauseHide:"",pauseLoadingHide:"none",icon:Wn,status:"",display:""}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){"pauseloading"===this.data.status?(this.data.pauseHide="none",this.data.pauseLoadingHide="inline-block",this.data.title="loading",this.data.icon='\n<svg version="1.1" class="goldplay__control--pause-loading" style="display:${\'pauseLoadingHide\'}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="25px" height="25px" viewBox="0 0 612 792" style="background:none;margin: -4px 0 0 -5px;" xml:space="preserve">\n<linearGradient id="goldplay-pause-loading-gradient" gradientUnits="userSpaceOnUse" x1="1.98" y1="784.6123" x2="26.2101" y2="770.623" gradientTransform="matrix(21.8571 0 0 21.8571 -2.0895 -16600.5293)">\n    <stop offset="0.1682" style="stop-color:#f1f1f1;stop-opacity:0"></stop>\n    <stop offset="0.7502" style="stop-color:#f1f1f1"></stop>\n    <stop offset="1" style="stop-color:#f1f1f1"></stop>\n</linearGradient>\n<path style="transform-origin: center center;animation: goldplay-rotate-360 .8s linear infinite;" fill="url(#goldplay-pause-loading-gradient)" d="M306,133.714c144.257,0,262.286,118.028,262.286,262.286c0,144.257-118.029,262.286-262.286,262.286\n  C161.743,658.286,43.714,540.257,43.714,396C43.714,251.743,161.743,133.714,306,133.714 M306,90C137.7,90,0,227.7,0,396\n  s137.7,306,306,306s306-137.7,306-306S474.3,90,306,90L306,90z">\n    <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0" to="360" dur=".8s" repeatCount="indefinite" />\n</path>\n<g>\n    <g>\n        <path fill="#f1f1f1" d="M229.5,514.028L229.5,514.028c-13.114,0-21.857-8.742-21.857-21.856V295.457\n        c0-10.929,8.743-21.857,21.857-21.857l0,0c10.929,0,21.857,8.743,21.857,21.857v196.715\n        C251.357,503.1,242.614,514.028,229.5,514.028z"></path>\n        <path fill="#f1f1f1" d="M229.5,273.6c-13.114,0-21.857,8.743-21.857,21.857v196.715c0,10.928,8.743,21.856,21.857,21.856\n        s21.857-10.929,21.857-21.856V295.457C251.357,282.343,242.614,273.6,229.5,273.6L229.5,273.6z"></path>\n    </g>\n    <g>\n        <path fill="#f1f1f1" d="M382.5,518.4L382.5,518.4c-13.114,0-21.857-8.743-21.857-21.857V299.829\n        c0-10.929,8.743-21.857,21.857-21.857l0,0c10.929,0,21.857,8.743,21.857,21.857v196.714\n        C404.357,509.657,395.614,518.4,382.5,518.4z"></path>\n        <path fill="#f1f1f1" d="M382.5,277.972c-10.929,0-21.857,8.743-21.857,21.857v196.714c0,10.929,10.929,21.857,21.857,21.857\n        s21.857-10.929,21.857-21.857V299.829C404.357,288.9,393.429,277.972,382.5,277.972L382.5,277.972z"></path>\n    </g>\n</g>\n</svg>\n'):"pause"===this.data.status&&(this.data.pauseHide="inline-block",this.data.pauseLoadingHide="none",this.data.title="pause",this.data.icon=Wn)}}]),n}(dn);function $n(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Xn,Yn,qn,Gn=function(t){l()(n,t);var e=$n(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(zn||(zn=gn()(['\n  <gp-button class="goldplay__control--replay" title="','" data-display="','">\n  <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n  width="24px" height="24px" viewBox="0 0 245.000000 206.000000"\n  preserveAspectRatio="xMidYMid meet">\n <g transform="translate(0.000000,206.000000) scale(0.100000,-0.100000)"\n fill="#f1f1f1" stroke="1">\n <path d="M1250 2046 c-286 -55 -525 -211 -681 -445 -91 -136 -152 -302 -167\n -453 -12 -119 3 -108 -143 -109 -70 -1 -156 -4 -192 -8 l-65 -6 262 -265 262\n -265 266 265 265 265 -62 6 c-35 4 -123 7 -197 8 l-134 1 7 69 c26 284 232\n 543 504 635 201 69 404 53 596 -47 62 -32 103 -63 177 -137 83 -83 102 -108\n 142 -190 63 -130 77 -193 77 -340 0 -178 -37 -298 -134 -435 -91 -126 -220\n -224 -369 -278 -72 -26 -99 -31 -218 -35 -117 -4 -146 -1 -215 17 -104 29\n -205 79 -283 142 l-63 52 -89 -89 c-49 -49 -89 -96 -89 -106 0 -24 154 -136\n 253 -185 89 -44 177 -74 272 -95 84 -17 303 -15 391 5 403 91 691 371 795 772\n 19 76 23 114 22 240 0 129 -4 164 -27 249 -99 377 -406 673 -778 751 -104 22\n -297 28 -385 11z"/>\n <path d="M1227 1418 c-9 -68 -7 -695 2 -770 l6 -57 240 200 c132 110 251 210\n 264 223 l23 24 -257 213 c-141 118 -260 215 -264 217 -5 1 -11 -21 -14 -50z"/>\n </g>\n </svg>\n  </gp-button>\n  '])),"title","display")),g()(u()(t),"data",{title:"replay",display:"",replay:"->"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return n}(dn);function Zn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Kn,Jn=Ke.create(Xn||(Xn=gn()(['\n<svg xmlns="http://www.w3.org/2000/svg" style="display:','" width="20px" height="20px" viewBox="0 0 24 24" style="margin-left: -5px;">\n<path d="M5.2 7.68l6.175-5.293a.5.5 0 0 1 .825.38v17.825a.5.5 0 0 1-.825.38L5.2 15.679H3a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2.2zm9 13.35v-2.375l.007-.003C16.852 17.493 19 14.897 19 11.479s-2.148-6.014-4.793-7.173a4.11 4.11 0 0 0-.007-.003V2c.027.006.054.012.082.02.852.221 1.274.453 1.436.535A10 10 0 0 1 21.2 11.48c0 4.106-2.474 7.633-6.013 9.174-.526.229-.583.284-.987.377zm0-13.973c1.5.925 2.5 2.582 2.5 4.473 0 1.892-1 3.55-2.5 4.473V7.057z" fill="#f1f1f1"></path>\n</svg>\n'])),"audioOnHide"),Qn=Ke.create(Yn||(Yn=gn()(['\n<svg xmlns="http://www.w3.org/2000/svg" style="display:','" width="20px" height="20px" viewBox="0 0 24 24" style="margin-left: -5px;">\n<path d="M12.2 13.914v6.678a.5.5 0 0 1-.825.38L5.2 15.679H3a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1h2.2l.412-.353-2.558-2.558a.5.5 0 0 1 0-.707l.707-.707a.5.5 0 0 1 .707 0l16.849 16.849a.5.5 0 0 1 0 .707l-.707.707a.5.5 0 0 1-.707 0l-2.386-2.386a10 10 0 0 1-2.33 1.422c-.526.229-.583.284-.987.377v-2.375l.007-.003a8.332 8.332 0 0 0 1.717-1.014l-1.67-1.669a5.251 5.251 0 0 1-.054.034v-.089l-2-2zM8.373 4.96l3.002-2.572a.5.5 0 0 1 .825.38v6.019L8.373 4.959zm9.867 9.867c.48-.99.76-2.115.76-3.347 0-3.418-2.148-6.014-4.793-7.173a4.11 4.11 0 0 0-.007-.003V2c.027.006.054.012.082.02.852.221 1.274.453 1.436.535A10 10 0 0 1 21.2 11.48a9.954 9.954 0 0 1-1.326 4.98l-1.634-1.633zm-1.766-1.766L14.2 10.786V7.057a5.247 5.247 0 0 1 2.274 6.003z" fill="#f1f1f1"></path>\n</svg>\n'])),"audioOffHide"),tr=function(t){l()(n,t);var e=Zn(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(qn||(qn=gn()(['\n  <gp-volume class="goldplay__volume-bar">\n    <gp-overbox class="goldplay-hoverbox goldplay__volume-bar--handle">\n      <span class="goldplay__volume-bar--precent">','</span>\n      <span class="goldplay__volume-bar--rod ','" title="adjust volume"></span>\n      <span class="goldplay__volume-bar--size">&nbsp;</span>\n      <span class="goldplay__volume-bar--column">&nbsp;</span>\n    </gp-overbox>\n    <gp-button class="goldplay__volume-bar--audio ','" title="','" data-mute="','" data-volume-size="','"  data-last-volume="','">\n    ',"\n    </gp-button>\n  </gp-volume>\n  "])),"dataPrecent","volumeBarRodHoverCss","audioOffClass","title","dataMute","dataVolumeSize","dataLastVolume","icon|html")),g()(u()(t),"options",{}),g()(u()(t),"data",{audioONHide:"",audioOffHide:"",audioOffClass:"",dataVolumeSize:"",dataPrecent:"",dataLastVolume:"",dataMute:"",volumeBarRodHoverCss:"",icon:Jn,title:"turn off"}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){this.data.dataPrecent=Math.floor(100*this.data.dataVolumeSize),""!==this.data.audioOffClass?(this.data.dataMute="true",this.data.audioOffHide="inline-block",this.data.audioOnHide="none",this.data.icon=Qn,this.data.title="turn on"):(this.data.dataMute="",this.data.audioOffHide="none",this.data.audioOnHide="inline-block",this.data.icon=Jn,this.data.title="turn off")}},{key:"initProps",value:function(){var t=this.element,e=this.options.cssName;this.INIT_VOLUME_SIZE=void 0===this.options.player.defaultVolumeSize?.5:this.options.player.defaultVolumeSize,this.$volumeBarHandle=t.querySelector("."+e.volumeBarHandle),this.$volumeBarRod=t.querySelector("."+e.volumeBarRod),this.$volumeBarAudio=t.querySelector("."+e.volumeBarAudio),this.$volumeBarSize=t.querySelector("."+e.volumeBarSize),this.$volumeBarColumn=t.querySelector("."+e.volumeBarColumn),this.volumeBarColumnHeight=this.$volumeBarColumn.offsetHeight,this.volumeBarColumnTop=this.$volumeBarColumn.offsetTop,this.volumeBarRodHeight=this.$volumeBarRod.offsetHeight,this.volumeBarRodHeightHalf=this.volumeBarRodHeight/2,this.volumeBarColumnRealTop=this.volumeBarColumnTop+this.volumeBarRodHeightHalf,this.volumeBarColumnMaxHeight=this.volumeBarColumnHeight-this.volumeBarRodHeight}},{key:"bindEvent",value:function(){var t,e=this,n=this.options.$controlBarContainer,r=this.options.cssName;Bn(n).on("mouseover","."+r.volumeBar,(function(){clearTimeout(t),e.showVolumeBarHandle()})),Bn(n).on("mousewheel","."+r.volumeBarHandle,(function(t){var n=t.wheelDelta/500;n=e.data.dataVolumeSize+n,e.setVolumeSize(n),t.preventDefault(),t.stopPropagation()})),Bn(n).on("click",["."+r.volumeBarColumn,"."+r.volumeBarSize],(function(t){var n=0;return t.target===e.$volumeBarColumn?n=(e.$volumeBarColumn.offsetHeight-t.offsetY)/t.target.offsetHeight:t.target===e.$volumeBarSize&&(n=e.$volumeBarColumn.offsetHeight-t.target.offsetHeight+t.offsetY,n=e.$volumeBarColumn.offsetHeight-n,n/=e.$volumeBarColumn.offsetHeight),e.setVolumeSize(n),!1})),Bn(n).on("click","."+r.volumeBarAudio,(function(t){return e.$volumeBarAudio.classList.contains(r.volumeBarAudioOff)?e.setAudioOn(t.offsetY):e.setAudioOff(t.offsetY),!1}));Bn(n).on("mouseout","."+r.volumeBar,(function(n){t=setTimeout((function(){!function(t){var n=e.element,r={y:n.offsetTop+e.$volumeBarHandle.offsetTop,x:n.offsetLeft};return r.width=n.offsetWidth,r.height=e.$volumeBarHandle.offsetHeight,t.pageX>r.x&&t.pageX<r.x+r.width&&t.pageY>r.y&&t.pageY<r.y+r.height}(n)?e.hideVolumeBarHandle():clearTimeout(t)}),N.c.hideBarBoxTime)})),this.volumeDragEvent=In(this.$volumeBarRod,{$container:this.element,type:"vertical",scope:{top:this.volumeBarColumnTop,right:0,bottom:this.volumeBarColumnTop+this.volumeBarColumnHeight,left:0},onStart:function(){e.data.volumeBarRodHoverCss=e.options.cssName.volumeBarRodHover},onDrag:function(t,n){n-=1,e.dragHandle(n)},onRelease:function(){e.data.volumeBarRodHoverCss=""}})}},{key:"hideVolumeBarHandle",value:function(){this.$volumeBarHandle.style.visibility="hidden"}},{key:"showVolumeBarHandle",value:function(){this.$volumeBarHandle.style.visibility="visible"}},{key:"getVolume",value:function(){var t=(this.$volumeBarSize.offsetHeight-this.volumeBarRodHeight)/this.volumeBarColumnMaxHeight;return t=Math.min(t,1),(t=Math.max(t,0)).toFixed(2)}},{key:"setVolume",value:function(t){this.data.dataVolumeSize=Number(t),this.events.emit(ot.default.PlayerOnVolume,t)}},{key:"initVolumeSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.data.dataLastVolume=t?0:this.INIT_VOLUME_SIZE,t?this.setAudioOff():this.setAudioOn()}},{key:"setAudioOn",value:function(){var t=this.data.dataLastVolume||0;this.setVolume(t);var e=parseFloat(t,10),n=Math.floor(e*this.volumeBarColumnMaxHeight),r=this.volumeBarColumnTop+(this.volumeBarColumnMaxHeight-n);this.$volumeBarSize.style.marginTop=r+"px",this.$volumeBarSize.style.height=n+this.volumeBarRodHeight+"px",this.$volumeBarRod.style.top=r+"px",this.data.audioOffClass=""}},{key:"setAudioOff",value:function(){this.setVolume(0),this.data.audioOffClass=this.options.cssName.volumeBarAudioOff;var t=this.getVolume();t>0&&(this.data.dataLastVolume=t),this.$volumeBarSize.style.height=this.volumeBarRodHeight+"px",this.$volumeBarSize.style.marginTop=this.volumeBarColumnRealTop-this.volumeBarRodHeightHalf+this.volumeBarColumnMaxHeight+"px",this.$volumeBarRod.style.top=this.volumeBarColumnRealTop+this.volumeBarColumnMaxHeight-this.volumeBarRodHeightHalf+"px"}},{key:"dragHandle",value:function(t){this.$volumeBarSize.style.marginTop=t+1+"px",this.$volumeBarSize.style.height=this.volumeBarColumnHeight-t+this.volumeBarRodHeight+"px";var e=this.getVolume();e<=0?this.setAudioOff(t):"true"==this.data.dataMute&&this.setAudioOn(t),this.setVolume(e)}},{key:"setVolumeSize",value:function(t){if((t=t.toFixed(2))>=1?t=1:t<.001&&(t=0),t!==this.data.dataVolumeSize){this.setVolume(t);var e=this.volumeBarColumnMaxHeight,n=e-t*e+this.volumeBarColumnTop;this.$volumeBarSize.style.marginTop=n+"px",this.$volumeBarSize.style.height=t*e+this.volumeBarRodHeight+"px",this.$volumeBarRod.style.top=n+"px",t<=0?this.data.audioOffClass=this.options.cssName.volumeBarAudioOff:"true"==this.data.dataMute&&(this.data.audioOffClass="")}}}]),n}(dn);function er(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var nr,rr=null,ir=function(t){l()(n,t);var e=er(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Kn||(Kn=gn()(['\n  <gp-wait class="goldplay-tip goldplay__waiting-bar" title="','" data-status="','">\n  <gp-speed class="goldplay__waiting-bar--speed">',"</gp-speed>\n  </gp-wait>\n  "])),"title","status","speed")),g()(u()(t),"data",{title:"waiting",speed:"",status:"",display:"show"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"initProps",value:function(){}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.LoaderUpdateSpeed,(function(e){"show"===t.data.display&&(t.data.speed=mn.formatBytes(e.speed)+" /s")})),this.events.on(ot.default.StreamDataReady,(function(){t.hideWaiting()})),this.events.on(ot.default.PlayerSeekEnd,(function(){t.hideWaiting()}))}},{key:"showWaiting",value:function(){var t=this.options.cssName,e=this.options.$screenContainer;e.querySelector("."+t.waitingBar)||e.prepend(this.element),this.data.display="show",this.show(),this.resetPosition()}},{key:"hideWaiting",value:function(){var t=this,e=this.options.player.status;clearTimeout(rr),"wait"===e?rr=setTimeout((function(){t.realHide()}),1e3):this.realHide()}},{key:"realHide",value:function(){var t=this.options.cssName;this.options.$screenContainer.querySelector("."+t.waitingBar)&&(this.data.display="hide",this.data.speed="Loading...",this.hide())}}]),n}(dn);function or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var ar,sr=function(t){l()(n,t);var e=or(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(nr||(nr=gn()(['\n  <gp-alert class="goldplay-tip goldplay__alter-box" title="','" data-display="','">\n  <em title="close" class="goldplay__alter--close">\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="background:none;opacity:0.6" xml:space="preserve" width="20px" height="20px" viewBox="0 0 496.158 496.158">\n    <path style="fill:#ff3300;" d="M496.158,248.085c0-137.021-111.07-248.082-248.076-248.082C111.07,0.003,0,111.063,0,248.085\n    c0,137.002,111.07,248.07,248.082,248.07C385.088,496.155,496.158,385.087,496.158,248.085z"/>\n    <path style="fill:#FFFFFF;" d="M277.042,248.082l72.528-84.196c7.91-9.182,6.876-23.041-2.31-30.951\n    c-9.172-7.904-23.032-6.876-30.947,2.306l-68.236,79.212l-68.229-79.212c-7.91-9.188-21.771-10.216-30.954-2.306\n    c-9.186,7.91-10.214,21.77-2.304,30.951l72.522,84.196l-72.522,84.192c-7.91,9.182-6.882,23.041,2.304,30.951\n    c4.143,3.569,9.241,5.318,14.316,5.318c6.161,0,12.294-2.586,16.638-7.624l68.229-79.212l68.236,79.212\n    c4.338,5.041,10.47,7.624,16.637,7.624c5.069,0,10.168-1.749,14.311-5.318c9.186-7.91,10.22-21.77,2.31-30.951L277.042,248.082z"/>\n    </svg>\n  </em>\n  <span class="goldplay__alter--warn">\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n    width="30" height="30" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">\n    <path style="fill:#495A79;" d="M501.461,383.799L320.501,51.401C306.7,28.6,282.7,14.8,256,14.8s-50.7,13.8-64.501,36.601\n      L10.539,383.799C-3.259,407.501-3.56,435.701,9.941,459.4c13.499,23.699,37.798,37.8,65.099,37.8h361.92\n      c27.301,0,51.601-14.101,65.099-37.8C515.56,435.701,515.259,407.501,501.461,383.799z"/>\n    <path style="fill:#42516D;" d="M502.059,459.4c-13.499,23.699-37.798,37.8-65.099,37.8H256V14.8c26.7,0,50.7,13.801,64.501,36.601\n      L501.461,383.8C515.259,407.501,515.56,435.701,502.059,459.4z"/>\n    <path style="fill:#FFDE33;" d="M475.661,399.1L294.699,66.699C286.601,52.9,271.901,44.8,256,44.8s-30.601,8.101-38.699,21.899\n      L36.339,399.1c-8.399,14.101-8.399,31.199-0.298,45.3c8.099,14.399,22.798,22.8,39,22.8h361.92c16.201,0,30.901-8.401,39-22.8\n      C484.06,430.299,484.06,413.201,475.661,399.1z"/>\n    <path style="fill:#FFBC33;" d="M475.96,444.4c-8.099,14.399-22.798,22.8-39,22.8H256V44.8c15.901,0,30.601,8.101,38.699,21.899\n      L475.661,399.1C484.06,413.201,484.06,430.299,475.96,444.4z"/>\n    <g>\n      <path style="fill:#495A79;" d="M256,437.2c-16.538,0-30-13.462-30-30s13.462-30,30-30s30,13.462,30,30S272.538,437.2,256,437.2z"/>\n      <path style="fill:#495A79;" d="M286,317.2c0,16.538-13.462,30-30,30s-30-13.462-30-30v-150c0-16.538,13.462-30,30-30\n        s30,13.462,30,30V317.2z"/>\n    </g>\n    <g>\n      <path style="fill:#42516D;" d="M286,407.2c0-16.538-13.462-30-30-30v60C272.538,437.2,286,423.738,286,407.2z"/>\n      <path style="fill:#42516D;" d="M286,317.2v-150c0-16.538-13.462-30-30-30v210C272.538,347.2,286,333.738,286,317.2z"/>\n    </g>\n    </svg>\n  </span>\n  <gp-content class="goldplay__alter--content">',"</gp-content>\n  </gp-alert>\n  "])),"title","display","content|trim")),g()(u()(t),"data",{title:"alert",display:"default",content:""}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"bindEvent",value:function(){var t=this,e=this.options.$screenContainer,n=this.options.cssName;Bn(e).on("click","."+n.alertClose,(function(){t.hide()}))}},{key:"afterWatch",value:function(){"show"===this.data.display&&this.resetPosition()}},{key:"showBox",value:function(){var t=this.options.cssName,e=this.options.$screenContainer;e.querySelector("."+t.alertBox)||e.prepend(this.element),this.data.display="show",this.show()}},{key:"hideBox",value:function(){var t=this.options.cssName;this.options.$screenContainer.querySelector("."+t.alertBox)&&(this.data.display="hide",this.hide())}},{key:"show",value:function(){this.element.style.opacity=1,this.element.style.display="inline-block",this.resetPosition()}},{key:"hide",value:function(){this.element.style.opacity=0,this.element.style.display="none"}}]),n}(dn);function ur(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var cr,lr=function(t){l()(n,t);var e=ur(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(ar||(ar=gn()(['\n  <gp-time class="goldplay__control--timer">\n  <span gid="time" class="goldplay__control--timer-play">','</span>\n  <span gid="slash">','</span>\n  <span gid="total-time" class="goldplay__control--timer-total">',"</span>\n  </gp-time>\n  "])),"time","slash","totalTime")),g()(u()(t),"data",{time:"00:00",totalTime:"",slash:"/"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"setTotalTime",value:function(t){var e=t.segmentPool.reduce((function(t,e){return t+e.duration}),0);this.options.player.options.isLive&&(this.element.querySelector('[gid="slash"]').style.display="none",this.element.querySelector('[gid="total-time"]').style.display="none"),this.data.totalTime=vn.formatHHMMSS(e)}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.LoaderPlayListLoaded,(function(e){t.setTotalTime(e.loadData)}))}},{key:"updateTime",value:function(t){this.element.querySelector('[gid="time"]').innerHTML=t}},{key:"updateTotalTime",value:function(t){this.element.querySelector('[gid="total-time"]').innerHTML=t}}]),n}(dn);function fr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}function hr(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return pr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function pr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var dr,yr=function(t){l()(n,t);var e=fr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(cr||(cr=gn()(['\n  <gp-speed class="goldplay__speed-bar" title="','">\n  <gp-overbox class="goldplay-hoverbox goldplay__speed-bar--box">\n  ','\n  </gp-overbox>\n  <gp-button class="goldplay__speed-bar--link">\n  ',"\n  </gp-button>\n  </gp-speed>\n  "])),"title","speedListHTML|html","currentSpeedName")),g()(u()(t),"data",{title:"speed",currentSpeed:1,speedList:null,currentSpeedName:"倍速",speedListHTML:""}),g()(u()(t),"options",{}),t.options=r,t.speedList=t.options.player.options.speedList||N.c.speedList,t.updateSpeedListHTML(),Object.assign(t.data,r.data),t.init(),t.initProps(),t.showHideBar(),t}return a()(n,[{key:"initProps",value:function(){var t=this.options.cssName;this.$barBox=this.element.querySelector("."+t.speedBarBox)}},{key:"bindEvent",value:function(){var t=this,e=this.options.cssName,n=this.options.$controlBarContainer;Bn(n).on("mouseover","."+e.speedBar,(function(){clearTimeout(r),t.showBarBoxHandle()}));var r;Bn(n).on("mouseout","."+e.speedBar,(function(e){r=setTimeout((function(){!function(e){var n=t.element,r={y:t.$barBox.offsetTop,x:n.offsetLeft};return r.width=n.offsetWidth,r.height=t.$barBox.offsetHeight,e.pageX>r.x&&e.pageX<r.x+r.width&&e.pageY>r.y&&e.pageY<r.y+r.height}(e)?t.hideBarBoxHandle():clearTimeout(r)}),N.c.hideBarBoxTime)})),Bn(this.element).on("click","[gp-node-li]",(function(e){var n=e.target,r=parseFloat(n.getAttribute("value"),10);if(r!==t.data.currentSpeed){t.data.currentSpeed=r;var i=t.speedList.filter((function(t){return t.value===r}));t.events.emit(ot.default.PlayerSpeedTo,i[0]),t.updateSpeedListHTML()}}))}},{key:"showHideBar",value:function(){this.speedList.length<=0&&this.hide()}},{key:"resetBoxPosition",value:function(){var t=33+28*this.speedList.length,e=(this.$barBox.offsetWidth-this.element.offsetWidth)/2;this.$barBox.style.marginTop=-t+"px",this.$barBox.style.marginLeft=-e+"px"}},{key:"hideBarBoxHandle",value:function(){this.$barBox.style.visibility="hidden"}},{key:"showBarBoxHandle",value:function(){this.$barBox.style.visibility="visible"}},{key:"updateSpeedListHTML",value:function(t){var e=this.speedList;if(!(e.length<=0)){void 0===t&&(t=this.data.currentSpeed);var n,r=e.slice(0,e.length).reverse(),i=hr(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.value===t?o.selected=!0:delete o.selected}}catch(t){i.e(t)}finally{i.f()}return this.data.speedListHTML=function(t){if(t){var e,n=["<ul>"],r=hr(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o="",a="";i.selected&&(o="gp-selected",a=" selected=".concat(i.selected)),n.push('\n    <li class="'.concat(o,'" gp-node-li value="').concat(i.value,'" ').concat(a,">").concat(i.name,"</li>\n    "))}}catch(t){r.e(t)}finally{r.f()}return n.push("</ul>"),n.join("")}}(r)}}}]),n}(dn);function gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var vr,mr=function(t){l()(n,t);var e=gr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(dr||(dr=gn()(['\n  <gp-subtitle class="goldplay__subtitle">\n  </gp-subtitle>\n  '])))),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return n}(dn);function br(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}function _r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return wr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wr(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function wr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Er,kr=function(t){l()(n,t);var e=br(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"rateList",[]),g()(u()(t),"defaultRate",{value:"600",name:"高清"}),g()(u()(t),"template",t.createTemplate(vr||(vr=gn()(['\n  <gp-rate class="goldplay__rate-bar" title="','">\n  <gp-overbox class="goldplay-hoverbox goldplay__rate-bar--box">\n  ','\n  </gp-overbox>\n  <gp-button class="goldplay__rate-bar--link">\n  ',"\n  </gp-button>\n  </gp-rate>\n  "])),"title","rateListHTML|html","currentRateName")),g()(u()(t),"data",{title:"stream rate",currentRate:"600",currentRateName:"高清",rateListHTML:""}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.rateList=t.options.player.options.rateList||t.rateList,t.defaultRate=t.options.player.options.defaultRate||t.defaultRate,t.setDefaultRate(),t.updateRateListHTML(),t.init(),t.initProps(),t.showHideBar(),t}return a()(n,[{key:"initProps",value:function(){var t=this.options.cssName;this.$barBox=this.element.querySelector("."+t.rateBarBox)}},{key:"setDefaultRate",value:function(){var t=this;if(!(this.rateList.length<=0)){var e=this.rateList.find((function(e){return String(e.value)===String(t.defaultRate.value)}));e?(this.data.currentRateName=e.name,this.data.currentRate=e.value):(this.data.currentRateName=this.rateList[0].name,this.data.currentRate=this.rateList[0].value)}}},{key:"bindEvent",value:function(){var t=this,e=this.options.cssName,n=this.options.$controlBarContainer;Bn(n).on("mouseover","."+e.rateBar,(function(){clearTimeout(r),t.showBarBoxHandle()}));var r;Bn(n).on("mouseout","."+e.rateBar,(function(e){r=setTimeout((function(){!function(e){var n=t.element,r={y:t.$barBox.offsetTop,x:n.offsetLeft};return r.width=n.offsetWidth,r.height=t.$barBox.offsetHeight,e.pageX>r.x&&e.pageX<r.x+r.width&&e.pageY>r.y&&e.pageY<r.y+r.height}(e)?t.hideBarBoxHandle():clearTimeout(r)}),N.c.hideBarBoxTime)})),Bn(this.element).on("click","[gp-node-li]",(function(e){var n=e.target.getAttribute("value");if(n!==t.data.currentRate){t.data.currentRate=n;var r=t.rateList.filter((function(t){return t.value===n}));t.events.emit(ot.default.PlayerChangeRate,r[0]),t.data.currentRateName=r[0].name,t.updateRateListHTML(),t.hideBarBoxHandle()}}))}},{key:"showHideBar",value:function(){var t=this.rateList;t&&t.length<=0&&this.hide()}},{key:"resetBoxPosition",value:function(){var t=33+28*this.rateList.length,e=(this.$barBox.offsetWidth-this.element.offsetWidth)/2;this.$barBox.style.marginTop=-t+"px",this.$barBox.style.marginLeft=-e+"px"}},{key:"hideBarBoxHandle",value:function(){this.$barBox.style.visibility="hidden"}},{key:"showBarBoxHandle",value:function(){this.$barBox.style.visibility="visible"}},{key:"updateRateListHTML",value:function(t){var e=this.rateList;if(!(e.length<=0)){void 0===t&&(t=this.data.currentRate);var n,r=e.slice(0,e.length).reverse(),i=_r(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.value===t?o.selected=!0:delete o.selected}}catch(t){i.e(t)}finally{i.f()}return this.data.rateListHTML=function(t){if(t){var e,n=["<ul>"],r=_r(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o="",a="";i.selected&&(o="gp-selected",a=" selected=".concat(i.selected)),n.push('\n    <li class="'.concat(o,'" gp-node-li value="').concat(i.value,'" ').concat(a,">").concat(i.name,"</li>\n    "))}}catch(t){r.e(t)}finally{r.f()}return n.push("</ul>"),n.join("")}}(r)}}}]),n}(dn);function Sr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var xr,Tr,Pr,Rr=function(t){l()(n,t);var e=Sr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Er||(Er=gn()(['\n  <gp-setting class="goldplay__setting-bar">\n  </gp-setting>\n  '])))),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return n}(dn);function Lr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ar,Br=Ke.create(xr||(xr=gn()(['\n<svg xmlns="http://www.w3.org/2000/svg" style="display:','" width="20" height="20" viewBox="0 0 24 24">\n  <path d="M2.5 4h19a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-.5.5h-19a.5.5 0 0 1-.5-.5v-15a.5.5 0 0 1 .5-.5zM5 7v10h14V7H5z" fill="#f1f1f1"></path>\n</svg>\n'])),"fullpageHide"),Dr=Ke.create(Tr||(Tr=gn()(['\n<svg xmlns="http://www.w3.org/2000/svg" style="display:','" width="20" height="20" viewBox="0 0 24 24">\n<path d="M3.5 6h17a.5.5 0 0 1 .5.5v11a.5.5 0 0 1-.5.5h-17a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5zM6 9v6h12V9H6z" fill="#f1f1f1"></path>\n</svg>\n'])),"fullpageExitHide"),Ir=function(t){l()(n,t);var e=Lr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"containerOriginStyle",""),g()(u()(t),"template",t.createTemplate(Pr||(Pr=gn()(['\n  <gp-button class="goldplay__control--fullpage" title="','" data-status="','">\n  ',"\n  </gp-button>\n  "])),"title","status","icon|html")),g()(u()(t),"data",{fullpageHide:"",fullpageExitHide:"none",status:"",icon:Br,title:"fullpage"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){"fullpage"===this.data.status?(this.data.fullpageHide="none",this.data.fullpageExitHide="inline-block",this.data.title="exit fullspage",this.data.icon=Dr):(this.data.fullpageHide="inline-block",this.data.fullpageExitHide="none",this.data.title="fullpage",this.data.icon=Br)}},{key:"initProps",value:function(){var t=this.options;this.$container=this.options.$container,this.$screenContainer=t.$screenContainer,this.$controlBarContainer=this.getComponent("controlBarContainer").element,this.originWidth=t.$container.offsetWidth,this.originHeight=t.$container.offsetHeight,this.containerOriginStyle=t.$container.getAttribute("style"),this.screenContainerOrginStyle=this.$screenContainer.getAttribute("style"),this.controlContainerOrginWidth=this.$controlBarContainer.style.width}},{key:"bindEvent",value:function(){var t=this,e=this.options.cssName,n=document,r=window;Bn(this.$controlBarContainer).on("click","."+e.fullPage,(function(){var e=t.data.status;"fullscreen"===t.getComponent("fullScreen").data.status&&G.exitFullscreen(),"fullpage"===e?t.exitFullPage():t.fullPage()})),this.eventsList.esckeyup=this.addEventListener(n,"keyup",(function(e){27===e.keyCode&&"fullpage"===t.data.status&&t.exitFullPage()})),this.eventsList.windowresize=this.addEventListener(r,"resize",(function(){if("fullpage"===t.data.status){var e=G.getInnerWidthHeight();t.resizeTo(e.width,e.height),t.resetPosition()}}))}},{key:"fullPage",value:function(){this.data.status="fullpage";var t=this.options,e=this.options.cssName,n=G.getInnerWidthHeight();this.saveOriginPosition(),t.$container.classList.add(e.containerFullPage),this.resizeTo(n.width,n.height),this.resetPosition(),scrollTo(0,0)}},{key:"saveOriginPosition",value:function(){var t=this.getComponent("progressBar");this.posterOriginStyle=this.getComponent("poster").element.getAttribute("style"),this.originScroll={scrollX:scrollX,scrollY:scrollY},this.progressBarOriginLeft=t.progressBarLeft,this.progressBarOriginWidth=t.progressBarWidth,this.progressBarPlayWidthRate=t.getProgressPlayLeftWidth().offsetWidth/this.progressBarOriginWidth,this.progressBarLoadWidthRate=t.getProgressLoadLeftWidth().offsetWidth/this.progressBarOriginWidth,this.progressBarLoadLeftRate=(t.getProgressLoadLeftWidth().offsetLeft-this.progressBarOriginLeft)/this.progressBarOriginWidth}},{key:"setProgressBarPosition",value:function(){var t=this.getComponent("progressBar"),e=t.progressBarWidth,n=t.progressBarLeft,r=e*this.progressBarPlayWidthRate,i=e*this.progressBarLoadWidthRate,o=e*this.progressBarLoadLeftRate;t.setProgressPosition(r),t.setProgressLoadLeftWidth(o+n,i),this.getComponent("progressBar").clearDragDotTop()}},{key:"resizeTo",value:function(t,e){var n=this.options,r=n.player,i=r.controlBarAutoHide?e:e-r.controlBarHeight;r.$screenContainer.style.width=t+"px",r.$screenContainer.style.height=i+"px",n.$container.style.width=t+"px",n.$container.style.height=e+"px"}},{key:"resetPosition",value:function(){var t=this.options;this.setProgressBarPosition(),t.player.resizeScreen(),this.getComponent("bigPlayButton").resetPosition(),this.getComponent("poster").resetPosition(),this.getComponent("waitingBar").resetPosition(),this.getComponent("controlBarContainer").resetPosition()}},{key:"exitFullPage",value:function(){this.data.status="exitfullpage";var t=this.options.cssName;this.saveOriginPosition(),this.$container.classList.remove(t.containerFullPage),this.resetScreen()}},{key:"resetScreen",value:function(){this.$container.setAttribute("style",this.containerOriginStyle),this.$screenContainer.setAttribute("style",this.screenContainerOrginStyle),this.$controlBarContainer.style.width=this.controlContainerOrginWidth,this.getComponent("poster").element.setAttribute("style",this.posterOriginStyle),scrollTo(this.originScroll.scrollX,this.originScroll.scrollY),this.resetPosition()}}]),n}(dn);function Or(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Cr,Nr,Fr='\n<svg xmlns="http://www.w3.org/2000/svg" gid="fullscreen" style="display:${\'fullscreenHide\'}" width="20" height="20" viewBox="0 0 24 24">\n<path d="M15 5.057V2h6.5a.5.5 0 0 1 .5.5V9h-2.943V5.057H15zm-6 0H5.057V9H2V2.5a.5.5 0 0 1 .5-.5H9v3.057zM15 22v-2.943h4.057V15H22v6.5a.5.5 0 0 1-.5.5H15zm-6 0H2.5a.5.5 0 0 1-.5-.5V15h3.057v4.057H9V22z" fill="#f1f1f1"></path>\n</svg>\n',Mr=function(t){l()(n,t);var e=Or(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Ar||(Ar=gn()(['\n  <gp-button class="goldplay__control--fullscreen" title="','" data-status="','">\n  ',"\n  </gp-button>\n  "])),"title","status","icon|html")),g()(u()(t),"data",{fullscreenHide:"inline-block",fullscreenExitHide:"none",status:"",icon:Fr,title:"fullscreen"}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){"fullscreen"===this.data.status?(this.data.fullscreenHide="none",this.data.fullscreenExitHide="inline-block",this.data.title="exit fullscreen",this.data.icon='\n<svg xmlns="http://www.w3.org/2000/svg" gid="fullscreenExit" style="display:${\'fullscreenExitHide\'}"  width="20" height="20" viewBox="0 0 24 24">\n<path d="M22 5.943V9h-6.5a.5.5 0 0 1-.5-.5V2h2.943v3.943H22zm-20 0h3.943V2H9v6.5a.5.5 0 0 1-.5.5H2V5.943zM22 15v2.943h-4.057V22H15v-6.5a.5.5 0 0 1 .5-.5H22zM2 15h6.5a.5.5 0 0 1 .5.5V22H5.943v-4.057H2V15z" fill="#f1f1f1"></path>\n</svg>\n'):(this.data.fullscreenHide="inline-block",this.data.fullscreenExitHide="none",this.data.title="fullscreen",this.data.icon=Fr)}},{key:"initProps",value:function(){this.getComponent("fullPage").initProps.call(this)}},{key:"bindEvent",value:function(){var t=this,e=this.options.$container,n=this.options.cssName,r=document,i=window;this.eventsList.fullscreenchange=this.addEventListener(r,"fullscreenchange",(function(){if(document.fullscreenElement||document.webkitFullscreenElement)t.fullScreen();else{var r=t.getComponent("fullPage");"fullpage"===r.data.status?(e.classList.remove(n.containerFullScreen),t.data.status="exitfullscreen",r.fullPage()):t.exitFullScreen()}})),this.eventsList.windowresize=this.addEventListener(i,"resize",(function(){document.fullscreenElement&&(t.resizeTo(screen.width,screen.height-(window.outerHeight-window.innerHeight)),t.resetPosition())})),Bn(this.$controlBarContainer).on("click","."+n.fullScreen,(function(){var e=t.data.status;t.saveOriginPosition(),"fullscreen"===e?G.exitFullscreen():G.Fullscreen(t.options.player.$container)}))}},{key:"fullScreen",value:function(){this.data.status="fullscreen";var t=this.options,e=this.options.cssName,n={width:screen.width,height:screen.height-(outerHeight-innerHeight)};G.isSafari()&&(n.height=n.height+38),t.$container.classList.add(e.containerFullScreen),this.resizeTo(n.width,n.height),this.resetPosition(),scrollTo(0,0)}},{key:"saveOriginPosition",value:function(){this.getComponent("fullPage").saveOriginPosition.call(this)}},{key:"resizeTo",value:function(t,e){this.getComponent("fullPage").resizeTo.call(this,t,e)}},{key:"resetPosition",value:function(){this.getComponent("fullPage").resetPosition.call(this)}},{key:"setProgressBarPosition",value:function(){this.getComponent("fullPage").setProgressBarPosition.call(this)}},{key:"exitFullScreen",value:function(){this.data.status="exitfullscreen";var t=this.options.cssName;this.saveOriginPosition(),this.options.$container.classList.remove(t.containerFullScreen),this.resetScreen(),this.saveOriginPosition()}},{key:"resetScreen",value:function(){this.getComponent("fullPage").resetScreen.call(this)}}]),n}(dn);function Ur(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var jr=Ke.create(Cr||(Cr=gn()(['<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\nwidth="','" height="','" viewBox="0 0 438.533 438.533" style="','" xml:space="preserve">\n<g>\n<path d="M409.133,109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736,9.801,259.058,0,219.273,0\n c-39.781,0-76.466,9.801-110.063,29.407c-33.595,19.604-60.192,46.201-79.8,79.796C9.801,142.8,0,179.489,0,219.267\n s9.804,76.463,29.407,110.062c19.607,33.585,46.204,60.189,79.799,79.798c33.597,19.605,70.283,29.407,110.063,29.407\n s76.47-9.802,110.065-29.407c33.593-19.602,60.189-46.206,79.795-79.798c19.603-33.599,29.403-70.287,29.403-110.062\n C438.533,179.489,428.732,142.795,409.133,109.203z M328.904,234.966L173.588,326.33c-2.856,1.711-5.902,2.567-9.136,2.567\n c-3.045,0-6.09-0.764-9.135-2.286c-6.09-3.614-9.136-8.939-9.136-15.985V127.907c0-7.041,3.046-12.371,9.136-15.987\n c6.28-3.427,12.369-3.333,18.271,0.284l155.316,91.36c6.088,3.424,9.134,8.663,9.134,15.703\n C338.038,226.308,334.992,231.537,328.904,234.966z" fill="','">\n</g>\n</svg>\n'])),"width","height","iconStyle","fillColor"),Hr="#999",zr=function(t){l()(n,t);var e=Ur(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"template",t.createTemplate(Nr||(Nr=gn()(['\n  <gp-button class="goldplay__screen--bigplay" title="','" data-status="','">\n  ',"\n  </gp-button>\n  "])),"title","status","icon|html")),g()(u()(t),"data",{titie:"click to play",iconStyle:"opacity:0.5",display:"hide",status:"",width:100,height:100,fillColor:Hr,icon:jr}),g()(u()(t),"options",{}),t.options=r,Object.assign(t.data,r.data),t.init(),t}return a()(n,[{key:"watch",value:function(){if("show"===this.data.display){var t=(this.element.parentNode.offsetHeight-this.data.height)/2;this.data.iconStyle="opacity:0.7;margin-top:".concat(t,"px")}}},{key:"resetPosition",value:function(){if("show"===this.data.display){var t=this.element.parentNode,e=t.offsetWidth,n=t.offsetHeight;!0===this.options.player.controlBarAutoHide&&(n-=this.options.player.controlBarHeight);var r=t.offsetTop,i=t.offsetLeft;this.element.style.width=e+"px",this.element.style.height=n+"px",this.element.style.top=r+"px",this.element.style.left=i+"px"}}},{key:"bindEvent",value:function(){var t=this,e=this.options.$screenContainer,n=this.options.cssName;Bn(e).on("click","."+n.bigPlayButton,(function(){t.events.emit(ot.default.PlayerOnPlay,t),t.events.emit(ot.default.ControlBarPlay,t),t.hide()})),Bn(e).on("mouseover","."+n.bigPlayButton,(function(){t.data.fillColor=t.options.bigPlayButtonColor||"#fff"})),Bn(e).on("mouseout","."+n.bigPlayButton,(function(e){var n=t.element,r={y:n.offsetTop,x:n.offsetLeft};r.width=n.offsetWidth,r.height=n.offsetHeight,e.pageX>r.x&&e.pageX<r.x+r.width&&e.pageY>r.y&&e.pageY<r.y+r.height||(t.data.fillColor=Hr)}))}},{key:"show",value:function(){var t=this;"show"!==this.data.display&&(this.data.display="show",this.element.style.opacity="1",setTimeout((function(){t.element.style.display="inline-block"}),1))}},{key:"hide",value:function(){"hide"!==this.data.display&&(this.element.style.opacity="0",this.data.display="hide",this.element.style.display="none")}}]),n}(dn);function Wr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Vr=function(t){l()(n,t);var e=Wr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),(t=e.call(this,r)).options=Object.assign(t.options,r),t.componentsController=t.options.componentsController,t.init(),t}return a()(n,[{key:"render",value:function(){var t=this,e=R.createEl("gp-button-block");e.classList.add("goldplay__control--button-block"),n.componentList.forEach((function(n){var r=t.componentsController.getComponent(n);e.appendChild(r.element)})),this.element=e}}],[{key:"addCustomControl",value:function(t){n.componentList.push(t)}}]),n}(dn);g()(Vr,"componentList",["playButton","pauseButton","replayButton"]);var $r=Vr;function Xr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Yr=function(t){l()(n,t);var e=Xr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),(t=e.call(this,r)).options=Object.assign(t.options,r),t.componentsController=t.options.componentsController,t.init(),t}return a()(n,[{key:"render",value:function(){var t=this,e=R.createEl("gp-control-sidebar");e.classList.add("goldplay__control--sidebar"),n.componentList.forEach((function(n){var r=t.componentsController.getComponent(n);e.appendChild(r.element)})),this.element=e}}],[{key:"addCustomControl",value:function(t,e){(e<0||e>n.componentList.length)&&(e=n.componentList.length),n.componentList.splice(e,0,t)}}]),n}(dn);g()(Yr,"componentList",["speedBar","rateBar","volumeBar","fullPage","fullScreen"]);var qr=Yr;function Gr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Zr=function(t){l()(n,t);var e=Gr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),(t=e.call(this,r)).options=Object.assign(t.options,r),t.componentsController=t.options.componentsController,t.init(),t}return a()(n,[{key:"render",value:function(){var t=this,e=R.createEl("gp-control-nearside");e.classList.add("goldplay__control--button-block"),n.componentList.forEach((function(n){var r=t.componentsController.getComponent(n);e.appendChild(r.element)})),this.element=e}}],[{key:"addCustomControl",value:function(t,e){(e<0||e>n.componentList.length)&&(e=n.componentList.length),n.componentList.splice(e,0,t)}}]),n}(dn);g()(Zr,"componentList",["playControl","timer"]);var Kr=Zr,Jr={BaseComponent:dn,controlBarContainer:kn,bigPlayButton:zr,poster:wn,progressBar:Nn,playButton:jn,pauseButton:Vn,replayButton:Gn,volumeBar:tr,waitingBar:ir,alertBox:sr,timer:lr,speedBar:yr,subtitle:mr,rateBar:kr,settingBar:Rr,fullPage:Ir,fullScreen:Mr,playControl:$r,sideControlBar:qr,nearControlBar:Kr};function Qr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var ti=Ve,ei=function(t){return t.substr(0,1).toUpperCase()+t.substr(1)},ni=function(t){l()(n,t);var e=Qr(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"allComponents",{}),g()(u()(t),"controlBarController",null),g()(u()(t),"options",{cssName:ti}),t.options=Object.assign(t.options,r),t.options.componentsController=u()(t),t.initComponents(),t.$container=t.options.$container,t.$screenContainer=t.options.$screenContainer,t.$canvas=t.options.$canvas,t.$audioContainer=t.options.$audioContainer,t.$audio=t.options.$audio,t.options.$controlBarContainer=t.controlBarContainer.element,t.bindEvent(),t}return a()(n,[{key:"run",value:function(){var t=this;for(var e in this.controlBarController&&this.controlBarController.run(),Jr)t[e]&&"function"==typeof t[e].registerMethod&&t[e].registerMethod()}},{key:"initComponents",value:function(){for(var t in Jr){var e=Jr[t];this.allComponents[t]||this.createComponent(e,t)}}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.PlayerLoadedMetaData,(function(){t.poster.hide()})),this.events.on(ot.default.AudioPlayerPlayFail,(function(){t.drawBigPlayButton(),t.getComponent("poster").hide(),t.events.emit(ot.default.PlayerOnPause,t),t.events.emit(ot.default.ControlBarPause,t)})),this.bindAlertBoxEvent(),this.bindWaitingBarEvent()}},{key:"bindWaitingBarEvent",value:function(){this.waitingBar.initProps(),this.waitingBar.bindEvent()}},{key:"drawBigPlayButton",value:function(){this.$screenContainer.prepend(this.bigPlayButton.element),this.bigPlayButton.show(),this.bigPlayButton.bindEvent(),this.bigPlayButton.resetPosition()}},{key:"setControlBarController",value:function(t){this.controlBarController=t}},{key:"getControlBarController",value:function(){return this.controlBarController||this.options.player.controlBarContainer}},{key:"bindAlertBoxEvent",value:function(){this.alertBox.initProps(),this.alertBox.bindEvent()}},{key:"drawPoster",value:function(){this.$screenContainer.prepend(this.poster.element),this.poster.data.display="show",this.poster.bindEvent(),this.poster.resetPosition()}},{key:"createComponent",value:function(t,e){var n=ei(e);this["set"+n](new t(this.options)),this[e]=this["get"+n](),this.allComponents[e]||(this.allComponents[e]=this[e])}},{key:"getComponent",value:function(t){return this.allComponents[t]||Jr[t]&&this.createComponent(Jr[t],t),this.allComponents[t]}},{key:"resetAllComponents",value:function(){var t=this,e=Object.getOwnPropertyNames(this),n={};e.forEach((function(e){Jr[e]&&(n[e]=t[e])})),this.allComponents=n}},{key:"getAllComponents",value:function(){return this.allComponents}}]),n}(B);for(var ri in ni.addComponet=function(t){var e=ei(t);ni.prototype["set"+e]=function(e){this[t]=e},ni.prototype["get"+e]=function(){return this[t]}},Jr)ni.addComponet(ri);var ii=ni;function oi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var ai=Ve,si=function(t){l()(n,t);var e=oi(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i()(this,n),t=e.call(this,r),g()(u()(t),"player",null),g()(u()(t),"loadData",null),g()(u()(t),"options",{cssName:ai}),t.options=Object.assign(t.options,r),t.player=t.options.player,t.loadData=t.player.loadData,t.componentsController=t.player.componentsController,t.$screenContainer=t.player.$screenContainer,t.initComponents(),t}return a()(n,[{key:"initComponents",value:function(){var t=this.componentsController;this.options.controlBar?Object.assign(this,t.getAllComponents()):Object.assign(this,{BaseComponent:t.getComponent("BaseComponent"),waitingBar:t.getComponent("waitingBar")}),this.container=this.controlBarContainer}},{key:"run",value:function(){this.drawLayout(),this.bindEvent(),"playing"===this.player.status||this.player.autoPlay?this.events.emit(ot.default.ControlBarPlay):this.events.emit(ot.default.ControlBarPause)}},{key:"bindEvent",value:function(){this.bindWaitingBarEvent(),this.options.controlBar&&(this.timer.setTotalTime(this.loadData),this.bindSpeedEvent(),this.bindContainerEvent(),this.bindTimerEvent(),this.bindPlayEvent(),this.bindProgressEvent(),this.bindRateEvent(),this.bindVolumeEvent(),this.bindFullPage(),this.bindFullScreen())}},{key:"bindContainerEvent",value:function(){this.container.initProps(),this.container.bindEvent()}},{key:"bindTimerEvent",value:function(){this.timer.initProps(),this.timer.bindEvent()}},{key:"bindSpeedEvent",value:function(){this.speedBar.bindEvent(),this.speedBar.resetBoxPosition()}},{key:"bindRateEvent",value:function(){this.rateBar.bindEvent(),this.rateBar.resetBoxPosition()}},{key:"bindFullPage",value:function(){this.fullPage.initProps(),this.fullPage.bindEvent()}},{key:"bindFullScreen",value:function(){this.fullScreen.initProps(),this.fullScreen.bindEvent()}},{key:"bindWaitingBarEvent",value:function(){var t=this;[ot.default.PlayerWait,ot.default.PlayerSeeking,ot.default.PlayerReset,ot.default.PlayerChangeRate,ot.default.PlayerChangeSrc].forEach((function(e){t.events.on(e,(function(){t.waitingBar.showWaiting()}))})),this.events.on(ot.default.PlayerSeekEnd,(function(){t.waitingBar.hideWaiting()})),this.events.on(ot.default.PlayerPlay,(function(){t.waitingBar.hideWaiting()})),this.events.on(ot.default.PlayerPlaying,(function(){t.waitingBar.hideWaiting()}))}},{key:"bindPlayEvent",value:function(){var t=this;this.events.on(ot.default.ControlBarPlay,(function(){"pause"!==t.pauseButton.data.status&&(t.pauseButton.data.status="pause"),t.replayButton.hide(),t.playButton.hide(),t.pauseButton.show(),t.bigPlayButton.hide()})),this.events.on(ot.default.ControlBarPause,(function(){"pause"!==t.player.status&&(t.pauseButton.data.status="pause"),t.playButton.show(),t.pauseButton.hide()})),this.events.on(ot.default.PlayerEnd,(function(){t.replayButton.show(),t.pauseButton.hide(),t.playButton.hide()})),this.events.on(ot.default.PlayerPlay,(function(){t.events.emit(ot.default.ControlBarPlay,t)})),this.events.on(ot.default.PlayerPause,(function(){t.events.emit(ot.default.ControlBarPause,t)})),this.events.on(ot.default.PlayerOnSeek,(function(e){e<1e3*t.loadData.sourceData.duration&&t.events.emit(ot.default.ControlBarPauseLoading)})),this.events.on(ot.default.ControlBarPauseLoading,(function(){"pauseloading"!==t.pauseButton.data.status&&(t.pauseButton.data.status="pauseloading"),t.replayButton.hide(),t.playButton.hide(),t.pauseButton.show()})),this.events.on(ot.default.PlayerSeekEnd,(function(){t.replayButton.hide(),"playing"===t.player.status||"playing"===t.player.statusBeforeSeek?(t.playButton.hide(),t.pauseButton.show()):(t.playButton.show(),t.pauseButton.hide())})),Bn(this.options.$container).on("click","."+ai.playButton,(function(){"play"!==t.player.status&&t.events.emit(ot.default.PlayerOnPlay,t)})),Bn(this.options.$container).on("click","."+ai.pauseButton,(function(){"pause"!==t.player.status&&t.events.emit(ot.default.PlayerOnPause,t)})),Bn(this.options.$container).on("click","."+ai.replayButton,(function(){t.events.emit(ot.default.PlayerOnSeek,t.player.startTime)}))}},{key:"bindProgressEvent",value:function(){this.progressBar.initProps(),this.progressBar.bindEvent()}},{key:"bindVolumeEvent",value:function(){this.volumeBar.initProps(),this.volumeBar.initVolumeSize(this.player.muted),this.volumeBar.bindEvent()}},{key:"drawLayout",value:function(){var t=this.options.$container;if(this.container){var e=this.container.element;t.append(e)}}},{key:"destroy",value:function(){this.removeEventListenerGlobal(),this.container&&this.container.destroy()}},{key:"removeEventListenerGlobal",value:function(){this.progressBar&&this.progressBar.progressDragEvent&&this.progressBar.progressDragEvent.removeEventListenerAll(),this.volumeBar&&this.volumeBar.volumeDragEvent&&this.volumeBar.volumeDragEvent.removeEventListenerAll(),this.fullPage&&this.fullPage.removeEventListenerAll(),this.fullScreen&&this.fullScreen.removeEventListenerAll()}}]),n}(B),ui=n(35),ci=n.n(ui);function li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var fi=null,hi=function(t){l()(n,t);var e=li(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"isLast",!1),r.type=t.type,r.libPath=t.libPath,r.player=t.player,r.keepCache=r.player.options.keepCache,r.init(),r.codecError=!1,r}return a()(n,[{key:"init",value:function(){"ts"==this.type&&this.initNornalWorker(),this.bindEvent(),this.loadjs()}},{key:"initNornalWorker",value:function(){this.processor=this.initWorker()}},{key:"initWorker",value:function(){var t=this,e=ci()(112);return e.onmessage=function(e){if(!t.codecError){var n=e.data,r=n.type,i=n.no,o=n.poolIndex,a=n.data;switch(r){case"dataProcessorReady":t.onDataProcessorReady();break;case"decoded":t.onDecoded(a,i,o);break;case"demuxedAAC":t.onDemuxedAAC(a,i);break;case"partEnd":t.onPartEnd(a,i);break;case"resetEnd":t.onResetEnd();break;case"maxPTS":t.onMaxPTS(a);break;case"flushEnd":t.onFlushEnd(a);break;case"codecError":t.onCodecError()}}},e}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.DemuxStartDemux,this.onStartDemux.bind(this)),this.events.on(ot.default.DemuxLast,(function(){t.isLast=!0})),this.events.on(ot.default.DecodeFlush,(function(){t.flush()}))}},{key:"flush",value:function(){this.processor.postMessage({type:"flush",sourceType:this.player.options.type})}},{key:"loadjs",value:function(){this.processor.postMessage({type:"loadwasm",libPath:this.libPath,codec:this.options.codec,sourceType:this.player.options.type})}},{key:"reset",value:function(){this.isLast=!1,this.processor.terminate(),this.initNornalWorker(),this.loadjs(),this.codecError=!1}},{key:"onFlushEnd",value:function(t){this.events.emit(ot.default.DecodeFlushEnd,t)}},{key:"onMaxPTS",value:function(t){this.events.emit(ot.default.PlayerMaxPTS,t.maxAudioPTS,t.maxVideoPTS)}},{key:"onDemuxedAAC",value:function(t,e){this.events.emit(ot.default.DemuxAAC,t,e),this.player.loadData.segmentPool.find((function(t){return t.no===e})).decoded&&this.keepCache&&this.events.emit(ot.default.DecodeApppendEnd)}},{key:"onDataProcessorReady",value:function(){this.player.seeking||this.player.reseting?this.events.emit(ot.default.ProcessorResetEnd):this.events.emit(ot.default.DataProcessorReady)}},{key:"onStartDemux",value:function(t){if(!this.player.reseting){this.logger.info("onStartDemux","postMessage to demux",t.no);var e=this.player.loadData.segmentPool.find((function(e){return e.no===t.no}));if(e.decoded&&this.keepCache){this.events.emit(ot.default.ImagePlayerReady),this.events.emit(ot.default.PlayerSeekEnd);var n=this.player.imagePlayer;n.ready=!0,n.status="ready",n.render(this.player.currentTime,!1)}t&&t.arrayBuffer&&t.arrayBuffer.byteLength>0?(this.demuxNo=t.no,this.processor.postMessage({type:"startDemux",data:t.arrayBuffer.slice(),no:t.no,decoded:e.decoded,poolIndex:this.player.imagePlayer.imageData.poolIndex,sourceType:this.player.options.type,isLast:this.isLast}),this.player.loadData.loadSegmentByNo(t.no+1)):this.logger.error("onStartDemux","data is null","data:",t)}}},{key:"onDecoded",value:function(t,e,n){this.player.reseting||this.events.emit(ot.default.DecodeDecoded,t,e,n)}},{key:"onPartEnd",value:function(t,e){var n=this.player.loadData.segmentPool.find((function(t){return t.no===e}));n&&this.keepCache&&(n.decoded=!0),this.events.emit(ot.default.DecodeApppendEnd,t)}},{key:"onResetEnd",value:function(){this.events.emit(ot.default.ProcessorResetEnd)}},{key:"destroy",value:function(){this.processor&&this.processor.terminate()}},{key:"onCodecError",value:function(){var t=this;this.codecError=!0,clearTimeout(fi),fi=setTimeout((function(){t.events.emit(ot.default.DemuxCodecError)}),100)}}]),n}(C.a);function pi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var di=null,yi=[],gi=function(t){l()(n,t);var e=pi(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"currentIndex",null),g()(u()(r),"retryTime",0),g()(u()(r),"dataReady",{audioReady:!1,imageReady:!1}),g()(u()(r),"hasInit",!1),g()(u()(r),"loadDataStatus","loading"),g()(u()(r),"duration",0),g()(u()(r),"tsNumber",0),r.loadData=t.loadData,r.imagePlayer=t.imagePlayer,r.audioPlayer=t.audioPlayer,r.player=t.player,r.keepCache=r.player.options.keepCache,r.bindEvent(),r}return a()(n,[{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.LoadDataRead,(function(e){if(e){var n=e.no;"".concat(t.player.options.sourceURL,"-").concat(n);t.onRead(e)}})),this.events.on(ot.default.DemuxVideo,(function(e,n){t.onVideoDemuxed(e,n)})),this.events.on(ot.default.DemuxAAC,(function(e,n){t.onAACDemuxed(e,n)})),this.events.on(ot.default.DecodeDecoded,(function(e,n,r){t.onDecoded(e,n,r)})),this.events.on(ot.default.DecodeApppendEnd,(function(e){t.onAppendEnd(e)})),this.events.on(ot.default.ImagePlayerReady,(function(){t.logger.info("bindevent","Events.ImagePlayerReady"),t.checkDataReady("imageReady")})),this.events.on(ot.default.AudioPlayerDataReady,(function(){t.logger.info("bindevent","Events.AudioPlayerDataReady"),t.player.receiveAACTime=null,t.checkDataReady("audioReady")})),this.events.on(ot.default.AudioPlayerWait,(function(){t.dataReady.audioReady=!1,t.events.emit(ot.default.PlayerWait,"audioPlayer")})),this.events.on(ot.default.ImagePlayerWait,(function(){t.dataReady.imageReady=!1,t.events.emit(ot.default.PlayerWait,"imagePlayer")})),this.events.on(ot.default.ImagePlayerEnd,(function(){t.player.currentTime>=1e3*t.player.duration&&(t.logger.info("bindevent","........imageplayer end"),t.events.emit(ot.default.PlayerEnd))})),this.events.on(ot.default.PlayerWait,(function(){t.logger.warn("player status wait"),t.player.statusBeforeWait=t.player.status,t.player.status="wait","loadend"===t.loadDataStatus&&(t.loadDataStatus="loading",t.loadNext())})),this.events.on(ot.default.PlayerLoadNext,(function(){"loadend"===t.loadDataStatus&&(t.loadDataStatus="loading",t.loadNext())})),this.events.on(ot.default.ImagePlayerSwitchPool,(function(e){t.startLoad(e)})),this.events.on(ot.default.DecodeFlushEnd,(function(e){t.logger.info("flushend>>>>>>>>>>>>>>>",e),t.imagePlayer.maxPTS=e}))}},{key:"checkDataReady",value:function(t){var e=this.dataReady;e[t]=!0;for(var n=Object.keys(e),r=0,i=0;i<n.length&&e[n[i]];i++)r++;r==n.length&&this.events.emit(ot.default.StreamDataReady)}},{key:"setBaseInfo",value:function(t){this.duration=t.duration,this.tsNumber=t.tsNumber}},{key:"reset",value:function(){this.dataReady={audioReady:!1,imageReady:!1},this.currentIndex=null,this.loadDataStatus="loading"}},{key:"startLoad",value:function(t){this.logger.info("startLoad","index:",t),this.currentIndex=t,this.player.currentIndex=t,this.events.emit(ot.default.LoadDataReadBufferByNo,t)}},{key:"loadNext",value:function(){if(this.player.reseting)this.loadDataStatus="loadend";else{if(this.currentIndex>=this.tsNumber)return this.logger.info("loadNext","load end","currentIndex",this.currentIndex,"tsNumber:",this.tsNumber),void(this.loadDataStatus="loadend");this.currentIndex+=1,this.player.currentIndex=this.currentIndex,this.logger.info("loadNext","load next ts","tsno:",this.currentIndex),this.events.emit(ot.default.LoadDataReadBufferByNo,this.currentIndex)}}},{key:"onDecoded",value:function(t,e,n){var r=this;t.forEach((function(t){t.no=e;var i=r.loadData.segmentPool.find((function(t){return t.no===e}));null==i.startVideoPts&&(i.startVideoPts=t.pts-1e3*i.start),t.pts=t.pts-i.startVideoPts,t.pts>=r.player.currentTime?r.imagePlayer.push(t,n):r.keepCache&&(t.poolIndex=n,yi.push(t),clearTimeout(di),di=setTimeout((function(){for(;yi.length;){var t=yi.shift();r.imagePlayer.push(t,t.poolIndex)}}),100))}))}},{key:"onAppendEnd",value:function(t){return this.loadDataStatus="loadend",t?(this.logger.info("onAppendEnd","events.decodeFlush",t),void this.events.emit(ot.default.DecodeFlush)):(this.logger.info("onAppendEnd","start load next ts condition",this.checkBuffer(),this.currentIndex),this.checkBuffer()&&null!==this.currentIndex?(this.logger.info("onAppendEnd","load next ts. currentIndex:",this.currentIndex),void this.loadNext()):void this.logger.info("onAppendEnd","load ts stop"))}},{key:"onAACDemuxed",value:function(t,e){var n=this;this.player.reseting||(t.length||this.audioPlayer.send({}),this.logger.info("StreamController","onAACDemuxed","tsno:",e,t.length),t.forEach((function(t){var r=n.loadData.segmentPool.find((function(t){return t.no===e}));null==r.startAudioPts&&(r.startAudioPts=t.PTS-1e3*r.start),t.PTS=t.PTS-r.startAudioPts,(t.PTS>=n.player.currentTime||t.audioEnd)&&(!n.player.receiveAACTime&&n.player.seeking&&(n.player.receiveAACTime=Date.now()),n.audioPlayer.send(t))})))}},{key:"onVideoDemuxed",value:function(t){this.player.reseting||this.events.emit(ot.default.DecodeStartDecode,t)}},{key:"checkBuffer",value:function(){var t=this.player,e=t.currentTime,n=(t.buffer()[1]||0)-e,r=t.playbackRate*t.maxBufferLength;return n>0&&!(n>r)}},{key:"onRead",value:function(t){this.player.reseting||(t&&t.arrayBuffer&&(t.no===this.currentIndex||this.player.playbackRate>1||"MP4"===this.player.options.type)?(this.retryTime=0,this.logger.warn("onRead","get stream data",t.no),t.no!==this.tsNumber||this.player.options.isLive||(this.logger.info("onRead","the last ts"),this.events.emit(ot.default.DemuxLast)),this.events.emit(ot.default.DemuxStartDemux,t)):this.logger.error("onRead","load ts failred","tsno:",this.currentIndex))}},{key:"readFromCache",value:function(t,e){var n=this;t.forEach((function(t){(t.PTS>=n.player.currentTime||t.audioEnd)&&(!n.player.receiveAACTime&&n.player.seeking&&(n.player.receiveAACTime=Date.now()),n.audioPlayer.send(t))})),e.forEach((function(t){n.player.reseting||t.pts>=n.player.currentTime&&n.imagePlayer.push(t)})),this.events.emit(ot.default.DecodeFlush)}}]),n}(C.a);function vi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var mi=null,bi=function(t){l()(n,t);var e=vi(n);function n(t){var r;return i()(this,n),r=e.call(this,t),g()(u()(r),"maxBufferLength",0),g()(u()(r),"duration",0),g()(u()(r),"pools",[[]]),g()(u()(r),"poolIndex",0),g()(u()(r),"start",0),g()(u()(r),"end",0),g()(u()(r),"offset",null),g()(u()(r),"fps",25),r.maxBufferLength=t.maxBufferLength,r.player=t.player,r.keepCache=r.player.options.keepCache,r}return a()(n,[{key:"push",value:function(t,e){var n=null==e?this.poolIndex:e,r=this.pools[n],i=r.length;null==this.offset&&(this.offset=t.pts,this.start=t.pts,this.fps=t.fps===1/0?25:t.fps),0===t.duration&&(t.duration=1e3/this.fps);var o=this.insertSort(r,t);if(-1!==o){if(r[o-1]){var a=r[o].pts-r[o-1].pts;r[o-1].duration=a}if(r[o+1]){var s=r[o+1].pts-r[o].pts;r[o].duration=s}e===this.poolIndex&&(this.end=r[i].pts+r[i].duration,this.duration=this.end-this.start),this.pools.length>1&&this.joinPools()}}},{key:"joinPools",value:function(){var t=this.pools.slice();t.sort((function(t,e){return t[0].pts-e[0].pts}));for(var e=0;e<t.length;e++){var n=t[e],r=t[e+1];if(r){var i=n[n.length-1],o=r[0].pts-i.pts;o<=200&&o>i.duration&&(i.duration=o)}}}},{key:"insertSort",value:function(t,e){var n=t.length;if(0===n)return t.push(e),0;if(t.findIndex((function(t){return t.pts===e.pts}))>-1)return-1;for(var r=0;r<n;r++)if(e.pts<t[r].pts){for(var i=n;i>r;)t[i]=t[i-1],i--;return t[r]=e,r}return t.push(e),t.length-1}},{key:"checkPool",value:function(){this.keepCache&&this.pools.length>3&&(this.pools.sort((function(t,e){return t.timestamp-e.timestamp})),this.pools=this.pools.slice(this.pools.length-3),this.joinPools())}},{key:"reset",value:function(t){var e=!1;(clearInterval(mi),mi=null,this.keepCache)?this.pools[this.poolIndex].length&&(-1===this.findIndex(t)&&(e=!0,this.poolIndex+=1,this.pools[this.poolIndex]=[]),this.pools[this.poolIndex].timestamp=Date.now()):(e=!0,this.offset=null,this.pools=[[]]);e&&(this.duration=0,this.start=0,this.end=0)}},{key:"find",value:function(t){var e=this.pools[this.poolIndex];if(0!==e.length){var n=this.findIndex(t,e);if(-1!==n){var r=e[n];return this.checkBuffer(t),e.timestamp=Date.now(),r}return this.findInPools(t)}}},{key:"findInPools",value:function(t){if(this.keepCache)for(var e=0;e<this.pools.length;e++){var n=this.pools[e],r=this.findIndex(t,n);if(r>-1){var i=n[n.length-1];return this.switchPool(e,i.no),n[r]}}}},{key:"switchPool",value:function(t,e){this.poolIndex=t;var n=this.pools[t];n.timestamp=Date.now(),this.start=n[0].pts;var r=n[n.length-1];this.end=r.pts+r.duration,this.duration=this.end-this.start,this.events.emit(ot.default.ImagePlayerSwitchPool,e)}},{key:"findIndex",value:function(t,e){for(var n=-1,r=0,i=(e=e||this.pools[this.poolIndex]).length;r<i;r++){var o=e[i-r-1],a=parseInt(o.pts);if(a<=t&&t<a+o.duration){n=i-r-1;break}}return n}},{key:"isBuffered",value:function(t){if(this.findIndex(t)>-1)return!0;if(this.keepCache){for(var e=0;e<this.pools.length;e++){var n=this.pools[e];if(this.findIndex(t,n)>-1){var r=n[n.length-1];return this.switchPool(e,r.no),!0}}return!1}}},{key:"checkBuffer",value:function(t){var e=this.duration,n=this.maxBufferLength,r=this.player.loadData.segmentPool.getLast().duration,i=this.player.streamController;if(e>n&&!this.keepCache){if(t>this.start){var o=this.pools[this.poolIndex],a=this.findIndex(t),s=o.splice(0,a);s.forEach((function(t){null})),s=null,this.start=o[0].pts,this.duration=this.end-this.start}return!1}return this.end-this.offset-this.player.currentTime<1e3*r&&i.currentIndex<i.tsNumber&&this.events.emit(ot.default.PlayerLoadNext),!0}},{key:"buffer",value:function(){return{start:this.start,end:this.end}}}]),n}(C.a),_i=n(64),wi=n.n(_i),Ei=n(21);function ki(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Si=function(t){l()(c,t);var e,n,r,o,s=ki(c);function c(t){var e;return i()(this,c),e=s.call(this,t),g()(u()(e),"maxBufferLength",0),g()(u()(e),"duration",0),g()(u()(e),"pools",[[]]),g()(u()(e),"poolIndex",0),g()(u()(e),"start",0),g()(u()(e),"end",0),g()(u()(e),"offset",null),g()(u()(e),"fps",25),e.maxBufferLength=t.maxBufferLength,e.player=t.player,e.keepCache=e.player.options.keepCache,e.initBfs(),e}return a()(c,[{key:"initBfs",value:function(){var t=this,e=this.player.options.sourceURL.match(/([^/]+?)\.m3u8/)[1];this.filename=e,Object(Ei.b)(e,"HTML5FS",(function(e){t.logger.info("fs=",e),t.g_imgio=Ei.a}),(function(e,n,r){t.logger.info("read=",e,n,r)}),(function(e,n,r){t.logger.info("write=",e,n,r)}))}},{key:"push",value:(o=Qe()(en.a.mark((function t(e,n){var r,i,o,a,s;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==n?this.poolIndex:n,i=this.pools[r],o=i.length,null==this.offset&&(this.offset=e.pts,this.start=e.pts,this.fps=e.fps===1/0?25:e.fps),e.pts=parseInt(e.pts,10),!((a=this.findIndexAll(e.pts))>-1)){t.next=8;break}return t.abrupt("return");case 8:if(-1!==(a=this.insertSort(i,e))){t.next=11;break}return t.abrupt("return");case 11:if(this.setDuration(),n===this.poolIndex&&(this.end=i[o].pts+i[o].duration,this.duration=this.end-this.start),!(s=i[a]).buf_y||!s.buf_y.length||"pending"===s.buf_y){t.next=17;break}return t.next=17,Ei.a.saveImg(n,s.pts,s);case 17:s.pts-this.start>5e3&&(delete s.buf_y,delete s.buf_u,delete s.buf_v);case 18:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"setDuration",value:function(){var t=1e3/this.fps*4,e=this.pools.reduce((function(t,e){return t.concat(e)}),[]);e.sort((function(t,e){return t.pts-e.pts}));for(var n=0;n<e.length-1;n++){var r=e[n],i=e[n+1].pts-r.pts;r.duration=i<t?i:t}}},{key:"joinPools",value:function(){var t=this.pools.slice();t.sort((function(t,e){return t.length?e.length?t[0].pts-e[0].pts:-1:1}));for(var e=1e3/this.fps*5,n=0;n<t.length;n++){var r=t[n],i=t[n+1];if(i&&i.length){var o=r[r.length-1],a=i[0].pts-o.pts;a<=e&&a>o.duration&&(o.duration=a)}}}},{key:"insertSort",value:function(t,e){var n=t.length;if(0===n)return t.push(e),0;if(t.findIndex((function(t){return t.pts===e.pts}))>-1)return-1;for(var r=0;r<n;r++)if(e.pts<t[r].pts){for(var i=n;i>r;)t[i]=t[i-1],i--;return t[r]=e,r}return t.push(e),t.length-1}},{key:"checkPool",value:function(){this.keepCache&&this.pools.length>3&&(this.pools.sort((function(t,e){return t.timestamp-e.timestamp})),this.pools=this.pools.slice(this.pools.length-3),this.joinPools())}},{key:"reset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;if(this.keepCache){e&&Ei.a.empty();var r=this.pools[this.poolIndex];r.length&&(-1===this.findIndex(t)&&(n=!0,this.poolIndex+=1,this.pools[this.poolIndex]=[]),this.pools[this.poolIndex].timestamp=Date.now())}else n=!0,this.offset=null,this.pools=[[]];n&&(this.duration=0,this.start=0,this.end=0)}},{key:"preload",value:(r=Qe()(en.a.mark((function t(e){var n,r,i,o,a,s,u,c,l,f,h,p,d;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.keepCache){t.next=2;break}return t.abrupt("return");case 2:n=1e3/this.fps,r=1,i=4*this.fps;case 4:if(!(r<i)){t.next=31;break}o=e+n*r,a=0;case 7:if(!(a<this.pools.length)){t.next=28;break}if(s=this.pools[a],!((u=this.findIndex(o,s))>-1)){t.next=25;break}if((c=s[u]).buf_y){t.next=25;break}return c.buf_y="pending",t.next=16,Ei.a.loadImg(a,c.pts);case 16:l=t.sent,h=(f=l).buf_y,p=f.buf_u,d=f.buf_v,c.buf_y=h,c.buf_u=p,c.buf_v=d,l.buf_y=null,l.buf_u=null,l.buf_v=null,l=null;case 25:a++,t.next=7;break;case 28:r++,t.next=4;break;case 31:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"find",value:(n=Qe()(en.a.mark((function t(e){var n,r,i,o,a,s,u,c;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.preload(e),n=this.pools[this.poolIndex],-1===(r=this.findIndex(e,n))){t.next=21;break}if(i=n[r],this.checkBuffer(e),n.timestamp=Date.now(),!i.buf_y||"pending"===i.buf_y){t.next=9;break}return t.abrupt("return",i);case 9:return t.next=11,Ei.a.loadImg(this.poolIndex,i.pts);case 11:return o=t.sent,s=(a=o).buf_y,u=a.buf_u,c=a.buf_v,i.buf_y=s,i.buf_u=u,i.buf_v=c,o.buf_y=null,o.buf_u=null,o.buf_v=null,o=null,t.abrupt("return",i);case 21:return t.abrupt("return",this.findInPools(e));case 22:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"findInPools",value:(e=Qe()(en.a.mark((function t(e){var n,r,i,o,a,s,u,c,l;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.keepCache){t.next=25;break}n=0;case 2:if(!(n<this.pools.length)){t.next=25;break}if(r=this.pools[n],!((i=this.findIndex(e,r))>-1)){t.next=22;break}if(o=r[i],this.switchPool(n,o.no),!o.buf_y||"pending"===o.buf_y){t.next=10;break}return t.abrupt("return",o);case 10:return t.next=12,Ei.a.loadImg(n,o.pts);case 12:return a=t.sent,u=(s=a).buf_y,c=s.buf_u,l=s.buf_v,o.buf_y=u,o.buf_u=c,o.buf_v=l,a.buf_y=null,a.buf_u=null,a.buf_v=null,wi()("data"),t.abrupt("return",o);case 22:n++,t.next=2;break;case 25:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"switchPool",value:function(t,e){this.poolIndex=t;var n=this.pools[t];n.timestamp=Date.now(),this.start=n[0].pts;var r=n[n.length-1];this.end=r.pts+r.duration,this.duration=this.end-this.start,this.events.emit(ot.default.ImagePlayerSwitchPool,e)}},{key:"findIndex",value:function(t,e){for(var n=-1,r=0,i=(e=e||this.pools[this.poolIndex]).length;r<i;r++){var o=e[i-r-1],a=parseInt(o.pts,10);if(a<=t&&t<a+o.duration){n=i-r-1;break}}return n}},{key:"findIndexAll",value:function(t){for(var e=0,n=this.pools.length;e<n;e++){var r=this.pools[e].findIndex((function(e){return e.pts===t}));if(r>-1)return r}return-1}},{key:"isBuffered",value:function(t){if(this.findIndex(t)>-1)return!0;if(this.keepCache){for(var e=0;e<this.pools.length;e++){var n=this.pools[e];if(this.findIndex(t,n)>-1){var r=n[n.length-1];return this.switchPool(e,r.no),!0}}return!1}}},{key:"checkBuffer",value:function(){if(this.end-this.offset-this.player.currentTime<1e4){var t=this.player,e=t.streamController;if(t.reseting)return!0;e.currentIndex<e.tsNumber&&e.loadNext()}return!0}},{key:"buffer",value:function(){return{start:this.start,end:this.end}}}]),c}(C.a),xi=n(65),Ti=n.n(xi),Pi=n(49),Ri=n.n(Pi);function Li(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ai=function(t){l()(n,t);var e=Li(n);function n(t){var r;i()(this,n),r=e.call(this),g()(u()(r),"canvas",null);var o=t.player,a=t.canvas,s=t.width,c=t.height,l=t.autoScale;return r.player=o,r.setCanvas(a),r.setRender(),r.width=s,r.height=c,r.autoScale=l,r}return a()(n,[{key:"setCanvas",value:function(t){this.canvas=t}},{key:"setRender",value:function(t){this.render=Ti.a.attach(t||this.canvas,{autoScale:this.autoScale})}},{key:"clear",value:function(){this.render.clear()}},{key:"drawFrame",value:function(t){var e,n,r,i,o,a=Date.now(),s=t.buf_y,u=t.buf_u,c=t.buf_v,l=t.width,f=t.height,h=l/2,p=f/2;e={bytes:s,stride:t.stride_y},n={bytes:u,stride:t.stride_u},r={bytes:c,stride:t.stride_v};var d=this.player.dims,y=d.width,g=d.height,v={displayWidth:this.autoScale?y:this.width,displayHeight:this.autoScale?g:this.height,width:l,height:f,chromaWidth:h,chromaHeight:p};i=Ri.a.format(v),o=Ri.a.frame(i,e,n,r),this.render.drawFrame(o);var m=Date.now();m-a>10&&this.logger.warn("drawFrame","reandertime:",m-a)}}]),n}(C.a);function Bi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Di=null,Ii=function(t){l()(o,t);var e,n,r=Bi(o);function o(t){var e;return i()(this,o),e=r.call(this,t),g()(u()(e),"status","pause"),g()(u()(e),"_currentTime",0),g()(u()(e),"maxPTS",null),g()(u()(e),"ready",!1),g()(u()(e),"firstRender",!1),e.playHandler=null,e.player=t.player,e.debug=t.debug||!1,e.autoScale=e.player.options.autoScale,e.keepCache=e.player.options.keepCache,e.screen=new Ai({player:e.player,canvas:t.canvas,width:e.player.screenWidth,height:e.player.screenHeight,autoScale:e.player.options.autoScale}),e.imageData=new(e.keepCache?Si:bi)({events:t.events,maxBufferLength:t.maxBufferLength,player:t.player}),e}return a()(o,[{key:"setScreenRender",value:function(t){this.screen.setCanvas(t),this.screen.setRender(t)}},{key:"clear",value:function(){this.screen.clear()}},{key:"play",value:function(t){"play"!==this.status&&(this.status="play",this.render(t))}},{key:"pause",value:function(){"pause"!==this.status&&(this.status="pause",clearTimeout(this.playHandler),this.playHandler=null)}},{key:"checkBuffer",value:function(){return this.imageData.checkBuffer(this.currentTime)}},{key:"push",value:function(t,e){if(this.imageData.push(t,e),e===this.imageData.poolIndex){var n=this.end-this.player.currentTime,r=N.d.READYBUFFERLENGTH;if(this.player.playbackRate>1&&(r*=8*this.player.playbackRate),n>r&&!this.ready){var i,o,a=this.player.currentTime<this.imageData.start?this.imageData.start:this.player.currentTime;o=a,i=this.render(a,!1),this.maxPTS||(this.maxPTS=this.imageData.offset+1e3*this.player.duration-1e3/this.imageData.fps*5),i&&(this.ready=!0,this.status="ready",this.player.seeking=!1,this.events.emit(ot.default.ImagePlayerReady),this.events.emit(ot.default.StreamDataReady),this.events.emit(ot.default.ImagePlayerBuffeUpdate),this.keepCache&&this.imageData.preload(o))}}}},{key:"find",value:(n=Qe()(en.a.mark((function t(e){var n;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.imageData.find(e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"buffer",value:function(){return this.imageData.buffer()}},{key:"isBuffered",value:function(t){return this.imageData.isBuffered(t)}},{key:"render",value:(e=Qe()(en.a.mark((function t(e){var n,r,i=this,o=arguments;return en.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(o.length>1&&void 0!==o[1])||o[1],!(e<this.imageData.offset)){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.find(e);case 5:if(!(r=t.sent)){t.next=17;break}return this.currentNo=r.no,this.firstRender||(this.firstRender=!0,this.events.emit(ot.default.PlayerLoadedMetaData,r.width,r.height)),this.screen.drawFrame(r),this.currentTime=Math.max(r.pts,e),n&&this.events.emit(ot.default.ImagePlayerRenderEnd,e,r.duration),this.keepCache&&(r.buf_y=null,r.buf_u=null,r.buf_v=null),r=null,t.abrupt("return",!0);case 17:if(!(this.maxPTS&&e>=this.maxPTS)){t.next=21;break}return this.status="end",this.events.emit(ot.default.ImagePlayerEnd,this.maxPTS),t.abrupt("return");case 21:return this.logger.warn("Events.ImagePlayerWait",e,this.start,this.end,this.imageData.poolIndex),this.logger.warn("render","not yuv data"),this.pause(),this.status="wait",this.ready=!1,this.events.emit(ot.default.ImagePlayerWait,"image","this"),(this.keepCache||e>this.end)&&(clearTimeout(Di),Di=setTimeout((function(){var t=e/1e3,n=i.player,r=n.processController,o=n.streamController,a=n.loadData,s=a.getSegmentByTime(t);if(s){var u=s.no;i.logger.info("checkDemuxNo",r.demuxNo,u),r.demuxNo===u&&(u+=1),a.bufferPool.getByKeyValue("no",u)[0]?(i.logger.info("streamController","startLoad",u),o.startLoad(u)):(i.logger.info("loadData","loadSegmentByNo",u),a.loadSegmentByNo(u))}}),1e3)),t.abrupt("return",!1);case 29:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"reset",value:function(t,e){this.pause(),this.status="pause",this.ready=!1,this.imageData.reset(t,e),this.maxPTS=null,this.currentTime=0}},{key:"resetScreen",value:function(){this.player.$canvas.width=this.player.screenWidth,this.player.$canvas.height=this.player.screenHeight,this.screen=new Ai({player:this.player,canvas:this.player.$canvas,width:this.player.screenWidth,height:this.player.screenHeight,autoScale:this.player.options.autoScale}),this.render(this.currentTime,!1)}},{key:"currentTime",get:function(){return this._currentTime},set:function(t){this._currentTime=t}},{key:"offset",get:function(){return this.imageData.offset}},{key:"fragDuration",get:function(){return Math.ceil(1e3/this.imageData.fps)}},{key:"start",get:function(){return this.imageData.start}},{key:"end",get:function(){return this.imageData.end}},{key:"duration",get:function(){return this.imageData.duration}}]),o}(C.a);function Oi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Ci=null,Ni=null,Fi=new WeakMap,Mi=new WeakMap,Ui=new WeakMap,ji=new WeakMap,Hi=new WeakMap,zi=function(t){l()(n,t);var e=Oi(n);function n(t){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,n),r=e.call(this),g()(u()(r),"mode",N.c.mode),g()(u()(r),"$container",null),g()(u()(r),"componentsController",null),g()(u()(r),"controlBar",!1),g()(u()(r),"controlBarController",null),g()(u()(r),"controlBarHeight",50),g()(u()(r),"alertError",null),g()(u()(r),"defaultAlert",!0),g()(u()(r),"dataController",null),g()(u()(r),"demuxer",null),g()(u()(r),"decoder",null),g()(u()(r),"preload",!0),g()(u()(r),"startTime",0),g()(u()(r),"screenWidth",null),g()(u()(r),"screenHeight",null),g()(u()(r),"options",{}),Fi.set(u()(r),{writable:!0,value:N.c.libPath}),g()(u()(r),"readyStatus",{dataProcessor:!1,firstData:!1,audioPlayer:!1}),g()(u()(r),"reseting",!1),Mi.set(u()(r),{writable:!0,value:0}),Ui.set(u()(r),{writable:!0,value:!1}),ji.set(u()(r),{writable:!0,value:1}),Hi.set(u()(r),{writable:!0,value:!1}),g()(u()(r),"maxBufferLength",N.d.MAXBUFFERLENGTH),g()(u()(r),"seekSegmentNo",-1),g()(u()(r),"status","init"),g()(u()(r),"loader",null),g()(u()(r),"currentIndex",null),g()(u()(r),"startIndex",1),g()(u()(r),"loadData",null),g()(u()(r),"paused",!0),g()(u()(r),"autoPlay",!0),g()(u()(r),"duration",0),g()(u()(r),"tsNumber",0),t||r.logger.error("Please pass in a dom object as the display container"),r.el=t,Object.assign(r.options,o),r.options.sourceURL=r.options.sourceURL||r.options.source,r.options.streamList=r.options.streamList||[],r.options.events=Object(k.a)(),r.maxBufferLength=void 0!==o.maxBufferLength?o.maxBufferLength:r.maxBufferLength,r.autoPlay=void 0!==o.autoPlay?o.autoPlay:r.autoPlay,r.controlBar=o.controlBar||r.controlBar,r.controlBarAutoHide=void 0!==o.controlBarAutoHide?o.controlBarAutoHide:r.controlBarAutoHide,E()(u()(r),Fi,void 0!==o.libPath?o.libPath:_()(u()(r),Fi)),r.preload=void 0===o.preload?r.preload:o.preload,r.startTime=void 0===o.startTime?r.startTime:o.startTime,r.originStartTime=r.startTime,r.playbackRate=void 0===o.playbackRate?r.playbackRate:o.playbackRate,r.defaultAlert=null==o.defaultAlert?r.defaultAlert:o.defaultAlert,null!=o.muted&&(r.muted=o.muted),null==r.options.codec&&(r.options.codec=1),r}return a()(n,[{key:"setAlertError",value:function(){this.options.alertError=this.alertError=I.getInstance({player:this,component:this.componentsController.alertBox,events:this.options.events})}},{key:"setDataController",value:function(){this.dataController=Ct.getInstance({player:this,events:this.options.events})}},{key:"setLoadData",value:function(){this.dataController.setLoadData({player:this,events:this.options.events}),this.loadData=this.dataController.loadData}},{key:"setComponentsController",value:function(){this.componentsController=ii.getInstance({$container:this.$container,$screenContainer:this.$screenContainer,$canvas:this.$canvas,$audioContainer:this.$audioContainer,$audio:this.$audio,loadData:this.loadData,bigPlayButtonColor:this.bigPlayButtonColor,player:this,events:this.options.events})}},{key:"setControlBarController",value:function(){var t=Object.assign({},this.options,{$container:this.$container,$screenContainer:this.$screenContainer,controlBar:this.controlBar,controlBarAutoHide:this.controlBarAutoHide,player:this});this.controlBarController=si.getInstance(t)}},{key:"setLoadController",value:function(){this.loaderController=Pt.getInstance(this.options.type,{player:this,events:this.options.events})}},{key:"setProcessorController",value:function(){this.processController=new hi({type:"ts",codec:this.options.codec,libPath:_()(this,Fi),events:this.options.events,player:this})}},{key:"setStreamController",value:function(){this.streamController=new gi({events:this.options.events,loadData:this.loadData,imagePlayer:this.imagePlayer,audioPlayer:this.audioPlayer,player:this})}},{key:"setImagerPlayer",value:function(){this.imagePlayer=new Ii({events:this.options.events,canvas:this.$canvas,maxBufferLength:this.maxBufferLength,player:this})}},{key:"setAudioPlayer",value:function(){this.audioPlayer=new We({player:this,events:this.options.events,audioNode:this.$audio})}},{key:"setAction",value:function(){this.action=new Ut({player:this,screen:this.screen,imagePlayer:this.imagePlayer,loadData:this.loadData,audioPlayer:this.audioPlayer,events:this.options.events})}},{key:"init",value:function(){this.controlBarHeight=this.options.controlBarHeight||this.controlBarHeight,this.options.httpWorker=ci()(102,{name:"httpWorker"}),this.currentTime=1e3*this.startTime,this.addEl(),this.setDataController(),this.setLoadData(),this.setLoadController(),this.setComponentsController(),this.setControlBarController(),this.componentsController.setControlBarController(this.controlBarController),this.setProcessorController(),this.setAlertError(),this.componentsController.drawPoster(),this.setImagerPlayer(),this.setAudioPlayer(),this.setAction(),this.setStreamController(),this.preload&&this.run(),this.bindEvent()}},{key:"bindEvent",value:function(){var t=this;this.events.on(ot.default.PlayerOnPlay,(function(){t.play()})),this.events.on(ot.default.PlayerOnPause,(function(){t.pause()})),this.events.on(ot.default.PlayerOnVolume,(function(e){t.volume=e})),this.events.on(ot.default.DataProcessorReady,(function(){t.logger.info("bindEvent","decoder ready"),t.checkReady("dataProcessor")})),this.events.on(ot.default.AudioPlayerReady,(function(){t.logger.info("bindEvent","audioPlayer ready"),t.seeking||t.checkReady("audioPlayer")})),this.events.on(ot.default.PlayerReady,(function(){t.logger.info("bindEvent","player ready"),t.onReady()})),this.events.on(ot.default.PlayerSpeedTo,(function(e){t.changeSpeed(e)})),this.events.on(ot.default.PlayerChangeRate,(function(e){t.changeRate(e)})),this.events.on(ot.default.PlayerWait,(function(){t.onWait()})),this.events.on(ot.default.PlayerPlay,(function(){t.onPlay()})),this.events.on(ot.default.LoaderPlayListLoaded,(function(e){"function"==typeof t.options.afterLoadPlaylist&&t.options.afterLoadPlaylist(t.loadData.sourceData);var n=e.exeLoader.segmentPool;t.duration=n.reduce((function(t,e){return t+e.duration}),0),t.tsNumber=n.length,t.streamController.setBaseInfo({duration:t.duration,tsNumber:t.tsNumber}),null==t.imagePlayer.imageData.offset&&(t.dataController.startLoad(t.startTime),t.currentTime=1e3*t.startTime)})),this.events.on(ot.default.LoadDataFirstLoaded,(function(e){t.logger.info("bindEvent","first data ready"),t.startIndex=e.no,t.streamController.currentIndex=e.no,t.checkReady("firstData")})),this.events.on(ot.default.StreamDataReady,(function(){t.logger.info("bindEvent","dataReady"),t.onDataReady()})),this.events.on(ot.default.PlayerLoadedMetaData,(function(e,n){t.setCanvas(),t.dims={width:e,height:n},t.options.autoScale&&t.resizeScreen(e,n),t.$canvas.style.display="inline-block"})),this.events.on(ot.default.PlayerEnd,(function(){t.status="end"})),this.events.on(ot.default.ImagePlayerBuffeUpdate,(function(){clearTimeout(Ni),Ni=setTimeout((function(){var e=t.buffer(),n=m()(e,2),r=n[0],i=n[1];t.events.emit(ot.default.PlayerbufferUpdate,[r/1e3,i/1e3])}),100)})),this.events.on(ot.default.PlayerOnSeek,(function(e){t.seek(Math.floor(e))})),this.events.on(ot.default.PlayerAlert,(function(e){t.defaultAlert&&t.alertError.show(e)})),this.events.on(ot.default.PlayerThrowError,(function(e){O.a.apply(t,e)})),this.events.on(ot.default.PlayerTimeUpdate,(function(e){t.options.onTimeupdate&&t.options.onTimeupdate(e)})),this.events.on(ot.default.DemuxCodecError,(function(){t.processController.options.codec=1===t.options.codec?0:1,t.changeSrc(t.options.sourceURL)})),this.events.on(ot.default.PlayerSeekEnd,(function(){t.events.emit(ot.default.PlayerTimeUpdate,t.currentTime)})),this.options.isLive&&(this.onVisibilityChange=function(){if(document.hidden);else{var e=t.loadData.segmentPool.getLast(),n=e.start,r=1e3*(n-15*e.duration);r>0&&t.currentTime<r&&t.seek(1e3*n)}},document.addEventListener("visibilitychange",this.onVisibilityChange))}},{key:"reset",value:function(t,e){this.startPts=null,this.action&&this.action.reset(t,e)}},{key:"switchPlaylist",value:function(t,e){this.loaderController.switchPlaylist(t,e)}},{key:"changeSpeed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.playbackRate=t.value||1}},{key:"setStartTime",value:function(t){this.startTime=t}},{key:"changeRate",value:function(t){this.pause(),this.events.emit(ot.default.ControlBarPauseLoading,this),this.setStartTime((this.currentTime-5e3)/1e3),this.changing=!0,this.seeking=!1,this.imagePlayer.firstRender=!1,this.readyStatus={dataProcessor:!1,firstData:!1,audioPlayer:!1},this.reset(!0),this.switchPlaylist(t.url)}},{key:"changeSrc",value:function(t,e){this.pause(),this.events.emit(ot.default.ControlBarPauseLoading,this),this.events.emit(ot.default.PlayerChangeSrc,this),this.changing=!0,this.seeking=!1,this.imagePlayer.firstRender=!1,this.readyStatus={dataProcessor:!1,firstData:!1,audioPlayer:!1},this.currentTime=1e3*this.startTime,this.imagePlayer.clear(),this.reset(!0),this.switchPlaylist(t,e)}},{key:"setCanvas",value:function(){var t=Ye.createCanvas(this);if(R.isElement(this.$canvas)){if(this.$canvas.width&&this.$canvas.height)return this.imagePlayer.setScreenRender(t),this.$canvas.replaceWith(t),void(this.$canvas=t)}else this.$screen.appendChild(t),this.$canvas=t}},{key:"destroy",value:function(){"playing"===this.status&&this.pause(),this.reset(!0,!0),this.$canvas.remove(),this.$audio.remove(),this.controlBarController&&(this.controlBarController.destroy(),delete this.controlBarController),this.$container&&(this.el.removeChild(this.$container),delete this.$container),this.processController.destroy(),this.loaderController.destroy(),this.options.isLive&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}},{key:"run",value:function(){this.loaderController.run()}},{key:"checkReady",value:function(t){var e=this.readyStatus;if(t&&"string"==typeof t){e[t]=!0;for(var n=Object.keys(e),r=0;r<n.length;r++)if(!e[n[r]])return!1;return this.logger.info("checkReady","player ready"),this.events.emit(ot.default.PlayerReady),!0}return this.logger.error("checkReady","check ready","type is no correct, type:",t),!1}},{key:"addEl",value:function(){var t,e,n,r;this.el?(t=Ye.createContainer(this),this.el.appendChild(t),this.$container=t,e=Ye.createScreenContainer(this),this.$screen=e,t.appendChild(e),this.$screenContainer=e,this.setCanvas(),r=Ye.createAudio(this),this.$audio=r,(n=Ye.createAudioContainer(this)).appendChild(r),this.$audioContainer=n,t.appendChild(n)):this.logger.error("addEl","not found el.","el:",this.options.el)}},{key:"onWait",value:function(){this.logger.info("onWait","wait,wait,wait")}},{key:"onPlay",value:function(){this.logger.info("onPlay","play, play, play")}},{key:"onReady",value:function(){this.changing||this.componentsController.run(),this.changing&&this.logger.info("onReady","change ready","startIndex:",this.startIndex),this.seeking||this.streamController.startLoad(this.startIndex)}},{key:"onDataReady",value:function(){"playing"===this.statusBeforeSeek||this.autoPlay&&this.paused||"playing"===this.statusBeforeWait&&"wait"===this.status&&"wait"!==this.imagePlayer.status&&"wait"!==this.audioPlayer.status?"playing"!==this.status&&this.play():"playing"!==this.status&&this.events.emit(ot.default.ControlBarPause)}},{key:"buffer",value:function(){var t=this.imagePlayer.buffer();return[t.start,t.end]}},{key:"play",value:function(){var t=this;this.seeking||this.reseting||(clearTimeout(Ci),Ci=setTimeout((function(){t.logger.info("play",t.status),("playing"!==t.status||t.audioPlayer.need&&"playing"!==t.audioPlayer.status)&&(t.logger.info("start play"),t.status="playing",t.paused=!1,t.action.play(t.currentTime),t.events.emit(ot.default.PlayerPlay,t))}),500))}},{key:"on",value:function(t,e){this.events.on("Player."+t,e)}},{key:"off",value:function(t,e){this.events.off("Player."+t,e)}},{key:"once",value:function(t,e){this.events.once("Player."+t,e)}},{key:"pause",value:function(){"pause"!=this.status&&(this.logger.info("pause"),this.status="pause",this.action.pause(),this.paused=!0,this.events.emit(ot.default.PlayerPause,this))}},{key:"seek",value:function(t){t<1e3*this.startTime||(t>=1e3*this.duration?this.logger.info("seek","seek to time:",t):(this.statusBeforeSeek=this.status,this.seekTime=Date.now(),this.seeking=!0,this.currentTime=t,this.action.seek(t)))}},{key:"fullScreen",value:function(){this.componentsController.fullScreen.saveOriginPosition(),G.Fullscreen(this.$container)}},{key:"exitFullScreen",value:function(){this.componentsController.fullScreen.saveOriginPosition(),G.exitFullscreen()}},{key:"muted",get:function(){return _()(this,Hi)},set:function(t){E()(this,Hi,!!t)}},{key:"playbackRate",get:function(){return _()(this,ji)},set:function(t){var e=this;E()(this,ji,t),"playing"===this.status&&(this.pause(),this.events.emit(ot.default.ControlBarPauseLoading),setTimeout((function(){e.play()}),200))}},{key:"seeking",get:function(){return _()(this,Ui)},set:function(t){E()(this,Ui,t),t?this.events.emit(ot.default.PlayerSeeking):this.events.emit(ot.default.PlayerSeekEnd)}},{key:"currentTime",get:function(){return _()(this,Mi)},set:function(t){E()(this,Mi,t)}},{key:"volume",get:function(){return this.audioPlayer.volume},set:function(t){this.audioPlayer.volume=t}},{key:"resize",value:function(t,e){this.$container.style.width=t+"px",this.$container.style.height=e+"px";var n=Ye.createScreenContainer(this);if(this.$screenContainer.style.width=n.style.width,this.$screenContainer.style.height=n.style.height,n.remove(),this.options.autoScale){if(this.dims){var r=this.dims,i=r.width,o=r.height;this.resizeScreen(i,o)}}else this.imagePlayer.resetScreen()}},{key:"resizeScreen",value:function(t,e){R.adaptSizeElement(t,e,this.$screenContainer,this.$canvas)}}]),n}(C.a);n(103);function Wi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d()(t);if(e){var i=d()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var Vi=function(t){l()(n,t);var e=Wi(n);function n(t,r){var o;return i()(this,n),o=e.call(this,t,r),g()(u()(o),"libPath",null),o.options.processURL=r.processURL,o.libPath=r.libPath,!1!==o.options.needInit&&o.init(),o}return a()(n,null,[{key:"getComponent",value:function(t){return Jr[t]}},{key:"registerComponent",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;if("string"!=typeof t||!t)throw new Error('Illegal component name, "'.concat(t,'"; must be a non-empty string.'));var i=Object.prototype.isPrototypeOf.call(dn,e.prototype);if(!i)throw new Error('Illegal component, "'.concat(t,'"; must be a BaseComponent subclass.'));Jr[t]=e,ii.addComponet(t),"left"===n?Kr.addCustomControl(t,r):qr.addCustomControl(t,r)}}]),n}(zi);e.default=Vi},8:function(t,e){t.exports=function(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))},t.exports.default=t.exports,t.exports.__esModule=!0},83:function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0},84:function(t,e){t.exports=function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},t.exports.default=t.exports,t.exports.__esModule=!0},85:function(t,e,n){var r=n(86);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},86:function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.default=t.exports,t.exports.__esModule=!0},87:function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},88:function(t,e){t.exports=function(t,e){return e.get?e.get.call(t):e.value},t.exports.default=t.exports,t.exports.__esModule=!0},89:function(t,e){t.exports=function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}},t.exports.default=t.exports,t.exports.__esModule=!0},9:function(t,e,n){"use strict";var r=n(3),i=n.n(r),o=n(5),a=n.n(o),s=n(0),u=n.n(s),c=n(13),l=n(27),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t),u()(this,"logger",null),this.options=e,this.debug=e.debug||!1,this.setLogger(this.constructor.name+".js")}return a()(t,[{key:"setLogger",value:function(t){this.logger=new c.a(t)}},{key:"getLogger",value:function(){return this.logger}},{key:"setOptions",value:function(t){Object.assign(this.options,t)}},{key:"events",get:function(){return this.options&&this.options.events?this.options.events(this):Object(l.a)(this)}},{key:"alert",get:function(){var t="";return this.options&&this.options.alertError&&(t=this.options.alertError),t}},{key:"toString",value:function(){return JSON.stringify(this)}}]),t}();e.a=f},90:function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0},91:function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")},t.exports.default=t.exports,t.exports.__esModule=!0},92:function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},n(93),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(44))},93:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,o,a,s,u=1,c={},l=!1,f=t.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(t);h=h&&h.setTimeout?h:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick((function(){d(t)}))}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){o.port2.postMessage(t)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(t){var e=f.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)}:(a="setImmediate$"+Math.random()+"$",s=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(a)&&d(+e.data.slice(a.length))},t.addEventListener?t.addEventListener("message",s,!1):t.attachEvent("onmessage",s),r=function(e){t.postMessage(a+e,"*")}),h.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return c[u]=i,r(u),u++},h.clearImmediate=p}function p(t){delete c[t]}function d(t){if(l)setTimeout(d,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(void 0,n)}}(e)}finally{p(t),l=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(44),n(94))},94:function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var t=s(h);l=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},95:function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var i=e&&e.prototype instanceof g?e:g,o=Object.create(i.prototype),a=new R(r||[]);return o._invoke=function(t,e,n){var r=f;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw o;return A()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=x(a,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var u=l(t,e,n);if("normal"===u.type){if(r=n.done?d:h,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f="suspendedStart",h="suspendedYield",p="executing",d="completed",y={};function g(){}function v(){}function m(){}var b={};b[o]=function(){return this};var _=Object.getPrototypeOf,w=_&&_(_(L([])));w&&w!==n&&r.call(w,o)&&(b=w);var E=m.prototype=g.prototype=Object.create(b);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,o,a,s){var u=l(t[i],t,o);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var i;this._invoke=function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}}function x(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function L(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:A}}function A(){return{value:e,done:!0}}return v.prototype=E.constructor=m,m.constructor=v,v.displayName=u(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,u(t,s,"GeneratorFunction")),t.prototype=Object.create(E),t},t.awrap=function(t){return{__await:t}},k(S.prototype),S.prototype[a]=function(){return this},t.AsyncIterator=S,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new S(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(E),u(E,s,"Generator"),E[o]=function(){return this},E.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=L,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;P(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:L(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},96:function(t,e,n){(function(e){t.exports=e.BFSRequire("fs")}).call(this,n(43))},97:function(t,e,n){!function(){"use strict";var e=n(45),r=n(98);function i(t){var e=this,n=t.getContext("2d"),i=null,o=null,a=null;return e.drawFrame=function(e){var s=e.format;t.width===s.displayWidth&&t.height===s.displayHeight||(t.width=s.displayWidth,t.height=s.displayHeight),null!==i&&i.width==s.width&&i.height==s.height||function(t,e){for(var r=(i=n.createImageData(t,e)).data,o=t*e*4,a=0;a<o;a+=4)r[a+3]=255}(s.width,s.height),r.convertYCbCr(e,i.data);var u,c,l,f=s.cropWidth!=s.displayWidth||s.cropHeight!=s.displayHeight;f?(o||(c=s.cropWidth,l=s.cropHeight,(o=document.createElement("canvas")).width=c,o.height=l,a=o.getContext("2d")),u=a):u=n,u.putImageData(i,-s.cropLeft,-s.cropTop,s.cropLeft,s.cropTop,s.cropWidth,s.cropHeight),f&&n.drawImage(o,0,0,s.displayWidth,s.displayHeight)},e.clear=function(){n.clearRect(0,0,t.width,t.height)},e}i.prototype=Object.create(e.prototype),t.exports=i}()},98:function(t,e,n){!function(){"use strict";var e=n(99);t.exports={convertYCbCr:function(t,n){var r=0|t.format.width,i=0|t.format.height,o=0|e(t.format.width/t.format.chromaWidth),a=0|e(t.format.height/t.format.chromaHeight),s=t.y.bytes,u=t.u.bytes,c=t.v.bytes,l=0|t.y.stride,f=0|t.u.stride,h=0|t.v.stride,p=r<<2,d=0,y=0,g=0,v=0,m=0,b=0,_=0,w=0,E=0,k=0,S=0,x=0,T=0,P=0,R=0,L=0,A=0,B=0;if(1==o&&1==a)for(_=0,w=p,B=0,L=0;L<i;L+=2){for(g=(y=L*l|0)+l|0,v=B*f|0,m=B*h|0,R=0;R<r;R+=2)E=0|u[v++],x=(409*(k=0|c[m++])|0)-57088|0,T=(100*E|0)+(208*k|0)-34816|0,P=(516*E|0)-70912|0,S=298*s[y++]|0,n[_]=S+x>>8,n[_+1]=S-T>>8,n[_+2]=S+P>>8,_+=4,S=298*s[y++]|0,n[_]=S+x>>8,n[_+1]=S-T>>8,n[_+2]=S+P>>8,_+=4,S=298*s[g++]|0,n[w]=S+x>>8,n[w+1]=S-T>>8,n[w+2]=S+P>>8,w+=4,S=298*s[g++]|0,n[w]=S+x>>8,n[w+1]=S-T>>8,n[w+2]=S+P>>8,w+=4;_+=p,w+=p,B++}else for(b=0,L=0;L<i;L++)for(A=0,d=L*l|0,v=(B=L>>a)*f|0,m=B*h|0,R=0;R<r;R++)E=0|u[v+(A=R>>o)],x=(409*(k=0|c[m+A])|0)-57088|0,T=(100*E|0)+(208*k|0)-34816|0,P=(516*E|0)-70912|0,S=298*s[d++]|0,n[b]=S+x>>8,n[b+1]=S-T>>8,n[b+2]=S+P>>8,b+=4}}}()},99:function(t,e){!function(){"use strict";t.exports=function(t){for(var e=0,n=t>>1;0!=n;)n>>=1,e++;if(t!==1<<e)throw"chroma plane dimensions must be power of 2 ratio to luma plane dimensions; got "+t;return e}}()}})}));